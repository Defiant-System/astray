if(Number.EPSILON===undefined){Number.EPSILON=Math.pow(2,-52)}if(Number.isInteger===undefined){Number.isInteger=function(e){return typeof e==="number"&&isFinite(e)&&Math.floor(e)===e}}if(Math.sign===undefined){Math.sign=function(e){return e<0?-1:e>0?1:+e}}if("name"in Function.prototype===false){Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}})}if(Object.assign===undefined){Object.assign=function(e){if(e===undefined||e===null){throw new TypeError("Cannot convert undefined or null to object")}var t=Object(e);for(var i=1;i<arguments.length;i++){var r=arguments[i];if(r!==undefined&&r!==null){for(var n in r){if(Object.prototype.hasOwnProperty.call(r,n)){t[n]=r[n]}}}}return t}}var REVISION="116";var MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2};var TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3};var CullFaceNone=0;var CullFaceBack=1;var CullFaceFront=2;var CullFaceFrontBack=3;var FrontFaceDirectionCW=0;var FrontFaceDirectionCCW=1;var BasicShadowMap=0;var PCFShadowMap=1;var PCFSoftShadowMap=2;var VSMShadowMap=3;var FrontSide=0;var BackSide=1;var DoubleSide=2;var FlatShading=1;var SmoothShading=2;var NoBlending=0;var NormalBlending=1;var AdditiveBlending=2;var SubtractiveBlending=3;var MultiplyBlending=4;var CustomBlending=5;var AddEquation=100;var SubtractEquation=101;var ReverseSubtractEquation=102;var MinEquation=103;var MaxEquation=104;var ZeroFactor=200;var OneFactor=201;var SrcColorFactor=202;var OneMinusSrcColorFactor=203;var SrcAlphaFactor=204;var OneMinusSrcAlphaFactor=205;var DstAlphaFactor=206;var OneMinusDstAlphaFactor=207;var DstColorFactor=208;var OneMinusDstColorFactor=209;var SrcAlphaSaturateFactor=210;var NeverDepth=0;var AlwaysDepth=1;var LessDepth=2;var LessEqualDepth=3;var EqualDepth=4;var GreaterEqualDepth=5;var GreaterDepth=6;var NotEqualDepth=7;var MultiplyOperation=0;var MixOperation=1;var AddOperation=2;var NoToneMapping=0;var LinearToneMapping=1;var ReinhardToneMapping=2;var Uncharted2ToneMapping=3;var CineonToneMapping=4;var ACESFilmicToneMapping=5;var UVMapping=300;var CubeReflectionMapping=301;var CubeRefractionMapping=302;var EquirectangularReflectionMapping=303;var EquirectangularRefractionMapping=304;var SphericalReflectionMapping=305;var CubeUVReflectionMapping=306;var CubeUVRefractionMapping=307;var RepeatWrapping=1e3;var ClampToEdgeWrapping=1001;var MirroredRepeatWrapping=1002;var NearestFilter=1003;var NearestMipmapNearestFilter=1004;var NearestMipMapNearestFilter=1004;var NearestMipmapLinearFilter=1005;var NearestMipMapLinearFilter=1005;var LinearFilter=1006;var LinearMipmapNearestFilter=1007;var LinearMipMapNearestFilter=1007;var LinearMipmapLinearFilter=1008;var LinearMipMapLinearFilter=1008;var UnsignedByteType=1009;var ByteType=1010;var ShortType=1011;var UnsignedShortType=1012;var IntType=1013;var UnsignedIntType=1014;var FloatType=1015;var HalfFloatType=1016;var UnsignedShort4444Type=1017;var UnsignedShort5551Type=1018;var UnsignedShort565Type=1019;var UnsignedInt248Type=1020;var AlphaFormat=1021;var RGBFormat=1022;var RGBAFormat=1023;var LuminanceFormat=1024;var LuminanceAlphaFormat=1025;var RGBEFormat=RGBAFormat;var DepthFormat=1026;var DepthStencilFormat=1027;var RedFormat=1028;var RedIntegerFormat=1029;var RGFormat=1030;var RGIntegerFormat=1031;var RGBIntegerFormat=1032;var RGBAIntegerFormat=1033;var RGB_S3TC_DXT1_Format=33776;var RGBA_S3TC_DXT1_Format=33777;var RGBA_S3TC_DXT3_Format=33778;var RGBA_S3TC_DXT5_Format=33779;var RGB_PVRTC_4BPPV1_Format=35840;var RGB_PVRTC_2BPPV1_Format=35841;var RGBA_PVRTC_4BPPV1_Format=35842;var RGBA_PVRTC_2BPPV1_Format=35843;var RGB_ETC1_Format=36196;var RGB_ETC2_Format=37492;var RGBA_ETC2_EAC_Format=37496;var RGBA_ASTC_4x4_Format=37808;var RGBA_ASTC_5x4_Format=37809;var RGBA_ASTC_5x5_Format=37810;var RGBA_ASTC_6x5_Format=37811;var RGBA_ASTC_6x6_Format=37812;var RGBA_ASTC_8x5_Format=37813;var RGBA_ASTC_8x6_Format=37814;var RGBA_ASTC_8x8_Format=37815;var RGBA_ASTC_10x5_Format=37816;var RGBA_ASTC_10x6_Format=37817;var RGBA_ASTC_10x8_Format=37818;var RGBA_ASTC_10x10_Format=37819;var RGBA_ASTC_12x10_Format=37820;var RGBA_ASTC_12x12_Format=37821;var RGBA_BPTC_Format=36492;var SRGB8_ALPHA8_ASTC_4x4_Format=37840;var SRGB8_ALPHA8_ASTC_5x4_Format=37841;var SRGB8_ALPHA8_ASTC_5x5_Format=37842;var SRGB8_ALPHA8_ASTC_6x5_Format=37843;var SRGB8_ALPHA8_ASTC_6x6_Format=37844;var SRGB8_ALPHA8_ASTC_8x5_Format=37845;var SRGB8_ALPHA8_ASTC_8x6_Format=37846;var SRGB8_ALPHA8_ASTC_8x8_Format=37847;var SRGB8_ALPHA8_ASTC_10x5_Format=37848;var SRGB8_ALPHA8_ASTC_10x6_Format=37849;var SRGB8_ALPHA8_ASTC_10x8_Format=37850;var SRGB8_ALPHA8_ASTC_10x10_Format=37851;var SRGB8_ALPHA8_ASTC_12x10_Format=37852;var SRGB8_ALPHA8_ASTC_12x12_Format=37853;var LoopOnce=2200;var LoopRepeat=2201;var LoopPingPong=2202;var InterpolateDiscrete=2300;var InterpolateLinear=2301;var InterpolateSmooth=2302;var ZeroCurvatureEnding=2400;var ZeroSlopeEnding=2401;var WrapAroundEnding=2402;var NormalAnimationBlendMode=2500;var AdditiveAnimationBlendMode=2501;var TrianglesDrawMode=0;var TriangleStripDrawMode=1;var TriangleFanDrawMode=2;var LinearEncoding=3e3;var sRGBEncoding=3001;var GammaEncoding=3007;var RGBEEncoding=3002;var LogLuvEncoding=3003;var RGBM7Encoding=3004;var RGBM16Encoding=3005;var RGBDEncoding=3006;var BasicDepthPacking=3200;var RGBADepthPacking=3201;var TangentSpaceNormalMap=0;var ObjectSpaceNormalMap=1;var ZeroStencilOp=0;var KeepStencilOp=7680;var ReplaceStencilOp=7681;var IncrementStencilOp=7682;var DecrementStencilOp=7683;var IncrementWrapStencilOp=34055;var DecrementWrapStencilOp=34056;var InvertStencilOp=5386;var NeverStencilFunc=512;var LessStencilFunc=513;var EqualStencilFunc=514;var LessEqualStencilFunc=515;var GreaterStencilFunc=516;var NotEqualStencilFunc=517;var GreaterEqualStencilFunc=518;var AlwaysStencilFunc=519;var StaticDrawUsage=35044;var DynamicDrawUsage=35048;var StreamDrawUsage=35040;var StaticReadUsage=35045;var DynamicReadUsage=35049;var StreamReadUsage=35041;var StaticCopyUsage=35046;var DynamicCopyUsage=35050;var StreamCopyUsage=35042;function EventDispatcher(){}Object.assign(EventDispatcher.prototype,{addEventListener:function(e,t){if(this._listeners===undefined)this._listeners={};var i=this._listeners;if(i[e]===undefined){i[e]=[]}if(i[e].indexOf(t)===-1){i[e].push(t)}},hasEventListener:function(e,t){if(this._listeners===undefined)return false;var i=this._listeners;return i[e]!==undefined&&i[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(this._listeners===undefined)return;var i=this._listeners;var r=i[e];if(r!==undefined){var n=r.indexOf(t);if(n!==-1){r.splice(n,1)}}},dispatchEvent:function(e){if(this._listeners===undefined)return;var t=this._listeners;var i=t[e.type];if(i!==undefined){e.target=this;var r=i.slice(0);for(var n=0,a=r.length;n<a;n++){r[n].call(this,e)}}}});var _lut=[];for(var i=0;i<256;i++){_lut[i]=(i<16?"0":"")+i.toString(16)}var MathUtils={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=Math.random()*4294967295|0;var t=Math.random()*4294967295|0;var i=Math.random()*4294967295|0;var r=Math.random()*4294967295|0;var n=_lut[e&255]+_lut[e>>8&255]+_lut[e>>16&255]+_lut[e>>24&255]+"-"+_lut[t&255]+_lut[t>>8&255]+"-"+_lut[t>>16&15|64]+_lut[t>>24&255]+"-"+_lut[i&63|128]+_lut[i>>8&255]+"-"+_lut[i>>16&255]+_lut[i>>24&255]+_lut[r&255]+_lut[r>>8&255]+_lut[r>>16&255]+_lut[r>>24&255];return n.toUpperCase()},clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){if(e<=t)return 0;if(e>=i)return 1;e=(e-t)/(i-t);return e*e*(3-2*e)},smootherstep:function(e,t,i){if(e<=t)return 0;if(e>=i)return 1;e=(e-t)/(i-t);return e*e*e*(e*(e*6-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*MathUtils.DEG2RAD},radToDeg:function(e){return e*MathUtils.RAD2DEG},isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,i,r,n){var a=Math.cos;var o=Math.sin;var s=a(i/2);var l=o(i/2);var c=a((t+r)/2);var u=o((t+r)/2);var h=a((t-r)/2);var p=o((t-r)/2);var m=a((r-t)/2);var f=o((r-t)/2);switch(n){case"XYX":e.set(s*u,l*h,l*p,s*c);break;case"YZY":e.set(l*p,s*u,l*h,s*c);break;case"ZXZ":e.set(l*h,l*p,s*u,s*c);break;case"XZX":e.set(s*u,l*f,l*m,s*c);break;case"YXY":e.set(l*m,s*u,l*f,s*c);break;case"ZYZ":e.set(l*f,l*m,s*u,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}};function Vector2(e,t){this.x=e||0;this.y=t||0}Object.defineProperties(Vector2.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}});Object.assign(Vector2.prototype,{isVector2:true,set:function(e,t){this.x=e;this.y=t;return this},setScalar:function(e){this.x=e;this.y=e;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){this.x=e.x;this.y=e.y;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;return this},addScalar:function(e){this.x+=e;this.y+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this},addScaledVector:function(e,t){this.x+=e.x*t;this.y+=e.y*t;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;return this},subScalar:function(e){this.x-=e;this.y-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this},multiply:function(e){this.x*=e.x;this.y*=e.y;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;return this},divide:function(e){this.x/=e.x;this.y/=e.y;return this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,i=this.y;var r=e.elements;this.x=r[0]*t+r[3]*i+r[6];this.y=r[1]*t+r[4]*i+r[7];return this},min:function(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);return this},max:function(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);return this},clamp:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));return this},clampScalar:function(e,t){this.x=Math.max(e,Math.min(t,this.x));this.y=Math.max(e,Math.min(t,this.y));return this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;return this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;return e},fromBufferAttribute:function(e,t,i){if(i!==undefined){console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute().")}this.x=e.getX(t);this.y=e.getY(t);return this},rotateAround:function(e,t){var i=Math.cos(t),r=Math.sin(t);var n=this.x-e.x;var a=this.y-e.y;this.x=n*i-a*r+e.x;this.y=n*r+a*i+e.y;return this},random:function(){this.x=Math.random();this.y=Math.random();return this}});function Matrix3(){this.elements=[1,0,0,0,1,0,0,0,1];if(arguments.length>0){console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}}Object.assign(Matrix3.prototype,{isMatrix3:true,set:function(e,t,i,r,n,a,o,s,l){var c=this.elements;c[0]=e;c[1]=r;c[2]=o;c[3]=t;c[4]=n;c[5]=s;c[6]=i;c[7]=a;c[8]=l;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements;var i=e.elements;t[0]=i[0];t[1]=i[1];t[2]=i[2];t[3]=i[3];t[4]=i[4];t[5]=i[5];t[6]=i[6];t[7]=i[7];t[8]=i[8];return this},extractBasis:function(e,t,i){e.setFromMatrix3Column(this,0);t.setFromMatrix3Column(this,1);i.setFromMatrix3Column(this,2);return this},setFromMatrix4:function(e){var t=e.elements;this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]);return this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements;var r=t.elements;var n=this.elements;var a=i[0],o=i[3],s=i[6];var l=i[1],c=i[4],u=i[7];var h=i[2],p=i[5],m=i[8];var f=r[0],d=r[3],_=r[6];var y=r[1],v=r[4],g=r[7];var x=r[2],b=r[5],M=r[8];n[0]=a*f+o*y+s*x;n[3]=a*d+o*v+s*b;n[6]=a*_+o*g+s*M;n[1]=l*f+c*y+u*x;n[4]=l*d+c*v+u*b;n[7]=l*_+c*g+u*M;n[2]=h*f+p*y+m*x;n[5]=h*d+p*v+m*b;n[8]=h*_+p*g+m*M;return this},multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[3]*=e;t[6]*=e;t[1]*=e;t[4]*=e;t[7]*=e;t[2]*=e;t[5]*=e;t[8]*=e;return this},determinant:function(){var e=this.elements;var t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-i*n*c+i*o*s+r*n*l-r*a*s},getInverse:function(e,t){if(t!==undefined){console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.")}var i=e.elements,r=this.elements,n=i[0],a=i[1],o=i[2],s=i[3],l=i[4],c=i[5],u=i[6],h=i[7],p=i[8],m=p*l-c*h,f=c*u-p*s,d=h*s-l*u,_=n*m+a*f+o*d;if(_===0)return this.set(0,0,0,0,0,0,0,0,0);var y=1/_;r[0]=m*y;r[1]=(o*h-p*a)*y;r[2]=(c*a-o*l)*y;r[3]=f*y;r[4]=(p*n-o*u)*y;r[5]=(o*s-c*n)*y;r[6]=d*y;r[7]=(a*u-h*n)*y;r[8]=(l*n-a*s)*y;return this},transpose:function(){var e,t=this.elements;e=t[1];t[1]=t[3];t[3]=e;e=t[2];t[2]=t[6];t[6]=e;e=t[5];t[5]=t[7];t[7]=e;return this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8];return this},setUvTransform:function(e,t,i,r,n,a,o){var s=Math.cos(n);var l=Math.sin(n);this.set(i*s,i*l,-i*(s*a+l*o)+a+e,-r*l,r*s,-r*(-l*a+s*o)+o+t,0,0,1)},scale:function(e,t){var i=this.elements;i[0]*=e;i[3]*=e;i[6]*=e;i[1]*=t;i[4]*=t;i[7]*=t;return this},rotate:function(e){var t=Math.cos(e);var i=Math.sin(e);var r=this.elements;var n=r[0],a=r[3],o=r[6];var s=r[1],l=r[4],c=r[7];r[0]=t*n+i*s;r[3]=t*a+i*l;r[6]=t*o+i*c;r[1]=-i*n+t*s;r[4]=-i*a+t*l;r[7]=-i*o+t*c;return this},translate:function(e,t){var i=this.elements;i[0]+=e*i[2];i[3]+=e*i[5];i[6]+=e*i[8];i[1]+=t*i[2];i[4]+=t*i[5];i[7]+=t*i[8];return this},equals:function(e){var t=this.elements;var i=e.elements;for(var r=0;r<9;r++){if(t[r]!==i[r])return false}return true},fromArray:function(e,t){if(t===undefined)t=0;for(var i=0;i<9;i++){this.elements[i]=e[i+t]}return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;var i=this.elements;e[t]=i[0];e[t+1]=i[1];e[t+2]=i[2];e[t+3]=i[3];e[t+4]=i[4];e[t+5]=i[5];e[t+6]=i[6];e[t+7]=i[7];e[t+8]=i[8];return e}});var _canvas;var ImageUtils={getDataURL:function(e){var t;if(typeof HTMLCanvasElement=="undefined"){return e.src}else if(e instanceof HTMLCanvasElement){t=e}else{if(_canvas===undefined)_canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");_canvas.width=e.width;_canvas.height=e.height;var i=_canvas.getContext("2d");if(e instanceof ImageData){i.putImageData(e,0,0)}else{i.drawImage(e,0,0,e.width,e.height)}t=_canvas}if(t.width>2048||t.height>2048){return t.toDataURL("image/jpeg",.6)}else{return t.toDataURL("image/png")}}};var textureId=0;function Texture(e,t,i,r,n,a,o,s,l,c){Object.defineProperty(this,"id",{value:textureId++});this.uuid=MathUtils.generateUUID();this.name="";this.image=e!==undefined?e:Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=t!==undefined?t:Texture.DEFAULT_MAPPING;this.wrapS=i!==undefined?i:ClampToEdgeWrapping;this.wrapT=r!==undefined?r:ClampToEdgeWrapping;this.magFilter=n!==undefined?n:LinearFilter;this.minFilter=a!==undefined?a:LinearMipmapLinearFilter;this.anisotropy=l!==undefined?l:1;this.format=o!==undefined?o:RGBAFormat;this.internalFormat=null;this.type=s!==undefined?s:UnsignedByteType;this.offset=new Vector2(0,0);this.repeat=new Vector2(1,1);this.center=new Vector2(0,0);this.rotation=0;this.matrixAutoUpdate=true;this.matrix=new Matrix3;this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this.encoding=c!==undefined?c:LinearEncoding;this.version=0;this.onUpdate=null}Texture.DEFAULT_IMAGE=undefined;Texture.DEFAULT_MAPPING=UVMapping;Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:true,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name;this.image=e.image;this.mipmaps=e.mipmaps.slice(0);this.mapping=e.mapping;this.wrapS=e.wrapS;this.wrapT=e.wrapT;this.magFilter=e.magFilter;this.minFilter=e.minFilter;this.anisotropy=e.anisotropy;this.format=e.format;this.internalFormat=e.internalFormat;this.type=e.type;this.offset.copy(e.offset);this.repeat.copy(e.repeat);this.center.copy(e.center);this.rotation=e.rotation;this.matrixAutoUpdate=e.matrixAutoUpdate;this.matrix.copy(e.matrix);this.generateMipmaps=e.generateMipmaps;this.premultiplyAlpha=e.premultiplyAlpha;this.flipY=e.flipY;this.unpackAlignment=e.unpackAlignment;this.encoding=e.encoding;return this},toJSON:function(e){var t=e===undefined||typeof e==="string";if(!t&&e.textures[this.uuid]!==undefined){return e.textures[this.uuid]}var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==undefined){var r=this.image;if(r.uuid===undefined){r.uuid=MathUtils.generateUUID()}if(!t&&e.images[r.uuid]===undefined){var n;if(Array.isArray(r)){n=[];for(var a=0,o=r.length;a<o;a++){n.push(ImageUtils.getDataURL(r[a]))}}else{n=ImageUtils.getDataURL(r)}e.images[r.uuid]={uuid:r.uuid,url:n}}i.image=r.uuid}if(!t){e.textures[this.uuid]=i}return i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==UVMapping)return e;e.applyMatrix3(this.matrix);if(e.x<0||e.x>1){switch(this.wrapS){case RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case MirroredRepeatWrapping:if(Math.abs(Math.floor(e.x)%2)===1){e.x=Math.ceil(e.x)-e.x}else{e.x=e.x-Math.floor(e.x)}break}}if(e.y<0||e.y>1){switch(this.wrapT){case RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case MirroredRepeatWrapping:if(Math.abs(Math.floor(e.y)%2)===1){e.y=Math.ceil(e.y)-e.y}else{e.y=e.y-Math.floor(e.y)}break}}if(this.flipY){e.y=1-e.y}return e}});Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(e){if(e===true)this.version++}});function Vector4(e,t,i,r){this.x=e||0;this.y=t||0;this.z=i||0;this.w=r!==undefined?r:1}Object.defineProperties(Vector4.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}});Object.assign(Vector4.prototype,{isVector4:true,set:function(e,t,i,r){this.x=e;this.y=t;this.z=i;this.w=r;return this},setScalar:function(e){this.x=e;this.y=e;this.z=e;this.w=e;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setW:function(e){this.w=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w!==undefined?e.w:1;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;this.w+=e.w;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;this.w+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;this.w=e.w+t.w;return this},addScaledVector:function(e,t){this.x+=e.x*t;this.y+=e.y*t;this.z+=e.z*t;this.w+=e.w*t;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;this.w-=e.w;return this},subScalar:function(e){this.x-=e;this.y-=e;this.z-=e;this.w-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;this.w=e.w-t.w;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;this.w*=e;return this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=this.w;var a=e.elements;this.x=a[0]*t+a[4]*i+a[8]*r+a[12]*n;this.y=a[1]*t+a[5]*i+a[9]*r+a[13]*n;this.z=a[2]*t+a[6]*i+a[10]*r+a[14]*n;this.w=a[3]*t+a[7]*i+a[11]*r+a[15]*n;return this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);if(t<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=e.x/t;this.y=e.y/t;this.z=e.z/t}return this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,n,a=.01,o=.1,s=e.elements,l=s[0],c=s[4],u=s[8],h=s[1],p=s[5],m=s[9],f=s[2],d=s[6],_=s[10];if(Math.abs(c-h)<a&&Math.abs(u-f)<a&&Math.abs(m-d)<a){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(m+d)<o&&Math.abs(l+p+_-3)<o){this.set(1,0,0,0);return this}t=Math.PI;var y=(l+1)/2;var v=(p+1)/2;var g=(_+1)/2;var x=(c+h)/4;var b=(u+f)/4;var M=(m+d)/4;if(y>v&&y>g){if(y<a){i=0;r=.707106781;n=.707106781}else{i=Math.sqrt(y);r=x/i;n=b/i}}else if(v>g){if(v<a){i=.707106781;r=0;n=.707106781}else{r=Math.sqrt(v);i=x/r;n=M/r}}else{if(g<a){i=.707106781;r=.707106781;n=0}else{n=Math.sqrt(g);i=b/n;r=M/n}}this.set(i,r,n,t);return this}var w=Math.sqrt((d-m)*(d-m)+(u-f)*(u-f)+(h-c)*(h-c));if(Math.abs(w)<.001)w=1;this.x=(d-m)/w;this.y=(u-f)/w;this.z=(h-c)/w;this.w=Math.acos((l+p+_-1)/2);return this},min:function(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);this.z=Math.min(this.z,e.z);this.w=Math.min(this.w,e.w);return this},max:function(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);this.z=Math.max(this.z,e.z);this.w=Math.max(this.w,e.w);return this},clamp:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));this.z=Math.max(e.z,Math.min(t.z,this.z));this.w=Math.max(e.w,Math.min(t.w,this.w));return this},clampScalar:function(e,t){this.x=Math.max(e,Math.min(t,this.x));this.y=Math.max(e,Math.min(t,this.y));this.z=Math.max(e,Math.min(t,this.z));this.w=Math.max(e,Math.min(t,this.w));return this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;this.w+=(e.w-this.w)*t;return this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];this.w=e[t+3];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;e[t+3]=this.w;return e},fromBufferAttribute:function(e,t,i){if(i!==undefined){console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute().")}this.x=e.getX(t);this.y=e.getY(t);this.z=e.getZ(t);this.w=e.getW(t);return this},random:function(){this.x=Math.random();this.y=Math.random();this.z=Math.random();this.w=Math.random();return this}});function WebGLRenderTarget(e,t,i){this.width=e;this.height=t;this.scissor=new Vector4(0,0,e,t);this.scissorTest=false;this.viewport=new Vector4(0,0,e,t);i=i||{};this.texture=new Texture(undefined,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding);this.texture.image={};this.texture.image.width=e;this.texture.image.height=t;this.texture.generateMipmaps=i.generateMipmaps!==undefined?i.generateMipmaps:false;this.texture.minFilter=i.minFilter!==undefined?i.minFilter:LinearFilter;this.depthBuffer=i.depthBuffer!==undefined?i.depthBuffer:true;this.stencilBuffer=i.stencilBuffer!==undefined?i.stencilBuffer:true;this.depthTexture=i.depthTexture!==undefined?i.depthTexture:null}WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:true,setSize:function(e,t){if(this.width!==e||this.height!==t){this.width=e;this.height=t;this.texture.image.width=e;this.texture.image.height=t;this.dispose()}this.viewport.set(0,0,e,t);this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.width=e.width;this.height=e.height;this.viewport.copy(e.viewport);this.texture=e.texture.clone();this.depthBuffer=e.depthBuffer;this.stencilBuffer=e.stencilBuffer;this.depthTexture=e.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function WebGLMultisampleRenderTarget(e,t,i){WebGLRenderTarget.call(this,e,t,i);this.samples=4}WebGLMultisampleRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultisampleRenderTarget,isWebGLMultisampleRenderTarget:true,copy:function(e){WebGLRenderTarget.prototype.copy.call(this,e);this.samples=e.samples;return this}});function Quaternion(e,t,i,r){this._x=e||0;this._y=t||0;this._z=i||0;this._w=r!==undefined?r:1}Object.assign(Quaternion,{slerp:function(e,t,i,r){return i.copy(e).slerp(t,r)},slerpFlat:function(e,t,i,r,n,a,o){var s=i[r+0],l=i[r+1],c=i[r+2],u=i[r+3],h=n[a+0],p=n[a+1],m=n[a+2],f=n[a+3];if(u!==f||s!==h||l!==p||c!==m){var d=1-o,_=s*h+l*p+c*m+u*f,y=_>=0?1:-1,v=1-_*_;if(v>Number.EPSILON){var g=Math.sqrt(v),x=Math.atan2(g,_*y);d=Math.sin(d*x)/g;o=Math.sin(o*x)/g}var b=o*y;s=s*d+h*b;l=l*d+p*b;c=c*d+m*b;u=u*d+f*b;if(d===1-o){var M=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=M;l*=M;c*=M;u*=M}}e[t]=s;e[t+1]=l;e[t+2]=c;e[t+3]=u},multiplyQuaternionsFlat:function(e,t,i,r,n,a){var o=i[r];var s=i[r+1];var l=i[r+2];var c=i[r+3];var u=n[a];var h=n[a+1];var p=n[a+2];var m=n[a+3];e[t]=o*m+c*u+s*p-l*h;e[t+1]=s*m+c*h+l*u-o*p;e[t+2]=l*m+c*p+o*h-s*u;e[t+3]=c*m-o*u-s*h-l*p;return e}});Object.defineProperties(Quaternion.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e;this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e;this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e;this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e;this._onChangeCallback()}}});Object.assign(Quaternion.prototype,{isQuaternion:true,set:function(e,t,i,r){this._x=e;this._y=t;this._z=i;this._w=r;this._onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){this._x=e.x;this._y=e.y;this._z=e.z;this._w=e.w;this._onChangeCallback();return this},setFromEuler:function(e,t){if(!(e&&e.isEuler)){throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.")}var i=e._x,r=e._y,n=e._z,a=e.order;var o=Math.cos;var s=Math.sin;var l=o(i/2);var c=o(r/2);var u=o(n/2);var h=s(i/2);var p=s(r/2);var m=s(n/2);switch(a){case"XYZ":this._x=h*c*u+l*p*m;this._y=l*p*u-h*c*m;this._z=l*c*m+h*p*u;this._w=l*c*u-h*p*m;break;case"YXZ":this._x=h*c*u+l*p*m;this._y=l*p*u-h*c*m;this._z=l*c*m-h*p*u;this._w=l*c*u+h*p*m;break;case"ZXY":this._x=h*c*u-l*p*m;this._y=l*p*u+h*c*m;this._z=l*c*m+h*p*u;this._w=l*c*u-h*p*m;break;case"ZYX":this._x=h*c*u-l*p*m;this._y=l*p*u+h*c*m;this._z=l*c*m-h*p*u;this._w=l*c*u+h*p*m;break;case"YZX":this._x=h*c*u+l*p*m;this._y=l*p*u+h*c*m;this._z=l*c*m-h*p*u;this._w=l*c*u-h*p*m;break;case"XZY":this._x=h*c*u-l*p*m;this._y=l*p*u-h*c*m;this._z=l*c*m+h*p*u;this._w=l*c*u+h*p*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}if(t!==false)this._onChangeCallback();return this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);this._x=e.x*r;this._y=e.y*r;this._z=e.z*r;this._w=Math.cos(i);this._onChangeCallback();return this},setFromRotationMatrix:function(e){var t=e.elements,i=t[0],r=t[4],n=t[8],a=t[1],o=t[5],s=t[9],l=t[2],c=t[6],u=t[10],h=i+o+u,p;if(h>0){p=.5/Math.sqrt(h+1);this._w=.25/p;this._x=(c-s)*p;this._y=(n-l)*p;this._z=(a-r)*p}else if(i>o&&i>u){p=2*Math.sqrt(1+i-o-u);this._w=(c-s)/p;this._x=.25*p;this._y=(r+a)/p;this._z=(n+l)/p}else if(o>u){p=2*Math.sqrt(1+o-i-u);this._w=(n-l)/p;this._x=(r+a)/p;this._y=.25*p;this._z=(s+c)/p}else{p=2*Math.sqrt(1+u-i-o);this._w=(a-r)/p;this._x=(n+l)/p;this._y=(s+c)/p;this._z=.25*p}this._onChangeCallback();return this},setFromUnitVectors:function(e,t){var i=1e-6;var r=e.dot(t)+1;if(r<i){r=0;if(Math.abs(e.x)>Math.abs(e.z)){this._x=-e.y;this._y=e.x;this._z=0;this._w=r}else{this._x=0;this._y=-e.z;this._z=e.y;this._w=r}}else{this._x=e.y*t.z-e.z*t.y;this._y=e.z*t.x-e.x*t.z;this._z=e.x*t.y-e.y*t.x;this._w=r}return this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(MathUtils.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var i=this.angleTo(e);if(i===0)return this;var r=Math.min(1,t/i);this.slerp(e,r);return this},inverse:function(){return this.conjugate()},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this._onChangeCallback();return this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();if(e===0){this._x=0;this._y=0;this._z=0;this._w=1}else{e=1/e;this._x=this._x*e;this._y=this._y*e;this._z=this._z*e;this._w=this._w*e}this._onChangeCallback();return this},multiply:function(e,t){if(t!==undefined){console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(e,t)}return this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,r=e._y,n=e._z,a=e._w;var o=t._x,s=t._y,l=t._z,c=t._w;this._x=i*c+a*o+r*l-n*s;this._y=r*c+a*s+n*o-i*l;this._z=n*c+a*l+i*s-r*o;this._w=a*c-i*o-r*s-n*l;this._onChangeCallback();return this},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var i=this._x,r=this._y,n=this._z,a=this._w;var o=a*e._w+i*e._x+r*e._y+n*e._z;if(o<0){this._w=-e._w;this._x=-e._x;this._y=-e._y;this._z=-e._z;o=-o}else{this.copy(e)}if(o>=1){this._w=a;this._x=i;this._y=r;this._z=n;return this}var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;this._w=l*a+t*this._w;this._x=l*i+t*this._x;this._y=l*r+t*this._y;this._z=l*n+t*this._z;this.normalize();this._onChangeCallback();return this}var c=Math.sqrt(s);var u=Math.atan2(c,o);var h=Math.sin((1-t)*u)/c,p=Math.sin(t*u)/c;this._w=a*h+this._w*p;this._x=i*h+this._x*p;this._y=r*h+this._y*p;this._z=n*h+this._z*p;this._onChangeCallback();return this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){if(t===undefined)t=0;this._x=e[t];this._y=e[t+1];this._z=e[t+2];this._w=e[t+3];this._onChangeCallback();return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._w;return e},fromBufferAttribute:function(e,t){this._x=e.getX(t);this._y=e.getY(t);this._z=e.getZ(t);this._w=e.getW(t);return this},_onChange:function(e){this._onChangeCallback=e;return this},_onChangeCallback:function(){}});var _vector=new Vector3;var _quaternion=new Quaternion;function Vector3(e,t,i){this.x=e||0;this.y=t||0;this.z=i||0}Object.assign(Vector3.prototype,{isVector3:true,set:function(e,t,i){this.x=e;this.y=t;this.z=i;return this},setScalar:function(e){this.x=e;this.y=e;this.z=e;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;return this},add:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;return this},addScaledVector:function(e,t){this.x+=e.x*t;this.y+=e.y*t;this.z+=e.z*t;return this},sub:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;return this},subScalar:function(e){this.x-=e;this.y-=e;this.z-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;return this},multiply:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(e,t)}this.x*=e.x;this.y*=e.y;this.z*=e.z;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;return this},multiplyVectors:function(e,t){this.x=e.x*t.x;this.y=e.y*t.y;this.z=e.z*t.z;return this},applyEuler:function(e){if(!(e&&e.isEuler)){console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.")}return this.applyQuaternion(_quaternion.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(_quaternion.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z;var n=e.elements;this.x=n[0]*t+n[3]*i+n[6]*r;this.y=n[1]*t+n[4]*i+n[7]*r;this.z=n[2]*t+n[5]*i+n[8]*r;return this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z;var n=e.elements;var a=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*a;this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*a;this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*a;return this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z;var n=e.x,a=e.y,o=e.z,s=e.w;var l=s*t+a*r-o*i;var c=s*i+o*t-n*r;var u=s*r+n*i-a*t;var h=-n*t-a*i-o*r;this.x=l*s+h*-n+c*-o-u*-a;this.y=c*s+h*-a+u*-n-l*-o;this.z=u*s+h*-o+l*-a-c*-n;return this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,i=this.y,r=this.z;var n=e.elements;this.x=n[0]*t+n[4]*i+n[8]*r;this.y=n[1]*t+n[5]*i+n[9]*r;this.z=n[2]*t+n[6]*i+n[10]*r;return this.normalize()},divide:function(e){this.x/=e.x;this.y/=e.y;this.z/=e.z;return this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);this.z=Math.min(this.z,e.z);return this},max:function(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);this.z=Math.max(this.z,e.z);return this},clamp:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));this.z=Math.max(e.z,Math.min(t.z,this.z));return this},clampScalar:function(e,t){this.x=Math.max(e,Math.min(t,this.x));this.y=Math.max(e,Math.min(t,this.y));this.z=Math.max(e,Math.min(t,this.z));return this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;return this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},cross:function(e,t){if(t!==undefined){console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(e,t)}return this.crossVectors(this,e)},crossVectors:function(e,t){var i=e.x,r=e.y,n=e.z;var a=t.x,o=t.y,s=t.z;this.x=r*s-n*o;this.y=n*a-i*s;this.z=i*o-r*a;return this},projectOnVector:function(e){var t=e.lengthSq();if(t===0)return this.set(0,0,0);var i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)},projectOnPlane:function(e){_vector.copy(this).projectOnVector(e);return this.sub(_vector)},reflect:function(e){return this.sub(_vector.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;var i=this.dot(e)/t;return Math.acos(MathUtils.clamp(i,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,i){var r=Math.sin(t)*e;this.x=r*Math.sin(i);this.y=Math.cos(t)*e;this.z=r*Math.cos(i);return this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,i){this.x=e*Math.sin(t);this.y=i;this.z=e*Math.cos(t);return this},setFromMatrixPosition:function(e){var t=e.elements;this.x=t[12];this.y=t[13];this.z=t[14];return this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length();var i=this.setFromMatrixColumn(e,1).length();var r=this.setFromMatrixColumn(e,2).length();this.x=t;this.y=i;this.z=r;return this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,t*4)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,t*3)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;return e},fromBufferAttribute:function(e,t,i){if(i!==undefined){console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute().")}this.x=e.getX(t);this.y=e.getY(t);this.z=e.getZ(t);return this},random:function(){this.x=Math.random();this.y=Math.random();this.z=Math.random();return this}});var _v1=new Vector3;var _m1=new Matrix4;var _zero=new Vector3(0,0,0);var _one=new Vector3(1,1,1);var _x=new Vector3;var _y=new Vector3;var _z=new Vector3;function Matrix4(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(arguments.length>0){console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}}Object.assign(Matrix4.prototype,{isMatrix4:true,set:function(e,t,i,r,n,a,o,s,l,c,u,h,p,m,f,d){var _=this.elements;_[0]=e;_[4]=t;_[8]=i;_[12]=r;_[1]=n;_[5]=a;_[9]=o;_[13]=s;_[2]=l;_[6]=c;_[10]=u;_[14]=h;_[3]=p;_[7]=m;_[11]=f;_[15]=d;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new Matrix4).fromArray(this.elements)},copy:function(e){var t=this.elements;var i=e.elements;t[0]=i[0];t[1]=i[1];t[2]=i[2];t[3]=i[3];t[4]=i[4];t[5]=i[5];t[6]=i[6];t[7]=i[7];t[8]=i[8];t[9]=i[9];t[10]=i[10];t[11]=i[11];t[12]=i[12];t[13]=i[13];t[14]=i[14];t[15]=i[15];return this},copyPosition:function(e){var t=this.elements,i=e.elements;t[12]=i[12];t[13]=i[13];t[14]=i[14];return this},extractBasis:function(e,t,i){e.setFromMatrixColumn(this,0);t.setFromMatrixColumn(this,1);i.setFromMatrixColumn(this,2);return this},makeBasis:function(e,t,i){this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1);return this},extractRotation:function(e){var t=this.elements;var i=e.elements;var r=1/_v1.setFromMatrixColumn(e,0).length();var n=1/_v1.setFromMatrixColumn(e,1).length();var a=1/_v1.setFromMatrixColumn(e,2).length();t[0]=i[0]*r;t[1]=i[1]*r;t[2]=i[2]*r;t[3]=0;t[4]=i[4]*n;t[5]=i[5]*n;t[6]=i[6]*n;t[7]=0;t[8]=i[8]*a;t[9]=i[9]*a;t[10]=i[10]*a;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},makeRotationFromEuler:function(e){if(!(e&&e.isEuler)){console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var t=this.elements;var i=e.x,r=e.y,n=e.z;var a=Math.cos(i),o=Math.sin(i);var s=Math.cos(r),l=Math.sin(r);var c=Math.cos(n),u=Math.sin(n);if(e.order==="XYZ"){var h=a*c,p=a*u,m=o*c,f=o*u;t[0]=s*c;t[4]=-s*u;t[8]=l;t[1]=p+m*l;t[5]=h-f*l;t[9]=-o*s;t[2]=f-h*l;t[6]=m+p*l;t[10]=a*s}else if(e.order==="YXZ"){var d=s*c,_=s*u,y=l*c,v=l*u;t[0]=d+v*o;t[4]=y*o-_;t[8]=a*l;t[1]=a*u;t[5]=a*c;t[9]=-o;t[2]=_*o-y;t[6]=v+d*o;t[10]=a*s}else if(e.order==="ZXY"){var d=s*c,_=s*u,y=l*c,v=l*u;t[0]=d-v*o;t[4]=-a*u;t[8]=y+_*o;t[1]=_+y*o;t[5]=a*c;t[9]=v-d*o;t[2]=-a*l;t[6]=o;t[10]=a*s}else if(e.order==="ZYX"){var h=a*c,p=a*u,m=o*c,f=o*u;t[0]=s*c;t[4]=m*l-p;t[8]=h*l+f;t[1]=s*u;t[5]=f*l+h;t[9]=p*l-m;t[2]=-l;t[6]=o*s;t[10]=a*s}else if(e.order==="YZX"){var g=a*s,x=a*l,b=o*s,M=o*l;t[0]=s*c;t[4]=M-g*u;t[8]=b*u+x;t[1]=u;t[5]=a*c;t[9]=-o*c;t[2]=-l*c;t[6]=x*u+b;t[10]=g-M*u}else if(e.order==="XZY"){var g=a*s,x=a*l,b=o*s,M=o*l;t[0]=s*c;t[4]=-u;t[8]=l*c;t[1]=g*u+M;t[5]=a*c;t[9]=x*u-b;t[2]=b*u-x;t[6]=o*c;t[10]=M*u+g}t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},makeRotationFromQuaternion:function(e){return this.compose(_zero,e,_one)},lookAt:function(e,t,i){var r=this.elements;_z.subVectors(e,t);if(_z.lengthSq()===0){_z.z=1}_z.normalize();_x.crossVectors(i,_z);if(_x.lengthSq()===0){if(Math.abs(i.z)===1){_z.x+=1e-4}else{_z.z+=1e-4}_z.normalize();_x.crossVectors(i,_z)}_x.normalize();_y.crossVectors(_z,_x);r[0]=_x.x;r[4]=_y.x;r[8]=_z.x;r[1]=_x.y;r[5]=_y.y;r[9]=_z.y;r[2]=_x.z;r[6]=_y.z;r[10]=_z.z;return this},multiply:function(e,t){if(t!==undefined){console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(e,t)}return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements;var r=t.elements;var n=this.elements;var a=i[0],o=i[4],s=i[8],l=i[12];var c=i[1],u=i[5],h=i[9],p=i[13];var m=i[2],f=i[6],d=i[10],_=i[14];var y=i[3],v=i[7],g=i[11],x=i[15];var b=r[0],M=r[4],w=r[8],S=r[12];var A=r[1],C=r[5],T=r[9],B=r[13];var L=r[2],D=r[6],E=r[10],R=r[14];var P=r[3],G=r[7],I=r[11],V=r[15];n[0]=a*b+o*A+s*L+l*P;n[4]=a*M+o*C+s*D+l*G;n[8]=a*w+o*T+s*E+l*I;n[12]=a*S+o*B+s*R+l*V;n[1]=c*b+u*A+h*L+p*P;n[5]=c*M+u*C+h*D+p*G;n[9]=c*w+u*T+h*E+p*I;n[13]=c*S+u*B+h*R+p*V;n[2]=m*b+f*A+d*L+_*P;n[6]=m*M+f*C+d*D+_*G;n[10]=m*w+f*T+d*E+_*I;n[14]=m*S+f*B+d*R+_*V;n[3]=y*b+v*A+g*L+x*P;n[7]=y*M+v*C+g*D+x*G;n[11]=y*w+v*T+g*E+x*I;n[15]=y*S+v*B+g*R+x*V;return this},multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[4]*=e;t[8]*=e;t[12]*=e;t[1]*=e;t[5]*=e;t[9]*=e;t[13]*=e;t[2]*=e;t[6]*=e;t[10]*=e;t[14]*=e;t[3]*=e;t[7]*=e;t[11]*=e;t[15]*=e;return this},determinant:function(){var e=this.elements;var t=e[0],i=e[4],r=e[8],n=e[12];var a=e[1],o=e[5],s=e[9],l=e[13];var c=e[2],u=e[6],h=e[10],p=e[14];var m=e[3],f=e[7],d=e[11],_=e[15];return m*(+n*s*u-r*l*u-n*o*h+i*l*h+r*o*p-i*s*p)+f*(+t*s*p-t*l*h+n*a*h-r*a*p+r*l*c-n*s*c)+d*(+t*l*u-t*o*p-n*a*u+i*a*p+n*o*c-i*l*c)+_*(-r*o*c-t*s*u+t*o*h+r*a*u-i*a*h+i*s*c)},transpose:function(){var e=this.elements;var t;t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this},setPosition:function(e,t,i){var r=this.elements;if(e.isVector3){r[12]=e.x;r[13]=e.y;r[14]=e.z}else{r[12]=e;r[13]=t;r[14]=i}return this},getInverse:function(e,t){if(t!==undefined){console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.")}var i=this.elements,r=e.elements,n=r[0],a=r[1],o=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],p=r[8],m=r[9],f=r[10],d=r[11],_=r[12],y=r[13],v=r[14],g=r[15],x=m*v*h-y*f*h+y*u*d-c*v*d-m*u*g+c*f*g,b=_*f*h-p*v*h-_*u*d+l*v*d+p*u*g-l*f*g,M=p*y*h-_*m*h+_*c*d-l*y*d-p*c*g+l*m*g,w=_*m*u-p*y*u-_*c*f+l*y*f+p*c*v-l*m*v;var S=n*x+a*b+o*M+s*w;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var A=1/S;i[0]=x*A;i[1]=(y*f*s-m*v*s-y*o*d+a*v*d+m*o*g-a*f*g)*A;i[2]=(c*v*s-y*u*s+y*o*h-a*v*h-c*o*g+a*u*g)*A;i[3]=(m*u*s-c*f*s-m*o*h+a*f*h+c*o*d-a*u*d)*A;i[4]=b*A;i[5]=(p*v*s-_*f*s+_*o*d-n*v*d-p*o*g+n*f*g)*A;i[6]=(_*u*s-l*v*s-_*o*h+n*v*h+l*o*g-n*u*g)*A;i[7]=(l*f*s-p*u*s+p*o*h-n*f*h-l*o*d+n*u*d)*A;i[8]=M*A;i[9]=(_*m*s-p*y*s-_*a*d+n*y*d+p*a*g-n*m*g)*A;i[10]=(l*y*s-_*c*s+_*a*h-n*y*h-l*a*g+n*c*g)*A;i[11]=(p*c*s-l*m*s-p*a*h+n*m*h+l*a*d-n*c*d)*A;i[12]=w*A;i[13]=(p*y*o-_*m*o+_*a*f-n*y*f-p*a*v+n*m*v)*A;i[14]=(_*c*o-l*y*o-_*a*u+n*y*u+l*a*v-n*c*v)*A;i[15]=(l*m*o-p*c*o+p*a*u-n*m*u-l*a*f+n*c*f)*A;return this},scale:function(e){var t=this.elements;var i=e.x,r=e.y,n=e.z;t[0]*=i;t[4]*=r;t[8]*=n;t[1]*=i;t[5]*=r;t[9]*=n;t[2]*=i;t[6]*=r;t[10]*=n;t[3]*=i;t[7]*=r;t[11]*=n;return this},getMaxScaleOnAxis:function(){var e=this.elements;var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];var i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6];var r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},makeTranslation:function(e,t,i){this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1);return this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1);return this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1);return this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(e,t){var i=Math.cos(t);var r=Math.sin(t);var n=1-i;var a=e.x,o=e.y,s=e.z;var l=n*a,c=n*o;this.set(l*a+i,l*o-r*s,l*s+r*o,0,l*o+r*s,c*o+i,c*s-r*a,0,l*s-r*o,c*s+r*a,n*s*s+i,0,0,0,0,1);return this},makeScale:function(e,t,i){this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1);return this},makeShear:function(e,t,i){this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1);return this},compose:function(e,t,i){var r=this.elements;var n=t._x,a=t._y,o=t._z,s=t._w;var l=n+n,c=a+a,u=o+o;var h=n*l,p=n*c,m=n*u;var f=a*c,d=a*u,_=o*u;var y=s*l,v=s*c,g=s*u;var x=i.x,b=i.y,M=i.z;r[0]=(1-(f+_))*x;r[1]=(p+g)*x;r[2]=(m-v)*x;r[3]=0;r[4]=(p-g)*b;r[5]=(1-(h+_))*b;r[6]=(d+y)*b;r[7]=0;r[8]=(m+v)*M;r[9]=(d-y)*M;r[10]=(1-(h+f))*M;r[11]=0;r[12]=e.x;r[13]=e.y;r[14]=e.z;r[15]=1;return this},decompose:function(e,t,i){var r=this.elements;var n=_v1.set(r[0],r[1],r[2]).length();var a=_v1.set(r[4],r[5],r[6]).length();var o=_v1.set(r[8],r[9],r[10]).length();var s=this.determinant();if(s<0)n=-n;e.x=r[12];e.y=r[13];e.z=r[14];_m1.copy(this);var l=1/n;var c=1/a;var u=1/o;_m1.elements[0]*=l;_m1.elements[1]*=l;_m1.elements[2]*=l;_m1.elements[4]*=c;_m1.elements[5]*=c;_m1.elements[6]*=c;_m1.elements[8]*=u;_m1.elements[9]*=u;_m1.elements[10]*=u;t.setFromRotationMatrix(_m1);i.x=n;i.y=a;i.z=o;return this},makePerspective:function(e,t,i,r,n,a){if(a===undefined){console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.")}var o=this.elements;var s=2*n/(t-e);var l=2*n/(i-r);var c=(t+e)/(t-e);var u=(i+r)/(i-r);var h=-(a+n)/(a-n);var p=-2*a*n/(a-n);o[0]=s;o[4]=0;o[8]=c;o[12]=0;o[1]=0;o[5]=l;o[9]=u;o[13]=0;o[2]=0;o[6]=0;o[10]=h;o[14]=p;o[3]=0;o[7]=0;o[11]=-1;o[15]=0;return this},makeOrthographic:function(e,t,i,r,n,a){var o=this.elements;var s=1/(t-e);var l=1/(i-r);var c=1/(a-n);var u=(t+e)*s;var h=(i+r)*l;var p=(a+n)*c;o[0]=2*s;o[4]=0;o[8]=0;o[12]=-u;o[1]=0;o[5]=2*l;o[9]=0;o[13]=-h;o[2]=0;o[6]=0;o[10]=-2*c;o[14]=-p;o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this},equals:function(e){var t=this.elements;var i=e.elements;for(var r=0;r<16;r++){if(t[r]!==i[r])return false}return true},fromArray:function(e,t){if(t===undefined)t=0;for(var i=0;i<16;i++){this.elements[i]=e[i+t]}return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;var i=this.elements;e[t]=i[0];e[t+1]=i[1];e[t+2]=i[2];e[t+3]=i[3];e[t+4]=i[4];e[t+5]=i[5];e[t+6]=i[6];e[t+7]=i[7];e[t+8]=i[8];e[t+9]=i[9];e[t+10]=i[10];e[t+11]=i[11];e[t+12]=i[12];e[t+13]=i[13];e[t+14]=i[14];e[t+15]=i[15];return e}});var _matrix=new Matrix4;var _quaternion$1=new Quaternion;function Euler(e,t,i,r){this._x=e||0;this._y=t||0;this._z=i||0;this._order=r||Euler.DefaultOrder}Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];Euler.DefaultOrder="XYZ";Object.defineProperties(Euler.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e;this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e;this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e;this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e;this._onChangeCallback()}}});Object.assign(Euler.prototype,{isEuler:true,set:function(e,t,i,r){this._x=e;this._y=t;this._z=i;this._order=r||this._order;this._onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){this._x=e._x;this._y=e._y;this._z=e._z;this._order=e._order;this._onChangeCallback();return this},setFromRotationMatrix:function(e,t,i){var r=MathUtils.clamp;var n=e.elements;var a=n[0],o=n[4],s=n[8];var l=n[1],c=n[5],u=n[9];var h=n[2],p=n[6],m=n[10];t=t||this._order;switch(t){case"XYZ":this._y=Math.asin(r(s,-1,1));if(Math.abs(s)<.9999999){this._x=Math.atan2(-u,m);this._z=Math.atan2(-o,a)}else{this._x=Math.atan2(p,c);this._z=0}break;case"YXZ":this._x=Math.asin(-r(u,-1,1));if(Math.abs(u)<.9999999){this._y=Math.atan2(s,m);this._z=Math.atan2(l,c)}else{this._y=Math.atan2(-h,a);this._z=0}break;case"ZXY":this._x=Math.asin(r(p,-1,1));if(Math.abs(p)<.9999999){this._y=Math.atan2(-h,m);this._z=Math.atan2(-o,c)}else{this._y=0;this._z=Math.atan2(l,a)}break;case"ZYX":this._y=Math.asin(-r(h,-1,1));if(Math.abs(h)<.9999999){this._x=Math.atan2(p,m);this._z=Math.atan2(l,a)}else{this._x=0;this._z=Math.atan2(-o,c)}break;case"YZX":this._z=Math.asin(r(l,-1,1));if(Math.abs(l)<.9999999){this._x=Math.atan2(-u,c);this._y=Math.atan2(-h,a)}else{this._x=0;this._y=Math.atan2(s,m)}break;case"XZY":this._z=Math.asin(-r(o,-1,1));if(Math.abs(o)<.9999999){this._x=Math.atan2(p,c);this._y=Math.atan2(s,a)}else{this._x=Math.atan2(-u,m);this._y=0}break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}this._order=t;if(i!==false)this._onChangeCallback();return this},setFromQuaternion:function(e,t,i){_matrix.makeRotationFromQuaternion(e);return this.setFromRotationMatrix(_matrix,t,i)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){_quaternion$1.setFromEuler(this);return this.setFromQuaternion(_quaternion$1,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){this._x=e[0];this._y=e[1];this._z=e[2];if(e[3]!==undefined)this._order=e[3];this._onChangeCallback();return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._order;return e},toVector3:function(e){if(e){return e.set(this._x,this._y,this._z)}else{return new Vector3(this._x,this._y,this._z)}},_onChange:function(e){this._onChangeCallback=e;return this},_onChangeCallback:function(){}});function Layers(){this.mask=1|0}Object.assign(Layers.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=4294967295|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return(this.mask&e.mask)!==0}});var _object3DId=0;var _v1$1=new Vector3;var _q1=new Quaternion;var _m1$1=new Matrix4;var _target=new Vector3;var _position=new Vector3;var _scale=new Vector3;var _quaternion$2=new Quaternion;var _xAxis=new Vector3(1,0,0);var _yAxis=new Vector3(0,1,0);var _zAxis=new Vector3(0,0,1);var _addedEvent={type:"added"};var _removedEvent={type:"removed"};function Object3D(){Object.defineProperty(this,"id",{value:_object3DId++});this.uuid=MathUtils.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=Object3D.DefaultUp.clone();var e=new Vector3;var t=new Euler;var i=new Quaternion;var r=new Vector3(1,1,1);function n(){i.setFromEuler(t,false)}function a(){t.setFromQuaternion(i,undefined,false)}t._onChange(n);i._onChange(a);Object.defineProperties(this,{position:{configurable:true,enumerable:true,value:e},rotation:{configurable:true,enumerable:true,value:t},quaternion:{configurable:true,enumerable:true,value:i},scale:{configurable:true,enumerable:true,value:r},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}});this.matrix=new Matrix4;this.matrixWorld=new Matrix4;this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=false;this.layers=new Layers;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.renderOrder=0;this.userData={}}Object3D.DefaultUp=new Vector3(0,1,0);Object3D.DefaultMatrixAutoUpdate=true;Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:true,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){if(this.matrixAutoUpdate)this.updateMatrix();this.matrix.premultiply(e);this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){this.quaternion.premultiply(e);return this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,true)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){_q1.setFromAxisAngle(e,t);this.quaternion.multiply(_q1);return this},rotateOnWorldAxis:function(e,t){_q1.setFromAxisAngle(e,t);this.quaternion.premultiply(_q1);return this},rotateX:function(e){return this.rotateOnAxis(_xAxis,e)},rotateY:function(e){return this.rotateOnAxis(_yAxis,e)},rotateZ:function(e){return this.rotateOnAxis(_zAxis,e)},translateOnAxis:function(e,t){_v1$1.copy(e).applyQuaternion(this.quaternion);this.position.add(_v1$1.multiplyScalar(t));return this},translateX:function(e){return this.translateOnAxis(_xAxis,e)},translateY:function(e){return this.translateOnAxis(_yAxis,e)},translateZ:function(e){return this.translateOnAxis(_zAxis,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(_m1$1.getInverse(this.matrixWorld))},lookAt:function(e,t,i){if(e.isVector3){_target.copy(e)}else{_target.set(e,t,i)}var r=this.parent;this.updateWorldMatrix(true,false);_position.setFromMatrixPosition(this.matrixWorld);if(this.isCamera||this.isLight){_m1$1.lookAt(_position,_target,this.up)}else{_m1$1.lookAt(_target,_position,this.up)}this.quaternion.setFromRotationMatrix(_m1$1);if(r){_m1$1.extractRotation(r.matrixWorld);_q1.setFromRotationMatrix(_m1$1);this.quaternion.premultiply(_q1.inverse())}},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.add(arguments[t])}return this}if(e===this){console.error("THREE.Object3D.add: object can't be added as a child of itself.",e);return this}if(e&&e.isObject3D){if(e.parent!==null){e.parent.remove(e)}e.parent=this;this.children.push(e);e.dispatchEvent(_addedEvent)}else{console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e)}return this},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.remove(arguments[t])}return this}var i=this.children.indexOf(e);if(i!==-1){e.parent=null;this.children.splice(i,1);e.dispatchEvent(_removedEvent)}return this},attach:function(e){this.updateWorldMatrix(true,false);_m1$1.getInverse(this.matrixWorld);if(e.parent!==null){e.parent.updateWorldMatrix(true,false);_m1$1.multiply(e.parent.matrixWorld)}e.applyMatrix4(_m1$1);e.updateWorldMatrix(false,false);this.add(e);return this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i];var a=n.getObjectByProperty(e,t);if(a!==undefined){return a}}return undefined},getWorldPosition:function(e){if(e===undefined){console.warn("THREE.Object3D: .getWorldPosition() target is now required");e=new Vector3}this.updateMatrixWorld(true);return e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){if(e===undefined){console.warn("THREE.Object3D: .getWorldQuaternion() target is now required");e=new Quaternion}this.updateMatrixWorld(true);this.matrixWorld.decompose(_position,e,_scale);return e},getWorldScale:function(e){if(e===undefined){console.warn("THREE.Object3D: .getWorldScale() target is now required");e=new Vector3}this.updateMatrixWorld(true);this.matrixWorld.decompose(_position,_quaternion$2,e);return e},getWorldDirection:function(e){if(e===undefined){console.warn("THREE.Object3D: .getWorldDirection() target is now required");e=new Vector3}this.updateMatrixWorld(true);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);var t=this.children;for(var i=0,r=t.length;i<r;i++){t[i].traverse(e)}},traverseVisible:function(e){if(this.visible===false)return;e(this);var t=this.children;for(var i=0,r=t.length;i<r;i++){t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;if(t!==null){e(t);t.traverseAncestors(e)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(e){if(this.matrixAutoUpdate)this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){if(this.parent===null){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;e=true}var t=this.children;for(var i=0,r=t.length;i<r;i++){t[i].updateMatrixWorld(e)}},updateWorldMatrix:function(e,t){var i=this.parent;if(e===true&&i!==null){i.updateWorldMatrix(true,false)}if(this.matrixAutoUpdate)this.updateMatrix();if(this.parent===null){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}if(t===true){var r=this.children;for(var n=0,a=r.length;n<a;n++){r[n].updateWorldMatrix(false,true)}}},toJSON:function(e){var t=e===undefined||typeof e==="string";var i={};if(t){e={geometries:{},materials:{},textures:{},images:{},shapes:{}};i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"}}var r={};r.uuid=this.uuid;r.type=this.type;if(this.name!=="")r.name=this.name;if(this.castShadow===true)r.castShadow=true;if(this.receiveShadow===true)r.receiveShadow=true;if(this.visible===false)r.visible=false;if(this.frustumCulled===false)r.frustumCulled=false;if(this.renderOrder!==0)r.renderOrder=this.renderOrder;if(JSON.stringify(this.userData)!=="{}")r.userData=this.userData;r.layers=this.layers.mask;r.matrix=this.matrix.toArray();if(this.matrixAutoUpdate===false)r.matrixAutoUpdate=false;if(this.isInstancedMesh){r.type="InstancedMesh";r.count=this.count;r.instanceMatrix=this.instanceMatrix.toJSON()}function n(t,i){if(t[i.uuid]===undefined){t[i.uuid]=i.toJSON(e)}return i.uuid}if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);var a=this.geometry.parameters;if(a!==undefined&&a.shapes!==undefined){var o=a.shapes;if(Array.isArray(o)){for(var s=0,l=o.length;s<l;s++){var c=o[s];n(e.shapes,c)}}else{n(e.shapes,o)}}}if(this.material!==undefined){if(Array.isArray(this.material)){var u=[];for(var s=0,l=this.material.length;s<l;s++){u.push(n(e.materials,this.material[s]))}r.material=u}else{r.material=n(e.materials,this.material)}}if(this.children.length>0){r.children=[];for(var s=0;s<this.children.length;s++){r.children.push(this.children[s].toJSON(e).object)}}if(t){var h=d(e.geometries);var p=d(e.materials);var m=d(e.textures);var f=d(e.images);var o=d(e.shapes);if(h.length>0)i.geometries=h;if(p.length>0)i.materials=p;if(m.length>0)i.textures=m;if(f.length>0)i.images=f;if(o.length>0)i.shapes=o}i.object=r;return i;function d(e){var t=[];for(var i in e){var r=e[i];delete r.metadata;t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(t===undefined)t=true;this.name=e.name;this.up.copy(e.up);this.position.copy(e.position);this.quaternion.copy(e.quaternion);this.scale.copy(e.scale);this.matrix.copy(e.matrix);this.matrixWorld.copy(e.matrixWorld);this.matrixAutoUpdate=e.matrixAutoUpdate;this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate;this.layers.mask=e.layers.mask;this.visible=e.visible;this.castShadow=e.castShadow;this.receiveShadow=e.receiveShadow;this.frustumCulled=e.frustumCulled;this.renderOrder=e.renderOrder;this.userData=JSON.parse(JSON.stringify(e.userData));if(t===true){for(var i=0;i<e.children.length;i++){var r=e.children[i];this.add(r.clone())}}return this}});function Scene(){Object3D.call(this);this.type="Scene";this.background=null;this.environment=null;this.fog=null;this.overrideMaterial=null;this.autoUpdate=true;if(typeof __THREE_DEVTOOLS__!=="undefined"){__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}Scene.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Scene,isScene:true,copy:function(e,t){Object3D.prototype.copy.call(this,e,t);if(e.background!==null)this.background=e.background.clone();if(e.environment!==null)this.environment=e.environment.clone();if(e.fog!==null)this.fog=e.fog.clone();if(e.overrideMaterial!==null)this.overrideMaterial=e.overrideMaterial.clone();this.autoUpdate=e.autoUpdate;this.matrixAutoUpdate=e.matrixAutoUpdate;return this},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);if(this.background!==null)t.object.background=this.background.toJSON(e);if(this.environment!==null)t.object.environment=this.environment.toJSON(e);if(this.fog!==null)t.object.fog=this.fog.toJSON();return t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3];var _vector$1=new Vector3;var _box=new Box3;var _v0=new Vector3;var _v1$2=new Vector3;var _v2=new Vector3;var _f0=new Vector3;var _f1=new Vector3;var _f2=new Vector3;var _center=new Vector3;var _extents=new Vector3;var _triangleNormal=new Vector3;var _testAxis=new Vector3;function Box3(e,t){this.min=e!==undefined?e:new Vector3(+Infinity,+Infinity,+Infinity);this.max=t!==undefined?t:new Vector3(-Infinity,-Infinity,-Infinity)}Object.assign(Box3.prototype,{isBox3:true,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromArray:function(e){var t=+Infinity;var i=+Infinity;var r=+Infinity;var n=-Infinity;var a=-Infinity;var o=-Infinity;for(var s=0,l=e.length;s<l;s+=3){var c=e[s];var u=e[s+1];var h=e[s+2];if(c<t)t=c;if(u<i)i=u;if(h<r)r=h;if(c>n)n=c;if(u>a)a=u;if(h>o)o=h}this.min.set(t,i,r);this.max.set(n,a,o);return this},setFromBufferAttribute:function(e){var t=+Infinity;var i=+Infinity;var r=+Infinity;var n=-Infinity;var a=-Infinity;var o=-Infinity;for(var s=0,l=e.count;s<l;s++){var c=e.getX(s);var u=e.getY(s);var h=e.getZ(s);if(c<t)t=c;if(u<i)i=u;if(h<r)r=h;if(c>n)n=c;if(u>a)a=u;if(h>o)o=h}this.min.set(t,i,r);this.max.set(n,a,o);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++){this.expandByPoint(e[t])}return this},setFromCenterAndSize:function(e,t){var i=_vector$1.copy(t).multiplyScalar(.5);this.min.copy(e).sub(i);this.max.copy(e).add(i);return this},setFromObject:function(e){this.makeEmpty();return this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=+Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){if(e===undefined){console.warn("THREE.Box3: .getCenter() target is now required");e=new Vector3}return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){if(e===undefined){console.warn("THREE.Box3: .getSize() target is now required");e=new Vector3}return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},expandByObject:function(e){e.updateWorldMatrix(false,false);var t=e.geometry;if(t!==undefined){if(t.boundingBox===null){t.computeBoundingBox()}_box.copy(t.boundingBox);_box.applyMatrix4(e.matrixWorld);this.union(_box)}var i=e.children;for(var r=0,n=i.length;r<n;r++){this.expandByObject(i[r])}return this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?false:true},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){if(t===undefined){console.warn("THREE.Box3: .getParameter() target is now required");t=new Vector3}return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?false:true},intersectsSphere:function(e){this.clampPoint(e.center,_vector$1);return _vector$1.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,i;if(e.normal.x>0){t=e.normal.x*this.min.x;i=e.normal.x*this.max.x}else{t=e.normal.x*this.max.x;i=e.normal.x*this.min.x}if(e.normal.y>0){t+=e.normal.y*this.min.y;i+=e.normal.y*this.max.y}else{t+=e.normal.y*this.max.y;i+=e.normal.y*this.min.y}if(e.normal.z>0){t+=e.normal.z*this.min.z;i+=e.normal.z*this.max.z}else{t+=e.normal.z*this.max.z;i+=e.normal.z*this.min.z}return t<=-e.constant&&i>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty()){return false}this.getCenter(_center);_extents.subVectors(this.max,_center);_v0.subVectors(e.a,_center);_v1$2.subVectors(e.b,_center);_v2.subVectors(e.c,_center);_f0.subVectors(_v1$2,_v0);_f1.subVectors(_v2,_v1$2);_f2.subVectors(_v0,_v2);var t=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];if(!satForAxes(t,_v0,_v1$2,_v2,_extents)){return false}t=[1,0,0,0,1,0,0,0,1];if(!satForAxes(t,_v0,_v1$2,_v2,_extents)){return false}_triangleNormal.crossVectors(_f0,_f1);t=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z];return satForAxes(t,_v0,_v1$2,_v2,_extents)},clampPoint:function(e,t){if(t===undefined){console.warn("THREE.Box3: .clampPoint() target is now required");t=new Vector3}return t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){var t=_vector$1.copy(e).clamp(this.min,this.max);return t.sub(e).length()},getBoundingSphere:function(e){if(e===undefined){console.error("THREE.Box3: .getBoundingSphere() target is now required")}this.getCenter(e.center);e.radius=this.getSize(_vector$1).length()*.5;return e},intersect:function(e){this.min.max(e.min);this.max.min(e.max);if(this.isEmpty())this.makeEmpty();return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},applyMatrix4:function(e){if(this.isEmpty())return this;_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e);_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e);_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e);_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e);_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e);_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e);_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e);_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e);this.setFromPoints(_points);return this},translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});function satForAxes(e,t,i,r,n){var a,o;for(a=0,o=e.length-3;a<=o;a+=3){_testAxis.fromArray(e,a);var s=n.x*Math.abs(_testAxis.x)+n.y*Math.abs(_testAxis.y)+n.z*Math.abs(_testAxis.z);var l=t.dot(_testAxis);var c=i.dot(_testAxis);var u=r.dot(_testAxis);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>s){return false}}return true}var _box$1=new Box3;function Sphere(e,t){this.center=e!==undefined?e:new Vector3;this.radius=t!==undefined?t:-1}Object.assign(Sphere.prototype,{set:function(e,t){this.center.copy(e);this.radius=t;return this},setFromPoints:function(e,t){var i=this.center;if(t!==undefined){i.copy(t)}else{_box$1.setFromPoints(e).getCenter(i)}var r=0;for(var n=0,a=e.length;n<a;n++){r=Math.max(r,i.distanceToSquared(e[n]))}this.radius=Math.sqrt(r);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.center.copy(e.center);this.radius=e.radius;return this},isEmpty:function(){return this.radius<0},makeEmpty:function(){this.center.set(0,0,0);this.radius=-1;return this},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var i=this.center.distanceToSquared(e);if(t===undefined){console.warn("THREE.Sphere: .clampPoint() target is now required");t=new Vector3}t.copy(e);if(i>this.radius*this.radius){t.sub(this.center).normalize();t.multiplyScalar(this.radius).add(this.center)}return t},getBoundingBox:function(e){if(e===undefined){console.warn("THREE.Sphere: .getBoundingBox() target is now required");e=new Box3}if(this.isEmpty()){e.makeEmpty();return e}e.set(this.center,this.center);e.expandByScalar(this.radius);return e},applyMatrix4:function(e){this.center.applyMatrix4(e);this.radius=this.radius*e.getMaxScaleOnAxis();return this},translate:function(e){this.center.add(e);return this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var _vector$2=new Vector3;var _segCenter=new Vector3;var _segDir=new Vector3;var _diff=new Vector3;var _edge1=new Vector3;var _edge2=new Vector3;var _normal=new Vector3;function Ray(e,t){this.origin=e!==undefined?e:new Vector3;this.direction=t!==undefined?t:new Vector3(0,0,-1)}Object.assign(Ray.prototype,{set:function(e,t){this.origin.copy(e);this.direction.copy(t);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.origin.copy(e.origin);this.direction.copy(e.direction);return this},at:function(e,t){if(t===undefined){console.warn("THREE.Ray: .at() target is now required");t=new Vector3}return t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){this.direction.copy(e).sub(this.origin).normalize();return this},recast:function(e){this.origin.copy(this.at(e,_vector$2));return this},closestPointToPoint:function(e,t){if(t===undefined){console.warn("THREE.Ray: .closestPointToPoint() target is now required");t=new Vector3}t.subVectors(e,this.origin);var i=t.dot(this.direction);if(i<0){return t.copy(this.origin)}return t.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=_vector$2.subVectors(e,this.origin).dot(this.direction);if(t<0){return this.origin.distanceToSquared(e)}_vector$2.copy(this.direction).multiplyScalar(t).add(this.origin);return _vector$2.distanceToSquared(e)},distanceSqToSegment:function(e,t,i,r){_segCenter.copy(e).add(t).multiplyScalar(.5);_segDir.copy(t).sub(e).normalize();_diff.copy(this.origin).sub(_segCenter);var n=e.distanceTo(t)*.5;var a=-this.direction.dot(_segDir);var o=_diff.dot(this.direction);var s=-_diff.dot(_segDir);var l=_diff.lengthSq();var c=Math.abs(1-a*a);var u,h,p,m;if(c>0){u=a*s-o;h=a*o-s;m=n*c;if(u>=0){if(h>=-m){if(h<=m){var f=1/c;u*=f;h*=f;p=u*(u+a*h+2*o)+h*(a*u+h+2*s)+l}else{h=n;u=Math.max(0,-(a*h+o));p=-u*u+h*(h+2*s)+l}}else{h=-n;u=Math.max(0,-(a*h+o));p=-u*u+h*(h+2*s)+l}}else{if(h<=-m){u=Math.max(0,-(-a*n+o));h=u>0?-n:Math.min(Math.max(-n,-s),n);p=-u*u+h*(h+2*s)+l}else if(h<=m){u=0;h=Math.min(Math.max(-n,-s),n);p=h*(h+2*s)+l}else{u=Math.max(0,-(a*n+o));h=u>0?n:Math.min(Math.max(-n,-s),n);p=-u*u+h*(h+2*s)+l}}}else{h=a>0?-n:n;u=Math.max(0,-(a*h+o));p=-u*u+h*(h+2*s)+l}if(i){i.copy(this.direction).multiplyScalar(u).add(this.origin)}if(r){r.copy(_segDir).multiplyScalar(h).add(_segCenter)}return p},intersectSphere:function(e,t){_vector$2.subVectors(e.center,this.origin);var i=_vector$2.dot(this.direction);var r=_vector$2.dot(_vector$2)-i*i;var n=e.radius*e.radius;if(r>n)return null;var a=Math.sqrt(n-r);var o=i-a;var s=i+a;if(o<0&&s<0)return null;if(o<0)return this.at(s,t);return this.at(o,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t===0){if(e.distanceToPoint(this.origin)===0){return 0}return null}var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);if(i===null){return null}return this.at(i,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0){return true}var i=e.normal.dot(this.direction);if(i*t<0){return true}return false},intersectBox:function(e,t){var i,r,n,a,o,s;var l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z;var h=this.origin;if(l>=0){i=(e.min.x-h.x)*l;r=(e.max.x-h.x)*l}else{i=(e.max.x-h.x)*l;r=(e.min.x-h.x)*l}if(c>=0){n=(e.min.y-h.y)*c;a=(e.max.y-h.y)*c}else{n=(e.max.y-h.y)*c;a=(e.min.y-h.y)*c}if(i>a||n>r)return null;if(n>i||i!==i)i=n;if(a<r||r!==r)r=a;if(u>=0){o=(e.min.z-h.z)*u;s=(e.max.z-h.z)*u}else{o=(e.max.z-h.z)*u;s=(e.min.z-h.z)*u}if(i>s||o>r)return null;if(o>i||i!==i)i=o;if(s<r||r!==r)r=s;if(r<0)return null;return this.at(i>=0?i:r,t)},intersectsBox:function(e){return this.intersectBox(e,_vector$2)!==null},intersectTriangle:function(e,t,i,r,n){_edge1.subVectors(t,e);_edge2.subVectors(i,e);_normal.crossVectors(_edge1,_edge2);var a=this.direction.dot(_normal);var o;if(a>0){if(r)return null;o=1}else if(a<0){o=-1;a=-a}else{return null}_diff.subVectors(this.origin,e);var s=o*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(s<0){return null}var l=o*this.direction.dot(_edge1.cross(_diff));if(l<0){return null}if(s+l>a){return null}var c=-o*_diff.dot(_normal);if(c<0){return null}return this.at(c/a,n)},applyMatrix4:function(e){this.origin.applyMatrix4(e);this.direction.transformDirection(e);return this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var _vector1=new Vector3;var _vector2=new Vector3;var _normalMatrix=new Matrix3;function Plane(e,t){this.normal=e!==undefined?e:new Vector3(1,0,0);this.constant=t!==undefined?t:0}Object.assign(Plane.prototype,{isPlane:true,set:function(e,t){this.normal.copy(e);this.constant=t;return this},setComponents:function(e,t,i,r){this.normal.set(e,t,i);this.constant=r;return this},setFromNormalAndCoplanarPoint:function(e,t){this.normal.copy(e);this.constant=-t.dot(this.normal);return this},setFromCoplanarPoints:function(e,t,i){var r=_vector1.subVectors(i,t).cross(_vector2.subVectors(e,t)).normalize();this.setFromNormalAndCoplanarPoint(r,e);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.normal.copy(e.normal);this.constant=e.constant;return this},normalize:function(){var e=1/this.normal.length();this.normal.multiplyScalar(e);this.constant*=e;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){if(t===undefined){console.warn("THREE.Plane: .projectPoint() target is now required");t=new Vector3}return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){if(t===undefined){console.warn("THREE.Plane: .intersectLine() target is now required");t=new Vector3}var i=e.delta(_vector1);var r=this.normal.dot(i);if(r===0){if(this.distanceToPoint(e.start)===0){return t.copy(e.start)}return undefined}var n=-(e.start.dot(this.normal)+this.constant)/r;if(n<0||n>1){return undefined}return t.copy(i).multiplyScalar(n).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start);var i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){if(e===undefined){console.warn("THREE.Plane: .coplanarPoint() target is now required");e=new Vector3}return e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var i=t||_normalMatrix.getNormalMatrix(e);var r=this.coplanarPoint(_vector1).applyMatrix4(e);var n=this.normal.applyMatrix3(i).normalize();this.constant=-r.dot(n);return this},translate:function(e){this.constant-=e.dot(this.normal);return this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var _v0$1=new Vector3;var _v1$3=new Vector3;var _v2$1=new Vector3;var _v3=new Vector3;var _vab=new Vector3;var _vac=new Vector3;var _vbc=new Vector3;var _vap=new Vector3;var _vbp=new Vector3;var _vcp=new Vector3;function Triangle(e,t,i){this.a=e!==undefined?e:new Vector3;this.b=t!==undefined?t:new Vector3;this.c=i!==undefined?i:new Vector3}Object.assign(Triangle,{getNormal:function(e,t,i,r){if(r===undefined){console.warn("THREE.Triangle: .getNormal() target is now required");r=new Vector3}r.subVectors(i,t);_v0$1.subVectors(e,t);r.cross(_v0$1);var n=r.lengthSq();if(n>0){return r.multiplyScalar(1/Math.sqrt(n))}return r.set(0,0,0)},getBarycoord:function(e,t,i,r,n){_v0$1.subVectors(r,t);_v1$3.subVectors(i,t);_v2$1.subVectors(e,t);var a=_v0$1.dot(_v0$1);var o=_v0$1.dot(_v1$3);var s=_v0$1.dot(_v2$1);var l=_v1$3.dot(_v1$3);var c=_v1$3.dot(_v2$1);var u=a*l-o*o;if(n===undefined){console.warn("THREE.Triangle: .getBarycoord() target is now required");n=new Vector3}if(u===0){return n.set(-2,-1,-1)}var h=1/u;var p=(l*s-o*c)*h;var m=(a*c-o*s)*h;return n.set(1-p-m,m,p)},containsPoint:function(e,t,i,r){Triangle.getBarycoord(e,t,i,r,_v3);return _v3.x>=0&&_v3.y>=0&&_v3.x+_v3.y<=1},getUV:function(e,t,i,r,n,a,o,s){this.getBarycoord(e,t,i,r,_v3);s.set(0,0);s.addScaledVector(n,_v3.x);s.addScaledVector(a,_v3.y);s.addScaledVector(o,_v3.z);return s},isFrontFacing:function(e,t,i,r){_v0$1.subVectors(i,t);_v1$3.subVectors(e,t);return _v0$1.cross(_v1$3).dot(r)<0?true:false}});Object.assign(Triangle.prototype,{set:function(e,t,i){this.a.copy(e);this.b.copy(t);this.c.copy(i);return this},setFromPointsAndIndices:function(e,t,i,r){this.a.copy(e[t]);this.b.copy(e[i]);this.c.copy(e[r]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a.copy(e.a);this.b.copy(e.b);this.c.copy(e.c);return this},getArea:function(){_v0$1.subVectors(this.c,this.b);_v1$3.subVectors(this.a,this.b);return _v0$1.cross(_v1$3).length()*.5},getMidpoint:function(e){if(e===undefined){console.warn("THREE.Triangle: .getMidpoint() target is now required");e=new Vector3}return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Triangle.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){if(e===undefined){console.warn("THREE.Triangle: .getPlane() target is now required");e=new Plane}return e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,i,r,n){return Triangle.getUV(e,this.a,this.b,this.c,t,i,r,n)},containsPoint:function(e){return Triangle.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return Triangle.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){if(t===undefined){console.warn("THREE.Triangle: .closestPointToPoint() target is now required");t=new Vector3}var i=this.a,r=this.b,n=this.c;var a,o;_vab.subVectors(r,i);_vac.subVectors(n,i);_vap.subVectors(e,i);var s=_vab.dot(_vap);var l=_vac.dot(_vap);if(s<=0&&l<=0){return t.copy(i)}_vbp.subVectors(e,r);var c=_vab.dot(_vbp);var u=_vac.dot(_vbp);if(c>=0&&u<=c){return t.copy(r)}var h=s*u-c*l;if(h<=0&&s>=0&&c<=0){a=s/(s-c);return t.copy(i).addScaledVector(_vab,a)}_vcp.subVectors(e,n);var p=_vab.dot(_vcp);var m=_vac.dot(_vcp);if(m>=0&&p<=m){return t.copy(n)}var f=p*l-s*m;if(f<=0&&l>=0&&m<=0){o=l/(l-m);return t.copy(i).addScaledVector(_vac,o)}var d=c*m-p*u;if(d<=0&&u-c>=0&&p-m>=0){_vbc.subVectors(n,r);o=(u-c)/(u-c+(p-m));return t.copy(r).addScaledVector(_vbc,o)}var _=1/(d+f+h);a=f*_;o=h*_;return t.copy(i).addScaledVector(_vab,a).addScaledVector(_vac,o)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};var _hslA={h:0,s:0,l:0};var _hslB={h:0,s:0,l:0};function Color(e,t,i){if(t===undefined&&i===undefined){return this.set(e)}return this.setRGB(e,t,i)}function hue2rgb(e,t,i){if(i<0)i+=1;if(i>1)i-=1;if(i<1/6)return e+(t-e)*6*i;if(i<1/2)return t;if(i<2/3)return e+(t-e)*6*(2/3-i);return e}function SRGBToLinear(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function LinearToSRGB(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}Object.assign(Color.prototype,{isColor:true,r:1,g:1,b:1,set:function(e){if(e&&e.isColor){this.copy(e)}else if(typeof e==="number"){this.setHex(e)}else if(typeof e==="string"){this.setStyle(e)}return this},setScalar:function(e){this.r=e;this.g=e;this.b=e;return this},setHex:function(e){e=Math.floor(e);this.r=(e>>16&255)/255;this.g=(e>>8&255)/255;this.b=(e&255)/255;return this},setRGB:function(e,t,i){this.r=e;this.g=t;this.b=i;return this},setHSL:function(e,t,i){e=MathUtils.euclideanModulo(e,1);t=MathUtils.clamp(t,0,1);i=MathUtils.clamp(i,0,1);if(t===0){this.r=this.g=this.b=i}else{var r=i<=.5?i*(1+t):i+t-i*t;var n=2*i-r;this.r=hue2rgb(n,r,e+1/3);this.g=hue2rgb(n,r,e);this.b=hue2rgb(n,r,e-1/3)}return this},setStyle:function(e){function t(t){if(t===undefined)return;if(parseFloat(t)<1){console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r;var n=i[1];var a=i[2];switch(n){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){this.r=Math.min(255,parseInt(r[1],10))/255;this.g=Math.min(255,parseInt(r[2],10))/255;this.b=Math.min(255,parseInt(r[3],10))/255;t(r[5]);return this}if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){this.r=Math.min(100,parseInt(r[1],10))/100;this.g=Math.min(100,parseInt(r[2],10))/100;this.b=Math.min(100,parseInt(r[3],10))/100;t(r[5]);return this}break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(r[1])/360;var s=parseInt(r[2],10)/100;var l=parseInt(r[3],10)/100;t(r[5]);return this.setHSL(o,s,l)}break}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c=i[1];var u=c.length;if(u===3){this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255;this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255;this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255;return this}else if(u===6){this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255;this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255;this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255;return this}}if(e&&e.length>0){return this.setColorName(e)}return this},setColorName:function(e){var t=_colorKeywords[e];if(t!==undefined){this.setHex(t)}else{console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){this.r=e.r;this.g=e.g;this.b=e.b;return this},copyGammaToLinear:function(e,t){if(t===undefined)t=2;this.r=Math.pow(e.r,t);this.g=Math.pow(e.g,t);this.b=Math.pow(e.b,t);return this},copyLinearToGamma:function(e,t){if(t===undefined)t=2;var i=t>0?1/t:1;this.r=Math.pow(e.r,i);this.g=Math.pow(e.g,i);this.b=Math.pow(e.b,i);return this},convertGammaToLinear:function(e){this.copyGammaToLinear(this,e);return this},convertLinearToGamma:function(e){this.copyLinearToGamma(this,e);return this},copySRGBToLinear:function(e){this.r=SRGBToLinear(e.r);this.g=SRGBToLinear(e.g);this.b=SRGBToLinear(e.b);return this},copyLinearToSRGB:function(e){this.r=LinearToSRGB(e.r);this.g=LinearToSRGB(e.g);this.b=LinearToSRGB(e.b);return this},convertSRGBToLinear:function(){this.copySRGBToLinear(this);return this},convertLinearToSRGB:function(){this.copyLinearToSRGB(this);return this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){if(e===undefined){console.warn("THREE.Color: .getHSL() target is now required");e={h:0,s:0,l:0}}var t=this.r,i=this.g,r=this.b;var n=Math.max(t,i,r);var a=Math.min(t,i,r);var o,s;var l=(a+n)/2;if(a===n){o=0;s=0}else{var c=n-a;s=l<=.5?c/(n+a):c/(2-n-a);switch(n){case t:o=(i-r)/c+(i<r?6:0);break;case i:o=(r-t)/c+2;break;case r:o=(t-i)/c+4;break}o/=6}e.h=o;e.s=s;e.l=l;return e},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,i){this.getHSL(_hslA);_hslA.h+=e;_hslA.s+=t;_hslA.l+=i;this.setHSL(_hslA.h,_hslA.s,_hslA.l);return this},add:function(e){this.r+=e.r;this.g+=e.g;this.b+=e.b;return this},addColors:function(e,t){this.r=e.r+t.r;this.g=e.g+t.g;this.b=e.b+t.b;return this},addScalar:function(e){this.r+=e;this.g+=e;this.b+=e;return this},sub:function(e){this.r=Math.max(0,this.r-e.r);this.g=Math.max(0,this.g-e.g);this.b=Math.max(0,this.b-e.b);return this},multiply:function(e){this.r*=e.r;this.g*=e.g;this.b*=e.b;return this},multiplyScalar:function(e){this.r*=e;this.g*=e;this.b*=e;return this},lerp:function(e,t){this.r+=(e.r-this.r)*t;this.g+=(e.g-this.g)*t;this.b+=(e.b-this.b)*t;return this},lerpHSL:function(e,t){this.getHSL(_hslA);e.getHSL(_hslB);var i=MathUtils.lerp(_hslA.h,_hslB.h,t);var r=MathUtils.lerp(_hslA.s,_hslB.s,t);var n=MathUtils.lerp(_hslA.l,_hslB.l,t);this.setHSL(i,r,n);return this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){if(t===undefined)t=0;this.r=e[t];this.g=e[t+1];this.b=e[t+2];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.r;e[t+1]=this.g;e[t+2]=this.b;return e},toJSON:function(){return this.getHex()}});Color.NAMES=_colorKeywords;function Face3(e,t,i,r,n,a){this.a=e;this.b=t;this.c=i;this.normal=r&&r.isVector3?r:new Vector3;this.vertexNormals=Array.isArray(r)?r:[];this.color=n&&n.isColor?n:new Color;this.vertexColors=Array.isArray(n)?n:[];this.materialIndex=a!==undefined?a:0}Object.assign(Face3.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a;this.b=e.b;this.c=e.c;this.normal.copy(e.normal);this.color.copy(e.color);this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++){this.vertexNormals[t]=e.vertexNormals[t].clone()}for(var t=0,i=e.vertexColors.length;t<i;t++){this.vertexColors[t]=e.vertexColors[t].clone()}return this}});var materialId=0;function Material(){Object.defineProperty(this,"id",{value:materialId++});this.uuid=MathUtils.generateUUID();this.name="";this.type="Material";this.fog=true;this.blending=NormalBlending;this.side=FrontSide;this.flatShading=false;this.vertexColors=false;this.opacity=1;this.transparent=false;this.blendSrc=SrcAlphaFactor;this.blendDst=OneMinusSrcAlphaFactor;this.blendEquation=AddEquation;this.blendSrcAlpha=null;this.blendDstAlpha=null;this.blendEquationAlpha=null;this.depthFunc=LessEqualDepth;this.depthTest=true;this.depthWrite=true;this.stencilWriteMask=255;this.stencilFunc=AlwaysStencilFunc;this.stencilRef=0;this.stencilFuncMask=255;this.stencilFail=KeepStencilOp;this.stencilZFail=KeepStencilOp;this.stencilZPass=KeepStencilOp;this.stencilWrite=false;this.clippingPlanes=null;this.clipIntersection=false;this.clipShadows=false;this.shadowSide=null;this.colorWrite=true;this.precision=null;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.dithering=false;this.alphaTest=0;this.premultipliedAlpha=false;this.visible=true;this.toneMapped=true;this.userData={};this.version=0}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:true,onBeforeCompile:function(){},setValues:function(e){if(e===undefined)return;for(var t in e){var i=e[t];if(i===undefined){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=i===FlatShading?true:false;continue}var r=this[t];if(r===undefined){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}if(r&&r.isColor){r.set(i)}else if(r&&r.isVector3&&(i&&i.isVector3)){r.copy(i)}else{this[t]=i}}},toJSON:function(e){var t=e===undefined||typeof e==="string";if(t){e={textures:{},images:{}}}var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid;i.type=this.type;if(this.name!=="")i.name=this.name;if(this.color&&this.color.isColor)i.color=this.color.getHex();if(this.roughness!==undefined)i.roughness=this.roughness;if(this.metalness!==undefined)i.metalness=this.metalness;if(this.sheen&&this.sheen.isColor)i.sheen=this.sheen.getHex();if(this.emissive&&this.emissive.isColor)i.emissive=this.emissive.getHex();if(this.emissiveIntensity&&this.emissiveIntensity!==1)i.emissiveIntensity=this.emissiveIntensity;if(this.specular&&this.specular.isColor)i.specular=this.specular.getHex();if(this.shininess!==undefined)i.shininess=this.shininess;if(this.clearcoat!==undefined)i.clearcoat=this.clearcoat;if(this.clearcoatRoughness!==undefined)i.clearcoatRoughness=this.clearcoatRoughness;if(this.clearcoatMap&&this.clearcoatMap.isTexture){i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid}if(this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture){i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid}if(this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture){i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid;i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()}if(this.map&&this.map.isTexture)i.map=this.map.toJSON(e).uuid;if(this.matcap&&this.matcap.isTexture)i.matcap=this.matcap.toJSON(e).uuid;if(this.alphaMap&&this.alphaMap.isTexture)i.alphaMap=this.alphaMap.toJSON(e).uuid;if(this.lightMap&&this.lightMap.isTexture)i.lightMap=this.lightMap.toJSON(e).uuid;if(this.aoMap&&this.aoMap.isTexture){i.aoMap=this.aoMap.toJSON(e).uuid;i.aoMapIntensity=this.aoMapIntensity}if(this.bumpMap&&this.bumpMap.isTexture){i.bumpMap=this.bumpMap.toJSON(e).uuid;i.bumpScale=this.bumpScale}if(this.normalMap&&this.normalMap.isTexture){i.normalMap=this.normalMap.toJSON(e).uuid;i.normalMapType=this.normalMapType;i.normalScale=this.normalScale.toArray()}if(this.displacementMap&&this.displacementMap.isTexture){i.displacementMap=this.displacementMap.toJSON(e).uuid;i.displacementScale=this.displacementScale;i.displacementBias=this.displacementBias}if(this.roughnessMap&&this.roughnessMap.isTexture)i.roughnessMap=this.roughnessMap.toJSON(e).uuid;if(this.metalnessMap&&this.metalnessMap.isTexture)i.metalnessMap=this.metalnessMap.toJSON(e).uuid;if(this.emissiveMap&&this.emissiveMap.isTexture)i.emissiveMap=this.emissiveMap.toJSON(e).uuid;if(this.specularMap&&this.specularMap.isTexture)i.specularMap=this.specularMap.toJSON(e).uuid;if(this.envMap&&this.envMap.isTexture){i.envMap=this.envMap.toJSON(e).uuid;i.reflectivity=this.reflectivity;i.refractionRatio=this.refractionRatio;if(this.combine!==undefined)i.combine=this.combine;if(this.envMapIntensity!==undefined)i.envMapIntensity=this.envMapIntensity}if(this.gradientMap&&this.gradientMap.isTexture){i.gradientMap=this.gradientMap.toJSON(e).uuid}if(this.size!==undefined)i.size=this.size;if(this.sizeAttenuation!==undefined)i.sizeAttenuation=this.sizeAttenuation;if(this.blending!==NormalBlending)i.blending=this.blending;if(this.flatShading===true)i.flatShading=this.flatShading;if(this.side!==FrontSide)i.side=this.side;if(this.vertexColors)i.vertexColors=true;if(this.opacity<1)i.opacity=this.opacity;if(this.transparent===true)i.transparent=this.transparent;i.depthFunc=this.depthFunc;i.depthTest=this.depthTest;i.depthWrite=this.depthWrite;i.stencilWrite=this.stencilWrite;i.stencilWriteMask=this.stencilWriteMask;i.stencilFunc=this.stencilFunc;i.stencilRef=this.stencilRef;i.stencilFuncMask=this.stencilFuncMask;i.stencilFail=this.stencilFail;i.stencilZFail=this.stencilZFail;i.stencilZPass=this.stencilZPass;if(this.rotation&&this.rotation!==0)i.rotation=this.rotation;if(this.polygonOffset===true)i.polygonOffset=true;if(this.polygonOffsetFactor!==0)i.polygonOffsetFactor=this.polygonOffsetFactor;if(this.polygonOffsetUnits!==0)i.polygonOffsetUnits=this.polygonOffsetUnits;if(this.linewidth&&this.linewidth!==1)i.linewidth=this.linewidth;if(this.dashSize!==undefined)i.dashSize=this.dashSize;if(this.gapSize!==undefined)i.gapSize=this.gapSize;if(this.scale!==undefined)i.scale=this.scale;if(this.dithering===true)i.dithering=true;if(this.alphaTest>0)i.alphaTest=this.alphaTest;if(this.premultipliedAlpha===true)i.premultipliedAlpha=this.premultipliedAlpha;if(this.wireframe===true)i.wireframe=this.wireframe;if(this.wireframeLinewidth>1)i.wireframeLinewidth=this.wireframeLinewidth;if(this.wireframeLinecap!=="round")i.wireframeLinecap=this.wireframeLinecap;if(this.wireframeLinejoin!=="round")i.wireframeLinejoin=this.wireframeLinejoin;if(this.morphTargets===true)i.morphTargets=true;if(this.morphNormals===true)i.morphNormals=true;if(this.skinning===true)i.skinning=true;if(this.visible===false)i.visible=false;if(this.toneMapped===false)i.toneMapped=false;if(JSON.stringify(this.userData)!=="{}")i.userData=this.userData;function r(e){var t=[];for(var i in e){var r=e[i];delete r.metadata;t.push(r)}return t}if(t){var n=r(e.textures);var a=r(e.images);if(n.length>0)i.textures=n;if(a.length>0)i.images=a}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name;this.fog=e.fog;this.blending=e.blending;this.side=e.side;this.flatShading=e.flatShading;this.vertexColors=e.vertexColors;this.opacity=e.opacity;this.transparent=e.transparent;this.blendSrc=e.blendSrc;this.blendDst=e.blendDst;this.blendEquation=e.blendEquation;this.blendSrcAlpha=e.blendSrcAlpha;this.blendDstAlpha=e.blendDstAlpha;this.blendEquationAlpha=e.blendEquationAlpha;this.depthFunc=e.depthFunc;this.depthTest=e.depthTest;this.depthWrite=e.depthWrite;this.stencilWriteMask=e.stencilWriteMask;this.stencilFunc=e.stencilFunc;this.stencilRef=e.stencilRef;this.stencilFuncMask=e.stencilFuncMask;this.stencilFail=e.stencilFail;this.stencilZFail=e.stencilZFail;this.stencilZPass=e.stencilZPass;this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,i=null;if(t!==null){var r=t.length;i=new Array(r);for(var n=0;n!==r;++n)i[n]=t[n].clone()}this.clippingPlanes=i;this.clipIntersection=e.clipIntersection;this.clipShadows=e.clipShadows;this.shadowSide=e.shadowSide;this.colorWrite=e.colorWrite;this.precision=e.precision;this.polygonOffset=e.polygonOffset;this.polygonOffsetFactor=e.polygonOffsetFactor;this.polygonOffsetUnits=e.polygonOffsetUnits;this.dithering=e.dithering;this.alphaTest=e.alphaTest;this.premultipliedAlpha=e.premultipliedAlpha;this.visible=e.visible;this.toneMapped=e.toneMapped;this.userData=JSON.parse(JSON.stringify(e.userData));return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.defineProperty(Material.prototype,"needsUpdate",{set:function(e){if(e===true)this.version++}});function MeshBasicMaterial(e){Material.call(this);this.type="MeshBasicMaterial";this.color=new Color(16777215);this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.skinning=false;this.morphTargets=false;this.setValues(e)}MeshBasicMaterial.prototype=Object.create(Material.prototype);MeshBasicMaterial.prototype.constructor=MeshBasicMaterial;MeshBasicMaterial.prototype.isMeshBasicMaterial=true;MeshBasicMaterial.prototype.copy=function(e){Material.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.skinning=e.skinning;this.morphTargets=e.morphTargets;return this};var _vector$3=new Vector3;function BufferAttribute(e,t,i){if(Array.isArray(e)){throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.")}this.name="";this.array=e;this.itemSize=t;this.count=e!==undefined?e.length/t:0;this.normalized=i===true;this.usage=StaticDrawUsage;this.updateRange={offset:0,count:-1};this.version=0}Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(e){if(e===true)this.version++}});Object.assign(BufferAttribute.prototype,{isBufferAttribute:true,onUploadCallback:function(){},setUsage:function(e){this.usage=e;return this},copy:function(e){this.name=e.name;this.array=new e.array.constructor(e.array);this.itemSize=e.itemSize;this.count=e.count;this.normalized=e.normalized;this.usage=e.usage;return this},copyAt:function(e,t,i){e*=this.itemSize;i*=t.itemSize;for(var r=0,n=this.itemSize;r<n;r++){this.array[e+r]=t.array[i+r]}return this},copyArray:function(e){this.array.set(e);return this},copyColorsArray:function(e){var t=this.array,i=0;for(var r=0,n=e.length;r<n;r++){var a=e[r];if(a===undefined){console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r);a=new Color}t[i++]=a.r;t[i++]=a.g;t[i++]=a.b}return this},copyVector2sArray:function(e){var t=this.array,i=0;for(var r=0,n=e.length;r<n;r++){var a=e[r];if(a===undefined){console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r);a=new Vector2}t[i++]=a.x;t[i++]=a.y}return this},copyVector3sArray:function(e){var t=this.array,i=0;for(var r=0,n=e.length;r<n;r++){var a=e[r];if(a===undefined){console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r);a=new Vector3}t[i++]=a.x;t[i++]=a.y;t[i++]=a.z}return this},copyVector4sArray:function(e){var t=this.array,i=0;for(var r=0,n=e.length;r<n;r++){var a=e[r];if(a===undefined){console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r);a=new Vector4}t[i++]=a.x;t[i++]=a.y;t[i++]=a.z;t[i++]=a.w}return this},applyMatrix3:function(e){for(var t=0,i=this.count;t<i;t++){_vector$3.x=this.getX(t);_vector$3.y=this.getY(t);_vector$3.z=this.getZ(t);_vector$3.applyMatrix3(e);this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z)}return this},applyMatrix4:function(e){for(var t=0,i=this.count;t<i;t++){_vector$3.x=this.getX(t);_vector$3.y=this.getY(t);_vector$3.z=this.getZ(t);_vector$3.applyMatrix4(e);this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z)}return this},applyNormalMatrix:function(e){for(var t=0,i=this.count;t<i;t++){_vector$3.x=this.getX(t);_vector$3.y=this.getY(t);_vector$3.z=this.getZ(t);_vector$3.applyNormalMatrix(e);this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z)}return this},transformDirection:function(e){for(var t=0,i=this.count;t<i;t++){_vector$3.x=this.getX(t);_vector$3.y=this.getY(t);_vector$3.z=this.getZ(t);_vector$3.transformDirection(e);this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z)}return this},set:function(e,t){if(t===undefined)t=0;this.array.set(e,t);return this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){this.array[e*this.itemSize]=t;return this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){this.array[e*this.itemSize+1]=t;return this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){this.array[e*this.itemSize+2]=t;return this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){this.array[e*this.itemSize+3]=t;return this},setXY:function(e,t,i){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=i;return this},setXYZ:function(e,t,i,r){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=i;this.array[e+2]=r;return this},setXYZW:function(e,t,i,r,n){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=i;this.array[e+2]=r;this.array[e+3]=n;return this},onUpload:function(e){this.onUploadCallback=e;return this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});function Int8BufferAttribute(e,t,i){BufferAttribute.call(this,new Int8Array(e),t,i)}Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int8BufferAttribute.prototype.constructor=Int8BufferAttribute;function Uint8BufferAttribute(e,t,i){BufferAttribute.call(this,new Uint8Array(e),t,i)}Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute;function Uint8ClampedBufferAttribute(e,t,i){BufferAttribute.call(this,new Uint8ClampedArray(e),t,i)}Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute;function Int16BufferAttribute(e,t,i){BufferAttribute.call(this,new Int16Array(e),t,i)}Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int16BufferAttribute.prototype.constructor=Int16BufferAttribute;function Uint16BufferAttribute(e,t,i){BufferAttribute.call(this,new Uint16Array(e),t,i)}Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute;function Int32BufferAttribute(e,t,i){BufferAttribute.call(this,new Int32Array(e),t,i)}Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int32BufferAttribute.prototype.constructor=Int32BufferAttribute;function Uint32BufferAttribute(e,t,i){BufferAttribute.call(this,new Uint32Array(e),t,i)}Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute;function Float32BufferAttribute(e,t,i){BufferAttribute.call(this,new Float32Array(e),t,i)}Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Float32BufferAttribute.prototype.constructor=Float32BufferAttribute;function Float64BufferAttribute(e,t,i){BufferAttribute.call(this,new Float64Array(e),t,i)}Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Float64BufferAttribute.prototype.constructor=Float64BufferAttribute;function DirectGeometry(){this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingBox=null;this.boundingSphere=null;this.verticesNeedUpdate=false;this.normalsNeedUpdate=false;this.colorsNeedUpdate=false;this.uvsNeedUpdate=false;this.groupsNeedUpdate=false}Object.assign(DirectGeometry.prototype,{computeGroups:function(e){var t;var i=[];var r=undefined;var n=e.faces;for(var a=0;a<n.length;a++){var o=n[a];if(o.materialIndex!==r){r=o.materialIndex;if(t!==undefined){t.count=a*3-t.start;i.push(t)}t={start:a*3,materialIndex:r}}}if(t!==undefined){t.count=a*3-t.start;i.push(t)}this.groups=i},fromGeometry:function(e){var t=e.faces;var i=e.vertices;var r=e.faceVertexUvs;var n=r[0]&&r[0].length>0;var a=r[1]&&r[1].length>0;var o=e.morphTargets;var s=o.length;var l;if(s>0){l=[];for(var c=0;c<s;c++){l[c]={name:o[c].name,data:[]}}this.morphTargets.position=l}var u=e.morphNormals;var h=u.length;var p;if(h>0){p=[];for(var c=0;c<h;c++){p[c]={name:u[c].name,data:[]}}this.morphTargets.normal=p}var m=e.skinIndices;var f=e.skinWeights;var d=m.length===i.length;var _=f.length===i.length;if(i.length>0&&t.length===0){console.error("THREE.DirectGeometry: Faceless geometries are not supported.")}for(var c=0;c<t.length;c++){var y=t[c];this.vertices.push(i[y.a],i[y.b],i[y.c]);var v=y.vertexNormals;if(v.length===3){this.normals.push(v[0],v[1],v[2])}else{var g=y.normal;this.normals.push(g,g,g)}var x=y.vertexColors;if(x.length===3){this.colors.push(x[0],x[1],x[2])}else{var b=y.color;this.colors.push(b,b,b)}if(n===true){var M=r[0][c];if(M!==undefined){this.uvs.push(M[0],M[1],M[2])}else{console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c);this.uvs.push(new Vector2,new Vector2,new Vector2)}}if(a===true){var M=r[1][c];if(M!==undefined){this.uvs2.push(M[0],M[1],M[2])}else{console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c);this.uvs2.push(new Vector2,new Vector2,new Vector2)}}for(var w=0;w<s;w++){var S=o[w].vertices;l[w].data.push(S[y.a],S[y.b],S[y.c])}for(var w=0;w<h;w++){var A=u[w].vertexNormals[c];p[w].data.push(A.a,A.b,A.c)}if(d){this.skinIndices.push(m[y.a],m[y.b],m[y.c])}if(_){this.skinWeights.push(f[y.a],f[y.b],f[y.c])}}this.computeGroups(e);this.verticesNeedUpdate=e.verticesNeedUpdate;this.normalsNeedUpdate=e.normalsNeedUpdate;this.colorsNeedUpdate=e.colorsNeedUpdate;this.uvsNeedUpdate=e.uvsNeedUpdate;this.groupsNeedUpdate=e.groupsNeedUpdate;if(e.boundingSphere!==null){this.boundingSphere=e.boundingSphere.clone()}if(e.boundingBox!==null){this.boundingBox=e.boundingBox.clone()}return this}});function arrayMax(e){if(e.length===0)return-Infinity;var t=e[0];for(var i=1,r=e.length;i<r;++i){if(e[i]>t)t=e[i]}return t}var _bufferGeometryId=1;var _m1$2=new Matrix4;var _obj=new Object3D;var _offset=new Vector3;var _box$2=new Box3;var _boxMorphTargets=new Box3;var _vector$4=new Vector3;function BufferGeometry(){Object.defineProperty(this,"id",{value:_bufferGeometryId+=2});this.uuid=MathUtils.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.morphTargetsRelative=false;this.groups=[];this.boundingBox=null;this.boundingSphere=null;this.drawRange={start:0,count:Infinity};this.userData={}}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:true,getIndex:function(){return this.index},setIndex:function(e){if(Array.isArray(e)){this.index=new(arrayMax(e)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(e,1)}else{this.index=e}},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){this.attributes[e]=t;return this},deleteAttribute:function(e){delete this.attributes[e];return this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:i!==undefined?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e;this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;if(t!==undefined){t.applyMatrix4(e);t.needsUpdate=true}var i=this.attributes.normal;if(i!==undefined){var r=(new Matrix3).getNormalMatrix(e);i.applyNormalMatrix(r);i.needsUpdate=true}var n=this.attributes.tangent;if(n!==undefined){n.transformDirection(e);n.needsUpdate=true}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}return this},rotateX:function(e){_m1$2.makeRotationX(e);this.applyMatrix4(_m1$2);return this},rotateY:function(e){_m1$2.makeRotationY(e);this.applyMatrix4(_m1$2);return this},rotateZ:function(e){_m1$2.makeRotationZ(e);this.applyMatrix4(_m1$2);return this},translate:function(e,t,i){_m1$2.makeTranslation(e,t,i);this.applyMatrix4(_m1$2);return this},scale:function(e,t,i){_m1$2.makeScale(e,t,i);this.applyMatrix4(_m1$2);return this},lookAt:function(e){_obj.lookAt(e);_obj.updateMatrix();this.applyMatrix4(_obj.matrix);return this},center:function(){this.computeBoundingBox();this.boundingBox.getCenter(_offset).negate();this.translate(_offset.x,_offset.y,_offset.z);return this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var i=new Float32BufferAttribute(t.vertices.length*3,3);var r=new Float32BufferAttribute(t.colors.length*3,3);this.setAttribute("position",i.copyVector3sArray(t.vertices));this.setAttribute("color",r.copyColorsArray(t.colors));if(t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new Float32BufferAttribute(t.lineDistances.length,1);this.setAttribute("lineDistance",n.copyArray(t.lineDistances))}if(t.boundingSphere!==null){this.boundingSphere=t.boundingSphere.clone()}if(t.boundingBox!==null){this.boundingBox=t.boundingBox.clone()}}else if(e.isMesh){if(t&&t.isGeometry){this.fromGeometry(t)}}return this},setFromPoints:function(e){var t=[];for(var i=0,r=e.length;i<r;i++){var n=e[i];t.push(n.x,n.y,n.z||0)}this.setAttribute("position",new Float32BufferAttribute(t,3));return this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var i=t.__directGeometry;if(t.elementsNeedUpdate===true){i=undefined;t.elementsNeedUpdate=false}if(i===undefined){return this.fromGeometry(t)}i.verticesNeedUpdate=t.verticesNeedUpdate;i.normalsNeedUpdate=t.normalsNeedUpdate;i.colorsNeedUpdate=t.colorsNeedUpdate;i.uvsNeedUpdate=t.uvsNeedUpdate;i.groupsNeedUpdate=t.groupsNeedUpdate;t.verticesNeedUpdate=false;t.normalsNeedUpdate=false;t.colorsNeedUpdate=false;t.uvsNeedUpdate=false;t.groupsNeedUpdate=false;t=i}var r;if(t.verticesNeedUpdate===true){r=this.attributes.position;if(r!==undefined){r.copyVector3sArray(t.vertices);r.needsUpdate=true}t.verticesNeedUpdate=false}if(t.normalsNeedUpdate===true){r=this.attributes.normal;if(r!==undefined){r.copyVector3sArray(t.normals);r.needsUpdate=true}t.normalsNeedUpdate=false}if(t.colorsNeedUpdate===true){r=this.attributes.color;if(r!==undefined){r.copyColorsArray(t.colors);r.needsUpdate=true}t.colorsNeedUpdate=false}if(t.uvsNeedUpdate){r=this.attributes.uv;if(r!==undefined){r.copyVector2sArray(t.uvs);r.needsUpdate=true}t.uvsNeedUpdate=false}if(t.lineDistancesNeedUpdate){r=this.attributes.lineDistance;if(r!==undefined){r.copyArray(t.lineDistances);r.needsUpdate=true}t.lineDistancesNeedUpdate=false}if(t.groupsNeedUpdate){t.computeGroups(e.geometry);this.groups=t.groups;t.groupsNeedUpdate=false}return this},fromGeometry:function(e){e.__directGeometry=(new DirectGeometry).fromGeometry(e);return this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(e.vertices.length*3);this.setAttribute("position",new BufferAttribute(t,3).copyVector3sArray(e.vertices));if(e.normals.length>0){var i=new Float32Array(e.normals.length*3);this.setAttribute("normal",new BufferAttribute(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(e.colors.length*3);this.setAttribute("color",new BufferAttribute(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var n=new Float32Array(e.uvs.length*2);this.setAttribute("uv",new BufferAttribute(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(e.uvs2.length*2);this.setAttribute("uv2",new BufferAttribute(a,2).copyVector2sArray(e.uvs2))}this.groups=e.groups;for(var o in e.morphTargets){var s=[];var l=e.morphTargets[o];for(var c=0,u=l.length;c<u;c++){var h=l[c];var p=new Float32BufferAttribute(h.data.length*3,3);p.name=h.name;s.push(p.copyVector3sArray(h.data))}this.morphAttributes[o]=s}if(e.skinIndices.length>0){var m=new Float32BufferAttribute(e.skinIndices.length*4,4);this.setAttribute("skinIndex",m.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new Float32BufferAttribute(e.skinWeights.length*4,4);this.setAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}if(e.boundingSphere!==null){this.boundingSphere=e.boundingSphere.clone()}if(e.boundingBox!==null){this.boundingBox=e.boundingBox.clone()}return this},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new Box3}var e=this.attributes.position;var t=this.morphAttributes.position;if(e!==undefined){this.boundingBox.setFromBufferAttribute(e);if(t){for(var i=0,r=t.length;i<r;i++){var n=t[i];_box$2.setFromBufferAttribute(n);if(this.morphTargetsRelative){_vector$4.addVectors(this.boundingBox.min,_box$2.min);this.boundingBox.expandByPoint(_vector$4);_vector$4.addVectors(this.boundingBox.max,_box$2.max);this.boundingBox.expandByPoint(_vector$4)}else{this.boundingBox.expandByPoint(_box$2.min);this.boundingBox.expandByPoint(_box$2.max)}}}}else{this.boundingBox.makeEmpty()}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new Sphere}var e=this.attributes.position;var t=this.morphAttributes.position;if(e){var i=this.boundingSphere.center;_box$2.setFromBufferAttribute(e);if(t){for(var r=0,n=t.length;r<n;r++){var a=t[r];_boxMorphTargets.setFromBufferAttribute(a);if(this.morphTargetsRelative){_vector$4.addVectors(_box$2.min,_boxMorphTargets.min);_box$2.expandByPoint(_vector$4);_vector$4.addVectors(_box$2.max,_boxMorphTargets.max);_box$2.expandByPoint(_vector$4)}else{_box$2.expandByPoint(_boxMorphTargets.min);_box$2.expandByPoint(_boxMorphTargets.max)}}}_box$2.getCenter(i);var o=0;for(var r=0,n=e.count;r<n;r++){_vector$4.fromBufferAttribute(e,r);o=Math.max(o,i.distanceToSquared(_vector$4))}if(t){for(var r=0,n=t.length;r<n;r++){var a=t[r];var s=this.morphTargetsRelative;for(var l=0,c=a.count;l<c;l++){_vector$4.fromBufferAttribute(a,l);if(s){_offset.fromBufferAttribute(e,l);_vector$4.add(_offset)}o=Math.max(o,i.distanceToSquared(_vector$4))}}}this.boundingSphere.radius=Math.sqrt(o);if(isNaN(this.boundingSphere.radius)){console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index;var t=this.attributes;if(t.position){var i=t.position.array;if(t.normal===undefined){this.setAttribute("normal",new BufferAttribute(new Float32Array(i.length),3))}else{var r=t.normal.array;for(var n=0,a=r.length;n<a;n++){r[n]=0}}var o=t.normal.array;var s,l,c;var u=new Vector3,h=new Vector3,p=new Vector3;var m=new Vector3,f=new Vector3;if(e){var d=e.array;for(var n=0,a=e.count;n<a;n+=3){s=d[n+0]*3;l=d[n+1]*3;c=d[n+2]*3;u.fromArray(i,s);h.fromArray(i,l);p.fromArray(i,c);m.subVectors(p,h);f.subVectors(u,h);m.cross(f);o[s]+=m.x;o[s+1]+=m.y;o[s+2]+=m.z;o[l]+=m.x;o[l+1]+=m.y;o[l+2]+=m.z;o[c]+=m.x;o[c+1]+=m.y;o[c+2]+=m.z}}else{for(var n=0,a=i.length;n<a;n+=9){u.fromArray(i,n);h.fromArray(i,n+3);p.fromArray(i,n+6);m.subVectors(p,h);f.subVectors(u,h);m.cross(f);o[n]=m.x;o[n+1]=m.y;o[n+2]=m.z;o[n+3]=m.x;o[n+4]=m.y;o[n+5]=m.z;o[n+6]=m.x;o[n+7]=m.y;o[n+8]=m.z}}this.normalizeNormals();t.normal.needsUpdate=true}},merge:function(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}if(t===undefined){t=0;console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. "+"Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge.")}var i=this.attributes;for(var r in i){if(e.attributes[r]===undefined)continue;var n=i[r];var a=n.array;var o=e.attributes[r];var s=o.array;var l=o.itemSize*t;var c=Math.min(s.length,a.length-l);for(var u=0,h=l;u<c;u++,h++){a[h]=s[u]}}return this},normalizeNormals:function(){var e=this.attributes.normal;for(var t=0,i=e.count;t<i;t++){_vector$4.x=e.getX(t);_vector$4.y=e.getY(t);_vector$4.z=e.getZ(t);_vector$4.normalize();e.setXYZ(t,_vector$4.x,_vector$4.y,_vector$4.z)}},toNonIndexed:function(){function e(e,t){var i=e.array;var r=e.itemSize;var n=new i.constructor(t.length*r);var a=0,o=0;for(var s=0,l=t.length;s<l;s++){a=t[s]*r;for(var c=0;c<r;c++){n[o++]=i[a++]}}return new BufferAttribute(n,r)}if(this.index===null){console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed.");return this}var t=new BufferGeometry;var i=this.index.array;var r=this.attributes;for(var n in r){var a=r[n];var o=e(a,i);t.setAttribute(n,o)}var s=this.morphAttributes;for(n in s){var l=[];var c=s[n];for(var u=0,h=c.length;u<h;u++){var a=c[u];var o=e(a,i);l.push(o)}t.morphAttributes[n]=l}t.morphTargetsRelative=this.morphTargetsRelative;var p=this.groups;for(var u=0,m=p.length;u<m;u++){var f=p[u];t.addGroup(f.start,f.count,f.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;if(this.name!=="")e.name=this.name;if(Object.keys(this.userData).length>0)e.userData=this.userData;if(this.parameters!==undefined){var t=this.parameters;for(var i in t){if(t[i]!==undefined)e[i]=t[i]}return e}e.data={attributes:{}};var r=this.index;if(r!==null){e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)}}var n=this.attributes;for(var i in n){var a=n[i];var o=a.toJSON();if(a.name!=="")o.name=a.name;e.data.attributes[i]=o}var s={};var l=false;for(var i in this.morphAttributes){var c=this.morphAttributes[i];var u=[];for(var h=0,p=c.length;h<p;h++){var a=c[h];var o=a.toJSON();if(a.name!=="")o.name=a.name;u.push(o)}if(u.length>0){s[i]=u;l=true}}if(l){e.data.morphAttributes=s;e.data.morphTargetsRelative=this.morphTargetsRelative}var m=this.groups;if(m.length>0){e.data.groups=JSON.parse(JSON.stringify(m))}var f=this.boundingSphere;if(f!==null){e.data.boundingSphere={center:f.center.toArray(),radius:f.radius}}return e},clone:function(){return(new BufferGeometry).copy(this)},copy:function(e){var t,i,r;this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingBox=null;this.boundingSphere=null;this.name=e.name;var n=e.index;if(n!==null){this.setIndex(n.clone())}var a=e.attributes;for(t in a){var o=a[t];this.setAttribute(t,o.clone())}var s=e.morphAttributes;for(t in s){var l=[];var c=s[t];for(i=0,r=c.length;i<r;i++){l.push(c[i].clone())}this.morphAttributes[t]=l}this.morphTargetsRelative=e.morphTargetsRelative;var u=e.groups;for(i=0,r=u.length;i<r;i++){var h=u[i];this.addGroup(h.start,h.count,h.materialIndex)}var p=e.boundingBox;if(p!==null){this.boundingBox=p.clone()}var m=e.boundingSphere;if(m!==null){this.boundingSphere=m.clone()}this.drawRange.start=e.drawRange.start;this.drawRange.count=e.drawRange.count;this.userData=e.userData;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var _inverseMatrix=new Matrix4;var _ray=new Ray;var _sphere=new Sphere;var _vA=new Vector3;var _vB=new Vector3;var _vC=new Vector3;var _tempA=new Vector3;var _tempB=new Vector3;var _tempC=new Vector3;var _morphA=new Vector3;var _morphB=new Vector3;var _morphC=new Vector3;var _uvA=new Vector2;var _uvB=new Vector2;var _uvC=new Vector2;var _intersectionPoint=new Vector3;var _intersectionPointWorld=new Vector3;function Mesh(e,t){Object3D.call(this);this.type="Mesh";this.geometry=e!==undefined?e:new BufferGeometry;this.material=t!==undefined?t:new MeshBasicMaterial;this.updateMorphTargets()}Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:true,copy:function(e){Object3D.prototype.copy.call(this,e);if(e.morphTargetInfluences!==undefined){this.morphTargetInfluences=e.morphTargetInfluences.slice()}if(e.morphTargetDictionary!==undefined){this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)}return this},updateMorphTargets:function(){var e=this.geometry;var t,i,r;if(e.isBufferGeometry){var n=e.morphAttributes;var a=Object.keys(n);if(a.length>0){var o=n[a[0]];if(o!==undefined){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(t=0,i=o.length;t<i;t++){r=o[t].name||String(t);this.morphTargetInfluences.push(0);this.morphTargetDictionary[r]=t}}}}else{var s=e.morphTargets;if(s!==undefined&&s.length>0){console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},raycast:function(e,t){var i=this.geometry;var r=this.material;var n=this.matrixWorld;if(r===undefined)return;if(i.boundingSphere===null)i.computeBoundingSphere();_sphere.copy(i.boundingSphere);_sphere.applyMatrix4(n);if(e.ray.intersectsSphere(_sphere)===false)return;_inverseMatrix.getInverse(n);_ray.copy(e.ray).applyMatrix4(_inverseMatrix);if(i.boundingBox!==null){if(_ray.intersectsBox(i.boundingBox)===false)return}var a;if(i.isBufferGeometry){var o,s,l;var c=i.index;var u=i.attributes.position;var h=i.morphAttributes.position;var p=i.morphTargetsRelative;var m=i.attributes.uv;var f=i.attributes.uv2;var d=i.groups;var _=i.drawRange;var y,v,g,x;var b,M;var w,S;if(c!==null){if(Array.isArray(r)){for(y=0,g=d.length;y<g;y++){b=d[y];M=r[b.materialIndex];w=Math.max(b.start,_.start);S=Math.min(b.start+b.count,_.start+_.count);for(v=w,x=S;v<x;v+=3){o=c.getX(v);s=c.getX(v+1);l=c.getX(v+2);a=checkBufferGeometryIntersection(this,M,e,_ray,u,h,p,m,f,o,s,l);if(a){a.faceIndex=Math.floor(v/3);a.face.materialIndex=b.materialIndex;t.push(a)}}}}else{w=Math.max(0,_.start);S=Math.min(c.count,_.start+_.count);for(y=w,g=S;y<g;y+=3){o=c.getX(y);s=c.getX(y+1);l=c.getX(y+2);a=checkBufferGeometryIntersection(this,r,e,_ray,u,h,p,m,f,o,s,l);if(a){a.faceIndex=Math.floor(y/3);t.push(a)}}}}else if(u!==undefined){if(Array.isArray(r)){for(y=0,g=d.length;y<g;y++){b=d[y];M=r[b.materialIndex];w=Math.max(b.start,_.start);S=Math.min(b.start+b.count,_.start+_.count);for(v=w,x=S;v<x;v+=3){o=v;s=v+1;l=v+2;a=checkBufferGeometryIntersection(this,M,e,_ray,u,h,p,m,f,o,s,l);if(a){a.faceIndex=Math.floor(v/3);a.face.materialIndex=b.materialIndex;t.push(a)}}}}else{w=Math.max(0,_.start);S=Math.min(u.count,_.start+_.count);for(y=w,g=S;y<g;y+=3){o=y;s=y+1;l=y+2;a=checkBufferGeometryIntersection(this,r,e,_ray,u,h,p,m,f,o,s,l);if(a){a.faceIndex=Math.floor(y/3);t.push(a)}}}}}else if(i.isGeometry){var A,C,T;var B=Array.isArray(r);var L=i.vertices;var D=i.faces;var E;var R=i.faceVertexUvs[0];if(R.length>0)E=R;for(var P=0,G=D.length;P<G;P++){var I=D[P];var V=B?r[I.materialIndex]:r;if(V===undefined)continue;A=L[I.a];C=L[I.b];T=L[I.c];a=checkIntersection(this,V,e,_ray,A,C,T,_intersectionPoint);if(a){if(E&&E[P]){var F=E[P];_uvA.copy(F[0]);_uvB.copy(F[1]);_uvC.copy(F[2]);a.uv=Triangle.getUV(_intersectionPoint,A,C,T,_uvA,_uvB,_uvC,new Vector2)}a.face=I;a.faceIndex=P;t.push(a)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function checkIntersection(e,t,i,r,n,a,o,s){var l;if(t.side===BackSide){l=r.intersectTriangle(o,a,n,true,s)}else{l=r.intersectTriangle(n,a,o,t.side!==DoubleSide,s)}if(l===null)return null;_intersectionPointWorld.copy(s);_intersectionPointWorld.applyMatrix4(e.matrixWorld);var c=i.ray.origin.distanceTo(_intersectionPointWorld);if(c<i.near||c>i.far)return null;return{distance:c,point:_intersectionPointWorld.clone(),object:e}}function checkBufferGeometryIntersection(e,t,i,r,n,a,o,s,l,c,u,h){_vA.fromBufferAttribute(n,c);_vB.fromBufferAttribute(n,u);_vC.fromBufferAttribute(n,h);var p=e.morphTargetInfluences;if(t.morphTargets&&a&&p){_morphA.set(0,0,0);_morphB.set(0,0,0);_morphC.set(0,0,0);for(var m=0,f=a.length;m<f;m++){var d=p[m];var _=a[m];if(d===0)continue;_tempA.fromBufferAttribute(_,c);_tempB.fromBufferAttribute(_,u);_tempC.fromBufferAttribute(_,h);if(o){_morphA.addScaledVector(_tempA,d);_morphB.addScaledVector(_tempB,d);_morphC.addScaledVector(_tempC,d)}else{_morphA.addScaledVector(_tempA.sub(_vA),d);_morphB.addScaledVector(_tempB.sub(_vB),d);_morphC.addScaledVector(_tempC.sub(_vC),d)}}_vA.add(_morphA);_vB.add(_morphB);_vC.add(_morphC)}if(e.isSkinnedMesh){e.boneTransform(c,_vA);e.boneTransform(u,_vB);e.boneTransform(h,_vC)}var y=checkIntersection(e,t,i,r,_vA,_vB,_vC,_intersectionPoint);if(y){if(s){_uvA.fromBufferAttribute(s,c);_uvB.fromBufferAttribute(s,u);_uvC.fromBufferAttribute(s,h);y.uv=Triangle.getUV(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2)}if(l){_uvA.fromBufferAttribute(l,c);_uvB.fromBufferAttribute(l,u);_uvC.fromBufferAttribute(l,h);y.uv2=Triangle.getUV(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2)}var v=new Face3(c,u,h);Triangle.getNormal(_vA,_vB,_vC,v.normal);y.face=v}return y}var _geometryId=0;var _m1$3=new Matrix4;var _obj$1=new Object3D;var _offset$1=new Vector3;function Geometry(){Object.defineProperty(this,"id",{value:_geometryId+=2});this.uuid=MathUtils.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.elementsNeedUpdate=false;this.verticesNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.groupsNeedUpdate=false}Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:true,applyMatrix4:function(e){var t=(new Matrix3).getNormalMatrix(e);for(var i=0,r=this.vertices.length;i<r;i++){var n=this.vertices[i];n.applyMatrix4(e)}for(var i=0,r=this.faces.length;i<r;i++){var a=this.faces[i];a.normal.applyMatrix3(t).normalize();for(var o=0,s=a.vertexNormals.length;o<s;o++){a.vertexNormals[o].applyMatrix3(t).normalize()}}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}this.verticesNeedUpdate=true;this.normalsNeedUpdate=true;return this},rotateX:function(e){_m1$3.makeRotationX(e);this.applyMatrix4(_m1$3);return this},rotateY:function(e){_m1$3.makeRotationY(e);this.applyMatrix4(_m1$3);return this},rotateZ:function(e){_m1$3.makeRotationZ(e);this.applyMatrix4(_m1$3);return this},translate:function(e,t,i){_m1$3.makeTranslation(e,t,i);this.applyMatrix4(_m1$3);return this},scale:function(e,t,i){_m1$3.makeScale(e,t,i);this.applyMatrix4(_m1$3);return this},lookAt:function(e){_obj$1.lookAt(e);_obj$1.updateMatrix();this.applyMatrix4(_obj$1.matrix);return this},fromBufferGeometry:function(e){var t=this;var i=e.index!==null?e.index.array:undefined;var r=e.attributes;if(r.position===undefined){console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion.");return this}var n=r.position.array;var a=r.normal!==undefined?r.normal.array:undefined;var o=r.color!==undefined?r.color.array:undefined;var s=r.uv!==undefined?r.uv.array:undefined;var l=r.uv2!==undefined?r.uv2.array:undefined;if(l!==undefined)this.faceVertexUvs[1]=[];for(var c=0;c<n.length;c+=3){t.vertices.push((new Vector3).fromArray(n,c));if(o!==undefined){t.colors.push((new Color).fromArray(o,c))}}function u(e,i,r,n){var c=o===undefined?[]:[t.colors[e].clone(),t.colors[i].clone(),t.colors[r].clone()];var u=a===undefined?[]:[(new Vector3).fromArray(a,e*3),(new Vector3).fromArray(a,i*3),(new Vector3).fromArray(a,r*3)];var h=new Face3(e,i,r,u,c,n);t.faces.push(h);if(s!==undefined){t.faceVertexUvs[0].push([(new Vector2).fromArray(s,e*2),(new Vector2).fromArray(s,i*2),(new Vector2).fromArray(s,r*2)])}if(l!==undefined){t.faceVertexUvs[1].push([(new Vector2).fromArray(l,e*2),(new Vector2).fromArray(l,i*2),(new Vector2).fromArray(l,r*2)])}}var h=e.groups;if(h.length>0){for(var c=0;c<h.length;c++){var p=h[c];var m=p.start;var f=p.count;for(var d=m,_=m+f;d<_;d+=3){if(i!==undefined){u(i[d],i[d+1],i[d+2],p.materialIndex)}else{u(d,d+1,d+2,p.materialIndex)}}}}else{if(i!==undefined){for(var c=0;c<i.length;c+=3){u(i[c],i[c+1],i[c+2])}}else{for(var c=0;c<n.length/3;c+=3){u(c,c+1,c+2)}}}this.computeFaceNormals();if(e.boundingBox!==null){this.boundingBox=e.boundingBox.clone()}if(e.boundingSphere!==null){this.boundingSphere=e.boundingSphere.clone()}return this},center:function(){this.computeBoundingBox();this.boundingBox.getCenter(_offset$1).negate();this.translate(_offset$1.x,_offset$1.y,_offset$1.z);return this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center;var t=this.boundingSphere.radius;var i=t===0?1:1/t;var r=new Matrix4;r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1);this.applyMatrix4(r);return this},computeFaceNormals:function(){var e=new Vector3,t=new Vector3;for(var i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];var a=this.vertices[n.a];var o=this.vertices[n.b];var s=this.vertices[n.c];e.subVectors(s,o);t.subVectors(a,o);e.cross(t);e.normalize();n.normal.copy(e)}},computeVertexNormals:function(e){if(e===undefined)e=true;var t,i,r,n,a,o;o=new Array(this.vertices.length);for(t=0,i=this.vertices.length;t<i;t++){o[t]=new Vector3}if(e){var s,l,c;var u=new Vector3,h=new Vector3;for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];s=this.vertices[a.a];l=this.vertices[a.b];c=this.vertices[a.c];u.subVectors(c,l);h.subVectors(s,l);u.cross(h);o[a.a].add(u);o[a.b].add(u);o[a.c].add(u)}}else{this.computeFaceNormals();for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];o[a.a].add(a.normal);o[a.b].add(a.normal);o[a.c].add(a.normal)}}for(t=0,i=this.vertices.length;t<i;t++){o[t].normalize()}for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];var p=a.vertexNormals;if(p.length===3){p[0].copy(o[a.a]);p[1].copy(o[a.b]);p[2].copy(o[a.c])}else{p[0]=o[a.a].clone();p[1]=o[a.b].clone();p[2]=o[a.c].clone()}}if(this.faces.length>0){this.normalsNeedUpdate=true}},computeFlatVertexNormals:function(){var e,t,i;this.computeFaceNormals();for(e=0,t=this.faces.length;e<t;e++){i=this.faces[e];var r=i.vertexNormals;if(r.length===3){r[0].copy(i.normal);r[1].copy(i.normal);r[2].copy(i.normal)}else{r[0]=i.normal.clone();r[1]=i.normal.clone();r[2]=i.normal.clone()}}if(this.faces.length>0){this.normalsNeedUpdate=true}},computeMorphNormals:function(){var e,t,i,r,n;for(i=0,r=this.faces.length;i<r;i++){n=this.faces[i];if(!n.__originalFaceNormal){n.__originalFaceNormal=n.normal.clone()}else{n.__originalFaceNormal.copy(n.normal)}if(!n.__originalVertexNormals)n.__originalVertexNormals=[];for(e=0,t=n.vertexNormals.length;e<t;e++){if(!n.__originalVertexNormals[e]){n.__originalVertexNormals[e]=n.vertexNormals[e].clone()}else{n.__originalVertexNormals[e].copy(n.vertexNormals[e])}}}var a=new Geometry;a.faces=this.faces;for(e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals;var s=this.morphNormals[e].vertexNormals;var l,c;for(i=0,r=this.faces.length;i<r;i++){l=new Vector3;c={a:new Vector3,b:new Vector3,c:new Vector3};o.push(l);s.push(c)}}var u=this.morphNormals[e];a.vertices=this.morphTargets[e].vertices;a.computeFaceNormals();a.computeVertexNormals();var l,c;for(i=0,r=this.faces.length;i<r;i++){n=this.faces[i];l=u.faceNormals[i];c=u.vertexNormals[i];l.copy(n.normal);c.a.copy(n.vertexNormals[0]);c.b.copy(n.vertexNormals[1]);c.c.copy(n.vertexNormals[2])}}for(i=0,r=this.faces.length;i<r;i++){n=this.faces[i];n.normal=n.__originalFaceNormal;n.vertexNormals=n.__originalVertexNormals}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new Sphere}this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}var r,n=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,l=e.faces,c=this.colors,u=e.colors;if(i===undefined)i=0;if(t!==undefined){r=(new Matrix3).getNormalMatrix(t)}for(var h=0,p=o.length;h<p;h++){var m=o[h];var f=m.clone();if(t!==undefined)f.applyMatrix4(t);a.push(f)}for(var h=0,p=u.length;h<p;h++){c.push(u[h].clone())}for(h=0,p=l.length;h<p;h++){var d=l[h],_,y,v,g=d.vertexNormals,x=d.vertexColors;_=new Face3(d.a+n,d.b+n,d.c+n);_.normal.copy(d.normal);if(r!==undefined){_.normal.applyMatrix3(r).normalize()}for(var b=0,M=g.length;b<M;b++){y=g[b].clone();if(r!==undefined){y.applyMatrix3(r).normalize()}_.vertexNormals.push(y)}_.color.copy(d.color);for(var b=0,M=x.length;b<M;b++){v=x[b];_.vertexColors.push(v.clone())}_.materialIndex=d.materialIndex+i;s.push(_)}for(var h=0,p=e.faceVertexUvs.length;h<p;h++){var w=e.faceVertexUvs[h];if(this.faceVertexUvs[h]===undefined)this.faceVertexUvs[h]=[];for(var b=0,M=w.length;b<M;b++){var S=w[b],A=[];for(var C=0,T=S.length;C<T;C++){A.push(S[C].clone())}this.faceVertexUvs[h].push(A)}}},mergeMesh:function(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}if(e.matrixAutoUpdate)e.updateMatrix();this.merge(e.geometry,e.matrix)},mergeVertices:function(){var e={};var t=[],i=[];var r,n;var a=4;var o=Math.pow(10,a);var s,l,c;var u,h,p;for(s=0,l=this.vertices.length;s<l;s++){r=this.vertices[s];n=Math.round(r.x*o)+"_"+Math.round(r.y*o)+"_"+Math.round(r.z*o);if(e[n]===undefined){e[n]=s;t.push(this.vertices[s]);i[s]=t.length-1}else{i[s]=i[e[n]]}}var m=[];for(s=0,l=this.faces.length;s<l;s++){c=this.faces[s];c.a=i[c.a];c.b=i[c.b];c.c=i[c.c];u=[c.a,c.b,c.c];for(var f=0;f<3;f++){if(u[f]===u[(f+1)%3]){m.push(s);break}}}for(s=m.length-1;s>=0;s--){var d=m[s];this.faces.splice(d,1);for(h=0,p=this.faceVertexUvs.length;h<p;h++){this.faceVertexUvs[h].splice(d,1)}}var _=this.vertices.length-t.length;this.vertices=t;return _},setFromPoints:function(e){this.vertices=[];for(var t=0,i=e.length;t<i;t++){var r=e[t];this.vertices.push(new Vector3(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){var e=this.faces;var t=e.length;for(var i=0;i<t;i++){e[i]._id=i}function r(e,t){return e.materialIndex-t.materialIndex}e.sort(r);var n=this.faceVertexUvs[0];var a=this.faceVertexUvs[1];var o,s;if(n&&n.length===t)o=[];if(a&&a.length===t)s=[];for(var i=0;i<t;i++){var l=e[i]._id;if(o)o.push(n[l]);if(s)s.push(a[l])}if(o)this.faceVertexUvs[0]=o;if(s)this.faceVertexUvs[1]=s},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;if(this.name!=="")e.name=this.name;if(this.parameters!==undefined){var t=this.parameters;for(var i in t){if(t[i]!==undefined)e[i]=t[i]}return e}var r=[];for(var n=0;n<this.vertices.length;n++){var a=this.vertices[n];r.push(a.x,a.y,a.z)}var o=[];var s=[];var l={};var c=[];var u={};var h=[];var p={};for(var n=0;n<this.faces.length;n++){var m=this.faces[n];var f=true;var d=false;var _=this.faceVertexUvs[0][n]!==undefined;var y=m.normal.length()>0;var v=m.vertexNormals.length>0;var g=m.color.r!==1||m.color.g!==1||m.color.b!==1;var x=m.vertexColors.length>0;var b=0;b=A(b,0,0);b=A(b,1,f);b=A(b,2,d);b=A(b,3,_);b=A(b,4,y);b=A(b,5,v);b=A(b,6,g);b=A(b,7,x);o.push(b);o.push(m.a,m.b,m.c);o.push(m.materialIndex);if(_){var M=this.faceVertexUvs[0][n];o.push(B(M[0]),B(M[1]),B(M[2]))}if(y){o.push(C(m.normal))}if(v){var w=m.vertexNormals;o.push(C(w[0]),C(w[1]),C(w[2]))}if(g){o.push(T(m.color))}if(x){var S=m.vertexColors;o.push(T(S[0]),T(S[1]),T(S[2]))}}function A(e,t,i){return i?e|1<<t:e&~(1<<t)}function C(e){var t=e.x.toString()+e.y.toString()+e.z.toString();if(l[t]!==undefined){return l[t]}l[t]=s.length/3;s.push(e.x,e.y,e.z);return l[t]}function T(e){var t=e.r.toString()+e.g.toString()+e.b.toString();if(u[t]!==undefined){return u[t]}u[t]=c.length;c.push(e.getHex());return u[t]}function B(e){var t=e.x.toString()+e.y.toString();if(p[t]!==undefined){return p[t]}p[t]=h.length/2;h.push(e.x,e.y);return p[t]}e.data={};e.data.vertices=r;e.data.normals=s;if(c.length>0)e.data.colors=c;if(h.length>0)e.data.uvs=[h];e.data.faces=o;return e},clone:function(){return(new Geometry).copy(this)},copy:function(e){var t,i,r,n,a,o;this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.name=e.name;var s=e.vertices;for(t=0,i=s.length;t<i;t++){this.vertices.push(s[t].clone())}var l=e.colors;for(t=0,i=l.length;t<i;t++){this.colors.push(l[t].clone())}var c=e.faces;for(t=0,i=c.length;t<i;t++){this.faces.push(c[t].clone())}for(t=0,i=e.faceVertexUvs.length;t<i;t++){var u=e.faceVertexUvs[t];if(this.faceVertexUvs[t]===undefined){this.faceVertexUvs[t]=[]}for(r=0,n=u.length;r<n;r++){var h=u[r],p=[];for(a=0,o=h.length;a<o;a++){var m=h[a];p.push(m.clone())}this.faceVertexUvs[t].push(p)}}var f=e.morphTargets;for(t=0,i=f.length;t<i;t++){var d={};d.name=f[t].name;if(f[t].vertices!==undefined){d.vertices=[];for(r=0,n=f[t].vertices.length;r<n;r++){d.vertices.push(f[t].vertices[r].clone())}}if(f[t].normals!==undefined){d.normals=[];for(r=0,n=f[t].normals.length;r<n;r++){d.normals.push(f[t].normals[r].clone())}}this.morphTargets.push(d)}var _=e.morphNormals;for(t=0,i=_.length;t<i;t++){var y={};if(_[t].vertexNormals!==undefined){y.vertexNormals=[];for(r=0,n=_[t].vertexNormals.length;r<n;r++){var v=_[t].vertexNormals[r];var g={};g.a=v.a.clone();g.b=v.b.clone();g.c=v.c.clone();y.vertexNormals.push(g)}}if(_[t].faceNormals!==undefined){y.faceNormals=[];for(r=0,n=_[t].faceNormals.length;r<n;r++){y.faceNormals.push(_[t].faceNormals[r].clone())}}this.morphNormals.push(y)}var x=e.skinWeights;for(t=0,i=x.length;t<i;t++){this.skinWeights.push(x[t].clone())}var b=e.skinIndices;for(t=0,i=b.length;t<i;t++){this.skinIndices.push(b[t].clone())}var M=e.lineDistances;for(t=0,i=M.length;t<i;t++){this.lineDistances.push(M[t])}var w=e.boundingBox;if(w!==null){this.boundingBox=w.clone()}var S=e.boundingSphere;if(S!==null){this.boundingSphere=S.clone()}this.elementsNeedUpdate=e.elementsNeedUpdate;this.verticesNeedUpdate=e.verticesNeedUpdate;this.uvsNeedUpdate=e.uvsNeedUpdate;this.normalsNeedUpdate=e.normalsNeedUpdate;this.colorsNeedUpdate=e.colorsNeedUpdate;this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate;this.groupsNeedUpdate=e.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class BoxGeometry extends Geometry{constructor(e,t,i,r,n,a){super();this.type="BoxGeometry";this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:a};this.fromBufferGeometry(new BoxBufferGeometry(e,t,i,r,n,a));this.mergeVertices()}}class BoxBufferGeometry extends BufferGeometry{constructor(e,t,i,r,n,a){super();this.type="BoxBufferGeometry";this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:a};var o=this;e=e||1;t=t||1;i=i||1;r=Math.floor(r)||1;n=Math.floor(n)||1;a=Math.floor(a)||1;var s=[];var l=[];var c=[];var u=[];var h=0;var p=0;m("z","y","x",-1,-1,i,t,e,a,n,0);m("z","y","x",1,-1,i,t,-e,a,n,1);m("x","z","y",1,1,e,i,t,r,a,2);m("x","z","y",1,-1,e,i,-t,r,a,3);m("x","y","z",1,-1,e,t,i,r,n,4);m("x","y","z",-1,-1,e,t,-i,r,n,5);this.setIndex(s);this.setAttribute("position",new Float32BufferAttribute(l,3));this.setAttribute("normal",new Float32BufferAttribute(c,3));this.setAttribute("uv",new Float32BufferAttribute(u,2));function m(e,t,i,r,n,a,m,f,d,_,y){var v=a/d;var g=m/_;var x=a/2;var b=m/2;var M=f/2;var w=d+1;var S=_+1;var A=0;var C=0;var T,B;var L=new Vector3;for(B=0;B<S;B++){var D=B*g-b;for(T=0;T<w;T++){var E=T*v-x;L[e]=E*r;L[t]=D*n;L[i]=M;l.push(L.x,L.y,L.z);L[e]=0;L[t]=0;L[i]=f>0?1:-1;c.push(L.x,L.y,L.z);u.push(T/d);u.push(1-B/_);A+=1}}for(B=0;B<_;B++){for(T=0;T<d;T++){var R=h+T+w*B;var P=h+T+w*(B+1);var G=h+(T+1)+w*(B+1);var I=h+(T+1)+w*B;s.push(R,P,I);s.push(P,G,I);C+=6}}o.addGroup(p,C,y);p+=C;h+=A}}}function cloneUniforms(e){var t={};for(var i in e){t[i]={};for(var r in e[i]){var n=e[i][r];if(n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)){t[i][r]=n.clone()}else if(Array.isArray(n)){t[i][r]=n.slice()}else{t[i][r]=n}}}return t}function mergeUniforms(e){var t={};for(var i=0;i<e.length;i++){var r=cloneUniforms(e[i]);for(var n in r){t[n]=r[n]}}return t}var UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";var default_fragment="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function ShaderMaterial(e){Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader=default_vertex;this.fragmentShader=default_fragment;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.clipping=false;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.extensions={derivatives:false,fragDepth:false,drawBuffers:false,shaderTextureLOD:false};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=undefined;this.uniformsNeedUpdate=false;if(e!==undefined){if(e.attributes!==undefined){console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.")}this.setValues(e)}}ShaderMaterial.prototype=Object.create(Material.prototype);ShaderMaterial.prototype.constructor=ShaderMaterial;ShaderMaterial.prototype.isShaderMaterial=true;ShaderMaterial.prototype.copy=function(e){Material.prototype.copy.call(this,e);this.fragmentShader=e.fragmentShader;this.vertexShader=e.vertexShader;this.uniforms=cloneUniforms(e.uniforms);this.defines=Object.assign({},e.defines);this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.lights=e.lights;this.clipping=e.clipping;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;this.extensions=e.extensions;return this};ShaderMaterial.prototype.toJSON=function(e){var t=Material.prototype.toJSON.call(this,e);t.uniforms={};for(var i in this.uniforms){var r=this.uniforms[i];var n=r.value;if(n&&n.isTexture){t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}}else if(n&&n.isColor){t.uniforms[i]={type:"c",value:n.getHex()}}else if(n&&n.isVector2){t.uniforms[i]={type:"v2",value:n.toArray()}}else if(n&&n.isVector3){t.uniforms[i]={type:"v3",value:n.toArray()}}else if(n&&n.isVector4){t.uniforms[i]={type:"v4",value:n.toArray()}}else if(n&&n.isMatrix3){t.uniforms[i]={type:"m3",value:n.toArray()}}else if(n&&n.isMatrix4){t.uniforms[i]={type:"m4",value:n.toArray()}}else{t.uniforms[i]={value:n}}}if(Object.keys(this.defines).length>0)t.defines=this.defines;t.vertexShader=this.vertexShader;t.fragmentShader=this.fragmentShader;var a={};for(var o in this.extensions){if(this.extensions[o]===true)a[o]=true}if(Object.keys(a).length>0)t.extensions=a;return t};function Camera(){Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new Matrix4;this.projectionMatrix=new Matrix4;this.projectionMatrixInverse=new Matrix4}Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:true,copy:function(e,t){Object3D.prototype.copy.call(this,e,t);this.matrixWorldInverse.copy(e.matrixWorldInverse);this.projectionMatrix.copy(e.projectionMatrix);this.projectionMatrixInverse.copy(e.projectionMatrixInverse);return this},getWorldDirection:function(e){if(e===undefined){console.warn("THREE.Camera: .getWorldDirection() target is now required");e=new Vector3}this.updateMatrixWorld(true);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Object3D.prototype.updateMatrixWorld.call(this,e);this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){Object3D.prototype.updateWorldMatrix.call(this,e,t);this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}});function PerspectiveCamera(e,t,i,r){Camera.call(this);this.type="PerspectiveCamera";this.fov=e!==undefined?e:50;this.zoom=1;this.near=i!==undefined?i:.1;this.far=r!==undefined?r:2e3;this.focus=10;this.aspect=t!==undefined?t:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:true,copy:function(e,t){Camera.prototype.copy.call(this,e,t);this.fov=e.fov;this.zoom=e.zoom;this.near=e.near;this.far=e.far;this.focus=e.focus;this.aspect=e.aspect;this.view=e.view===null?null:Object.assign({},e.view);this.filmGauge=e.filmGauge;this.filmOffset=e.filmOffset;return this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=MathUtils.RAD2DEG*2*Math.atan(t);this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(MathUtils.DEG2RAD*.5*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return MathUtils.RAD2DEG*2*Math.atan(Math.tan(MathUtils.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,r,n,a){this.aspect=e/t;if(this.view===null){this.view={enabled:true,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}this.view.enabled=true;this.view.fullWidth=e;this.view.fullHeight=t;this.view.offsetX=i;this.view.offsetY=r;this.view.width=n;this.view.height=a;this.updateProjectionMatrix()},clearViewOffset:function(){if(this.view!==null){this.view.enabled=false}this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(MathUtils.DEG2RAD*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,a=this.view;if(this.view!==null&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;n+=a.offsetX*r/o;t-=a.offsetY*i/s;r*=a.width/o;i*=a.height/s}var l=this.filmOffset;if(l!==0)n+=e*l/this.getFilmWidth();this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far);this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);t.object.fov=this.fov;t.object.zoom=this.zoom;t.object.near=this.near;t.object.far=this.far;t.object.focus=this.focus;t.object.aspect=this.aspect;if(this.view!==null)t.object.view=Object.assign({},this.view);t.object.filmGauge=this.filmGauge;t.object.filmOffset=this.filmOffset;return t}});var fov=90,aspect=1;function CubeCamera(e,t,i,r){Object3D.call(this);this.type="CubeCamera";var n=new PerspectiveCamera(fov,aspect,e,t);n.up.set(0,-1,0);n.lookAt(new Vector3(1,0,0));this.add(n);var a=new PerspectiveCamera(fov,aspect,e,t);a.up.set(0,-1,0);a.lookAt(new Vector3(-1,0,0));this.add(a);var o=new PerspectiveCamera(fov,aspect,e,t);o.up.set(0,0,1);o.lookAt(new Vector3(0,1,0));this.add(o);var s=new PerspectiveCamera(fov,aspect,e,t);s.up.set(0,0,-1);s.lookAt(new Vector3(0,-1,0));this.add(s);var l=new PerspectiveCamera(fov,aspect,e,t);l.up.set(0,-1,0);l.lookAt(new Vector3(0,0,1));this.add(l);var c=new PerspectiveCamera(fov,aspect,e,t);c.up.set(0,-1,0);c.lookAt(new Vector3(0,0,-1));this.add(c);r=r||{format:RGBFormat,magFilter:LinearFilter,minFilter:LinearFilter};this.renderTarget=new WebGLCubeRenderTarget(i,r);this.renderTarget.texture.name="CubeCamera";this.update=function(e,t){if(this.parent===null)this.updateMatrixWorld();var i=e.getRenderTarget();var r=this.renderTarget;var u=r.texture.generateMipmaps;r.texture.generateMipmaps=false;e.setRenderTarget(r,0);e.render(t,n);e.setRenderTarget(r,1);e.render(t,a);e.setRenderTarget(r,2);e.render(t,o);e.setRenderTarget(r,3);e.render(t,s);e.setRenderTarget(r,4);e.render(t,l);r.texture.generateMipmaps=u;e.setRenderTarget(r,5);e.render(t,c);e.setRenderTarget(i)};this.clear=function(e,t,i,r){var n=e.getRenderTarget();var a=this.renderTarget;for(var o=0;o<6;o++){e.setRenderTarget(a,o);e.clear(t,i,r)}e.setRenderTarget(n)}}CubeCamera.prototype=Object.create(Object3D.prototype);CubeCamera.prototype.constructor=CubeCamera;function WebGLCubeRenderTarget(e,t,i){if(Number.isInteger(t)){console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )");t=i}WebGLRenderTarget.call(this,e,e,t)}WebGLCubeRenderTarget.prototype=Object.create(WebGLRenderTarget.prototype);WebGLCubeRenderTarget.prototype.constructor=WebGLCubeRenderTarget;WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=true;WebGLCubeRenderTarget.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type;this.texture.format=t.format;this.texture.encoding=t.encoding;var i=new Scene;var r={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")};var n=new ShaderMaterial({type:"CubemapFromEquirect",uniforms:cloneUniforms(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:BackSide,blending:NoBlending});n.uniforms.tEquirect.value=t;var a=new Mesh(new BoxBufferGeometry(5,5,5),n);i.add(a);var o=new CubeCamera(1,10,1);o.renderTarget=this;o.renderTarget.texture.name="CubeCameraTexture";o.update(e,i);a.geometry.dispose();a.material.dispose();return this};function DataTexture(e,t,i,r,n,a,o,s,l,c,u,h){Texture.call(this,null,a,o,s,l,c,r,n,u,h);this.image={data:e||null,width:t||1,height:i||1};this.magFilter=l!==undefined?l:NearestFilter;this.minFilter=c!==undefined?c:NearestFilter;this.generateMipmaps=false;this.flipY=false;this.unpackAlignment=1;this.needsUpdate=true}DataTexture.prototype=Object.create(Texture.prototype);DataTexture.prototype.constructor=DataTexture;DataTexture.prototype.isDataTexture=true;var _sphere$1=new Sphere;var _vector$5=new Vector3;function Frustum(e,t,i,r,n,a){this.planes=[e!==undefined?e:new Plane,t!==undefined?t:new Plane,i!==undefined?i:new Plane,r!==undefined?r:new Plane,n!==undefined?n:new Plane,a!==undefined?a:new Plane]}Object.assign(Frustum.prototype,{set:function(e,t,i,r,n,a){var o=this.planes;o[0].copy(e);o[1].copy(t);o[2].copy(i);o[3].copy(r);o[4].copy(n);o[5].copy(a);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){var t=this.planes;for(var i=0;i<6;i++){t[i].copy(e.planes[i])}return this},setFromProjectionMatrix:function(e){var t=this.planes;var i=e.elements;var r=i[0],n=i[1],a=i[2],o=i[3];var s=i[4],l=i[5],c=i[6],u=i[7];var h=i[8],p=i[9],m=i[10],f=i[11];var d=i[12],_=i[13],y=i[14],v=i[15];t[0].setComponents(o-r,u-s,f-h,v-d).normalize();t[1].setComponents(o+r,u+s,f+h,v+d).normalize();t[2].setComponents(o+n,u+l,f+p,v+_).normalize();t[3].setComponents(o-n,u-l,f-p,v-_).normalize();t[4].setComponents(o-a,u-c,f-m,v-y).normalize();t[5].setComponents(o+a,u+c,f+m,v+y).normalize();return this},intersectsObject:function(e){var t=e.geometry;if(t.boundingSphere===null)t.computeBoundingSphere();_sphere$1.copy(t.boundingSphere).applyMatrix4(e.matrixWorld);return this.intersectsSphere(_sphere$1)},intersectsSprite:function(e){_sphere$1.center.set(0,0,0);_sphere$1.radius=.7071067811865476;_sphere$1.applyMatrix4(e.matrixWorld);return this.intersectsSphere(_sphere$1)},intersectsSphere:function(e){var t=this.planes;var i=e.center;var r=-e.radius;for(var n=0;n<6;n++){var a=t[n].distanceToPoint(i);if(a<r){return false}}return true},intersectsBox:function(e){var t=this.planes;for(var i=0;i<6;i++){var r=t[i];_vector$5.x=r.normal.x>0?e.max.x:e.min.x;_vector$5.y=r.normal.y>0?e.max.y:e.min.y;_vector$5.z=r.normal.z>0?e.max.z:e.min.z;if(r.distanceToPoint(_vector$5)<0){return false}}return true},containsPoint:function(e){var t=this.planes;for(var i=0;i<6;i++){if(t[i].distanceToPoint(e)<0){return false}}return true}});var UniformsLib={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}};function WebGLAnimation(){var e=null;var t=false;var i=null;function r(n,a){if(t===false)return;i(n,a);e.requestAnimationFrame(r)}return{start:function(){if(t===true)return;if(i===null)return;e.requestAnimationFrame(r);t=true},stop:function(){t=false},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function WebGLAttributes(e,t){var i=t.isWebGL2;var r=new WeakMap;function n(t,i){var r=t.array;var n=t.usage;var a=e.createBuffer();e.bindBuffer(i,a);e.bufferData(i,r,n);t.onUploadCallback();var o=5126;if(r instanceof Float32Array){o=5126}else if(r instanceof Float64Array){console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array.")}else if(r instanceof Uint16Array){o=5123}else if(r instanceof Int16Array){o=5122}else if(r instanceof Uint32Array){o=5125}else if(r instanceof Int32Array){o=5124}else if(r instanceof Int8Array){o=5120}else if(r instanceof Uint8Array){o=5121}return{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}function a(t,r,n){var a=r.array;var o=r.updateRange;e.bindBuffer(n,t);if(o.count===-1){e.bufferSubData(n,0,a)}else{if(i){e.bufferSubData(n,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count)}else{e.bufferSubData(n,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count))}o.count=-1}}function o(e){if(e.isInterleavedBufferAttribute)e=e.data;return r.get(e)}function s(t){if(t.isInterleavedBufferAttribute)t=t.data;var i=r.get(t);if(i){e.deleteBuffer(i.buffer);r.delete(t)}}function l(e,t){if(e.isInterleavedBufferAttribute)e=e.data;var i=r.get(e);if(i===undefined){r.set(e,n(e,t))}else if(i.version<e.version){a(i.buffer,e,t);i.version=e.version}}return{get:o,remove:s,update:l}}function PlaneGeometry(e,t,i,r){Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};this.fromBufferGeometry(new PlaneBufferGeometry(e,t,i,r));this.mergeVertices()}PlaneGeometry.prototype=Object.create(Geometry.prototype);PlaneGeometry.prototype.constructor=PlaneGeometry;function PlaneBufferGeometry(e,t,i,r){BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};e=e||1;t=t||1;var n=e/2;var a=t/2;var o=Math.floor(i)||1;var s=Math.floor(r)||1;var l=o+1;var c=s+1;var u=e/o;var h=t/s;var p,m;var f=[];var d=[];var _=[];var y=[];for(m=0;m<c;m++){var v=m*h-a;for(p=0;p<l;p++){var g=p*u-n;d.push(g,-v,0);_.push(0,0,1);y.push(p/o);y.push(1-m/s)}}for(m=0;m<s;m++){for(p=0;p<o;p++){var x=p+l*m;var b=p+l*(m+1);var M=p+1+l*(m+1);var w=p+1+l*m;f.push(x,b,w);f.push(b,M,w)}}this.setIndex(f);this.setAttribute("position",new Float32BufferAttribute(d,3));this.setAttribute("normal",new Float32BufferAttribute(_,3));this.setAttribute("uv",new Float32BufferAttribute(y,2))}PlaneBufferGeometry.prototype=Object.create(BufferGeometry.prototype);PlaneBufferGeometry.prototype.constructor=PlaneBufferGeometry;var alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif";var alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif";var alphatest_fragment="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif";var aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif";var aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif";var begin_vertex="vec3 transformed = vec3( position );";var beginnormal_vertex="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif";var bsdfs="vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif";var bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif";var clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif";var clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif";var clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif";var clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif";var color_fragment="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif";var color_pars_fragment="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif";var color_pars_vertex="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif";var color_vertex="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif";var common="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}";var cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif";var defaultnormal_vertex="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif";var displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif";var displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif";var emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif";var emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif";var encodings_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );";var encodings_pars_fragment="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}";var envmap_fragment="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif";var envmap_common_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif";var envmap_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif";var envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif";var envmap_vertex="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif";var fog_vertex="#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif";var fog_pars_vertex="#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif";var fog_fragment="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif";var fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif";var gradientmap_pars_fragment="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}";var lightmap_fragment="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif";var lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif";var lights_lambert_vertex="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif";var lights_pars_begin="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif";var envmap_physical_pars_fragment="#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif";var lights_toon_fragment="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;";var lights_toon_pars_fragment="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)";var lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;";var lights_phong_pars_fragment="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)";var lights_physical_fragment="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif";var lights_physical_pars_fragment="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}";var lights_fragment_begin="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif";var lights_fragment_maps="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif";var lights_fragment_end="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif";var logdepthbuf_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif";var logdepthbuf_pars_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif";var logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif";var logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif";var map_fragment="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif";var map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif";var map_particle_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif";var map_particle_pars_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif";var metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif";var metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif";var morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif";var morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif";var morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif";var normal_fragment_begin="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;";var normal_fragment_maps="#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif";var normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif";var clearcoat_normal_fragment_begin="#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif";var clearcoat_normal_fragment_maps="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif";var clearcoat_pars_fragment="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif";var packing="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}";var premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif";var project_vertex="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;";var dithering_fragment="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif";var dithering_pars_fragment="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif";var roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif";var roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif";var shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif";var shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif";var shadowmap_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif";var shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}";var skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif";var skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif";var skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif";var skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif";var specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif";var specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif";var tonemapping_fragment="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif";var tonemapping_pars_fragment="#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}";var uv_pars_fragment="#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif";var uv_pars_vertex="#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif";var uv_vertex="#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif";var uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif";var uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif";var uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif";var worldpos_vertex="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif";var background_frag="uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}";var background_vert="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}";var cube_frag="#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}";var cube_vert="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}";var depth_frag="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}";var depth_vert="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}";var distanceRGBA_frag="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}";var distanceRGBA_vert="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}";var equirect_frag="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}";var equirect_vert="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}";var linedashed_frag="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}";var linedashed_vert="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}";var meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}";var meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}";var meshlambert_frag="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}";var meshlambert_vert="#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}";var meshmatcap_frag="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}";var meshmatcap_vert="#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}";var meshtoon_frag="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}";var meshtoon_vert="#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}";var meshphong_frag="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}";var meshphong_vert="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}";var meshphysical_frag="#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}";var meshphysical_vert="#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}";var normal_frag="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}";var normal_vert="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}";var points_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}";var points_vert="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}";var shadow_frag="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}";var shadow_vert="#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}";var sprite_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}";var sprite_vert="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}";var ShaderChunk={alphamap_fragment:alphamap_fragment,alphamap_pars_fragment:alphamap_pars_fragment,alphatest_fragment:alphatest_fragment,aomap_fragment:aomap_fragment,aomap_pars_fragment:aomap_pars_fragment,begin_vertex:begin_vertex,beginnormal_vertex:beginnormal_vertex,bsdfs:bsdfs,bumpmap_pars_fragment:bumpmap_pars_fragment,clipping_planes_fragment:clipping_planes_fragment,clipping_planes_pars_fragment:clipping_planes_pars_fragment,clipping_planes_pars_vertex:clipping_planes_pars_vertex,clipping_planes_vertex:clipping_planes_vertex,color_fragment:color_fragment,color_pars_fragment:color_pars_fragment,color_pars_vertex:color_pars_vertex,color_vertex:color_vertex,common:common,cube_uv_reflection_fragment:cube_uv_reflection_fragment,defaultnormal_vertex:defaultnormal_vertex,displacementmap_pars_vertex:displacementmap_pars_vertex,displacementmap_vertex:displacementmap_vertex,emissivemap_fragment:emissivemap_fragment,emissivemap_pars_fragment:emissivemap_pars_fragment,encodings_fragment:encodings_fragment,encodings_pars_fragment:encodings_pars_fragment,envmap_fragment:envmap_fragment,envmap_common_pars_fragment:envmap_common_pars_fragment,envmap_pars_fragment:envmap_pars_fragment,envmap_pars_vertex:envmap_pars_vertex,envmap_physical_pars_fragment:envmap_physical_pars_fragment,envmap_vertex:envmap_vertex,fog_vertex:fog_vertex,fog_pars_vertex:fog_pars_vertex,fog_fragment:fog_fragment,fog_pars_fragment:fog_pars_fragment,gradientmap_pars_fragment:gradientmap_pars_fragment,lightmap_fragment:lightmap_fragment,lightmap_pars_fragment:lightmap_pars_fragment,lights_lambert_vertex:lights_lambert_vertex,lights_pars_begin:lights_pars_begin,lights_toon_fragment:lights_toon_fragment,lights_toon_pars_fragment:lights_toon_pars_fragment,lights_phong_fragment:lights_phong_fragment,lights_phong_pars_fragment:lights_phong_pars_fragment,lights_physical_fragment:lights_physical_fragment,lights_physical_pars_fragment:lights_physical_pars_fragment,lights_fragment_begin:lights_fragment_begin,lights_fragment_maps:lights_fragment_maps,lights_fragment_end:lights_fragment_end,logdepthbuf_fragment:logdepthbuf_fragment,logdepthbuf_pars_fragment:logdepthbuf_pars_fragment,logdepthbuf_pars_vertex:logdepthbuf_pars_vertex,logdepthbuf_vertex:logdepthbuf_vertex,map_fragment:map_fragment,map_pars_fragment:map_pars_fragment,map_particle_fragment:map_particle_fragment,map_particle_pars_fragment:map_particle_pars_fragment,metalnessmap_fragment:metalnessmap_fragment,metalnessmap_pars_fragment:metalnessmap_pars_fragment,morphnormal_vertex:morphnormal_vertex,morphtarget_pars_vertex:morphtarget_pars_vertex,morphtarget_vertex:morphtarget_vertex,normal_fragment_begin:normal_fragment_begin,normal_fragment_maps:normal_fragment_maps,normalmap_pars_fragment:normalmap_pars_fragment,clearcoat_normal_fragment_begin:clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps:clearcoat_normal_fragment_maps,clearcoat_pars_fragment:clearcoat_pars_fragment,packing:packing,premultiplied_alpha_fragment:premultiplied_alpha_fragment,project_vertex:project_vertex,dithering_fragment:dithering_fragment,dithering_pars_fragment:dithering_pars_fragment,roughnessmap_fragment:roughnessmap_fragment,roughnessmap_pars_fragment:roughnessmap_pars_fragment,shadowmap_pars_fragment:shadowmap_pars_fragment,shadowmap_pars_vertex:shadowmap_pars_vertex,shadowmap_vertex:shadowmap_vertex,shadowmask_pars_fragment:shadowmask_pars_fragment,skinbase_vertex:skinbase_vertex,skinning_pars_vertex:skinning_pars_vertex,skinning_vertex:skinning_vertex,skinnormal_vertex:skinnormal_vertex,specularmap_fragment:specularmap_fragment,specularmap_pars_fragment:specularmap_pars_fragment,tonemapping_fragment:tonemapping_fragment,tonemapping_pars_fragment:tonemapping_pars_fragment,uv_pars_fragment:uv_pars_fragment,uv_pars_vertex:uv_pars_vertex,uv_vertex:uv_vertex,uv2_pars_fragment:uv2_pars_fragment,uv2_pars_vertex:uv2_pars_vertex,uv2_vertex:uv2_vertex,worldpos_vertex:worldpos_vertex,background_frag:background_frag,background_vert:background_vert,cube_frag:cube_frag,cube_vert:cube_vert,depth_frag:depth_frag,depth_vert:depth_vert,distanceRGBA_frag:distanceRGBA_frag,distanceRGBA_vert:distanceRGBA_vert,equirect_frag:equirect_frag,equirect_vert:equirect_vert,linedashed_frag:linedashed_frag,linedashed_vert:linedashed_vert,meshbasic_frag:meshbasic_frag,meshbasic_vert:meshbasic_vert,meshlambert_frag:meshlambert_frag,meshlambert_vert:meshlambert_vert,meshmatcap_frag:meshmatcap_frag,meshmatcap_vert:meshmatcap_vert,meshtoon_frag:meshtoon_frag,meshtoon_vert:meshtoon_vert,meshphong_frag:meshphong_frag,meshphong_vert:meshphong_vert,meshphysical_frag:meshphysical_frag,meshphysical_vert:meshphysical_vert,normal_frag:normal_frag,normal_vert:normal_vert,points_frag:points_frag,points_vert:points_vert,shadow_frag:shadow_frag,shadow_vert:shadow_vert,sprite_frag:sprite_frag,sprite_vert:sprite_vert};var ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},cube:{uniforms:mergeUniforms([UniformsLib.envmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Color(0)},transparency:{value:0}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};function WebGLBackground(e,t,i,r){var n=new Color(0);var a=0;var o;var s;var l=null;var c=0;var u=null;function h(t,r,h,m){var f=r.background;var d=e.xr;var _=d.getSession&&d.getSession();if(_&&_.environmentBlendMode==="additive"){f=null}if(f===null){p(n,a)}else if(f&&f.isColor){p(f,1);m=true}if(e.autoClear||m){e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)}if(f&&(f.isCubeTexture||f.isWebGLCubeRenderTarget||f.mapping===CubeUVReflectionMapping)){if(s===undefined){s=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({type:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.cube.uniforms),vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:false,depthWrite:false,fog:false}));s.geometry.deleteAttribute("normal");s.geometry.deleteAttribute("uv");s.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)};Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}});i.update(s)}var y=f.isWebGLCubeRenderTarget?f.texture:f;s.material.uniforms.envMap.value=y;s.material.uniforms.flipEnvMap.value=y.isCubeTexture?-1:1;if(l!==f||c!==y.version||u!==e.toneMapping){s.material.needsUpdate=true;l=f;c=y.version;u=e.toneMapping}t.unshift(s,s.geometry,s.material,0,0,null)}else if(f&&f.isTexture){if(o===undefined){o=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial({type:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:false,depthWrite:false,fog:false}));o.geometry.deleteAttribute("normal");Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}});i.update(o)}o.material.uniforms.t2D.value=f;if(f.matrixAutoUpdate===true){f.updateMatrix()}o.material.uniforms.uvTransform.value.copy(f.matrix);if(l!==f||c!==f.version||u!==e.toneMapping){o.material.needsUpdate=true;l=f;c=f.version;u=e.toneMapping}t.unshift(o,o.geometry,o.material,0,0,null)}}function p(e,i){t.buffers.color.setClear(e.r,e.g,e.b,i,r)}return{getClearColor:function(){return n},setClearColor:function(e,t){n.set(e);a=t!==undefined?t:1;p(n,a)},getClearAlpha:function(){return a},setClearAlpha:function(e){a=e;p(n,a)},render:h}}function WebGLBufferRenderer(e,t,i,r){var n=r.isWebGL2;var a;function o(e){a=e}function s(t,r){e.drawArrays(a,t,r);i.update(r,a)}function l(r,o,s,l){if(l===0)return;var c,u;if(n){c=e;u="drawArraysInstanced"}else{c=t.get("ANGLE_instanced_arrays");u="drawArraysInstancedANGLE";if(c===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}c[u](a,o,s,l);i.update(s,a,l)}this.setMode=o;this.render=s;this.renderInstances=l}function WebGLCapabilities(e,t,i){var r;function n(){if(r!==undefined)return r;var i=t.get("EXT_texture_filter_anisotropic");if(i!==null){r=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else{r=0}return r}function a(t){if(t==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0){return"highp"}t="mediump"}if(t==="mediump"){if(e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0){return"mediump"}}return"lowp"}var o=typeof WebGL2RenderingContext!=="undefined"&&e instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!=="undefined"&&e instanceof WebGL2ComputeRenderingContext;var s=i.precision!==undefined?i.precision:"highp";var l=a(s);if(l!==s){console.warn("THREE.WebGLRenderer:",s,"not supported, using",l,"instead.");s=l}var c=i.logarithmicDepthBuffer===true;var u=e.getParameter(34930);var h=e.getParameter(35660);var p=e.getParameter(3379);var m=e.getParameter(34076);var f=e.getParameter(34921);var d=e.getParameter(36347);var _=e.getParameter(36348);var y=e.getParameter(36349);var v=h>0;var g=o||!!t.get("OES_texture_float");var x=v&&g;var b=o?e.getParameter(36183):0;return{isWebGL2:o,getMaxAnisotropy:n,getMaxPrecision:a,precision:s,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:p,maxCubemapSize:m,maxAttributes:f,maxVertexUniforms:d,maxVaryings:_,maxFragmentUniforms:y,vertexTextures:v,floatFragmentTextures:g,floatVertexTextures:x,maxSamples:b}}function WebGLClipping(){var e=this,t=null,i=0,r=false,n=false,a=new Plane,o=new Matrix3,s={value:null,needsUpdate:false};this.uniform=s;this.numPlanes=0;this.numIntersection=0;this.init=function(e,n,a){var o=e.length!==0||n||i!==0||r;r=n;t=c(e,a,0);i=e.length;return o};this.beginShadows=function(){n=true;c(null)};this.endShadows=function(){n=false;l()};this.setState=function(e,a,o,u,h,p){if(!r||e===null||e.length===0||n&&!o){if(n){c(null)}else{l()}}else{var m=n?0:i,f=m*4,d=h.clippingState||null;s.value=d;d=c(e,u,f,p);for(var _=0;_!==f;++_){d[_]=t[_]}h.clippingState=d;this.numIntersection=a?this.numPlanes:0;this.numPlanes+=m}};function l(){if(s.value!==t){s.value=t;s.needsUpdate=i>0}e.numPlanes=i;e.numIntersection=0}function c(t,i,r,n){var l=t!==null?t.length:0,c=null;if(l!==0){c=s.value;if(n!==true||c===null){var u=r+l*4,h=i.matrixWorldInverse;o.getNormalMatrix(h);if(c===null||c.length<u){c=new Float32Array(u)}for(var p=0,m=r;p!==l;++p,m+=4){a.copy(t[p]).applyMatrix4(h,o);a.normal.toArray(c,m);c[m+3]=a.constant}}s.value=c;s.needsUpdate=true}e.numPlanes=l;e.numIntersection=0;return c}}function WebGLExtensions(e){var t={};return{get:function(i){if(t[i]!==undefined){return t[i]}var r;switch(i){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(i)}if(r===null){console.warn("THREE.WebGLRenderer: "+i+" extension not supported.")}t[i]=r;return r}}}function WebGLGeometries(e,t,i){var r=new WeakMap;var n=new WeakMap;function a(e){var o=e.target;var s=r.get(o);if(s.index!==null){t.remove(s.index)}for(var l in s.attributes){t.remove(s.attributes[l])}o.removeEventListener("dispose",a);r.delete(o);var c=n.get(s);if(c){t.remove(c);n.delete(s)}i.memory.geometries--}function o(e,t){var n=r.get(t);if(n)return n;t.addEventListener("dispose",a);if(t.isBufferGeometry){n=t}else if(t.isGeometry){if(t._bufferGeometry===undefined){t._bufferGeometry=(new BufferGeometry).setFromObject(e)}n=t._bufferGeometry}r.set(t,n);i.memory.geometries++;return n}function s(e){var i=e.index;var r=e.attributes;if(i!==null){t.update(i,34963)}for(var n in r){t.update(r[n],34962)}var a=e.morphAttributes;for(var n in a){var o=a[n];for(var s=0,l=o.length;s<l;s++){t.update(o[s],34962)}}}function l(e){var i=[];var r=e.index;var a=e.attributes.position;var o=0;if(r!==null){var s=r.array;o=r.version;for(var l=0,c=s.length;l<c;l+=3){var u=s[l+0];var h=s[l+1];var p=s[l+2];i.push(u,h,h,p,p,u)}}else{var s=a.array;o=a.version;for(var l=0,c=s.length/3-1;l<c;l+=3){var u=l+0;var h=l+1;var p=l+2;i.push(u,h,h,p,p,u)}}var m=new(arrayMax(i)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(i,1);m.version=o;t.update(m,34963);var f=n.get(e);if(f)t.remove(f);n.set(e,m)}function c(e){var t=n.get(e);if(t){var i=e.index;if(i!==null){if(t.version<i.version){l(e)}}}else{l(e)}return n.get(e)}return{get:o,update:s,getWireframeAttribute:c}}function WebGLIndexedBufferRenderer(e,t,i,r){var n=r.isWebGL2;var a;function o(e){a=e}var s,l;function c(e){s=e.type;l=e.bytesPerElement}function u(t,r){e.drawElements(a,r,s,t*l);i.update(r,a)}function h(r,o,c,u){if(u===0)return;var h,p;if(n){h=e;p="drawElementsInstanced"}else{h=t.get("ANGLE_instanced_arrays");p="drawElementsInstancedANGLE";if(h===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}h[p](a,c,s,o*l,u);i.update(c,a,u)}this.setMode=o;this.setIndex=c;this.render=u;this.renderInstances=h}function WebGLInfo(e){var t={geometries:0,textures:0};var i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(e,t,r){r=r||1;i.calls++;switch(t){case 4:i.triangles+=r*(e/3);break;case 1:i.lines+=r*(e/2);break;case 3:i.lines+=r*(e-1);break;case 2:i.lines+=r*e;break;case 0:i.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",t);break}}function n(){i.frame++;i.calls=0;i.triangles=0;i.points=0;i.lines=0}return{memory:t,render:i,programs:null,autoReset:true,reset:n,update:r}}function absNumericalSort(e,t){return Math.abs(t[1])-Math.abs(e[1])}function WebGLMorphtargets(e){var t={};var i=new Float32Array(8);function r(r,n,a,o){var s=r.morphTargetInfluences;var l=s===undefined?0:s.length;var c=t[n.id];if(c===undefined){c=[];for(var u=0;u<l;u++){c[u]=[u,0]}t[n.id]=c}var h=a.morphTargets&&n.morphAttributes.position;var p=a.morphNormals&&n.morphAttributes.normal;for(var u=0;u<l;u++){var m=c[u];if(m[1]!==0){if(h)n.deleteAttribute("morphTarget"+u);if(p)n.deleteAttribute("morphNormal"+u)}}for(var u=0;u<l;u++){var m=c[u];m[0]=u;m[1]=s[u]}c.sort(absNumericalSort);var f=0;for(var u=0;u<8;u++){var m=c[u];if(m){var d=m[0];var _=m[1];if(_){if(h)n.setAttribute("morphTarget"+u,h[d]);if(p)n.setAttribute("morphNormal"+u,p[d]);i[u]=_;f+=_;continue}}i[u]=0}var y=n.morphTargetsRelative?1:1-f;o.getUniforms().setValue(e,"morphTargetBaseInfluence",y);o.getUniforms().setValue(e,"morphTargetInfluences",i)}return{update:r}}function WebGLObjects(e,t,i,r){var n=new WeakMap;function a(e){var a=r.render.frame;var o=e.geometry;var s=t.get(e,o);if(n.get(s)!==a){if(o.isGeometry){s.updateFromObject(e)}t.update(s);n.set(s,a)}if(e.isInstancedMesh){i.update(e.instanceMatrix,34962)}return s}function o(){n=new WeakMap}return{update:a,dispose:o}}function CubeTexture(e,t,i,r,n,a,o,s,l,c){e=e!==undefined?e:[];t=t!==undefined?t:CubeReflectionMapping;o=o!==undefined?o:RGBFormat;Texture.call(this,e,t,i,r,n,a,o,s,l,c);this.flipY=false}CubeTexture.prototype=Object.create(Texture.prototype);CubeTexture.prototype.constructor=CubeTexture;CubeTexture.prototype.isCubeTexture=true;Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});function DataTexture2DArray(e,t,i,r){Texture.call(this,null);this.image={data:e||null,width:t||1,height:i||1,depth:r||1};this.magFilter=NearestFilter;this.minFilter=NearestFilter;this.wrapR=ClampToEdgeWrapping;this.generateMipmaps=false;this.flipY=false;this.needsUpdate=true}DataTexture2DArray.prototype=Object.create(Texture.prototype);DataTexture2DArray.prototype.constructor=DataTexture2DArray;DataTexture2DArray.prototype.isDataTexture2DArray=true;function DataTexture3D(e,t,i,r){Texture.call(this,null);this.image={data:e||null,width:t||1,height:i||1,depth:r||1};this.magFilter=NearestFilter;this.minFilter=NearestFilter;this.wrapR=ClampToEdgeWrapping;this.generateMipmaps=false;this.flipY=false;this.needsUpdate=true}DataTexture3D.prototype=Object.create(Texture.prototype);DataTexture3D.prototype.constructor=DataTexture3D;DataTexture3D.prototype.isDataTexture3D=true;var emptyTexture=new Texture;var emptyTexture2dArray=new DataTexture2DArray;var emptyTexture3d=new DataTexture3D;var emptyCubeTexture=new CubeTexture;var arrayCacheF32=[];var arrayCacheI32=[];var mat4array=new Float32Array(16);var mat3array=new Float32Array(9);var mat2array=new Float32Array(4);function flatten(e,t,i){var r=e[0];if(r<=0||r>0)return e;var n=t*i,a=arrayCacheF32[n];if(a===undefined){a=new Float32Array(n);arrayCacheF32[n]=a}if(t!==0){r.toArray(a,0);for(var o=1,s=0;o!==t;++o){s+=i;e[o].toArray(a,s)}}return a}function arraysEqual(e,t){if(e.length!==t.length)return false;for(var i=0,r=e.length;i<r;i++){if(e[i]!==t[i])return false}return true}function copyArray(e,t){for(var i=0,r=t.length;i<r;i++){e[i]=t[i]}}function allocTexUnits(e,t){var i=arrayCacheI32[t];if(i===undefined){i=new Int32Array(t);arrayCacheI32[t]=i}for(var r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function setValueV1f(e,t){var i=this.cache;if(i[0]===t)return;e.uniform1f(this.addr,t);i[0]=t}function setValueV2f(e,t){var i=this.cache;if(t.x!==undefined){if(i[0]!==t.x||i[1]!==t.y){e.uniform2f(this.addr,t.x,t.y);i[0]=t.x;i[1]=t.y}}else{if(arraysEqual(i,t))return;e.uniform2fv(this.addr,t);copyArray(i,t)}}function setValueV3f(e,t){var i=this.cache;if(t.x!==undefined){if(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z){e.uniform3f(this.addr,t.x,t.y,t.z);i[0]=t.x;i[1]=t.y;i[2]=t.z}}else if(t.r!==undefined){if(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b){e.uniform3f(this.addr,t.r,t.g,t.b);i[0]=t.r;i[1]=t.g;i[2]=t.b}}else{if(arraysEqual(i,t))return;e.uniform3fv(this.addr,t);copyArray(i,t)}}function setValueV4f(e,t){var i=this.cache;if(t.x!==undefined){if(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w){e.uniform4f(this.addr,t.x,t.y,t.z,t.w);i[0]=t.x;i[1]=t.y;i[2]=t.z;i[3]=t.w}}else{if(arraysEqual(i,t))return;e.uniform4fv(this.addr,t);copyArray(i,t)}}function setValueM2(e,t){var i=this.cache;var r=t.elements;if(r===undefined){if(arraysEqual(i,t))return;e.uniformMatrix2fv(this.addr,false,t);copyArray(i,t)}else{if(arraysEqual(i,r))return;mat2array.set(r);e.uniformMatrix2fv(this.addr,false,mat2array);copyArray(i,r)}}function setValueM3(e,t){var i=this.cache;var r=t.elements;if(r===undefined){if(arraysEqual(i,t))return;e.uniformMatrix3fv(this.addr,false,t);copyArray(i,t)}else{if(arraysEqual(i,r))return;mat3array.set(r);e.uniformMatrix3fv(this.addr,false,mat3array);copyArray(i,r)}}function setValueM4(e,t){var i=this.cache;var r=t.elements;if(r===undefined){if(arraysEqual(i,t))return;e.uniformMatrix4fv(this.addr,false,t);copyArray(i,t)}else{if(arraysEqual(i,r))return;mat4array.set(r);e.uniformMatrix4fv(this.addr,false,mat4array);copyArray(i,r)}}function setValueT1(e,t,i){var r=this.cache;var n=i.allocateTextureUnit();if(r[0]!==n){e.uniform1i(this.addr,n);r[0]=n}i.safeSetTexture2D(t||emptyTexture,n)}function setValueT2DArray1(e,t,i){var r=this.cache;var n=i.allocateTextureUnit();if(r[0]!==n){e.uniform1i(this.addr,n);r[0]=n}i.setTexture2DArray(t||emptyTexture2dArray,n)}function setValueT3D1(e,t,i){var r=this.cache;var n=i.allocateTextureUnit();if(r[0]!==n){e.uniform1i(this.addr,n);r[0]=n}i.setTexture3D(t||emptyTexture3d,n)}function setValueT6(e,t,i){var r=this.cache;var n=i.allocateTextureUnit();if(r[0]!==n){e.uniform1i(this.addr,n);r[0]=n}i.safeSetTextureCube(t||emptyCubeTexture,n)}function setValueV1i(e,t){var i=this.cache;if(i[0]===t)return;e.uniform1i(this.addr,t);i[0]=t}function setValueV2i(e,t){var i=this.cache;if(arraysEqual(i,t))return;e.uniform2iv(this.addr,t);copyArray(i,t)}function setValueV3i(e,t){var i=this.cache;if(arraysEqual(i,t))return;e.uniform3iv(this.addr,t);copyArray(i,t)}function setValueV4i(e,t){var i=this.cache;if(arraysEqual(i,t))return;e.uniform4iv(this.addr,t);copyArray(i,t)}function setValueV1ui(e,t){var i=this.cache;if(i[0]===t)return;e.uniform1ui(this.addr,t);i[0]=t}function getSingularSetter(e){switch(e){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(e,t){e.uniform1fv(this.addr,t)}function setValueV1iArray(e,t){e.uniform1iv(this.addr,t)}function setValueV2iArray(e,t){e.uniform2iv(this.addr,t)}function setValueV3iArray(e,t){e.uniform3iv(this.addr,t)}function setValueV4iArray(e,t){e.uniform4iv(this.addr,t)}function setValueV2fArray(e,t){var i=flatten(t,this.size,2);e.uniform2fv(this.addr,i)}function setValueV3fArray(e,t){var i=flatten(t,this.size,3);e.uniform3fv(this.addr,i)}function setValueV4fArray(e,t){var i=flatten(t,this.size,4);e.uniform4fv(this.addr,i)}function setValueM2Array(e,t){var i=flatten(t,this.size,4);e.uniformMatrix2fv(this.addr,false,i)}function setValueM3Array(e,t){var i=flatten(t,this.size,9);e.uniformMatrix3fv(this.addr,false,i)}function setValueM4Array(e,t){var i=flatten(t,this.size,16);e.uniformMatrix4fv(this.addr,false,i)}function setValueT1Array(e,t,i){var r=t.length;var n=allocTexUnits(i,r);e.uniform1iv(this.addr,n);for(var a=0;a!==r;++a){i.safeSetTexture2D(t[a]||emptyTexture,n[a])}}function setValueT6Array(e,t,i){var r=t.length;var n=allocTexUnits(i,r);e.uniform1iv(this.addr,n);for(var a=0;a!==r;++a){i.safeSetTextureCube(t[a]||emptyCubeTexture,n[a])}}function getPureArraySetter(e){switch(e){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}function SingleUniform(e,t,i){this.id=e;this.addr=i;this.cache=[];this.setValue=getSingularSetter(t.type)}function PureArrayUniform(e,t,i){this.id=e;this.addr=i;this.cache=[];this.size=t.size;this.setValue=getPureArraySetter(t.type)}PureArrayUniform.prototype.updateCache=function(e){var t=this.cache;if(e instanceof Float32Array&&t.length!==e.length){this.cache=new Float32Array(e.length)}copyArray(t,e)};function StructuredUniform(e){this.id=e;this.seq=[];this.map={}}StructuredUniform.prototype.setValue=function(e,t,i){var r=this.seq;for(var n=0,a=r.length;n!==a;++n){var o=r[n];o.setValue(e,t[o.id],i)}};var RePathPart=/([\w\d_]+)(\])?(\[|\.)?/g;function addUniform(e,t){e.seq.push(t);e.map[t.id]=t}function parseUniform(e,t,i){var r=e.name,n=r.length;RePathPart.lastIndex=0;while(true){var a=RePathPart.exec(r),o=RePathPart.lastIndex,s=a[1],l=a[2]==="]",c=a[3];if(l)s=s|0;if(c===undefined||c==="["&&o+2===n){addUniform(i,c===undefined?new SingleUniform(s,e,t):new PureArrayUniform(s,e,t));break}else{var u=i.map,h=u[s];if(h===undefined){h=new StructuredUniform(s);addUniform(i,h)}i=h}}}function WebGLUniforms(e,t){this.seq=[];this.map={};var i=e.getProgramParameter(t,35718);for(var r=0;r<i;++r){var n=e.getActiveUniform(t,r),a=e.getUniformLocation(t,n.name);parseUniform(n,a,this)}}WebGLUniforms.prototype.setValue=function(e,t,i,r){var n=this.map[t];if(n!==undefined)n.setValue(e,i,r)};WebGLUniforms.prototype.setOptional=function(e,t,i){var r=t[i];if(r!==undefined)this.setValue(e,i,r)};WebGLUniforms.upload=function(e,t,i,r){for(var n=0,a=t.length;n!==a;++n){var o=t[n],s=i[o.id];if(s.needsUpdate!==false){o.setValue(e,s.value,r)}}};WebGLUniforms.seqWithValue=function(e,t){var i=[];for(var r=0,n=e.length;r!==n;++r){var a=e[r];if(a.id in t)i.push(a)}return i};function WebGLShader(e,t,i){var r=e.createShader(t);e.shaderSource(r,i);e.compileShader(r);return r}var programIdCount=0;function addLineNumbers(e){var t=e.split("\n");for(var i=0;i<t.length;i++){t[i]=i+1+": "+t[i]}return t.join("\n")}function getEncodingComponents(e){switch(e){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case LogLuvEncoding:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function getShaderErrors(e,t,i){var r=e.getShaderParameter(t,35713);var n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";var a=e.getShaderSource(t);return"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+n+addLineNumbers(a)}function getTexelDecodingFunction(e,t){var i=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function getTexelEncodingFunction(e,t){var i=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function getToneMappingFunction(e,t){var i;switch(t){case LinearToneMapping:i="Linear";break;case ReinhardToneMapping:i="Reinhard";break;case Uncharted2ToneMapping:i="Uncharted2";break;case CineonToneMapping:i="OptimizedCineon";break;case ACESFilmicToneMapping:i="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function generateExtensions(e){var t=[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return t.filter(filterEmptyLine).join("\n")}function generateDefines(e){var t=[];for(var i in e){var r=e[i];if(r===false)continue;t.push("#define "+i+" "+r)}return t.join("\n")}function fetchAttributeLocations(e,t){var i={};var r=e.getProgramParameter(t,35721);for(var n=0;n<r;n++){var a=e.getActiveAttrib(t,n);var o=a.name;i[o]=e.getAttribLocation(t,o)}return i}function filterEmptyLine(e){return e!==""}function replaceLightNums(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function replaceClippingPlaneNums(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(e){return e.replace(includePattern,includeReplacer)}function includeReplacer(e,t){var i=ShaderChunk[t];if(i===undefined){throw new Error("Can not resolve #include <"+t+">")}return resolveIncludes(i)}var deprecatedUnrollLoopPattern=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;var unrollLoopPattern=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g;function unrollLoops(e){return e.replace(unrollLoopPattern,loopReplacer).replace(deprecatedUnrollLoopPattern,deprecatedLoopReplacer)}function deprecatedLoopReplacer(e,t,i,r){console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead.");return loopReplacer(e,t,i,r)}function loopReplacer(e,t,i,r){var n="";for(var a=parseInt(t);a<parseInt(i);a++){n+=r.replace(/\[ i \]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a)}return n}function generatePrecision(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";if(e.precision==="highp"){t+="\n#define HIGH_PRECISION"}else if(e.precision==="mediump"){t+="\n#define MEDIUM_PRECISION"}else if(e.precision==="lowp"){t+="\n#define LOW_PRECISION"}return t}function generateShadowMapTypeDefine(e){var t="SHADOWMAP_TYPE_BASIC";if(e.shadowMapType===PCFShadowMap){t="SHADOWMAP_TYPE_PCF"}else if(e.shadowMapType===PCFSoftShadowMap){t="SHADOWMAP_TYPE_PCF_SOFT"}else if(e.shadowMapType===VSMShadowMap){t="SHADOWMAP_TYPE_VSM"}return t}function generateEnvMapTypeDefine(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap){switch(e.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:t="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:t="ENVMAP_TYPE_CUBE_UV";break;case EquirectangularReflectionMapping:case EquirectangularRefractionMapping:t="ENVMAP_TYPE_EQUIREC";break;case SphericalReflectionMapping:t="ENVMAP_TYPE_SPHERE";break}}return t}function generateEnvMapModeDefine(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap){switch(e.envMapMode){case CubeRefractionMapping:case EquirectangularRefractionMapping:t="ENVMAP_MODE_REFRACTION";break}}return t}function generateEnvMapBlendingDefine(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap){switch(e.combine){case MultiplyOperation:t="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:t="ENVMAP_BLENDING_MIX";break;case AddOperation:t="ENVMAP_BLENDING_ADD";break}}return t}function WebGLProgram(e,t,i){var r=e.getContext();var n=i.defines;var a=i.vertexShader;var o=i.fragmentShader;var s=generateShadowMapTypeDefine(i);var l=generateEnvMapTypeDefine(i);var c=generateEnvMapModeDefine(i);var u=generateEnvMapBlendingDefine(i);var h=e.gammaFactor>0?e.gammaFactor:1;var p=i.isWebGL2?"":generateExtensions(i);var m=generateDefines(n);var f=r.createProgram();var d,_;if(i.isRawShaderMaterial){d=[m].filter(filterEmptyLine).join("\n");if(d.length>0){d+="\n"}_=[p,m].filter(filterEmptyLine).join("\n");if(_.length>0){_+="\n"}}else{d=[generatePrecision(i),"#define SHADER_NAME "+i.shaderName,m,i.instancing?"#define USE_INSTANCING":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+h,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===false?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+s:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n");_=[p,generatePrecision(i),"#define SHADER_NAME "+i.shaderName,m,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+h,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+l:"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+s:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",i.toneMapping!==NoToneMapping?ShaderChunk["tonemapping_pars_fragment"]:"",i.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.outputEncoding||i.mapEncoding||i.matcapEncoding||i.envMapEncoding||i.emissiveMapEncoding||i.lightMapEncoding?ShaderChunk["encodings_pars_fragment"]:"",i.mapEncoding?getTexelDecodingFunction("mapTexelToLinear",i.mapEncoding):"",i.matcapEncoding?getTexelDecodingFunction("matcapTexelToLinear",i.matcapEncoding):"",i.envMapEncoding?getTexelDecodingFunction("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMapEncoding?getTexelDecodingFunction("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMapEncoding?getTexelDecodingFunction("lightMapTexelToLinear",i.lightMapEncoding):"",i.outputEncoding?getTexelEncodingFunction("linearToOutputTexel",i.outputEncoding):"",i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")}a=resolveIncludes(a);a=replaceLightNums(a,i);a=replaceClippingPlaneNums(a,i);o=resolveIncludes(o);o=replaceLightNums(o,i);o=replaceClippingPlaneNums(o,i);a=unrollLoops(a);o=unrollLoops(o);if(i.isWebGL2&&!i.isRawShaderMaterial){var y=false;var v=/^\s*#version\s+300\s+es\s*\n/;if(i.isShaderMaterial&&a.match(v)!==null&&o.match(v)!==null){y=true;a=a.replace(v,"");o=o.replace(v,"")}d=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+d;_=["#version 300 es\n","#define varying in",y?"":"out highp vec4 pc_fragColor;",y?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_}var g=d+a;var x=_+o;var b=WebGLShader(r,35633,g);var M=WebGLShader(r,35632,x);r.attachShader(f,b);r.attachShader(f,M);if(i.index0AttributeName!==undefined){r.bindAttribLocation(f,0,i.index0AttributeName)}else if(i.morphTargets===true){r.bindAttribLocation(f,0,"position")}r.linkProgram(f);if(e.debug.checkShaderErrors){var w=r.getProgramInfoLog(f).trim();var S=r.getShaderInfoLog(b).trim();var A=r.getShaderInfoLog(M).trim();var C=true;var T=true;if(r.getProgramParameter(f,35714)===false){C=false;var B=getShaderErrors(r,b,"vertex");var L=getShaderErrors(r,M,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(f,35715),"gl.getProgramInfoLog",w,B,L)}else if(w!==""){console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",w)}else if(S===""||A===""){T=false}if(T){this.diagnostics={runnable:C,programLog:w,vertexShader:{log:S,prefix:d},fragmentShader:{log:A,prefix:_}}}}r.deleteShader(b);r.deleteShader(M);var D;this.getUniforms=function(){if(D===undefined){D=new WebGLUniforms(r,f)}return D};var E;this.getAttributes=function(){if(E===undefined){E=fetchAttributeLocations(r,f)}return E};this.destroy=function(){r.deleteProgram(f);this.program=undefined};this.name=i.shaderName;this.id=programIdCount++;this.cacheKey=t;this.usedTimes=1;this.program=f;this.vertexShader=b;this.fragmentShader=M;return this}function WebGLPrograms(e,t,i){var r=[];var n=i.isWebGL2;var a=i.logarithmicDepthBuffer;var o=i.floatVertexTextures;var s=i.precision;var l=i.maxVertexUniforms;var c=i.vertexTextures;var u={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};var h=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function p(e,t){var i;if(t){var r=ShaderLib[t];i={name:e.type,uniforms:UniformsUtils.clone(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}}else{i={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}}return i}function m(e){var t=e.skeleton;var i=t.bones;if(o){return 1024}else{var r=l;var n=Math.floor((r-20)/4);var a=Math.min(n,i.length);if(a<i.length){console.warn("THREE.WebGLRenderer: Skeleton has "+i.length+" bones. This GPU supports "+a+".");return 0}return a}}function f(e){var t;if(!e){t=LinearEncoding}else if(e.isTexture){t=e.encoding}else if(e.isWebGLRenderTarget){console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead.");t=e.texture.encoding}return t}this.getParameters=function(r,l,h,d,_,y,v){var g=d.fog;var x=r.isMeshStandardMaterial?d.environment:null;var b=r.envMap||x;var M=u[r.type];var w=v.isSkinnedMesh?m(v):0;if(r.precision!==null){s=i.getMaxPrecision(r.precision);if(s!==r.precision){console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",s,"instead.")}}var S=p(r,M);r.onBeforeCompile(S,e);var A=e.getRenderTarget();var C={isWebGL2:n,shaderID:M,shaderName:S.name,uniforms:S.uniforms,vertexShader:S.vertexShader,fragmentShader:S.fragmentShader,defines:r.defines,isRawShaderMaterial:r.isRawShaderMaterial,isShaderMaterial:r.isShaderMaterial,precision:s,instancing:v.isInstancedMesh===true,supportsVertexTextures:c,outputEncoding:A!==null?f(A.texture):e.outputEncoding,map:!!r.map,mapEncoding:f(r.map),matcap:!!r.matcap,matcapEncoding:f(r.matcap),envMap:!!b,envMapMode:b&&b.mapping,envMapEncoding:f(b),envMapCubeUV:!!b&&(b.mapping===CubeUVReflectionMapping||b.mapping===CubeUVRefractionMapping),lightMap:!!r.lightMap,lightMapEncoding:f(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:f(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===ObjectSpaceNormalMap,tangentSpaceNormalMap:r.normalMapType===TangentSpaceNormalMap,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexUvs:!!r.map||!!r.bumpMap||!!r.normalMap||!!r.specularMap||!!r.alphaMap||!!r.emissiveMap||!!r.roughnessMap||!!r.metalnessMap||!!r.clearcoatMap||!!r.clearcoatRoughnessMap||!!r.clearcoatNormalMap||!!r.displacementMap,uvsVertexOnly:!(!!r.map||!!r.bumpMap||!!r.normalMap||!!r.specularMap||!!r.alphaMap||!!r.emissiveMap||!!r.roughnessMap||!!r.metalnessMap||!!r.clearcoatNormalMap)&&!!r.displacementMap,fog:!!g,useFog:r.fog,fogExp2:g&&g.isFogExp2,flatShading:r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:a,skinning:r.skinning&&w>0,maxBones:w,useVertexTexture:o,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:l.directional.length,numPointLights:l.point.length,numSpotLights:l.spot.length,numRectAreaLights:l.rectArea.length,numHemiLights:l.hemi.length,numDirLightShadows:l.directionalShadowMap.length,numPointLightShadows:l.pointShadowMap.length,numSpotLightShadows:l.spotShadowMap.length,numClippingPlanes:_,numClipIntersection:y,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:NoToneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===DoubleSide,flipSided:r.side===BackSide,depthPacking:r.depthPacking!==undefined?r.depthPacking:false,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:n||t.get("EXT_frag_depth")!==null,rendererExtensionDrawBuffers:n||t.get("WEBGL_draw_buffers")!==null,rendererExtensionShaderTextureLod:n||t.get("EXT_shader_texture_lod")!==null,onBeforeCompile:r.onBeforeCompile};return C};this.getProgramCacheKey=function(t){var i=[];if(t.shaderID){i.push(t.shaderID)}else{i.push(t.fragmentShader);i.push(t.vertexShader)}if(t.defines!==undefined){for(var r in t.defines){i.push(r);i.push(t.defines[r])}}if(t.isRawShaderMaterial===undefined){for(var n=0;n<h.length;n++){i.push(t[h[n]])}i.push(e.outputEncoding);i.push(e.gammaFactor)}i.push(t.onBeforeCompile.toString());return i.join()};this.acquireProgram=function(t,i){var n;for(var a=0,o=r.length;a<o;a++){var s=r[a];if(s.cacheKey===i){n=s;++n.usedTimes;break}}if(n===undefined){n=new WebGLProgram(e,i,t);r.push(n)}return n};this.releaseProgram=function(e){if(--e.usedTimes===0){var t=r.indexOf(e);r[t]=r[r.length-1];r.pop();e.destroy()}};this.programs=r}function WebGLProperties(){var e=new WeakMap;function t(t){var i=e.get(t);if(i===undefined){i={};e.set(t,i)}return i}function i(t){e.delete(t)}function r(t,i,r){e.get(t)[i]=r}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function painterSortStable(e,t){if(e.groupOrder!==t.groupOrder){return e.groupOrder-t.groupOrder}else if(e.renderOrder!==t.renderOrder){return e.renderOrder-t.renderOrder}else if(e.program!==t.program){return e.program.id-t.program.id}else if(e.material.id!==t.material.id){return e.material.id-t.material.id}else if(e.z!==t.z){return e.z-t.z}else{return e.id-t.id}}function reversePainterSortStable(e,t){if(e.groupOrder!==t.groupOrder){return e.groupOrder-t.groupOrder}else if(e.renderOrder!==t.renderOrder){return e.renderOrder-t.renderOrder}else if(e.z!==t.z){return t.z-e.z}else{return e.id-t.id}}function WebGLRenderList(){var e=[];var t=0;var i=[];var r=[];var n={id:-1};function a(){t=0;i.length=0;r.length=0}function o(i,r,a,o,s,l){var c=e[t];if(c===undefined){c={id:i.id,object:i,geometry:r,material:a,program:a.program||n,groupOrder:o,renderOrder:i.renderOrder,z:s,group:l};e[t]=c}else{c.id=i.id;c.object=i;c.geometry=r;c.material=a;c.program=a.program||n;c.groupOrder=o;c.renderOrder=i.renderOrder;c.z=s;c.group=l}t++;return c}function s(e,t,n,a,s,l){var c=o(e,t,n,a,s,l);(n.transparent===true?r:i).push(c)}function l(e,t,n,a,s,l){var c=o(e,t,n,a,s,l);(n.transparent===true?r:i).unshift(c)}function c(e,t){if(i.length>1)i.sort(e||painterSortStable);if(r.length>1)r.sort(t||reversePainterSortStable)}function u(){for(var i=t,r=e.length;i<r;i++){var n=e[i];if(n.id===null)break;n.id=null;n.object=null;n.geometry=null;n.material=null;n.program=null;n.group=null}}return{opaque:i,transparent:r,init:a,push:s,unshift:l,finish:u,sort:c}}function WebGLRenderLists(){var e=new WeakMap;function t(i){var r=i.target;r.removeEventListener("dispose",t);e.delete(r)}function i(i,r){var n=e.get(i);var a;if(n===undefined){a=new WebGLRenderList;e.set(i,new WeakMap);e.get(i).set(r,a);i.addEventListener("dispose",t)}else{a=n.get(r);if(a===undefined){a=new WebGLRenderList;n.set(r,a)}}return a}function r(){e=new WeakMap}return{get:i,dispose:r}}function UniformsCache(){var e={};return{get:function(t){if(e[t.id]!==undefined){return e[t.id]}var i;switch(t.type){case"DirectionalLight":i={direction:new Vector3,color:new Color};break;case"SpotLight":i={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":i={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}e[t.id]=i;return i}}}function ShadowUniformsCache(){var e={};return{get:function(t){if(e[t.id]!==undefined){return e[t.id]}var i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":i={shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":i={shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}e[t.id]=i;return i}}}var nextVersion=0;function shadowCastingLightsFirst(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function WebGLLights(){var e=new UniformsCache;var t=ShadowUniformsCache();var i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(var r=0;r<9;r++)i.probe.push(new Vector3);var n=new Vector3;var a=new Matrix4;var o=new Matrix4;function s(r,s,l){var c=0,u=0,h=0;for(var p=0;p<9;p++)i.probe[p].set(0,0,0);var m=0;var f=0;var d=0;var _=0;var y=0;var v=0;var g=0;var x=0;var b=l.matrixWorldInverse;r.sort(shadowCastingLightsFirst);for(var p=0,M=r.length;p<M;p++){var w=r[p];var S=w.color;var A=w.intensity;var C=w.distance;var T=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight){c+=S.r*A;u+=S.g*A;h+=S.b*A}else if(w.isLightProbe){for(var B=0;B<9;B++){i.probe[B].addScaledVector(w.sh.coefficients[B],A)}}else if(w.isDirectionalLight){var L=e.get(w);L.color.copy(w.color).multiplyScalar(w.intensity);L.direction.setFromMatrixPosition(w.matrixWorld);n.setFromMatrixPosition(w.target.matrixWorld);L.direction.sub(n);L.direction.transformDirection(b);if(w.castShadow){var D=w.shadow;var E=t.get(w);E.shadowBias=D.bias;E.shadowRadius=D.radius;E.shadowMapSize=D.mapSize;i.directionalShadow[m]=E;i.directionalShadowMap[m]=T;i.directionalShadowMatrix[m]=w.shadow.matrix;v++}i.directional[m]=L;m++}else if(w.isSpotLight){var L=e.get(w);L.position.setFromMatrixPosition(w.matrixWorld);L.position.applyMatrix4(b);L.color.copy(S).multiplyScalar(A);L.distance=C;L.direction.setFromMatrixPosition(w.matrixWorld);n.setFromMatrixPosition(w.target.matrixWorld);L.direction.sub(n);L.direction.transformDirection(b);L.coneCos=Math.cos(w.angle);L.penumbraCos=Math.cos(w.angle*(1-w.penumbra));L.decay=w.decay;if(w.castShadow){var D=w.shadow;var E=t.get(w);E.shadowBias=D.bias;E.shadowRadius=D.radius;E.shadowMapSize=D.mapSize;i.spotShadow[d]=E;i.spotShadowMap[d]=T;i.spotShadowMatrix[d]=w.shadow.matrix;x++}i.spot[d]=L;d++}else if(w.isRectAreaLight){var L=e.get(w);L.color.copy(S).multiplyScalar(A);L.position.setFromMatrixPosition(w.matrixWorld);L.position.applyMatrix4(b);o.identity();a.copy(w.matrixWorld);a.premultiply(b);o.extractRotation(a);L.halfWidth.set(w.width*.5,0,0);L.halfHeight.set(0,w.height*.5,0);L.halfWidth.applyMatrix4(o);L.halfHeight.applyMatrix4(o);i.rectArea[_]=L;_++}else if(w.isPointLight){var L=e.get(w);L.position.setFromMatrixPosition(w.matrixWorld);L.position.applyMatrix4(b);L.color.copy(w.color).multiplyScalar(w.intensity);L.distance=w.distance;L.decay=w.decay;if(w.castShadow){var D=w.shadow;var E=t.get(w);E.shadowBias=D.bias;E.shadowRadius=D.radius;E.shadowMapSize=D.mapSize;E.shadowCameraNear=D.camera.near;E.shadowCameraFar=D.camera.far;i.pointShadow[f]=E;i.pointShadowMap[f]=T;i.pointShadowMatrix[f]=w.shadow.matrix;g++}i.point[f]=L;f++}else if(w.isHemisphereLight){var L=e.get(w);L.direction.setFromMatrixPosition(w.matrixWorld);L.direction.transformDirection(b);L.direction.normalize();L.skyColor.copy(w.color).multiplyScalar(A);L.groundColor.copy(w.groundColor).multiplyScalar(A);i.hemi[y]=L;y++}}i.ambient[0]=c;i.ambient[1]=u;i.ambient[2]=h;var R=i.hash;if(R.directionalLength!==m||R.pointLength!==f||R.spotLength!==d||R.rectAreaLength!==_||R.hemiLength!==y||R.numDirectionalShadows!==v||R.numPointShadows!==g||R.numSpotShadows!==x){i.directional.length=m;i.spot.length=d;i.rectArea.length=_;i.point.length=f;i.hemi.length=y;i.directionalShadow.length=v;i.directionalShadowMap.length=v;i.pointShadow.length=g;i.pointShadowMap.length=g;i.spotShadow.length=x;i.spotShadowMap.length=x;i.directionalShadowMatrix.length=v;i.pointShadowMatrix.length=g;i.spotShadowMatrix.length=x;R.directionalLength=m;R.pointLength=f;R.spotLength=d;R.rectAreaLength=_;R.hemiLength=y;R.numDirectionalShadows=v;R.numPointShadows=g;R.numSpotShadows=x;i.version=nextVersion++}}return{setup:s,state:i}}function WebGLRenderState(){var e=new WebGLLights;var t=[];var i=[];function r(){t.length=0;i.length=0}function n(e){t.push(e)}function a(e){i.push(e)}function o(r){e.setup(t,i,r)}var s={lightsArray:t,shadowsArray:i,lights:e};return{init:r,state:s,setupLights:o,pushLight:n,pushShadow:a}}function WebGLRenderStates(){var e=new WeakMap;function t(i){var r=i.target;r.removeEventListener("dispose",t);e.delete(r)}function i(i,r){var n;if(e.has(i)===false){n=new WebGLRenderState;e.set(i,new WeakMap);e.get(i).set(r,n);i.addEventListener("dispose",t)}else{if(e.get(i).has(r)===false){n=new WebGLRenderState;e.get(i).set(r,n)}else{n=e.get(i).get(r)}}return n}function r(){e=new WeakMap}return{get:i,dispose:r}}function MeshDepthMaterial(e){Material.call(this);this.type="MeshDepthMaterial";this.depthPacking=BasicDepthPacking;this.skinning=false;this.morphTargets=false;this.map=null;this.alphaMap=null;this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.setValues(e)}MeshDepthMaterial.prototype=Object.create(Material.prototype);MeshDepthMaterial.prototype.constructor=MeshDepthMaterial;MeshDepthMaterial.prototype.isMeshDepthMaterial=true;MeshDepthMaterial.prototype.copy=function(e){Material.prototype.copy.call(this,e);this.depthPacking=e.depthPacking;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.map=e.map;this.alphaMap=e.alphaMap;this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;return this};function MeshDistanceMaterial(e){Material.call(this);this.type="MeshDistanceMaterial";this.referencePosition=new Vector3;this.nearDistance=1;this.farDistance=1e3;this.skinning=false;this.morphTargets=false;this.map=null;this.alphaMap=null;this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.fog=false;this.setValues(e)}MeshDistanceMaterial.prototype=Object.create(Material.prototype);MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial;MeshDistanceMaterial.prototype.isMeshDistanceMaterial=true;MeshDistanceMaterial.prototype.copy=function(e){Material.prototype.copy.call(this,e);this.referencePosition.copy(e.referencePosition);this.nearDistance=e.nearDistance;this.farDistance=e.farDistance;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.map=e.map;this.alphaMap=e.alphaMap;this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;return this};var vsm_frag="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";var vsm_vert="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function WebGLShadowMap(e,t,i){var r=new Frustum,n=new Vector2,a=new Vector2,o=new Vector4,s=[],l=[],c={};var u={0:BackSide,1:FrontSide,2:DoubleSide};var h=new ShaderMaterial({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vsm_vert,fragmentShader:vsm_frag});var p=h.clone();p.defines.HORIZONAL_PASS=1;var m=new BufferGeometry;m.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var f=new Mesh(m,h);var d=this;this.enabled=false;this.autoUpdate=true;this.needsUpdate=false;this.type=PCFShadowMap;this.render=function(t,s,l){if(d.enabled===false)return;if(d.autoUpdate===false&&d.needsUpdate===false)return;if(t.length===0)return;var c=e.getRenderTarget();var u=e.getActiveCubeFace();var h=e.getActiveMipmapLevel();var p=e.state;p.setBlending(NoBlending);p.buffers.color.setClear(1,1,1,1);p.buffers.depth.setTest(true);p.setScissorTest(false);for(var m=0,f=t.length;m<f;m++){var y=t[m];var v=y.shadow;if(v===undefined){console.warn("THREE.WebGLShadowMap:",y,"has no shadow.");continue}n.copy(v.mapSize);var g=v.getFrameExtents();n.multiply(g);a.copy(v.mapSize);if(n.x>i||n.y>i){if(n.x>i){a.x=Math.floor(i/g.x);n.x=a.x*g.x;v.mapSize.x=a.x}if(n.y>i){a.y=Math.floor(i/g.y);n.y=a.y*g.y;v.mapSize.y=a.y}}if(v.map===null&&!v.isPointLightShadow&&this.type===VSMShadowMap){var b={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};v.map=new WebGLRenderTarget(n.x,n.y,b);v.map.texture.name=y.name+".shadowMap";v.mapPass=new WebGLRenderTarget(n.x,n.y,b);v.camera.updateProjectionMatrix()}if(v.map===null){var b={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat};v.map=new WebGLRenderTarget(n.x,n.y,b);v.map.texture.name=y.name+".shadowMap";v.camera.updateProjectionMatrix()}e.setRenderTarget(v.map);e.clear();var M=v.getViewportCount();for(var w=0;w<M;w++){var S=v.getViewport(w);o.set(a.x*S.x,a.y*S.y,a.x*S.z,a.y*S.w);p.viewport(o);v.updateMatrices(y,w);r=v.getFrustum();x(s,l,v.camera,y,this.type)}if(!v.isPointLightShadow&&this.type===VSMShadowMap){_(v,l)}}d.needsUpdate=false;e.setRenderTarget(c,u,h)};function _(i,r){var n=t.update(f);h.uniforms.shadow_pass.value=i.map.texture;h.uniforms.resolution.value=i.mapSize;h.uniforms.radius.value=i.radius;e.setRenderTarget(i.mapPass);e.clear();e.renderBufferDirect(r,null,n,h,f,null);p.uniforms.shadow_pass.value=i.mapPass.texture;p.uniforms.resolution.value=i.mapSize;p.uniforms.radius.value=i.radius;e.setRenderTarget(i.map);e.clear();e.renderBufferDirect(r,null,n,p,f,null)}function y(e,t,i){var r=e<<0|t<<1|i<<2;var n=s[r];if(n===undefined){n=new MeshDepthMaterial({depthPacking:RGBADepthPacking,morphTargets:e,skinning:t});s[r]=n}return n}function v(e,t,i){var r=e<<0|t<<1|i<<2;var n=l[r];if(n===undefined){n=new MeshDistanceMaterial({morphTargets:e,skinning:t});l[r]=n}return n}function g(t,i,r,n,a,o,s){var l=null;var h=y;var p=t.customDepthMaterial;if(n.isPointLight===true){h=v;p=t.customDistanceMaterial}if(p===undefined){var m=false;if(r.morphTargets===true){m=i.morphAttributes&&i.morphAttributes.position&&i.morphAttributes.position.length>0}var f=false;if(t.isSkinnedMesh===true){if(r.skinning===true){f=true}else{console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)}}var d=t.isInstancedMesh===true;l=h(m,f,d)}else{l=p}if(e.localClippingEnabled&&r.clipShadows===true&&r.clippingPlanes.length!==0){var _=l.uuid,g=r.uuid;var x=c[_];if(x===undefined){x={};c[_]=x}var b=x[g];if(b===undefined){b=l.clone();x[g]=b}l=b}l.visible=r.visible;l.wireframe=r.wireframe;if(s===VSMShadowMap){l.side=r.shadowSide!==null?r.shadowSide:r.side}else{l.side=r.shadowSide!==null?r.shadowSide:u[r.side]}l.clipShadows=r.clipShadows;l.clippingPlanes=r.clippingPlanes;l.clipIntersection=r.clipIntersection;l.wireframeLinewidth=r.wireframeLinewidth;l.linewidth=r.linewidth;if(n.isPointLight===true&&l.isMeshDistanceMaterial===true){l.referencePosition.setFromMatrixPosition(n.matrixWorld);l.nearDistance=a;l.farDistance=o}return l}function x(i,n,a,o,s){if(i.visible===false)return;var l=i.layers.test(n.layers);if(l&&(i.isMesh||i.isLine||i.isPoints)){if((i.castShadow||i.receiveShadow&&s===VSMShadowMap)&&(!i.frustumCulled||r.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,i.matrixWorld);var c=t.update(i);var u=i.material;if(Array.isArray(u)){var h=c.groups;for(var p=0,m=h.length;p<m;p++){var f=h[p];var d=u[f.materialIndex];if(d&&d.visible){var _=g(i,c,d,o,a.near,a.far,s);e.renderBufferDirect(a,null,c,_,i,f)}}}else if(u.visible){var _=g(i,c,u,o,a.near,a.far,s);e.renderBufferDirect(a,null,c,_,i,null)}}}var y=i.children;for(var v=0,b=y.length;v<b;v++){x(y[v],n,a,o,s)}}}function WebGLState(e,t,i){var r=i.isWebGL2;function n(){var t=false;var i=new Vector4;var r=null;var n=new Vector4(0,0,0,0);return{setMask:function(i){if(r!==i&&!t){e.colorMask(i,i,i,i);r=i}},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){if(s===true){t*=o;r*=o;a*=o}i.set(t,r,a,o);if(n.equals(i)===false){e.clearColor(t,r,a,o);n.copy(i)}},reset:function(){t=false;r=null;n.set(-1,0,0,0)}}}function a(){var t=false;var i=null;var r=null;var n=null;return{setTest:function(e){if(e){W(2929)}else{J(2929)}},setMask:function(r){if(i!==r&&!t){e.depthMask(r);i=r}},setFunc:function(t){if(r!==t){if(t){switch(t){case NeverDepth:e.depthFunc(512);break;case AlwaysDepth:e.depthFunc(519);break;case LessDepth:e.depthFunc(513);break;case LessEqualDepth:e.depthFunc(515);break;case EqualDepth:e.depthFunc(514);break;case GreaterEqualDepth:e.depthFunc(518);break;case GreaterDepth:e.depthFunc(516);break;case NotEqualDepth:e.depthFunc(517);break;default:e.depthFunc(515)}}else{e.depthFunc(515)}r=t}},setLocked:function(e){t=e},setClear:function(t){if(n!==t){e.clearDepth(t);n=t}},reset:function(){t=false;i=null;r=null;n=null}}}function o(){var t=false;var i=null;var r=null;var n=null;var a=null;var o=null;var s=null;var l=null;var c=null;return{setTest:function(e){if(!t){if(e){W(2960)}else{J(2960)}}},setMask:function(r){if(i!==r&&!t){e.stencilMask(r);i=r}},setFunc:function(t,i,o){if(r!==t||n!==i||a!==o){e.stencilFunc(t,i,o);r=t;n=i;a=o}},setOp:function(t,i,r){if(o!==t||s!==i||l!==r){e.stencilOp(t,i,r);o=t;s=i;l=r}},setLocked:function(e){t=e},setClear:function(t){if(c!==t){e.clearStencil(t);c=t}},reset:function(){t=false;i=null;r=null;n=null;a=null;o=null;s=null;l=null;c=null}}}var s=new n;var l=new a;var c=new o;var u=e.getParameter(34921);var h=new Uint8Array(u);var p=new Uint8Array(u);var m=new Uint8Array(u);var f={};var d=null;var _=null;var y=null;var v=null;var g=null;var x=null;var b=null;var M=null;var w=null;var S=false;var A=null;var C=null;var T=null;var B=null;var L=null;var D=e.getParameter(35661);var E=false;var R=0;var P=e.getParameter(7938);if(P.indexOf("WebGL")!==-1){R=parseFloat(/^WebGL\ ([0-9])/.exec(P)[1]);E=R>=1}else if(P.indexOf("OpenGL ES")!==-1){R=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(P)[1]);E=R>=2}var G=null;var I={};var V=new Vector4;var F=new Vector4;function O(t,i,r){var n=new Uint8Array(4);var a=e.createTexture();e.bindTexture(t,a);e.texParameteri(t,10241,9728);e.texParameteri(t,10240,9728);for(var o=0;o<r;o++){e.texImage2D(i+o,0,6408,1,1,0,6408,5121,n)}return a}var N={};N[3553]=O(3553,3553,1);N[34067]=O(34067,34069,6);s.setClear(0,0,0,1);l.setClear(1);c.setClear(0);W(2929);l.setFunc(LessEqualDepth);Q(false);ee(CullFaceBack);W(2884);Y(NoBlending);function U(){for(var e=0,t=h.length;e<t;e++){h[e]=0}}function z(e){k(e,0)}function k(i,n){h[i]=1;if(p[i]===0){e.enableVertexAttribArray(i);p[i]=1}if(m[i]!==n){var a=r?e:t.get("ANGLE_instanced_arrays");a[r?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,n);m[i]=n}}function H(){for(var t=0,i=p.length;t!==i;++t){if(p[t]!==h[t]){e.disableVertexAttribArray(t);p[t]=0}}}function j(t,i,n,a,o,s){if(r===true&&(n===5124||n===5125)){e.vertexAttribIPointer(t,i,n,a,o,s)}else{e.vertexAttribPointer(t,i,n,a,o,s)}}function W(t){if(f[t]!==true){e.enable(t);f[t]=true}}function J(t){if(f[t]!==false){e.disable(t);f[t]=false}}function q(t){if(d!==t){e.useProgram(t);d=t;return true}return false}var X={[AddEquation]:32774,[SubtractEquation]:32778,[ReverseSubtractEquation]:32779};if(r){X[MinEquation]=32775;X[MaxEquation]=32776}else{var $=t.get("EXT_blend_minmax");if($!==null){X[MinEquation]=$.MIN_EXT;X[MaxEquation]=$.MAX_EXT}}var Z={[ZeroFactor]:0,[OneFactor]:1,[SrcColorFactor]:768,[SrcAlphaFactor]:770,[SrcAlphaSaturateFactor]:776,[DstColorFactor]:774,[DstAlphaFactor]:772,[OneMinusSrcColorFactor]:769,[OneMinusSrcAlphaFactor]:771,[OneMinusDstColorFactor]:775,[OneMinusDstAlphaFactor]:773};function Y(t,i,r,n,a,o,s,l){if(t===NoBlending){if(_){J(3042);_=false}return}if(!_){W(3042);_=true}if(t!==CustomBlending){if(t!==y||l!==S){if(v!==AddEquation||b!==AddEquation){e.blendEquation(32774);v=AddEquation;b=AddEquation}if(l){switch(t){case NormalBlending:e.blendFuncSeparate(1,771,1,771);break;case AdditiveBlending:e.blendFunc(1,1);break;case SubtractiveBlending:e.blendFuncSeparate(0,0,769,771);break;case MultiplyBlending:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t);break}}else{switch(t){case NormalBlending:e.blendFuncSeparate(770,771,1,771);break;case AdditiveBlending:e.blendFunc(770,1);break;case SubtractiveBlending:e.blendFunc(0,769);break;case MultiplyBlending:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t);break}}g=null;x=null;M=null;w=null;y=t;S=l}return}a=a||i;o=o||r;s=s||n;if(i!==v||a!==b){e.blendEquationSeparate(X[i],X[a]);v=i;b=a}if(r!==g||n!==x||o!==M||s!==w){e.blendFuncSeparate(Z[r],Z[n],Z[o],Z[s]);g=r;x=n;M=o;w=s}y=t;S=null}function K(e,t){e.side===DoubleSide?J(2884):W(2884);var i=e.side===BackSide;if(t)i=!i;Q(i);e.blending===NormalBlending&&e.transparent===false?Y(NoBlending):Y(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha);l.setFunc(e.depthFunc);l.setTest(e.depthTest);l.setMask(e.depthWrite);s.setMask(e.colorWrite);var r=e.stencilWrite;c.setTest(r);if(r){c.setMask(e.stencilWriteMask);c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask);c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)}ie(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function Q(t){if(A!==t){if(t){e.frontFace(2304)}else{e.frontFace(2305)}A=t}}function ee(t){if(t!==CullFaceNone){W(2884);if(t!==C){if(t===CullFaceBack){e.cullFace(1029)}else if(t===CullFaceFront){e.cullFace(1028)}else{e.cullFace(1032)}}}else{J(2884)}C=t}function te(t){if(t!==T){if(E)e.lineWidth(t);T=t}}function ie(t,i,r){if(t){W(32823);if(B!==i||L!==r){e.polygonOffset(i,r);B=i;L=r}}else{J(32823)}}function re(e){if(e){W(3089)}else{J(3089)}}function ne(t){if(t===undefined)t=33984+D-1;if(G!==t){e.activeTexture(t);G=t}}function ae(t,i){if(G===null){ne()}var r=I[G];if(r===undefined){r={type:undefined,texture:undefined};I[G]=r}if(r.type!==t||r.texture!==i){e.bindTexture(t,i||N[t]);r.type=t;r.texture=i}}function oe(){var t=I[G];if(t!==undefined&&t.type!==undefined){e.bindTexture(t.type,null);t.type=undefined;t.texture=undefined}}function se(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function le(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function ce(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function ue(t){if(V.equals(t)===false){e.scissor(t.x,t.y,t.z,t.w);V.copy(t)}}function he(t){if(F.equals(t)===false){e.viewport(t.x,t.y,t.z,t.w);F.copy(t)}}function pe(){for(var t=0;t<p.length;t++){if(p[t]===1){e.disableVertexAttribArray(t);p[t]=0}}f={};G=null;I={};d=null;y=null;A=null;C=null;s.reset();l.reset();c.reset()}return{buffers:{color:s,depth:l,stencil:c},initAttributes:U,enableAttribute:z,enableAttributeAndDivisor:k,disableUnusedAttributes:H,vertexAttribPointer:j,enable:W,disable:J,useProgram:q,setBlending:Y,setMaterial:K,setFlipSided:Q,setCullFace:ee,setLineWidth:te,setPolygonOffset:ie,setScissorTest:re,activeTexture:ne,bindTexture:ae,unbindTexture:oe,compressedTexImage2D:se,texImage2D:le,texImage3D:ce,scissor:ue,viewport:he,reset:pe}}function WebGLTextures(e,t,i,r,n,a,o){var s=n.isWebGL2;var l=n.maxTextures;var c=n.maxCubemapSize;var u=n.maxTextureSize;var h=n.maxSamples;var p=new WeakMap;var m;var f=false;try{f=typeof OffscreenCanvas!=="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(e){}function d(e,t){return f?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function _(e,t,i,r){var n=1;if(e.width>r||e.height>r){n=r/Math.max(e.width,e.height)}if(n<1||t===true){if(typeof HTMLImageElement!=="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!=="undefined"&&e instanceof HTMLCanvasElement||typeof ImageBitmap!=="undefined"&&e instanceof ImageBitmap){var a=t?MathUtils.floorPowerOfTwo:Math.floor;var o=a(n*e.width);var s=a(n*e.height);if(m===undefined)m=d(o,s);var l=i?d(o,s):m;l.width=o;l.height=s;var c=l.getContext("2d");c.drawImage(e,0,0,o,s);console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+").");return l}else{if("data"in e){console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+").")}return e}}return e}function y(e){return MathUtils.isPowerOfTwo(e.width)&&MathUtils.isPowerOfTwo(e.height)}function v(e){if(s)return false;return e.wrapS!==ClampToEdgeWrapping||e.wrapT!==ClampToEdgeWrapping||e.minFilter!==NearestFilter&&e.minFilter!==LinearFilter}function g(e,t){return e.generateMipmaps&&t&&e.minFilter!==NearestFilter&&e.minFilter!==LinearFilter}function x(t,i,n,a){e.generateMipmap(t);var o=r.get(i);o.__maxMipLevel=Math.log(Math.max(n,a))*Math.LOG2E}function b(i,r,n){if(s===false)return r;if(i!==null){if(e[i]!==undefined)return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}var a=r;if(r===6403){if(n===5126)a=33326;if(n===5131)a=33325;if(n===5121)a=33321}if(r===6407){if(n===5126)a=34837;if(n===5131)a=34843;if(n===5121)a=32849}if(r===6408){if(n===5126)a=34836;if(n===5131)a=34842;if(n===5121)a=32856}if(a===33325||a===33326||a===34842||a===34836){t.get("EXT_color_buffer_float")}return a}function M(e){if(e===NearestFilter||e===NearestMipmapNearestFilter||e===NearestMipmapLinearFilter){return 9728}return 9729}function w(e){var t=e.target;t.removeEventListener("dispose",w);A(t);if(t.isVideoTexture){p.delete(t)}o.memory.textures--}function S(e){var t=e.target;t.removeEventListener("dispose",S);C(t);o.memory.textures--}function A(t){var i=r.get(t);if(i.__webglInit===undefined)return;e.deleteTexture(i.__webglTexture);r.remove(t)}function C(t){var i=r.get(t);var n=r.get(t.texture);if(!t)return;if(n.__webglTexture!==undefined){e.deleteTexture(n.__webglTexture)}if(t.depthTexture){t.depthTexture.dispose()}if(t.isWebGLCubeRenderTarget){for(var a=0;a<6;a++){e.deleteFramebuffer(i.__webglFramebuffer[a]);if(i.__webglDepthbuffer)e.deleteRenderbuffer(i.__webglDepthbuffer[a])}}else{e.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer)e.deleteRenderbuffer(i.__webglDepthbuffer);if(i.__webglMultisampledFramebuffer)e.deleteFramebuffer(i.__webglMultisampledFramebuffer);if(i.__webglColorRenderbuffer)e.deleteRenderbuffer(i.__webglColorRenderbuffer);if(i.__webglDepthRenderbuffer)e.deleteRenderbuffer(i.__webglDepthRenderbuffer)}r.remove(t.texture);r.remove(t)}var T=0;function B(){T=0}function L(){var e=T;if(e>=l){console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l)}T+=1;return e}function D(e,t){var n=r.get(e);if(e.isVideoTexture)X(e);if(e.version>0&&n.__version!==e.version){var a=e.image;if(a===undefined){console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined")}else if(a.complete===false){console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}else{N(n,e,t);return}}i.activeTexture(33984+t);i.bindTexture(3553,n.__webglTexture)}function E(e,t){var n=r.get(e);if(e.version>0&&n.__version!==e.version){N(n,e,t);return}i.activeTexture(33984+t);i.bindTexture(35866,n.__webglTexture)}function R(e,t){var n=r.get(e);if(e.version>0&&n.__version!==e.version){N(n,e,t);return}i.activeTexture(33984+t);i.bindTexture(32879,n.__webglTexture)}function P(t,n){if(t.image.length!==6)return;var o=r.get(t);if(t.version>0&&o.__version!==t.version){O(o,t);i.activeTexture(33984+n);i.bindTexture(34067,o.__webglTexture);e.pixelStorei(37440,t.flipY);var l=t&&(t.isCompressedTexture||t.image[0].isCompressedTexture);var u=t.image[0]&&t.image[0].isDataTexture;var h=[];for(var p=0;p<6;p++){if(!l&&!u){h[p]=_(t.image[p],false,true,c)}else{h[p]=u?t.image[p].image:t.image[p]}}var m=h[0],f=y(m)||s,d=a.convert(t.format),v=a.convert(t.type),M=b(t.internalFormat,d,v);F(34067,t,f);var w;if(l){for(var p=0;p<6;p++){w=h[p].mipmaps;for(var S=0;S<w.length;S++){var A=w[S];if(t.format!==RGBAFormat&&t.format!==RGBFormat){if(d!==null){i.compressedTexImage2D(34069+p,S,M,A.width,A.height,0,A.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()")}}else{i.texImage2D(34069+p,S,M,A.width,A.height,0,d,v,A.data)}}}o.__maxMipLevel=w.length-1}else{w=t.mipmaps;for(var p=0;p<6;p++){if(u){i.texImage2D(34069+p,0,M,h[p].width,h[p].height,0,d,v,h[p].data);for(var S=0;S<w.length;S++){var A=w[S];var C=A.image[p].image;i.texImage2D(34069+p,S+1,M,C.width,C.height,0,d,v,C.data)}}else{i.texImage2D(34069+p,0,M,d,v,h[p]);for(var S=0;S<w.length;S++){var A=w[S];i.texImage2D(34069+p,S+1,M,d,v,A.image[p])}}}o.__maxMipLevel=w.length}if(g(t,f)){x(34067,t,m.width,m.height)}o.__version=t.version;if(t.onUpdate)t.onUpdate(t)}else{i.activeTexture(33984+n);i.bindTexture(34067,o.__webglTexture)}}function G(e,t){i.activeTexture(33984+t);i.bindTexture(34067,r.get(e).__webglTexture)}var I={[RepeatWrapping]:10497,[ClampToEdgeWrapping]:33071,[MirroredRepeatWrapping]:33648};var V={[NearestFilter]:9728,[NearestMipmapNearestFilter]:9984,[NearestMipmapLinearFilter]:9986,[LinearFilter]:9729,[LinearMipmapNearestFilter]:9985,[LinearMipmapLinearFilter]:9987};function F(i,a,o){if(o){e.texParameteri(i,10242,I[a.wrapS]);e.texParameteri(i,10243,I[a.wrapT]);if(i===32879||i===35866){e.texParameteri(i,32882,I[a.wrapR])}e.texParameteri(i,10240,V[a.magFilter]);e.texParameteri(i,10241,V[a.minFilter])}else{e.texParameteri(i,10242,33071);e.texParameteri(i,10243,33071);if(i===32879||i===35866){e.texParameteri(i,32882,33071)}if(a.wrapS!==ClampToEdgeWrapping||a.wrapT!==ClampToEdgeWrapping){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.")}e.texParameteri(i,10240,M(a.magFilter));e.texParameteri(i,10241,M(a.minFilter));if(a.minFilter!==NearestFilter&&a.minFilter!==LinearFilter){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")}}var l=t.get("EXT_texture_filter_anisotropic");if(l){if(a.type===FloatType&&t.get("OES_texture_float_linear")===null)return;if(a.type===HalfFloatType&&(s||t.get("OES_texture_half_float_linear"))===null)return;if(a.anisotropy>1||r.get(a).__currentAnisotropy){e.texParameterf(i,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,n.getMaxAnisotropy()));r.get(a).__currentAnisotropy=a.anisotropy}}}function O(t,i){if(t.__webglInit===undefined){t.__webglInit=true;i.addEventListener("dispose",w);t.__webglTexture=e.createTexture();o.memory.textures++}}function N(t,r,n){var o=3553;if(r.isDataTexture2DArray)o=35866;if(r.isDataTexture3D)o=32879;O(t,r);i.activeTexture(33984+n);i.bindTexture(o,t.__webglTexture);e.pixelStorei(37440,r.flipY);e.pixelStorei(37441,r.premultiplyAlpha);e.pixelStorei(3317,r.unpackAlignment);var l=v(r)&&y(r.image)===false;var c=_(r.image,l,false,u);var h=y(c)||s,p=a.convert(r.format),m=a.convert(r.type),f=b(r.internalFormat,p,m);F(o,r,h);var d,M=r.mipmaps;if(r.isDepthTexture){f=6402;if(s){if(r.type===FloatType){f=36012}else if(r.type===UnsignedIntType){f=33190}else if(r.type===UnsignedInt248Type){f=35056}else{f=33189}}else{if(r.type===FloatType){console.error("WebGLRenderer: Floating point depth texture requires WebGL2.")}}if(r.format===DepthFormat&&f===6402){if(r.type!==UnsignedShortType&&r.type!==UnsignedIntType){console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.");r.type=UnsignedShortType;m=a.convert(r.type)}}if(r.format===DepthStencilFormat&&f===6402){f=34041;if(r.type!==UnsignedInt248Type){console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.");r.type=UnsignedInt248Type;m=a.convert(r.type)}}i.texImage2D(3553,0,f,c.width,c.height,0,p,m,null)}else if(r.isDataTexture){if(M.length>0&&h){for(var w=0,S=M.length;w<S;w++){d=M[w];i.texImage2D(3553,w,f,d.width,d.height,0,p,m,d.data)}r.generateMipmaps=false;t.__maxMipLevel=M.length-1}else{i.texImage2D(3553,0,f,c.width,c.height,0,p,m,c.data);t.__maxMipLevel=0}}else if(r.isCompressedTexture){for(var w=0,S=M.length;w<S;w++){d=M[w];if(r.format!==RGBAFormat&&r.format!==RGBFormat){if(p!==null){i.compressedTexImage2D(3553,w,f,d.width,d.height,0,d.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}}else{i.texImage2D(3553,w,f,d.width,d.height,0,p,m,d.data)}}t.__maxMipLevel=M.length-1}else if(r.isDataTexture2DArray){i.texImage3D(35866,0,f,c.width,c.height,c.depth,0,p,m,c.data);t.__maxMipLevel=0}else if(r.isDataTexture3D){i.texImage3D(32879,0,f,c.width,c.height,c.depth,0,p,m,c.data);t.__maxMipLevel=0}else{if(M.length>0&&h){for(var w=0,S=M.length;w<S;w++){d=M[w];i.texImage2D(3553,w,f,p,m,d)}r.generateMipmaps=false;t.__maxMipLevel=M.length-1}else{i.texImage2D(3553,0,f,p,m,c);t.__maxMipLevel=0}}if(g(r,h)){x(o,r,c.width,c.height)}t.__version=r.version;if(r.onUpdate)r.onUpdate(r)}function U(t,n,o,s){var l=a.convert(n.texture.format);var c=a.convert(n.texture.type);var u=b(n.texture.internalFormat,l,c);i.texImage2D(s,0,u,n.width,n.height,0,l,c,null);e.bindFramebuffer(36160,t);e.framebufferTexture2D(36160,o,s,r.get(n.texture).__webglTexture,0);e.bindFramebuffer(36160,null)}function z(t,i,r){e.bindRenderbuffer(36161,t);if(i.depthBuffer&&!i.stencilBuffer){var n=33189;if(r){var o=i.depthTexture;if(o&&o.isDepthTexture){if(o.type===FloatType){n=36012}else if(o.type===UnsignedIntType){n=33190}}var s=q(i);e.renderbufferStorageMultisample(36161,s,n,i.width,i.height)}else{e.renderbufferStorage(36161,n,i.width,i.height)}e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){if(r){var s=q(i);e.renderbufferStorageMultisample(36161,s,35056,i.width,i.height)}else{e.renderbufferStorage(36161,34041,i.width,i.height)}e.framebufferRenderbuffer(36160,33306,36161,t)}else{var l=a.convert(i.texture.format);var c=a.convert(i.texture.type);var n=b(i.texture.internalFormat,l,c);if(r){var s=q(i);e.renderbufferStorageMultisample(36161,s,n,i.width,i.height)}else{e.renderbufferStorage(36161,n,i.width,i.height)}}e.bindRenderbuffer(36161,null)}function k(t,i){var n=i&&i.isWebGLCubeRenderTarget;if(n)throw new Error("Depth Texture with cube render targets is not supported");e.bindFramebuffer(36160,t);if(!(i.depthTexture&&i.depthTexture.isDepthTexture)){throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture")}if(!r.get(i.depthTexture).__webglTexture||i.depthTexture.image.width!==i.width||i.depthTexture.image.height!==i.height){i.depthTexture.image.width=i.width;i.depthTexture.image.height=i.height;i.depthTexture.needsUpdate=true}D(i.depthTexture,0);var a=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===DepthFormat){e.framebufferTexture2D(36160,36096,3553,a,0)}else if(i.depthTexture.format===DepthStencilFormat){e.framebufferTexture2D(36160,33306,3553,a,0)}else{throw new Error("Unknown depthTexture format")}}function H(t){var i=r.get(t);var n=t.isWebGLCubeRenderTarget===true;if(t.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");k(i.__webglFramebuffer,t)}else{if(n){i.__webglDepthbuffer=[];for(var a=0;a<6;a++){e.bindFramebuffer(36160,i.__webglFramebuffer[a]);i.__webglDepthbuffer[a]=e.createRenderbuffer();z(i.__webglDepthbuffer[a],t,false)}}else{e.bindFramebuffer(36160,i.__webglFramebuffer);i.__webglDepthbuffer=e.createRenderbuffer();z(i.__webglDepthbuffer,t,false)}}e.bindFramebuffer(36160,null)}function j(t){var n=r.get(t);var l=r.get(t.texture);t.addEventListener("dispose",S);l.__webglTexture=e.createTexture();o.memory.textures++;var c=t.isWebGLCubeRenderTarget===true;var u=t.isWebGLMultisampleRenderTarget===true;var h=y(t)||s;if(s&&t.texture.format===RGBFormat&&(t.texture.type===FloatType||t.texture.type===HalfFloatType)){t.texture.format=RGBAFormat;console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")}if(c){n.__webglFramebuffer=[];for(var p=0;p<6;p++){n.__webglFramebuffer[p]=e.createFramebuffer()}}else{n.__webglFramebuffer=e.createFramebuffer();if(u){if(s){n.__webglMultisampledFramebuffer=e.createFramebuffer();n.__webglColorRenderbuffer=e.createRenderbuffer();e.bindRenderbuffer(36161,n.__webglColorRenderbuffer);var m=a.convert(t.texture.format);var f=a.convert(t.texture.type);var d=b(t.texture.internalFormat,m,f);var _=q(t);e.renderbufferStorageMultisample(36161,_,d,t.width,t.height);e.bindFramebuffer(36160,n.__webglMultisampledFramebuffer);e.framebufferRenderbuffer(36160,36064,36161,n.__webglColorRenderbuffer);e.bindRenderbuffer(36161,null);if(t.depthBuffer){n.__webglDepthRenderbuffer=e.createRenderbuffer();z(n.__webglDepthRenderbuffer,t,true)}e.bindFramebuffer(36160,null)}else{console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}}}if(c){i.bindTexture(34067,l.__webglTexture);F(34067,t.texture,h);for(var p=0;p<6;p++){U(n.__webglFramebuffer[p],t,36064,34069+p)}if(g(t.texture,h)){x(34067,t.texture,t.width,t.height)}i.bindTexture(34067,null)}else{i.bindTexture(3553,l.__webglTexture);F(3553,t.texture,h);U(n.__webglFramebuffer,t,36064,3553);if(g(t.texture,h)){x(3553,t.texture,t.width,t.height)}i.bindTexture(3553,null)}if(t.depthBuffer){H(t)}}function W(e){var t=e.texture;var n=y(e)||s;if(g(t,n)){var a=e.isWebGLCubeRenderTarget?34067:3553;var o=r.get(t).__webglTexture;i.bindTexture(a,o);x(a,t,e.width,e.height);i.bindTexture(a,null)}}function J(t){if(t.isWebGLMultisampleRenderTarget){if(s){var i=r.get(t);e.bindFramebuffer(36008,i.__webglMultisampledFramebuffer);e.bindFramebuffer(36009,i.__webglFramebuffer);var n=t.width;var a=t.height;var o=16384;if(t.depthBuffer)o|=256;if(t.stencilBuffer)o|=1024;e.blitFramebuffer(0,0,n,a,0,0,n,a,o,9728);e.bindFramebuffer(36160,i.__webglMultisampledFramebuffer)}else{console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}}}function q(e){return s&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}function X(e){var t=o.render.frame;if(p.get(e)!==t){p.set(e,t);e.update()}}var $=false;var Z=false;function Y(e,t){if(e&&e.isWebGLRenderTarget){if($===false){console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead.");$=true}e=e.texture}D(e,t)}function K(e,t){if(e&&e.isWebGLCubeRenderTarget){if(Z===false){console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead.");Z=true}e=e.texture}if(e&&e.isCubeTexture||Array.isArray(e.image)&&e.image.length===6){P(e,t)}else{G(e,t)}}this.allocateTextureUnit=L;this.resetTextureUnits=B;this.setTexture2D=D;this.setTexture2DArray=E;this.setTexture3D=R;this.setTextureCube=P;this.setTextureCubeDynamic=G;this.setupRenderTarget=j;this.updateRenderTargetMipmap=W;this.updateMultisampleRenderTarget=J;this.safeSetTexture2D=Y;this.safeSetTextureCube=K}function WebGLUtils(e,t,i){var r=i.isWebGL2;function n(e){var i;if(e===UnsignedByteType)return 5121;if(e===UnsignedShort4444Type)return 32819;if(e===UnsignedShort5551Type)return 32820;if(e===UnsignedShort565Type)return 33635;if(e===ByteType)return 5120;if(e===ShortType)return 5122;if(e===UnsignedShortType)return 5123;if(e===IntType)return 5124;if(e===UnsignedIntType)return 5125;if(e===FloatType)return 5126;if(e===HalfFloatType){if(r)return 5131;i=t.get("OES_texture_half_float");if(i!==null){return i.HALF_FLOAT_OES}else{return null}}if(e===AlphaFormat)return 6406;if(e===RGBFormat)return 6407;if(e===RGBAFormat)return 6408;if(e===LuminanceFormat)return 6409;if(e===LuminanceAlphaFormat)return 6410;if(e===DepthFormat)return 6402;if(e===DepthStencilFormat)return 34041;if(e===RedFormat)return 6403;if(e===RedIntegerFormat)return 36244;if(e===RGFormat)return 33319;if(e===RGIntegerFormat)return 33320;if(e===RGBIntegerFormat)return 36248;if(e===RGBAIntegerFormat)return 36249;if(e===RGB_S3TC_DXT1_Format||e===RGBA_S3TC_DXT1_Format||e===RGBA_S3TC_DXT3_Format||e===RGBA_S3TC_DXT5_Format){i=t.get("WEBGL_compressed_texture_s3tc");if(i!==null){if(e===RGB_S3TC_DXT1_Format)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===RGBA_S3TC_DXT1_Format)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===RGBA_S3TC_DXT3_Format)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===RGBA_S3TC_DXT5_Format)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}else{return null}}if(e===RGB_PVRTC_4BPPV1_Format||e===RGB_PVRTC_2BPPV1_Format||e===RGBA_PVRTC_4BPPV1_Format||e===RGBA_PVRTC_2BPPV1_Format){i=t.get("WEBGL_compressed_texture_pvrtc");if(i!==null){if(e===RGB_PVRTC_4BPPV1_Format)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===RGB_PVRTC_2BPPV1_Format)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===RGBA_PVRTC_4BPPV1_Format)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===RGBA_PVRTC_2BPPV1_Format)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else{return null}}if(e===RGB_ETC1_Format){i=t.get("WEBGL_compressed_texture_etc1");if(i!==null){return i.COMPRESSED_RGB_ETC1_WEBGL}else{return null}}if(e===RGB_ETC2_Format||e===RGBA_ETC2_EAC_Format){i=t.get("WEBGL_compressed_texture_etc");if(i!==null){if(e===RGB_ETC2_Format)return i.COMPRESSED_RGB8_ETC2;if(e===RGBA_ETC2_EAC_Format)return i.COMPRESSED_RGBA8_ETC2_EAC}}if(e===RGBA_ASTC_4x4_Format||e===RGBA_ASTC_5x4_Format||e===RGBA_ASTC_5x5_Format||e===RGBA_ASTC_6x5_Format||e===RGBA_ASTC_6x6_Format||e===RGBA_ASTC_8x5_Format||e===RGBA_ASTC_8x6_Format||e===RGBA_ASTC_8x8_Format||e===RGBA_ASTC_10x5_Format||e===RGBA_ASTC_10x6_Format||e===RGBA_ASTC_10x8_Format||e===RGBA_ASTC_10x10_Format||e===RGBA_ASTC_12x10_Format||e===RGBA_ASTC_12x12_Format||e===SRGB8_ALPHA8_ASTC_4x4_Format||e===SRGB8_ALPHA8_ASTC_5x4_Format||e===SRGB8_ALPHA8_ASTC_5x5_Format||e===SRGB8_ALPHA8_ASTC_6x5_Format||e===SRGB8_ALPHA8_ASTC_6x6_Format||e===SRGB8_ALPHA8_ASTC_8x5_Format||e===SRGB8_ALPHA8_ASTC_8x6_Format||e===SRGB8_ALPHA8_ASTC_8x8_Format||e===SRGB8_ALPHA8_ASTC_10x5_Format||e===SRGB8_ALPHA8_ASTC_10x6_Format||e===SRGB8_ALPHA8_ASTC_10x8_Format||e===SRGB8_ALPHA8_ASTC_10x10_Format||e===SRGB8_ALPHA8_ASTC_12x10_Format||e===SRGB8_ALPHA8_ASTC_12x12_Format){i=t.get("WEBGL_compressed_texture_astc");if(i!==null){return e}else{return null}}if(e===RGBA_BPTC_Format){i=t.get("EXT_texture_compression_bptc");if(i!==null){return e}else{return null}}if(e===UnsignedInt248Type){if(r)return 34042;i=t.get("WEBGL_depth_texture");if(i!==null){return i.UNSIGNED_INT_24_8_WEBGL}else{return null}}}return{convert:n}}function ArrayCamera(e){PerspectiveCamera.call(this);this.cameras=e||[]}ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:true});function Group(){Object3D.call(this);this.type="Group"}Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:true});function WebXRController(){this._targetRay=null;this._grip=null}Object.assign(WebXRController.prototype,{constructor:WebXRController,getTargetRaySpace:function(){if(this._targetRay===null){this._targetRay=new Group;this._targetRay.matrixAutoUpdate=false;this._targetRay.visible=false}return this._targetRay},getGripSpace:function(){if(this._grip===null){this._grip=new Group;this._grip.matrixAutoUpdate=false;this._grip.visible=false}return this._grip},dispatchEvent:function(e){if(this._targetRay!==null){this._targetRay.dispatchEvent(e)}if(this._grip!==null){this._grip.dispatchEvent(e)}return this},disconnect:function(e){this.dispatchEvent({type:"disconnected",data:e});if(this._targetRay!==null){this._targetRay.visible=false}if(this._grip!==null){this._grip.visible=false}return this},update:function(e,t,i){var r=null;var n=null;var a=this._targetRay;var o=this._grip;if(e){if(a!==null){r=t.getPose(e.targetRaySpace,i);if(r!==null){a.matrix.fromArray(r.transform.matrix);a.matrix.decompose(a.position,a.rotation,a.scale)}}if(o!==null&&e.gripSpace){n=t.getPose(e.gripSpace,i);if(n!==null){o.matrix.fromArray(n.transform.matrix);o.matrix.decompose(o.position,o.rotation,o.scale)}}}if(a!==null){a.visible=r!==null}if(o!==null){o.visible=n!==null}return this}});function WebXRManager(e,t){var i=this;var r=null;var n=1;var a=null;var o="local-floor";var s=null;var l=[];var c=new Map;var u=new PerspectiveCamera;u.layers.enable(1);u.viewport=new Vector4;var h=new PerspectiveCamera;h.layers.enable(2);h.viewport=new Vector4;var p=[u,h];var m=new ArrayCamera;m.layers.enable(1);m.layers.enable(2);var f=null;var d=null;this.enabled=false;this.isPresenting=false;this.getController=function(e){var t=l[e];if(t===undefined){t=new WebXRController;l[e]=t}return t.getTargetRaySpace()};this.getControllerGrip=function(e){var t=l[e];if(t===undefined){t=new WebXRController;l[e]=t}return t.getGripSpace()};function _(e){var t=c.get(e.inputSource);if(t){t.dispatchEvent({type:e.type})}}function y(){c.forEach((function(e,t){e.disconnect(t)}));c.clear();e.setFramebuffer(null);e.setRenderTarget(e.getRenderTarget());C.stop();i.isPresenting=false;i.dispatchEvent({type:"sessionend"})}function v(e){a=e;C.setContext(r);C.start();i.isPresenting=true;i.dispatchEvent({type:"sessionstart"})}this.setFramebufferScaleFactor=function(e){n=e;if(i.isPresenting===true){console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")}};this.setReferenceSpaceType=function(e){o=e;if(i.isPresenting===true){console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")}};this.getReferenceSpace=function(){return a};this.getSession=function(){return r};this.setSession=function(e){r=e;if(r!==null){r.addEventListener("select",_);r.addEventListener("selectstart",_);r.addEventListener("selectend",_);r.addEventListener("squeeze",_);r.addEventListener("squeezestart",_);r.addEventListener("squeezeend",_);r.addEventListener("end",y);var i=t.getContextAttributes();var a={antialias:i.antialias,alpha:i.alpha,depth:i.depth,stencil:i.stencil,framebufferScaleFactor:n};var s=new XRWebGLLayer(r,t,a);r.updateRenderState({baseLayer:s});r.requestReferenceSpace(o).then(v);r.addEventListener("inputsourceschange",g)}};function g(e){var t=r.inputSources;for(var i=0;i<l.length;i++){c.set(t[i],l[i])}for(var i=0;i<e.removed.length;i++){var n=e.removed[i];var a=c.get(n);if(a){a.dispatchEvent({type:"disconnected",data:n});c.delete(n)}}for(var i=0;i<e.added.length;i++){var n=e.added[i];var a=c.get(n);if(a){a.dispatchEvent({type:"connected",data:n})}}}var x=new Vector3;var b=new Vector3;function M(e,t,i){x.setFromMatrixPosition(t.matrixWorld);b.setFromMatrixPosition(i.matrixWorld);var r=x.distanceTo(b);var n=t.projectionMatrix.elements;var a=i.projectionMatrix.elements;var o=n[14]/(n[10]-1);var s=n[14]/(n[10]+1);var l=(n[9]+1)/n[5];var c=(n[9]-1)/n[5];var u=(n[8]-1)/n[0];var h=(a[8]+1)/a[0];var p=o*u;var m=o*h;var f=r/(-u+h);var d=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale);e.translateX(d);e.translateZ(f);e.matrixWorld.compose(e.position,e.quaternion,e.scale);e.matrixWorldInverse.getInverse(e.matrixWorld);var _=o+f;var y=s+f;var v=p-d;var g=m+(r-d);var M=l*s/y*_;var w=c*s/y*_;e.projectionMatrix.makePerspective(v,g,M,w,_,y)}function w(e,t){if(t===null){e.matrixWorld.copy(e.matrix)}else{e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix)}e.matrixWorldInverse.getInverse(e.matrixWorld)}this.getCamera=function(e){m.near=h.near=u.near=e.near;m.far=h.far=u.far=e.far;if(f!==m.near||d!==m.far){r.updateRenderState({depthNear:m.near,depthFar:m.far});f=m.near;d=m.far}var t=e.parent;var i=m.cameras;w(m,t);for(var n=0;n<i.length;n++){w(i[n],t)}e.matrixWorld.copy(m.matrixWorld);var a=e.children;for(var n=0,o=a.length;n<o;n++){a[n].updateMatrixWorld(true)}if(i.length===2){M(m,u,h)}else{m.projectionMatrix.copy(u.projectionMatrix)}return m};var S=null;function A(t,i){s=i.getViewerPose(a);if(s!==null){var n=s.views;var o=r.renderState.baseLayer;e.setFramebuffer(o.framebuffer);var c=false;if(n.length!==m.cameras.length){m.cameras.length=0;c=true}for(var u=0;u<n.length;u++){var h=n[u];var f=o.getViewport(h);var d=p[u];d.matrix.fromArray(h.transform.matrix);d.projectionMatrix.fromArray(h.projectionMatrix);d.viewport.set(f.x,f.y,f.width,f.height);if(u===0){m.matrix.copy(d.matrix)}if(c===true){m.cameras.push(d)}}}var _=r.inputSources;for(var u=0;u<l.length;u++){var y=l[u];var v=_[u];y.update(v,i,a)}if(S)S(t,i)}var C=new WebGLAnimation;C.setAnimationLoop(A);this.setAnimationLoop=function(e){S=e};this.dispose=function(){}}Object.assign(WebXRManager.prototype,EventDispatcher.prototype);function WebGLRenderer(e){e=e||{};var t=e.canvas!==undefined?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=e.context!==undefined?e.context:null,r=e.alpha!==undefined?e.alpha:false,n=e.depth!==undefined?e.depth:true,a=e.stencil!==undefined?e.stencil:true,o=e.antialias!==undefined?e.antialias:false,s=e.premultipliedAlpha!==undefined?e.premultipliedAlpha:true,l=e.preserveDrawingBuffer!==undefined?e.preserveDrawingBuffer:false,c=e.powerPreference!==undefined?e.powerPreference:"default",u=e.failIfMajorPerformanceCaveat!==undefined?e.failIfMajorPerformanceCaveat:false;var h=null;var p=null;this.domElement=t;this.debug={checkShaderErrors:true};this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.clippingPlanes=[];this.localClippingEnabled=false;this.gammaFactor=2;this.outputEncoding=LinearEncoding;this.physicallyCorrectLights=false;this.toneMapping=NoToneMapping;this.toneMappingExposure=1;this.toneMappingWhitePoint=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var m=this,f=false,d=null,_=0,y=0,v=null,g=null,x=-1,b={geometry:null,program:null,wireframe:false},M=null,w=null,S=new Vector4,A=new Vector4,C=null,T=t.width,B=t.height,L=1,D=null,E=null,R=new Vector4(0,0,T,B),P=new Vector4(0,0,T,B),G=false,I=new Frustum,V=new WebGLClipping,F=false,O=false,N=new Matrix4,U=new Vector3;function z(){return v===null?L:1}var k;try{var H={alpha:r,depth:n,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u,xrCompatible:true};t.addEventListener("webglcontextlost",ue,false);t.addEventListener("webglcontextrestored",he,false);k=i||t.getContext("webgl",H)||t.getContext("experimental-webgl",H);if(k===null){if(t.getContext("webgl")!==null){throw new Error("Error creating WebGL context with your selected attributes.")}else{throw new Error("Error creating WebGL context.")}}if(k.getShaderPrecisionFormat===undefined){k.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}}catch(e){console.error("THREE.WebGLRenderer: "+e.message);throw e}var j,W,J,q;var X,$,Z,Y,K;var Q,ee,te;var ie,re,ne,ae;var oe;function se(){j=new WebGLExtensions(k);W=new WebGLCapabilities(k,j,e);if(W.isWebGL2===false){j.get("WEBGL_depth_texture");j.get("OES_texture_float");j.get("OES_texture_half_float");j.get("OES_texture_half_float_linear");j.get("OES_standard_derivatives");j.get("OES_element_index_uint");j.get("ANGLE_instanced_arrays")}j.get("OES_texture_float_linear");oe=new WebGLUtils(k,j,W);J=new WebGLState(k,j,W);J.scissor(A.copy(P).multiplyScalar(L).floor());J.viewport(S.copy(R).multiplyScalar(L).floor());q=new WebGLInfo(k);X=new WebGLProperties;$=new WebGLTextures(k,j,J,X,W,oe,q);Z=new WebGLAttributes(k,W);Y=new WebGLGeometries(k,Z,q);K=new WebGLObjects(k,Y,Z,q);re=new WebGLMorphtargets(k);Q=new WebGLPrograms(m,j,W);ee=new WebGLRenderLists;te=new WebGLRenderStates;ie=new WebGLBackground(m,J,K,s);ne=new WebGLBufferRenderer(k,j,q,W);ae=new WebGLIndexedBufferRenderer(k,j,q,W);q.programs=Q.programs;m.capabilities=W;m.extensions=j;m.properties=X;m.renderLists=ee;m.state=J;m.info=q}se();var le=new WebXRManager(m,k);this.xr=le;var ce=new WebGLShadowMap(m,K,W.maxTextureSize);this.shadowMap=ce;this.getContext=function(){return k};this.getContextAttributes=function(){return k.getContextAttributes()};this.forceContextLoss=function(){var e=j.get("WEBGL_lose_context");if(e)e.loseContext()};this.forceContextRestore=function(){var e=j.get("WEBGL_lose_context");if(e)e.restoreContext()};this.getPixelRatio=function(){return L};this.setPixelRatio=function(e){if(e===undefined)return;L=e;this.setSize(T,B,false)};this.getSize=function(e){if(e===undefined){console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument");e=new Vector2}return e.set(T,B)};this.setSize=function(e,i,r){if(le.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}T=e;B=i;t.width=Math.floor(e*L);t.height=Math.floor(i*L);if(r!==false){t.style.width=e+"px";t.style.height=i+"px"}this.setViewport(0,0,e,i)};this.getDrawingBufferSize=function(e){if(e===undefined){console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument");e=new Vector2}return e.set(T*L,B*L).floor()};this.setDrawingBufferSize=function(e,i,r){T=e;B=i;L=r;t.width=Math.floor(e*r);t.height=Math.floor(i*r);this.setViewport(0,0,e,i)};this.getCurrentViewport=function(e){if(e===undefined){console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument");e=new Vector4}return e.copy(S)};this.getViewport=function(e){return e.copy(R)};this.setViewport=function(e,t,i,r){if(e.isVector4){R.set(e.x,e.y,e.z,e.w)}else{R.set(e,t,i,r)}J.viewport(S.copy(R).multiplyScalar(L).floor())};this.getScissor=function(e){return e.copy(P)};this.setScissor=function(e,t,i,r){if(e.isVector4){P.set(e.x,e.y,e.z,e.w)}else{P.set(e,t,i,r)}J.scissor(A.copy(P).multiplyScalar(L).floor())};this.getScissorTest=function(){return G};this.setScissorTest=function(e){J.setScissorTest(G=e)};this.setOpaqueSort=function(e){D=e};this.setTransparentSort=function(e){E=e};this.getClearColor=function(){return ie.getClearColor()};this.setClearColor=function(){ie.setClearColor.apply(ie,arguments)};this.getClearAlpha=function(){return ie.getClearAlpha()};this.setClearAlpha=function(){ie.setClearAlpha.apply(ie,arguments)};this.clear=function(e,t,i){var r=0;if(e===undefined||e)r|=16384;if(t===undefined||t)r|=256;if(i===undefined||i)r|=1024;k.clear(r)};this.clearColor=function(){this.clear(true,false,false)};this.clearDepth=function(){this.clear(false,true,false)};this.clearStencil=function(){this.clear(false,false,true)};this.dispose=function(){t.removeEventListener("webglcontextlost",ue,false);t.removeEventListener("webglcontextrestored",he,false);ee.dispose();te.dispose();X.dispose();K.dispose();le.dispose();xe.stop()};function ue(e){e.preventDefault();console.log("THREE.WebGLRenderer: Context Lost.");f=true}function he(){console.log("THREE.WebGLRenderer: Context Restored.");f=false;se()}function pe(e){var t=e.target;t.removeEventListener("dispose",pe);me(t)}function me(e){fe(e);X.remove(e)}function fe(e){var t=X.get(e).program;e.program=undefined;if(t!==undefined){Q.releaseProgram(t)}}function de(e,t){e.render((function(e){m.renderBufferImmediate(e,t)}))}this.renderBufferImmediate=function(e,t){J.initAttributes();var i=X.get(e);if(e.hasPositions&&!i.position)i.position=k.createBuffer();if(e.hasNormals&&!i.normal)i.normal=k.createBuffer();if(e.hasUvs&&!i.uv)i.uv=k.createBuffer();if(e.hasColors&&!i.color)i.color=k.createBuffer();var r=t.getAttributes();if(e.hasPositions){k.bindBuffer(34962,i.position);k.bufferData(34962,e.positionArray,35048);J.enableAttribute(r.position);k.vertexAttribPointer(r.position,3,5126,false,0,0)}if(e.hasNormals){k.bindBuffer(34962,i.normal);k.bufferData(34962,e.normalArray,35048);J.enableAttribute(r.normal);k.vertexAttribPointer(r.normal,3,5126,false,0,0)}if(e.hasUvs){k.bindBuffer(34962,i.uv);k.bufferData(34962,e.uvArray,35048);J.enableAttribute(r.uv);k.vertexAttribPointer(r.uv,2,5126,false,0,0)}if(e.hasColors){k.bindBuffer(34962,i.color);k.bufferData(34962,e.colorArray,35048);J.enableAttribute(r.color);k.vertexAttribPointer(r.color,3,5126,false,0,0)}J.disableUnusedAttributes();k.drawArrays(4,0,e.count);e.count=0};var _e=new Scene;this.renderBufferDirect=function(e,t,i,r,n,a){if(t===null)t=_e;var o=n.isMesh&&n.matrixWorld.determinant()<0;var s=Ae(e,t,r,n);J.setMaterial(r,o);var l=false;if(b.geometry!==i.id||b.program!==s.id||b.wireframe!==(r.wireframe===true)){b.geometry=i.id;b.program=s.id;b.wireframe=r.wireframe===true;l=true}if(r.morphTargets||r.morphNormals){re.update(n,i,r,s);l=true}if(n.isInstancedMesh===true){l=true}var c=i.index;var u=i.attributes.position;if(c===null){if(u===undefined||u.count===0)return}else if(c.count===0){return}var h=1;if(r.wireframe===true){c=Y.getWireframeAttribute(i);h=2}var p;var m=ne;if(c!==null){p=Z.get(c);m=ae;m.setIndex(p)}if(l){ye(n,i,r,s);if(c!==null){k.bindBuffer(34963,p.buffer)}}var f=c!==null?c.count:u.count;var d=i.drawRange.start*h;var _=i.drawRange.count*h;var y=a!==null?a.start*h:0;var v=a!==null?a.count*h:Infinity;var g=Math.max(d,y);var x=Math.min(f,d+_,y+v)-1;var M=Math.max(0,x-g+1);if(M===0)return;if(n.isMesh){if(r.wireframe===true){J.setLineWidth(r.wireframeLinewidth*z());m.setMode(1)}else{m.setMode(4)}}else if(n.isLine){var w=r.linewidth;if(w===undefined)w=1;J.setLineWidth(w*z());if(n.isLineSegments){m.setMode(1)}else if(n.isLineLoop){m.setMode(2)}else{m.setMode(3)}}else if(n.isPoints){m.setMode(0)}else if(n.isSprite){m.setMode(4)}if(n.isInstancedMesh){m.renderInstances(i,g,M,n.count)}else if(i.isInstancedBufferGeometry){m.renderInstances(i,g,M,i.maxInstancedCount)}else{m.render(g,M)}};function ye(e,t,i,r){if(W.isWebGL2===false&&(e.isInstancedMesh||t.isInstancedBufferGeometry)){if(j.get("ANGLE_instanced_arrays")===null)return}J.initAttributes();var n=t.attributes;var a=r.getAttributes();var o=i.defaultAttributeValues;for(var s in a){var l=a[s];if(l>=0){var c=n[s];if(c!==undefined){var u=c.normalized;var h=c.itemSize;var p=Z.get(c);if(p===undefined)continue;var m=p.buffer;var f=p.type;var d=p.bytesPerElement;if(c.isInterleavedBufferAttribute){var _=c.data;var y=_.stride;var v=c.offset;if(_&&_.isInstancedInterleavedBuffer){J.enableAttributeAndDivisor(l,_.meshPerAttribute);if(t.maxInstancedCount===undefined){t.maxInstancedCount=_.meshPerAttribute*_.count}}else{J.enableAttribute(l)}k.bindBuffer(34962,m);J.vertexAttribPointer(l,h,f,u,y*d,v*d)}else{if(c.isInstancedBufferAttribute){J.enableAttributeAndDivisor(l,c.meshPerAttribute);if(t.maxInstancedCount===undefined){t.maxInstancedCount=c.meshPerAttribute*c.count}}else{J.enableAttribute(l)}k.bindBuffer(34962,m);J.vertexAttribPointer(l,h,f,u,0,0)}}else if(s==="instanceMatrix"){var p=Z.get(e.instanceMatrix);if(p===undefined)continue;var m=p.buffer;var f=p.type;J.enableAttributeAndDivisor(l+0,1);J.enableAttributeAndDivisor(l+1,1);J.enableAttributeAndDivisor(l+2,1);J.enableAttributeAndDivisor(l+3,1);k.bindBuffer(34962,m);k.vertexAttribPointer(l+0,4,f,false,64,0);k.vertexAttribPointer(l+1,4,f,false,64,16);k.vertexAttribPointer(l+2,4,f,false,64,32);k.vertexAttribPointer(l+3,4,f,false,64,48)}else if(o!==undefined){var g=o[s];if(g!==undefined){switch(g.length){case 2:k.vertexAttrib2fv(l,g);break;case 3:k.vertexAttrib3fv(l,g);break;case 4:k.vertexAttrib4fv(l,g);break;default:k.vertexAttrib1fv(l,g)}}}}}J.disableUnusedAttributes()}this.compile=function(e,t){p=te.get(e,t);p.init();e.traverse((function(e){if(e.isLight){p.pushLight(e);if(e.castShadow){p.pushShadow(e)}}}));p.setupLights(t);var i={};e.traverse((function(t){if(t.material){if(Array.isArray(t.material)){for(var r=0;r<t.material.length;r++){if(t.material[r].uuid in i===false){Se(t.material[r],e,t);i[t.material[r].uuid]=true}}}else if(t.material.uuid in i===false){Se(t.material,e,t);i[t.material.uuid]=true}}}))};var ve=null;function ge(e){if(le.isPresenting)return;if(ve)ve(e)}var xe=new WebGLAnimation;xe.setAnimationLoop(ge);if(typeof window!=="undefined")xe.setContext(window);this.setAnimationLoop=function(e){ve=e;le.setAnimationLoop(e);xe.start()};this.render=function(e,t){var i,r;if(arguments[2]!==undefined){console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead.");i=arguments[2]}if(arguments[3]!==undefined){console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead.");r=arguments[3]}if(!(t&&t.isCamera)){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(f)return;b.geometry=null;b.program=null;b.wireframe=false;x=-1;M=null;if(e.autoUpdate===true)e.updateMatrixWorld();if(t.parent===null)t.updateMatrixWorld();if(le.enabled&&le.isPresenting){t=le.getCamera(t)}e.onBeforeRender(m,e,t,i||v);p=te.get(e,t);p.init();N.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);I.setFromProjectionMatrix(N);O=this.localClippingEnabled;F=V.init(this.clippingPlanes,O,t);h=ee.get(e,t);h.init();be(e,t,0,m.sortObjects);h.finish();if(m.sortObjects===true){h.sort(D,E)}if(F)V.beginShadows();var n=p.state.shadowsArray;ce.render(n,e,t);p.setupLights(t);if(F)V.endShadows();if(this.info.autoReset)this.info.reset();if(i!==undefined){this.setRenderTarget(i)}ie.render(h,e,t,r);var a=h.opaque;var o=h.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;if(a.length)Me(a,e,t,s);if(o.length)Me(o,e,t,s)}else{if(a.length)Me(a,e,t);if(o.length)Me(o,e,t)}e.onAfterRender(m,e,t);if(v!==null){$.updateRenderTargetMipmap(v);$.updateMultisampleRenderTarget(v)}J.buffers.depth.setTest(true);J.buffers.depth.setMask(true);J.buffers.color.setMask(true);J.setPolygonOffset(false);h=null;p=null};function be(e,t,i,r){if(e.visible===false)return;var n=e.layers.test(t.layers);if(n){if(e.isGroup){i=e.renderOrder}else if(e.isLOD){if(e.autoUpdate===true)e.update(t)}else if(e.isLight){p.pushLight(e);if(e.castShadow){p.pushShadow(e)}}else if(e.isSprite){if(!e.frustumCulled||I.intersectsSprite(e)){if(r){U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(N)}var a=K.update(e);var o=e.material;if(o.visible){h.push(e,a,o,i,U.z,null)}}}else if(e.isImmediateRenderObject){if(r){U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(N)}h.push(e,null,e.material,i,U.z,null)}else if(e.isMesh||e.isLine||e.isPoints){if(e.isSkinnedMesh){if(e.skeleton.frame!==q.render.frame){e.skeleton.update();e.skeleton.frame=q.render.frame}}if(!e.frustumCulled||I.intersectsObject(e)){if(r){U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(N)}var a=K.update(e);var o=e.material;if(Array.isArray(o)){var s=a.groups;for(var l=0,c=s.length;l<c;l++){var u=s[l];var m=o[u.materialIndex];if(m&&m.visible){h.push(e,a,m,i,U.z,u)}}}else if(o.visible){h.push(e,a,o,i,U.z,null)}}}}var f=e.children;for(var l=0,c=f.length;l<c;l++){be(f[l],t,i,r)}}function Me(e,t,i,r){for(var n=0,a=e.length;n<a;n++){var o=e[n];var s=o.object;var l=o.geometry;var c=r===undefined?o.material:r;var u=o.group;if(i.isArrayCamera){w=i;var h=i.cameras;for(var m=0,f=h.length;m<f;m++){var d=h[m];if(s.layers.test(d.layers)){J.viewport(S.copy(d.viewport));p.setupLights(d);we(s,t,d,l,c,u)}}}else{w=null;we(s,t,i,l,c,u)}}}function we(e,t,i,r,n,a){e.onBeforeRender(m,t,i,r,n,a);p=te.get(t,w||i);e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld);e.normalMatrix.getNormalMatrix(e.modelViewMatrix);if(e.isImmediateRenderObject){var o=Ae(i,t,n,e);J.setMaterial(n);b.geometry=null;b.program=null;b.wireframe=false;de(e,o)}else{m.renderBufferDirect(i,t,r,n,e,a)}e.onAfterRender(m,t,i,r,n,a);p=te.get(t,w||i)}function Se(e,t,i){var r=X.get(e);var n=p.state.lights;var a=p.state.shadowsArray;var o=n.state.version;var s=Q.getParameters(e,n.state,a,t,V.numPlanes,V.numIntersection,i);var l=Q.getProgramCacheKey(s);var c=r.program;var u=true;if(c===undefined){e.addEventListener("dispose",pe)}else if(c.cacheKey!==l){fe(e)}else if(r.lightsStateVersion!==o){r.lightsStateVersion=o;u=false}else if(s.shaderID!==undefined){return}else{u=false}if(u){c=Q.acquireProgram(s,l);r.program=c;r.uniforms=s.uniforms;r.outputEncoding=s.outputEncoding;e.program=c}var h=c.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var f=0;f<m.maxMorphTargets;f++){if(h["morphTarget"+f]>=0){e.numSupportedMorphTargets++}}}if(e.morphNormals){e.numSupportedMorphNormals=0;for(var f=0;f<m.maxMorphNormals;f++){if(h["morphNormal"+f]>=0){e.numSupportedMorphNormals++}}}var d=r.uniforms;if(!e.isShaderMaterial&&!e.isRawShaderMaterial||e.clipping===true){r.numClippingPlanes=V.numPlanes;r.numIntersection=V.numIntersection;d.clippingPlanes=V.uniform}r.environment=e.isMeshStandardMaterial?t.environment:null;r.fog=t.fog;r.needsLights=ke(e);r.lightsStateVersion=o;if(r.needsLights){d.ambientLightColor.value=n.state.ambient;d.lightProbe.value=n.state.probe;d.directionalLights.value=n.state.directional;d.directionalLightShadows.value=n.state.directionalShadow;d.spotLights.value=n.state.spot;d.spotLightShadows.value=n.state.spotShadow;d.rectAreaLights.value=n.state.rectArea;d.pointLights.value=n.state.point;d.pointLightShadows.value=n.state.pointShadow;d.hemisphereLights.value=n.state.hemi;d.directionalShadowMap.value=n.state.directionalShadowMap;d.directionalShadowMatrix.value=n.state.directionalShadowMatrix;d.spotShadowMap.value=n.state.spotShadowMap;d.spotShadowMatrix.value=n.state.spotShadowMatrix;d.pointShadowMap.value=n.state.pointShadowMap;d.pointShadowMatrix.value=n.state.pointShadowMatrix}var _=r.program.getUniforms(),y=WebGLUniforms.seqWithValue(_.seq,d);r.uniformsList=y}function Ae(e,t,i,r){$.resetTextureUnits();var n=t.fog;var a=i.isMeshStandardMaterial?t.environment:null;var o=v===null?m.outputEncoding:v.texture.encoding;var s=X.get(i);var l=p.state.lights;if(F){if(O||e!==M){var c=e===M&&i.id===x;V.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,e,s,c)}}if(i.version===s.__version){if(s.program===undefined){Se(i,t,r)}else if(i.fog&&s.fog!==n){Se(i,t,r)}else if(s.environment!==a){Se(i,t,r)}else if(s.needsLights&&s.lightsStateVersion!==l.state.version){Se(i,t,r)}else if(s.numClippingPlanes!==undefined&&(s.numClippingPlanes!==V.numPlanes||s.numIntersection!==V.numIntersection)){Se(i,t,r)}else if(s.outputEncoding!==o){Se(i,t,r)}}else{Se(i,t,r);s.__version=i.version}var u=false;var h=false;var f=false;var d=s.program,_=d.getUniforms(),y=s.uniforms;if(J.useProgram(d.program)){u=true;h=true;f=true}if(i.id!==x){x=i.id;h=true}if(u||M!==e){_.setValue(k,"projectionMatrix",e.projectionMatrix);if(W.logarithmicDepthBuffer){_.setValue(k,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2))}if(M!==e){M=e;h=true;f=true}if(i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){var g=_.map.cameraPosition;if(g!==undefined){g.setValue(k,U.setFromMatrixPosition(e.matrixWorld))}}if(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial){_.setValue(k,"isOrthographic",e.isOrthographicCamera===true)}if(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning){_.setValue(k,"viewMatrix",e.matrixWorldInverse)}}if(i.skinning){_.setOptional(k,r,"bindMatrix");_.setOptional(k,r,"bindMatrixInverse");var b=r.skeleton;if(b){var w=b.bones;if(W.floatVertexTextures){if(b.boneTexture===undefined){var S=Math.sqrt(w.length*4);S=MathUtils.ceilPowerOfTwo(S);S=Math.max(S,4);var A=new Float32Array(S*S*4);A.set(b.boneMatrices);var C=new DataTexture(A,S,S,RGBAFormat,FloatType);b.boneMatrices=A;b.boneTexture=C;b.boneTextureSize=S}_.setValue(k,"boneTexture",b.boneTexture,$);_.setValue(k,"boneTextureSize",b.boneTextureSize)}else{_.setOptional(k,b,"boneMatrices")}}}if(h||s.receiveShadow!==r.receiveShadow){s.receiveShadow=r.receiveShadow;_.setValue(k,"receiveShadow",r.receiveShadow)}if(h){_.setValue(k,"toneMappingExposure",m.toneMappingExposure);_.setValue(k,"toneMappingWhitePoint",m.toneMappingWhitePoint);if(s.needsLights){ze(y,f)}if(n&&i.fog){Ee(y,n)}if(i.isMeshBasicMaterial){Ce(y,i)}else if(i.isMeshLambertMaterial){Ce(y,i);Re(y,i)}else if(i.isMeshToonMaterial){Ce(y,i);Ge(y,i)}else if(i.isMeshPhongMaterial){Ce(y,i);Pe(y,i)}else if(i.isMeshStandardMaterial){Ce(y,i,a);if(i.isMeshPhysicalMaterial){Ve(y,i,a)}else{Ie(y,i,a)}}else if(i.isMeshMatcapMaterial){Ce(y,i);Fe(y,i)}else if(i.isMeshDepthMaterial){Ce(y,i);Oe(y,i)}else if(i.isMeshDistanceMaterial){Ce(y,i);Ne(y,i)}else if(i.isMeshNormalMaterial){Ce(y,i);Ue(y,i)}else if(i.isLineBasicMaterial){Te(y,i);if(i.isLineDashedMaterial){Be(y,i)}}else if(i.isPointsMaterial){Le(y,i)}else if(i.isSpriteMaterial){De(y,i)}else if(i.isShadowMaterial){y.color.value.copy(i.color);y.opacity.value=i.opacity}if(y.ltc_1!==undefined)y.ltc_1.value=UniformsLib.LTC_1;if(y.ltc_2!==undefined)y.ltc_2.value=UniformsLib.LTC_2;WebGLUniforms.upload(k,s.uniformsList,y,$);if(i.isShaderMaterial){i.uniformsNeedUpdate=false}}if(i.isShaderMaterial&&i.uniformsNeedUpdate===true){WebGLUniforms.upload(k,s.uniformsList,y,$);i.uniformsNeedUpdate=false}if(i.isSpriteMaterial){_.setValue(k,"center",r.center)}_.setValue(k,"modelViewMatrix",r.modelViewMatrix);_.setValue(k,"normalMatrix",r.normalMatrix);_.setValue(k,"modelMatrix",r.matrixWorld);return d}function Ce(e,t,i){e.opacity.value=t.opacity;if(t.color){e.diffuse.value.copy(t.color)}if(t.emissive){e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity)}if(t.map){e.map.value=t.map}if(t.alphaMap){e.alphaMap.value=t.alphaMap}if(t.specularMap){e.specularMap.value=t.specularMap}var r=t.envMap||i;if(r){e.envMap.value=r;e.flipEnvMap.value=r.isCubeTexture?-1:1;e.reflectivity.value=t.reflectivity;e.refractionRatio.value=t.refractionRatio;e.maxMipLevel.value=X.get(r).__maxMipLevel}if(t.lightMap){e.lightMap.value=t.lightMap;e.lightMapIntensity.value=t.lightMapIntensity}if(t.aoMap){e.aoMap.value=t.aoMap;e.aoMapIntensity.value=t.aoMapIntensity}var n;if(t.map){n=t.map}else if(t.specularMap){n=t.specularMap}else if(t.displacementMap){n=t.displacementMap}else if(t.normalMap){n=t.normalMap}else if(t.bumpMap){n=t.bumpMap}else if(t.roughnessMap){n=t.roughnessMap}else if(t.metalnessMap){n=t.metalnessMap}else if(t.alphaMap){n=t.alphaMap}else if(t.emissiveMap){n=t.emissiveMap}if(n!==undefined){if(n.isWebGLRenderTarget){n=n.texture}if(n.matrixAutoUpdate===true){n.updateMatrix()}e.uvTransform.value.copy(n.matrix)}var a;if(t.aoMap){a=t.aoMap}else if(t.lightMap){a=t.lightMap}if(a!==undefined){if(a.isWebGLRenderTarget){a=a.texture}if(a.matrixAutoUpdate===true){a.updateMatrix()}e.uv2Transform.value.copy(a.matrix)}}function Te(e,t){e.diffuse.value.copy(t.color);e.opacity.value=t.opacity}function Be(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function Le(e,t){e.diffuse.value.copy(t.color);e.opacity.value=t.opacity;e.size.value=t.size*L;e.scale.value=B*.5;if(t.map){e.map.value=t.map}if(t.alphaMap){e.alphaMap.value=t.alphaMap}var i;if(t.map){i=t.map}else if(t.alphaMap){i=t.alphaMap}if(i!==undefined){if(i.matrixAutoUpdate===true){i.updateMatrix()}e.uvTransform.value.copy(i.matrix)}}function De(e,t){e.diffuse.value.copy(t.color);e.opacity.value=t.opacity;e.rotation.value=t.rotation;if(t.map){e.map.value=t.map}if(t.alphaMap){e.alphaMap.value=t.alphaMap}var i;if(t.map){i=t.map}else if(t.alphaMap){i=t.alphaMap}if(i!==undefined){if(i.matrixAutoUpdate===true){i.updateMatrix()}e.uvTransform.value.copy(i.matrix)}}function Ee(e,t){e.fogColor.value.copy(t.color);if(t.isFog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t.isFogExp2){e.fogDensity.value=t.density}}function Re(e,t){if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}}function Pe(e,t){e.specular.value.copy(t.specular);e.shininess.value=Math.max(t.shininess,1e-4);if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===BackSide)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===BackSide)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function Ge(e,t){e.specular.value.copy(t.specular);e.shininess.value=Math.max(t.shininess,1e-4);if(t.gradientMap){e.gradientMap.value=t.gradientMap}if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===BackSide)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===BackSide)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function Ie(e,t,i){e.roughness.value=t.roughness;e.metalness.value=t.metalness;if(t.roughnessMap){e.roughnessMap.value=t.roughnessMap}if(t.metalnessMap){e.metalnessMap.value=t.metalnessMap}if(t.emissiveMap){e.emissiveMap.value=t.emissiveMap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===BackSide)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===BackSide)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}if(t.envMap||i){e.envMapIntensity.value=t.envMapIntensity}}function Ve(e,t,i){Ie(e,t,i);e.reflectivity.value=t.reflectivity;e.clearcoat.value=t.clearcoat;e.clearcoatRoughness.value=t.clearcoatRoughness;if(t.sheen)e.sheen.value.copy(t.sheen);if(t.clearcoatMap){e.clearcoatMap.value=t.clearcoatMap}if(t.clearcoatRoughnessMap){e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap}if(t.clearcoatNormalMap){e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale);e.clearcoatNormalMap.value=t.clearcoatNormalMap;if(t.side===BackSide){e.clearcoatNormalScale.value.negate()}}e.transparency.value=t.transparency}function Fe(e,t){if(t.matcap){e.matcap.value=t.matcap}if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===BackSide)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===BackSide)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function Oe(e,t){if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function Ne(e,t){if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}e.referencePosition.value.copy(t.referencePosition);e.nearDistance.value=t.nearDistance;e.farDistance.value=t.farDistance}function Ue(e,t){if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale;if(t.side===BackSide)e.bumpScale.value*=-1}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale);if(t.side===BackSide)e.normalScale.value.negate()}if(t.displacementMap){e.displacementMap.value=t.displacementMap;e.displacementScale.value=t.displacementScale;e.displacementBias.value=t.displacementBias}}function ze(e,t){e.ambientLightColor.needsUpdate=t;e.lightProbe.needsUpdate=t;e.directionalLights.needsUpdate=t;e.directionalLightShadows.needsUpdate=t;e.pointLights.needsUpdate=t;e.pointLightShadows.needsUpdate=t;e.spotLights.needsUpdate=t;e.spotLightShadows.needsUpdate=t;e.rectAreaLights.needsUpdate=t;e.hemisphereLights.needsUpdate=t}function ke(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&e.lights===true}this.setFramebuffer=function(e){if(d!==e&&v===null)k.bindFramebuffer(36160,e);d=e};this.getActiveCubeFace=function(){return _};this.getActiveMipmapLevel=function(){return y};this.getRenderTarget=function(){return v};this.setRenderTarget=function(e,t,i){v=e;_=t;y=i;if(e&&X.get(e).__webglFramebuffer===undefined){$.setupRenderTarget(e)}var r=d;var n=false;if(e){var a=X.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget){r=a[t||0];n=true}else if(e.isWebGLMultisampleRenderTarget){r=X.get(e).__webglMultisampledFramebuffer}else{r=a}S.copy(e.viewport);A.copy(e.scissor);C=e.scissorTest}else{S.copy(R).multiplyScalar(L).floor();A.copy(P).multiplyScalar(L).floor();C=G}if(g!==r){k.bindFramebuffer(36160,r);g=r}J.viewport(S);J.scissor(A);J.setScissorTest(C);if(n){var o=X.get(e.texture);k.framebufferTexture2D(36160,36064,34069+(t||0),o.__webglTexture,i||0)}};this.readRenderTargetPixels=function(e,t,i,r,n,a,o){if(!(e&&e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}var s=X.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&o!==undefined){s=s[o]}if(s){var l=false;if(s!==g){k.bindFramebuffer(36160,s);l=true}try{var c=e.texture;var u=c.format;var h=c.type;if(u!==RGBAFormat&&oe.convert(u)!==k.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(h!==UnsignedByteType&&oe.convert(h)!==k.getParameter(35738)&&!(h===FloatType&&(W.isWebGL2||j.get("OES_texture_float")||j.get("WEBGL_color_buffer_float")))&&!(h===HalfFloatType&&(W.isWebGL2?j.get("EXT_color_buffer_float"):j.get("EXT_color_buffer_half_float")))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}if(k.checkFramebufferStatus(36160)===36053){if(t>=0&&t<=e.width-r&&(i>=0&&i<=e.height-n)){k.readPixels(t,i,r,n,oe.convert(u),oe.convert(h),a)}}else{console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}}finally{if(l){k.bindFramebuffer(36160,g)}}}};this.copyFramebufferToTexture=function(e,t,i){if(i===undefined)i=0;var r=Math.pow(2,-i);var n=Math.floor(t.image.width*r);var a=Math.floor(t.image.height*r);var o=oe.convert(t.format);$.setTexture2D(t,0);k.copyTexImage2D(3553,i,o,e.x,e.y,n,a,0);J.unbindTexture()};this.copyTextureToTexture=function(e,t,i,r){if(r===undefined)r=0;var n=t.image.width;var a=t.image.height;var o=oe.convert(i.format);var s=oe.convert(i.type);$.setTexture2D(i,0);if(t.isDataTexture){k.texSubImage2D(3553,r,e.x,e.y,n,a,o,s,t.image.data)}else{if(t.isCompressedTexture){k.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data)}else{k.texSubImage2D(3553,r,e.x,e.y,o,s,t.image)}}if(r===0&&i.generateMipmaps)k.generateMipmap(3553);J.unbindTexture()};this.initTexture=function(e){$.setTexture2D(e,0);J.unbindTexture()};if(typeof __THREE_DEVTOOLS__!=="undefined"){__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}function FogExp2(e,t){this.name="";this.color=new Color(e);this.density=t!==undefined?t:25e-5}Object.assign(FogExp2.prototype,{isFogExp2:true,clone:function(){return new FogExp2(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}});function Fog(e,t,i){this.name="";this.color=new Color(e);this.near=t!==undefined?t:1;this.far=i!==undefined?i:1e3}Object.assign(Fog.prototype,{isFog:true,clone:function(){return new Fog(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}});function InterleavedBuffer(e,t){this.array=e;this.stride=t;this.count=e!==undefined?e.length/t:0;this.usage=StaticDrawUsage;this.updateRange={offset:0,count:-1};this.version=0}Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(e){if(e===true)this.version++}});Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:true,onUploadCallback:function(){},setUsage:function(e){this.usage=e;return this},copy:function(e){this.array=new e.array.constructor(e.array);this.count=e.count;this.stride=e.stride;this.usage=e.usage;return this},copyAt:function(e,t,i){e*=this.stride;i*=t.stride;for(var r=0,n=this.stride;r<n;r++){this.array[e+r]=t.array[i+r]}return this},set:function(e,t){if(t===undefined)t=0;this.array.set(e,t);return this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){this.onUploadCallback=e;return this}});var _vector$6=new Vector3;function InterleavedBufferAttribute(e,t,i,r){this.data=e;this.itemSize=t;this.offset=i;this.normalized=r===true}Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}});Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:true,applyMatrix4:function(e){for(var t=0,i=this.data.count;t<i;t++){_vector$6.x=this.getX(t);_vector$6.y=this.getY(t);_vector$6.z=this.getZ(t);_vector$6.applyMatrix4(e);this.setXYZ(t,_vector$6.x,_vector$6.y,_vector$6.z)}return this},setX:function(e,t){this.data.array[e*this.data.stride+this.offset]=t;return this},setY:function(e,t){this.data.array[e*this.data.stride+this.offset+1]=t;return this},setZ:function(e,t){this.data.array[e*this.data.stride+this.offset+2]=t;return this},setW:function(e,t){this.data.array[e*this.data.stride+this.offset+3]=t;return this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=i;return this},setXYZ:function(e,t,i,r){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=i;this.data.array[e+2]=r;return this},setXYZW:function(e,t,i,r,n){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=i;this.data.array[e+2]=r;this.data.array[e+3]=n;return this}});function SpriteMaterial(e){Material.call(this);this.type="SpriteMaterial";this.color=new Color(16777215);this.map=null;this.alphaMap=null;this.rotation=0;this.sizeAttenuation=true;this.transparent=true;this.setValues(e)}SpriteMaterial.prototype=Object.create(Material.prototype);SpriteMaterial.prototype.constructor=SpriteMaterial;SpriteMaterial.prototype.isSpriteMaterial=true;SpriteMaterial.prototype.copy=function(e){Material.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.alphaMap=e.alphaMap;this.rotation=e.rotation;this.sizeAttenuation=e.sizeAttenuation;return this};var _geometry;var _intersectPoint=new Vector3;var _worldScale=new Vector3;var _mvPosition=new Vector3;var _alignedPosition=new Vector2;var _rotatedPosition=new Vector2;var _viewWorldMatrix=new Matrix4;var _vA$1=new Vector3;var _vB$1=new Vector3;var _vC$1=new Vector3;var _uvA$1=new Vector2;var _uvB$1=new Vector2;var _uvC$1=new Vector2;function Sprite(e){Object3D.call(this);this.type="Sprite";if(_geometry===undefined){_geometry=new BufferGeometry;var t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);var i=new InterleavedBuffer(t,5);_geometry.setIndex([0,1,2,0,2,3]);_geometry.setAttribute("position",new InterleavedBufferAttribute(i,3,0,false));_geometry.setAttribute("uv",new InterleavedBufferAttribute(i,2,3,false))}this.geometry=_geometry;this.material=e!==undefined?e:new SpriteMaterial;this.center=new Vector2(.5,.5)}Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:true,raycast:function(e,t){if(e.camera===null){console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.')}_worldScale.setFromMatrixScale(this.matrixWorld);_viewWorldMatrix.copy(e.camera.matrixWorld);this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld);_mvPosition.setFromMatrixPosition(this.modelViewMatrix);if(e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===false){_worldScale.multiplyScalar(-_mvPosition.z)}var i=this.material.rotation;var r,n;if(i!==0){n=Math.cos(i);r=Math.sin(i)}var a=this.center;transformVertex(_vA$1.set(-.5,-.5,0),_mvPosition,a,_worldScale,r,n);transformVertex(_vB$1.set(.5,-.5,0),_mvPosition,a,_worldScale,r,n);transformVertex(_vC$1.set(.5,.5,0),_mvPosition,a,_worldScale,r,n);_uvA$1.set(0,0);_uvB$1.set(1,0);_uvC$1.set(1,1);var o=e.ray.intersectTriangle(_vA$1,_vB$1,_vC$1,false,_intersectPoint);if(o===null){transformVertex(_vB$1.set(-.5,.5,0),_mvPosition,a,_worldScale,r,n);_uvB$1.set(0,1);o=e.ray.intersectTriangle(_vA$1,_vC$1,_vB$1,false,_intersectPoint);if(o===null){return}}var s=e.ray.origin.distanceTo(_intersectPoint);if(s<e.near||s>e.far)return;t.push({distance:s,point:_intersectPoint.clone(),uv:Triangle.getUV(_intersectPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),face:null,object:this})},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){Object3D.prototype.copy.call(this,e);if(e.center!==undefined)this.center.copy(e.center);return this}});function transformVertex(e,t,i,r,n,a){_alignedPosition.subVectors(e,i).addScalar(.5).multiply(r);if(n!==undefined){_rotatedPosition.x=a*_alignedPosition.x-n*_alignedPosition.y;_rotatedPosition.y=n*_alignedPosition.x+a*_alignedPosition.y}else{_rotatedPosition.copy(_alignedPosition)}e.copy(t);e.x+=_rotatedPosition.x;e.y+=_rotatedPosition.y;e.applyMatrix4(_viewWorldMatrix)}var _v1$4=new Vector3;var _v2$2=new Vector3;function LOD(){Object3D.call(this);this._currentLevel=0;this.type="LOD";Object.defineProperties(this,{levels:{enumerable:true,value:[]}});this.autoUpdate=true}LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,isLOD:true,copy:function(e){Object3D.prototype.copy.call(this,e,false);var t=e.levels;for(var i=0,r=t.length;i<r;i++){var n=t[i];this.addLevel(n.object.clone(),n.distance)}this.autoUpdate=e.autoUpdate;return this},addLevel:function(e,t){if(t===undefined)t=0;t=Math.abs(t);var i=this.levels;for(var r=0;r<i.length;r++){if(t<i[r].distance){break}}i.splice(r,0,{distance:t,object:e});this.add(e);return this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var i=1,r=t.length;i<r;i++){if(e<t[i].distance){break}}return t[i-1].object}return null},raycast:function(e,t){var i=this.levels;if(i.length>0){_v1$4.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(_v1$4);this.getObjectForDistance(r).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){_v1$4.setFromMatrixPosition(e.matrixWorld);_v2$2.setFromMatrixPosition(this.matrixWorld);var i=_v1$4.distanceTo(_v2$2)/e.zoom;t[0].object.visible=true;for(var r=1,n=t.length;r<n;r++){if(i>=t[r].distance){t[r-1].object.visible=false;t[r].object.visible=true}else{break}}this._currentLevel=r-1;for(;r<n;r++){t[r].object.visible=false}}},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);if(this.autoUpdate===false)t.object.autoUpdate=false;t.object.levels=[];var i=this.levels;for(var r=0,n=i.length;r<n;r++){var a=i[r];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}});function SkinnedMesh(e,t){if(e&&e.isGeometry){console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}Mesh.call(this,e,t);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new Matrix4;this.bindMatrixInverse=new Matrix4}SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:true,bind:function(e,t){this.skeleton=e;if(t===undefined){this.updateMatrixWorld(true);this.skeleton.calculateInverses();t=this.matrixWorld}this.bindMatrix.copy(t);this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var e=new Vector4;var t=this.geometry.attributes.skinWeight;for(var i=0,r=t.count;i<r;i++){e.x=t.getX(i);e.y=t.getY(i);e.z=t.getZ(i);e.w=t.getW(i);var n=1/e.manhattanLength();if(n!==Infinity){e.multiplyScalar(n)}else{e.set(1,0,0,0)}t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Mesh.prototype.updateMatrixWorld.call(this,e);if(this.bindMode==="attached"){this.bindMatrixInverse.getInverse(this.matrixWorld)}else if(this.bindMode==="detached"){this.bindMatrixInverse.getInverse(this.bindMatrix)}else{console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)},boneTransform:function(){var e=new Vector3;var t=new Vector4;var i=new Vector4;var r=new Vector3;var n=new Matrix4;return function(a,o){var s=this.skeleton;var l=this.geometry;t.fromBufferAttribute(l.attributes.skinIndex,a);i.fromBufferAttribute(l.attributes.skinWeight,a);e.fromBufferAttribute(l.attributes.position,a).applyMatrix4(this.bindMatrix);o.set(0,0,0);for(var c=0;c<4;c++){var u=i.getComponent(c);if(u!==0){var h=t.getComponent(c);n.multiplyMatrices(s.bones[h].matrixWorld,s.boneInverses[h]);o.addScaledVector(r.copy(e).applyMatrix4(n),u)}}return o.applyMatrix4(this.bindMatrixInverse)}}()});var _offsetMatrix=new Matrix4;var _identityMatrix=new Matrix4;function Skeleton(e,t){e=e||[];this.bones=e.slice(0);this.boneMatrices=new Float32Array(this.bones.length*16);this.frame=-1;if(t===undefined){this.calculateInverses()}else{if(this.bones.length===t.length){this.boneInverses=t.slice(0)}else{console.warn("THREE.Skeleton boneInverses is the wrong length.");this.boneInverses=[];for(var i=0,r=this.bones.length;i<r;i++){this.boneInverses.push(new Matrix4)}}}}Object.assign(Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new Matrix4;if(this.bones[e]){i.getInverse(this.bones[e].matrixWorld)}this.boneInverses.push(i)}},pose:function(){var e,t,i;for(t=0,i=this.bones.length;t<i;t++){e=this.bones[t];if(e){e.matrixWorld.getInverse(this.boneInverses[t])}}for(t=0,i=this.bones.length;t<i;t++){e=this.bones[t];if(e){if(e.parent&&e.parent.isBone){e.matrix.getInverse(e.parent.matrixWorld);e.matrix.multiply(e.matrixWorld)}else{e.matrix.copy(e.matrixWorld)}e.matrix.decompose(e.position,e.quaternion,e.scale)}}},update:function(){var e=this.bones;var t=this.boneInverses;var i=this.boneMatrices;var r=this.boneTexture;for(var n=0,a=e.length;n<a;n++){var o=e[n]?e[n].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(o,t[n]);_offsetMatrix.toArray(i,n*16)}if(r!==undefined){r.needsUpdate=true}},clone:function(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,i=this.bones.length;t<i;t++){var r=this.bones[t];if(r.name===e){return r}}return undefined},dispose:function(){if(this.boneTexture){this.boneTexture.dispose();this.boneTexture=undefined}}});function Bone(){Object3D.call(this);this.type="Bone"}Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:true});var _instanceLocalMatrix=new Matrix4;var _instanceWorldMatrix=new Matrix4;var _instanceIntersects=[];var _mesh=new Mesh;function InstancedMesh(e,t,i){Mesh.call(this,e,t);this.instanceMatrix=new BufferAttribute(new Float32Array(i*16),16);this.count=i;this.frustumCulled=false}InstancedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:InstancedMesh,isInstancedMesh:true,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,e*16)},raycast:function(e,t){var i=this.matrixWorld;var r=this.count;_mesh.geometry=this.geometry;_mesh.material=this.material;if(_mesh.material===undefined)return;for(var n=0;n<r;n++){this.getMatrixAt(n,_instanceLocalMatrix);_instanceWorldMatrix.multiplyMatrices(i,_instanceLocalMatrix);_mesh.matrixWorld=_instanceWorldMatrix;_mesh.raycast(e,_instanceIntersects);for(var a=0,o=_instanceIntersects.length;a<o;a++){var s=_instanceIntersects[a];s.instanceId=n;s.object=this;t.push(s)}_instanceIntersects.length=0}},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,e*16)},updateMorphTargets:function(){}});function LineBasicMaterial(e){Material.call(this);this.type="LineBasicMaterial";this.color=new Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.setValues(e)}LineBasicMaterial.prototype=Object.create(Material.prototype);LineBasicMaterial.prototype.constructor=LineBasicMaterial;LineBasicMaterial.prototype.isLineBasicMaterial=true;LineBasicMaterial.prototype.copy=function(e){Material.prototype.copy.call(this,e);this.color.copy(e.color);this.linewidth=e.linewidth;this.linecap=e.linecap;this.linejoin=e.linejoin;return this};var _start=new Vector3;var _end=new Vector3;var _inverseMatrix$1=new Matrix4;var _ray$1=new Ray;var _sphere$2=new Sphere;function Line(e,t,i){if(i===1){console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead.")}Object3D.call(this);this.type="Line";this.geometry=e!==undefined?e:new BufferGeometry;this.material=t!==undefined?t:new LineBasicMaterial}Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:true,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry){if(e.index===null){var t=e.attributes.position;var i=[0];for(var r=1,n=t.count;r<n;r++){_start.fromBufferAttribute(t,r-1);_end.fromBufferAttribute(t,r);i[r]=i[r-1];i[r]+=_start.distanceTo(_end)}e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else{console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.")}}else if(e.isGeometry){var a=e.vertices;var i=e.lineDistances;i[0]=0;for(var r=1,n=a.length;r<n;r++){i[r]=i[r-1];i[r]+=a[r-1].distanceTo(a[r])}}return this},raycast:function(e,t){var i=this.geometry;var r=this.matrixWorld;var n=e.params.Line.threshold;if(i.boundingSphere===null)i.computeBoundingSphere();_sphere$2.copy(i.boundingSphere);_sphere$2.applyMatrix4(r);_sphere$2.radius+=n;if(e.ray.intersectsSphere(_sphere$2)===false)return;_inverseMatrix$1.getInverse(r);_ray$1.copy(e.ray).applyMatrix4(_inverseMatrix$1);var a=n/((this.scale.x+this.scale.y+this.scale.z)/3);var o=a*a;var s=new Vector3;var l=new Vector3;var c=new Vector3;var u=new Vector3;var h=this&&this.isLineSegments?2:1;if(i.isBufferGeometry){var p=i.index;var m=i.attributes;var f=m.position.array;if(p!==null){var d=p.array;for(var _=0,y=d.length-1;_<y;_+=h){var v=d[_];var g=d[_+1];s.fromArray(f,v*3);l.fromArray(f,g*3);var x=_ray$1.distanceSqToSegment(s,l,u,c);if(x>o)continue;u.applyMatrix4(this.matrixWorld);var b=e.ray.origin.distanceTo(u);if(b<e.near||b>e.far)continue;t.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else{for(var _=0,y=f.length/3-1;_<y;_+=h){s.fromArray(f,3*_);l.fromArray(f,3*_+3);var x=_ray$1.distanceSqToSegment(s,l,u,c);if(x>o)continue;u.applyMatrix4(this.matrixWorld);var b=e.ray.origin.distanceTo(u);if(b<e.near||b>e.far)continue;t.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}else if(i.isGeometry){var M=i.vertices;var w=M.length;for(var _=0;_<w-1;_+=h){var x=_ray$1.distanceSqToSegment(M[_],M[_+1],u,c);if(x>o)continue;u.applyMatrix4(this.matrixWorld);var b=e.ray.origin.distanceTo(u);if(b<e.near||b>e.far)continue;t.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var _start$1=new Vector3;var _end$1=new Vector3;function LineSegments(e,t){Line.call(this,e,t);this.type="LineSegments"}LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:true,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry){if(e.index===null){var t=e.attributes.position;var i=[];for(var r=0,n=t.count;r<n;r+=2){_start$1.fromBufferAttribute(t,r);_end$1.fromBufferAttribute(t,r+1);i[r]=r===0?0:i[r-1];i[r+1]=i[r]+_start$1.distanceTo(_end$1)}e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else{console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.")}}else if(e.isGeometry){var a=e.vertices;var i=e.lineDistances;for(var r=0,n=a.length;r<n;r+=2){_start$1.copy(a[r]);_end$1.copy(a[r+1]);i[r]=r===0?0:i[r-1];i[r+1]=i[r]+_start$1.distanceTo(_end$1)}}return this}});function LineLoop(e,t){Line.call(this,e,t);this.type="LineLoop"}LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:true});function PointsMaterial(e){Material.call(this);this.type="PointsMaterial";this.color=new Color(16777215);this.map=null;this.alphaMap=null;this.size=1;this.sizeAttenuation=true;this.morphTargets=false;this.setValues(e)}PointsMaterial.prototype=Object.create(Material.prototype);PointsMaterial.prototype.constructor=PointsMaterial;PointsMaterial.prototype.isPointsMaterial=true;PointsMaterial.prototype.copy=function(e){Material.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.alphaMap=e.alphaMap;this.size=e.size;this.sizeAttenuation=e.sizeAttenuation;this.morphTargets=e.morphTargets;return this};var _inverseMatrix$2=new Matrix4;var _ray$2=new Ray;var _sphere$3=new Sphere;var _position$1=new Vector3;function Points(e,t){Object3D.call(this);this.type="Points";this.geometry=e!==undefined?e:new BufferGeometry;this.material=t!==undefined?t:new PointsMaterial;this.updateMorphTargets()}Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:true,raycast:function(e,t){var i=this.geometry;var r=this.matrixWorld;var n=e.params.Points.threshold;if(i.boundingSphere===null)i.computeBoundingSphere();_sphere$3.copy(i.boundingSphere);_sphere$3.applyMatrix4(r);_sphere$3.radius+=n;if(e.ray.intersectsSphere(_sphere$3)===false)return;_inverseMatrix$2.getInverse(r);_ray$2.copy(e.ray).applyMatrix4(_inverseMatrix$2);var a=n/((this.scale.x+this.scale.y+this.scale.z)/3);var o=a*a;if(i.isBufferGeometry){var s=i.index;var l=i.attributes;var c=l.position.array;if(s!==null){var u=s.array;for(var h=0,p=u.length;h<p;h++){var m=u[h];_position$1.fromArray(c,m*3);testPoint(_position$1,m,o,r,e,t,this)}}else{for(var h=0,f=c.length/3;h<f;h++){_position$1.fromArray(c,h*3);testPoint(_position$1,h,o,r,e,t,this)}}}else{var d=i.vertices;for(var h=0,f=d.length;h<f;h++){testPoint(d[h],h,o,r,e,t,this)}}},updateMorphTargets:function(){var e=this.geometry;var t,i,r;if(e.isBufferGeometry){var n=e.morphAttributes;var a=Object.keys(n);if(a.length>0){var o=n[a[0]];if(o!==undefined){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(t=0,i=o.length;t<i;t++){r=o[t].name||String(t);this.morphTargetInfluences.push(0);this.morphTargetDictionary[r]=t}}}}else{var s=e.morphTargets;if(s!==undefined&&s.length>0){console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function testPoint(e,t,i,r,n,a,o){var s=_ray$2.distanceSqToPoint(e);if(s<i){var l=new Vector3;_ray$2.closestPointToPoint(e,l);l.applyMatrix4(r);var c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;a.push({distance:c,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:o})}}function VideoTexture(e,t,i,r,n,a,o,s,l){Texture.call(this,e,t,i,r,n,a,o,s,l);this.format=o!==undefined?o:RGBFormat;this.minFilter=a!==undefined?a:LinearFilter;this.magFilter=n!==undefined?n:LinearFilter;this.generateMipmaps=false}VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,isVideoTexture:true,update:function(){var e=this.image;if(e.readyState>=e.HAVE_CURRENT_DATA){this.needsUpdate=true}}});function CompressedTexture(e,t,i,r,n,a,o,s,l,c,u,h){Texture.call(this,null,a,o,s,l,c,r,n,u,h);this.image={width:t,height:i};this.mipmaps=e;this.flipY=false;this.generateMipmaps=false}CompressedTexture.prototype=Object.create(Texture.prototype);CompressedTexture.prototype.constructor=CompressedTexture;CompressedTexture.prototype.isCompressedTexture=true;function CanvasTexture(e,t,i,r,n,a,o,s,l){Texture.call(this,e,t,i,r,n,a,o,s,l);this.needsUpdate=true}CanvasTexture.prototype=Object.create(Texture.prototype);CanvasTexture.prototype.constructor=CanvasTexture;CanvasTexture.prototype.isCanvasTexture=true;function DepthTexture(e,t,i,r,n,a,o,s,l,c){c=c!==undefined?c:DepthFormat;if(c!==DepthFormat&&c!==DepthStencilFormat){throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat")}if(i===undefined&&c===DepthFormat)i=UnsignedShortType;if(i===undefined&&c===DepthStencilFormat)i=UnsignedInt248Type;Texture.call(this,null,r,n,a,o,s,c,i,l);this.image={width:e,height:t};this.magFilter=o!==undefined?o:NearestFilter;this.minFilter=s!==undefined?s:NearestFilter;this.flipY=false;this.generateMipmaps=false}DepthTexture.prototype=Object.create(Texture.prototype);DepthTexture.prototype.constructor=DepthTexture;DepthTexture.prototype.isDepthTexture=true;function WireframeGeometry(e){BufferGeometry.call(this);this.type="WireframeGeometry";var t=[];var i,r,n,a,o;var s=[0,0],l={},c,u,h;var p,m=["a","b","c"];var f;if(e&&e.isGeometry){var d=e.faces;for(i=0,n=d.length;i<n;i++){var _=d[i];for(r=0;r<3;r++){u=_[m[r]];h=_[m[(r+1)%3]];s[0]=Math.min(u,h);s[1]=Math.max(u,h);p=s[0]+","+s[1];if(l[p]===undefined){l[p]={index1:s[0],index2:s[1]}}}}for(p in l){c=l[p];f=e.vertices[c.index1];t.push(f.x,f.y,f.z);f=e.vertices[c.index2];t.push(f.x,f.y,f.z)}}else if(e&&e.isBufferGeometry){var y,v,g;var x,b,M;var w,S;f=new Vector3;if(e.index!==null){y=e.attributes.position;v=e.index;g=e.groups;if(g.length===0){g=[{start:0,count:v.count,materialIndex:0}]}for(a=0,o=g.length;a<o;++a){x=g[a];b=x.start;M=x.count;for(i=b,n=b+M;i<n;i+=3){for(r=0;r<3;r++){u=v.getX(i+r);h=v.getX(i+(r+1)%3);s[0]=Math.min(u,h);s[1]=Math.max(u,h);p=s[0]+","+s[1];if(l[p]===undefined){l[p]={index1:s[0],index2:s[1]}}}}}for(p in l){c=l[p];f.fromBufferAttribute(y,c.index1);t.push(f.x,f.y,f.z);f.fromBufferAttribute(y,c.index2);t.push(f.x,f.y,f.z)}}else{y=e.attributes.position;for(i=0,n=y.count/3;i<n;i++){for(r=0;r<3;r++){w=3*i+r;f.fromBufferAttribute(y,w);t.push(f.x,f.y,f.z);S=3*i+(r+1)%3;f.fromBufferAttribute(y,S);t.push(f.x,f.y,f.z)}}}}this.setAttribute("position",new Float32BufferAttribute(t,3))}WireframeGeometry.prototype=Object.create(BufferGeometry.prototype);WireframeGeometry.prototype.constructor=WireframeGeometry;function ParametricGeometry(e,t,i){Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:e,slices:t,stacks:i};this.fromBufferGeometry(new ParametricBufferGeometry(e,t,i));this.mergeVertices()}ParametricGeometry.prototype=Object.create(Geometry.prototype);ParametricGeometry.prototype.constructor=ParametricGeometry;function ParametricBufferGeometry(e,t,i){BufferGeometry.call(this);this.type="ParametricBufferGeometry";this.parameters={func:e,slices:t,stacks:i};var r=[];var n=[];var a=[];var o=[];var s=1e-5;var l=new Vector3;var c=new Vector3,u=new Vector3;var h=new Vector3,p=new Vector3;var m,f;if(e.length<3){console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.")}var d=t+1;for(m=0;m<=i;m++){var _=m/i;for(f=0;f<=t;f++){var y=f/t;e(y,_,c);n.push(c.x,c.y,c.z);if(y-s>=0){e(y-s,_,u);h.subVectors(c,u)}else{e(y+s,_,u);h.subVectors(u,c)}if(_-s>=0){e(y,_-s,u);p.subVectors(c,u)}else{e(y,_+s,u);p.subVectors(u,c)}l.crossVectors(h,p).normalize();a.push(l.x,l.y,l.z);o.push(y,_)}}for(m=0;m<i;m++){for(f=0;f<t;f++){var v=m*d+f;var g=m*d+f+1;var x=(m+1)*d+f+1;var b=(m+1)*d+f;r.push(v,g,b);r.push(g,x,b)}}this.setIndex(r);this.setAttribute("position",new Float32BufferAttribute(n,3));this.setAttribute("normal",new Float32BufferAttribute(a,3));this.setAttribute("uv",new Float32BufferAttribute(o,2))}ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype);ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry;function PolyhedronGeometry(e,t,i,r){Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:e,indices:t,radius:i,detail:r};this.fromBufferGeometry(new PolyhedronBufferGeometry(e,t,i,r));this.mergeVertices()}PolyhedronGeometry.prototype=Object.create(Geometry.prototype);PolyhedronGeometry.prototype.constructor=PolyhedronGeometry;function PolyhedronBufferGeometry(e,t,i,r){BufferGeometry.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:e,indices:t,radius:i,detail:r};i=i||1;r=r||0;var n=[];var a=[];o(r);l(i);c();this.setAttribute("position",new Float32BufferAttribute(n,3));this.setAttribute("normal",new Float32BufferAttribute(n.slice(),3));this.setAttribute("uv",new Float32BufferAttribute(a,2));if(r===0){this.computeVertexNormals()}else{this.normalizeNormals()}function o(e){var i=new Vector3;var r=new Vector3;var n=new Vector3;for(var a=0;a<t.length;a+=3){p(t[a+0],i);p(t[a+1],r);p(t[a+2],n);s(i,r,n,e)}}function s(e,t,i,r){var n=Math.pow(2,r);var a=[];var o,s;for(o=0;o<=n;o++){a[o]=[];var l=e.clone().lerp(i,o/n);var c=t.clone().lerp(i,o/n);var u=n-o;for(s=0;s<=u;s++){if(s===0&&o===n){a[o][s]=l}else{a[o][s]=l.clone().lerp(c,s/u)}}}for(o=0;o<n;o++){for(s=0;s<2*(n-o)-1;s++){var p=Math.floor(s/2);if(s%2===0){h(a[o][p+1]);h(a[o+1][p]);h(a[o][p])}else{h(a[o][p+1]);h(a[o+1][p+1]);h(a[o+1][p])}}}}function l(e){var t=new Vector3;for(var i=0;i<n.length;i+=3){t.x=n[i+0];t.y=n[i+1];t.z=n[i+2];t.normalize().multiplyScalar(e);n[i+0]=t.x;n[i+1]=t.y;n[i+2]=t.z}}function c(){var e=new Vector3;for(var t=0;t<n.length;t+=3){e.x=n[t+0];e.y=n[t+1];e.z=n[t+2];var i=d(e)/2/Math.PI+.5;var r=_(e)/Math.PI+.5;a.push(i,1-r)}m();u()}function u(){for(var e=0;e<a.length;e+=6){var t=a[e+0];var i=a[e+2];var r=a[e+4];var n=Math.max(t,i,r);var o=Math.min(t,i,r);if(n>.9&&o<.1){if(t<.2)a[e+0]+=1;if(i<.2)a[e+2]+=1;if(r<.2)a[e+4]+=1}}}function h(e){n.push(e.x,e.y,e.z)}function p(t,i){var r=t*3;i.x=e[r+0];i.y=e[r+1];i.z=e[r+2]}function m(){var e=new Vector3;var t=new Vector3;var i=new Vector3;var r=new Vector3;var o=new Vector2;var s=new Vector2;var l=new Vector2;for(var c=0,u=0;c<n.length;c+=9,u+=6){e.set(n[c+0],n[c+1],n[c+2]);t.set(n[c+3],n[c+4],n[c+5]);i.set(n[c+6],n[c+7],n[c+8]);o.set(a[u+0],a[u+1]);s.set(a[u+2],a[u+3]);l.set(a[u+4],a[u+5]);r.copy(e).add(t).add(i).divideScalar(3);var h=d(r);f(o,u+0,e,h);f(s,u+2,t,h);f(l,u+4,i,h)}}function f(e,t,i,r){if(r<0&&e.x===1){a[t]=e.x-1}if(i.x===0&&i.z===0){a[t]=r/2/Math.PI+.5}}function d(e){return Math.atan2(e.z,-e.x)}function _(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}}PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry.prototype);PolyhedronBufferGeometry.prototype.constructor=PolyhedronBufferGeometry;function TetrahedronGeometry(e,t){Geometry.call(this);this.type="TetrahedronGeometry";this.parameters={radius:e,detail:t};this.fromBufferGeometry(new TetrahedronBufferGeometry(e,t));this.mergeVertices()}TetrahedronGeometry.prototype=Object.create(Geometry.prototype);TetrahedronGeometry.prototype.constructor=TetrahedronGeometry;function TetrahedronBufferGeometry(e,t){var i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1];var r=[2,1,0,0,3,2,1,3,0,2,3,1];PolyhedronBufferGeometry.call(this,i,r,e,t);this.type="TetrahedronBufferGeometry";this.parameters={radius:e,detail:t}}TetrahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);TetrahedronBufferGeometry.prototype.constructor=TetrahedronBufferGeometry;function OctahedronGeometry(e,t){Geometry.call(this);this.type="OctahedronGeometry";this.parameters={radius:e,detail:t};this.fromBufferGeometry(new OctahedronBufferGeometry(e,t));this.mergeVertices()}OctahedronGeometry.prototype=Object.create(Geometry.prototype);OctahedronGeometry.prototype.constructor=OctahedronGeometry;function OctahedronBufferGeometry(e,t){var i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1];var r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];PolyhedronBufferGeometry.call(this,i,r,e,t);this.type="OctahedronBufferGeometry";this.parameters={radius:e,detail:t}}OctahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);OctahedronBufferGeometry.prototype.constructor=OctahedronBufferGeometry;function IcosahedronGeometry(e,t){Geometry.call(this);this.type="IcosahedronGeometry";this.parameters={radius:e,detail:t};this.fromBufferGeometry(new IcosahedronBufferGeometry(e,t));this.mergeVertices()}IcosahedronGeometry.prototype=Object.create(Geometry.prototype);IcosahedronGeometry.prototype.constructor=IcosahedronGeometry;function IcosahedronBufferGeometry(e,t){var i=(1+Math.sqrt(5))/2;var r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];var n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];PolyhedronBufferGeometry.call(this,r,n,e,t);this.type="IcosahedronBufferGeometry";this.parameters={radius:e,detail:t}}IcosahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);IcosahedronBufferGeometry.prototype.constructor=IcosahedronBufferGeometry;function DodecahedronGeometry(e,t){Geometry.call(this);this.type="DodecahedronGeometry";this.parameters={radius:e,detail:t};this.fromBufferGeometry(new DodecahedronBufferGeometry(e,t));this.mergeVertices()}DodecahedronGeometry.prototype=Object.create(Geometry.prototype);DodecahedronGeometry.prototype.constructor=DodecahedronGeometry;function DodecahedronBufferGeometry(e,t){var i=(1+Math.sqrt(5))/2;var r=1/i;var n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r];var a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];PolyhedronBufferGeometry.call(this,n,a,e,t);this.type="DodecahedronBufferGeometry";this.parameters={radius:e,detail:t}}DodecahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);DodecahedronBufferGeometry.prototype.constructor=DodecahedronBufferGeometry;function TubeGeometry(e,t,i,r,n,a){Geometry.call(this);this.type="TubeGeometry";this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n};if(a!==undefined)console.warn("THREE.TubeGeometry: taper has been removed.");var o=new TubeBufferGeometry(e,t,i,r,n);this.tangents=o.tangents;this.normals=o.normals;this.binormals=o.binormals;this.fromBufferGeometry(o);this.mergeVertices()}TubeGeometry.prototype=Object.create(Geometry.prototype);TubeGeometry.prototype.constructor=TubeGeometry;function TubeBufferGeometry(e,t,i,r,n){BufferGeometry.call(this);this.type="TubeBufferGeometry";this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n};t=t||64;i=i||1;r=r||8;n=n||false;var a=e.computeFrenetFrames(t,n);this.tangents=a.tangents;this.normals=a.normals;this.binormals=a.binormals;var o=new Vector3;var s=new Vector3;var l=new Vector2;var c=new Vector3;var u,h;var p=[];var m=[];var f=[];var d=[];_();this.setIndex(d);this.setAttribute("position",new Float32BufferAttribute(p,3));this.setAttribute("normal",new Float32BufferAttribute(m,3));this.setAttribute("uv",new Float32BufferAttribute(f,2));function _(){for(u=0;u<t;u++){y(u)}y(n===false?t:0);g();v()}function y(n){c=e.getPointAt(n/t,c);var l=a.normals[n];var u=a.binormals[n];for(h=0;h<=r;h++){var f=h/r*Math.PI*2;var d=Math.sin(f);var _=-Math.cos(f);s.x=_*l.x+d*u.x;s.y=_*l.y+d*u.y;s.z=_*l.z+d*u.z;s.normalize();m.push(s.x,s.y,s.z);o.x=c.x+i*s.x;o.y=c.y+i*s.y;o.z=c.z+i*s.z;p.push(o.x,o.y,o.z)}}function v(){for(h=1;h<=t;h++){for(u=1;u<=r;u++){var e=(r+1)*(h-1)+(u-1);var i=(r+1)*h+(u-1);var n=(r+1)*h+u;var a=(r+1)*(h-1)+u;d.push(e,i,a);d.push(i,n,a)}}}function g(){for(u=0;u<=t;u++){for(h=0;h<=r;h++){l.x=u/t;l.y=h/r;f.push(l.x,l.y)}}}}TubeBufferGeometry.prototype=Object.create(BufferGeometry.prototype);TubeBufferGeometry.prototype.constructor=TubeBufferGeometry;TubeBufferGeometry.prototype.toJSON=function(){var e=BufferGeometry.prototype.toJSON.call(this);e.path=this.parameters.path.toJSON();return e};function TorusKnotGeometry(e,t,i,r,n,a,o){Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:a};if(o!==undefined)console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new TorusKnotBufferGeometry(e,t,i,r,n,a));this.mergeVertices()}TorusKnotGeometry.prototype=Object.create(Geometry.prototype);TorusKnotGeometry.prototype.constructor=TorusKnotGeometry;function TorusKnotBufferGeometry(e,t,i,r,n,a){BufferGeometry.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:a};e=e||1;t=t||.4;i=Math.floor(i)||64;r=Math.floor(r)||8;n=n||2;a=a||3;var o=[];var s=[];var l=[];var c=[];var u,h;var p=new Vector3;var m=new Vector3;var f=new Vector3;var d=new Vector3;var _=new Vector3;var y=new Vector3;var v=new Vector3;for(u=0;u<=i;++u){var g=u/i*n*Math.PI*2;T(g,n,a,e,f);T(g+.01,n,a,e,d);y.subVectors(d,f);v.addVectors(d,f);_.crossVectors(y,v);v.crossVectors(_,y);_.normalize();v.normalize();for(h=0;h<=r;++h){var x=h/r*Math.PI*2;var b=-t*Math.cos(x);var M=t*Math.sin(x);p.x=f.x+(b*v.x+M*_.x);p.y=f.y+(b*v.y+M*_.y);p.z=f.z+(b*v.z+M*_.z);s.push(p.x,p.y,p.z);m.subVectors(p,f).normalize();l.push(m.x,m.y,m.z);c.push(u/i);c.push(h/r)}}for(h=1;h<=i;h++){for(u=1;u<=r;u++){var w=(r+1)*(h-1)+(u-1);var S=(r+1)*h+(u-1);var A=(r+1)*h+u;var C=(r+1)*(h-1)+u;o.push(w,S,C);o.push(S,A,C)}}this.setIndex(o);this.setAttribute("position",new Float32BufferAttribute(s,3));this.setAttribute("normal",new Float32BufferAttribute(l,3));this.setAttribute("uv",new Float32BufferAttribute(c,2));function T(e,t,i,r,n){var a=Math.cos(e);var o=Math.sin(e);var s=i/t*e;var l=Math.cos(s);n.x=r*(2+l)*.5*a;n.y=r*(2+l)*o*.5;n.z=r*Math.sin(s)*.5}}TorusKnotBufferGeometry.prototype=Object.create(BufferGeometry.prototype);TorusKnotBufferGeometry.prototype.constructor=TorusKnotBufferGeometry;function TorusGeometry(e,t,i,r,n){Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n};this.fromBufferGeometry(new TorusBufferGeometry(e,t,i,r,n));this.mergeVertices()}TorusGeometry.prototype=Object.create(Geometry.prototype);TorusGeometry.prototype.constructor=TorusGeometry;function TorusBufferGeometry(e,t,i,r,n){BufferGeometry.call(this);this.type="TorusBufferGeometry";this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n};e=e||1;t=t||.4;i=Math.floor(i)||8;r=Math.floor(r)||6;n=n||Math.PI*2;var a=[];var o=[];var s=[];var l=[];var c=new Vector3;var u=new Vector3;var h=new Vector3;var p,m;for(p=0;p<=i;p++){for(m=0;m<=r;m++){var f=m/r*n;var d=p/i*Math.PI*2;u.x=(e+t*Math.cos(d))*Math.cos(f);u.y=(e+t*Math.cos(d))*Math.sin(f);u.z=t*Math.sin(d);o.push(u.x,u.y,u.z);c.x=e*Math.cos(f);c.y=e*Math.sin(f);h.subVectors(u,c).normalize();s.push(h.x,h.y,h.z);l.push(m/r);l.push(p/i)}}for(p=1;p<=i;p++){for(m=1;m<=r;m++){var _=(r+1)*p+m-1;var y=(r+1)*(p-1)+m-1;var v=(r+1)*(p-1)+m;var g=(r+1)*p+m;a.push(_,y,g);a.push(y,v,g)}}this.setIndex(a);this.setAttribute("position",new Float32BufferAttribute(o,3));this.setAttribute("normal",new Float32BufferAttribute(s,3));this.setAttribute("uv",new Float32BufferAttribute(l,2))}TorusBufferGeometry.prototype=Object.create(BufferGeometry.prototype);TorusBufferGeometry.prototype.constructor=TorusBufferGeometry;var Earcut={triangulate:function(e,t,i){i=i||2;var r=t&&t.length,n=r?t[0]*i:e.length,a=linkedList(e,0,n,i,true),o=[];if(!a||a.next===a.prev)return o;var s,l,c,u,h,p,m;if(r)a=eliminateHoles(e,t,a,i);if(e.length>80*i){s=c=e[0];l=u=e[1];for(var f=i;f<n;f+=i){h=e[f];p=e[f+1];if(h<s)s=h;if(p<l)l=p;if(h>c)c=h;if(p>u)u=p}m=Math.max(c-s,u-l);m=m!==0?1/m:0}earcutLinked(a,o,i,s,l,m);return o}};function linkedList(e,t,i,r,n){var a,o;if(n===signedArea(e,t,i,r)>0){for(a=t;a<i;a+=r)o=insertNode(a,e[a],e[a+1],o)}else{for(a=i-r;a>=t;a-=r)o=insertNode(a,e[a],e[a+1],o)}if(o&&equals(o,o.next)){removeNode(o);o=o.next}return o}function filterPoints(e,t){if(!e)return e;if(!t)t=e;var i=e,r;do{r=false;if(!i.steiner&&(equals(i,i.next)||area(i.prev,i,i.next)===0)){removeNode(i);i=t=i.prev;if(i===i.next)break;r=true}else{i=i.next}}while(r||i!==t);return t}function earcutLinked(e,t,i,r,n,a,o){if(!e)return;if(!o&&a)indexCurve(e,r,n,a);var s=e,l,c;while(e.prev!==e.next){l=e.prev;c=e.next;if(a?isEarHashed(e,r,n,a):isEar(e)){t.push(l.i/i);t.push(e.i/i);t.push(c.i/i);removeNode(e);e=c.next;s=c.next;continue}e=c;if(e===s){if(!o){earcutLinked(filterPoints(e),t,i,r,n,a,1)}else if(o===1){e=cureLocalIntersections(filterPoints(e),t,i);earcutLinked(e,t,i,r,n,a,2)}else if(o===2){splitEarcut(e,t,i,r,n,a)}break}}}function isEar(e){var t=e.prev,i=e,r=e.next;if(area(t,i,r)>=0)return false;var n=e.next.next;while(n!==e.prev){if(pointInTriangle(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return false;n=n.next}return true}function isEarHashed(e,t,i,r){var n=e.prev,a=e,o=e.next;if(area(n,a,o)>=0)return false;var s=n.x<a.x?n.x<o.x?n.x:o.x:a.x<o.x?a.x:o.x,l=n.y<a.y?n.y<o.y?n.y:o.y:a.y<o.y?a.y:o.y,c=n.x>a.x?n.x>o.x?n.x:o.x:a.x>o.x?a.x:o.x,u=n.y>a.y?n.y>o.y?n.y:o.y:a.y>o.y?a.y:o.y;var h=zOrder(s,l,t,i,r),p=zOrder(c,u,t,i,r);var m=e.prevZ,f=e.nextZ;while(m&&m.z>=h&&f&&f.z<=p){if(m!==e.prev&&m!==e.next&&pointInTriangle(n.x,n.y,a.x,a.y,o.x,o.y,m.x,m.y)&&area(m.prev,m,m.next)>=0)return false;m=m.prevZ;if(f!==e.prev&&f!==e.next&&pointInTriangle(n.x,n.y,a.x,a.y,o.x,o.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return false;f=f.nextZ}while(m&&m.z>=h){if(m!==e.prev&&m!==e.next&&pointInTriangle(n.x,n.y,a.x,a.y,o.x,o.y,m.x,m.y)&&area(m.prev,m,m.next)>=0)return false;m=m.prevZ}while(f&&f.z<=p){if(f!==e.prev&&f!==e.next&&pointInTriangle(n.x,n.y,a.x,a.y,o.x,o.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return false;f=f.nextZ}return true}function cureLocalIntersections(e,t,i){var r=e;do{var n=r.prev,a=r.next.next;if(!equals(n,a)&&intersects(n,r,r.next,a)&&locallyInside(n,a)&&locallyInside(a,n)){t.push(n.i/i);t.push(r.i/i);t.push(a.i/i);removeNode(r);removeNode(r.next);r=e=a}r=r.next}while(r!==e);return filterPoints(r)}function splitEarcut(e,t,i,r,n,a){var o=e;do{var s=o.next.next;while(s!==o.prev){if(o.i!==s.i&&isValidDiagonal(o,s)){var l=splitPolygon(o,s);o=filterPoints(o,o.next);l=filterPoints(l,l.next);earcutLinked(o,t,i,r,n,a);earcutLinked(l,t,i,r,n,a);return}s=s.next}o=o.next}while(o!==e)}function eliminateHoles(e,t,i,r){var n=[],a,o,s,l,c;for(a=0,o=t.length;a<o;a++){s=t[a]*r;l=a<o-1?t[a+1]*r:e.length;c=linkedList(e,s,l,r,false);if(c===c.next)c.steiner=true;n.push(getLeftmost(c))}n.sort(compareX);for(a=0;a<n.length;a++){eliminateHole(n[a],i);i=filterPoints(i,i.next)}return i}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){t=findHoleBridge(e,t);if(t){var i=splitPolygon(t,e);filterPoints(t,t.next);filterPoints(i,i.next)}}function findHoleBridge(e,t){var i=t,r=e.x,n=e.y,a=-Infinity,o;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var s=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>a){a=s;if(s===r){if(n===i.y)return i;if(n===i.next.y)return i.next}o=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!o)return null;if(r===a)return o;var l=o,c=o.x,u=o.y,h=Infinity,p;i=o;do{if(r>=i.x&&i.x>=c&&r!==i.x&&pointInTriangle(n<u?r:a,n,c,u,n<u?a:r,n,i.x,i.y)){p=Math.abs(n-i.y)/(r-i.x);if(locallyInside(i,e)&&(p<h||p===h&&(i.x>o.x||i.x===o.x&&sectorContainsSector(o,i)))){o=i;h=p}}i=i.next}while(i!==l);return o}function sectorContainsSector(e,t){return area(e.prev,e,t.prev)<0&&area(t.next,e,e.next)<0}function indexCurve(e,t,i,r){var n=e;do{if(n.z===null)n.z=zOrder(n.x,n.y,t,i,r);n.prevZ=n.prev;n.nextZ=n.next;n=n.next}while(n!==e);n.prevZ.nextZ=null;n.prevZ=null;sortLinked(n)}function sortLinked(e){var t,i,r,n,a,o,s,l,c=1;do{i=e;e=null;a=null;o=0;while(i){o++;r=i;s=0;for(t=0;t<c;t++){s++;r=r.nextZ;if(!r)break}l=c;while(s>0||l>0&&r){if(s!==0&&(l===0||!r||i.z<=r.z)){n=i;i=i.nextZ;s--}else{n=r;r=r.nextZ;l--}if(a)a.nextZ=n;else e=n;n.prevZ=a;a=n}i=r}a.nextZ=null;c*=2}while(o>1);return e}function zOrder(e,t,i,r,n){e=32767*(e-i)*n;t=32767*(t-r)*n;e=(e|e<<8)&16711935;e=(e|e<<4)&252645135;e=(e|e<<2)&858993459;e=(e|e<<1)&1431655765;t=(t|t<<8)&16711935;t=(t|t<<4)&252645135;t=(t|t<<2)&858993459;t=(t|t<<1)&1431655765;return e|t<<1}function getLeftmost(e){var t=e,i=e;do{if(t.x<i.x||t.x===i.x&&t.y<i.y)i=t;t=t.next}while(t!==e);return i}function pointInTriangle(e,t,i,r,n,a,o,s){return(n-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(i-o)*(t-s)>=0&&(i-o)*(a-s)-(n-o)*(r-s)>=0}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon(e,t)&&(locallyInside(e,t)&&locallyInside(t,e)&&middleInside(e,t)&&(area(e.prev,e,t.prev)||area(e,t.prev,t))||equals(e,t)&&area(e.prev,e,e.next)>0&&area(t.prev,t,t.next)>0)}function area(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,i,r){var n=sign(area(e,t,i));var a=sign(area(e,t,r));var o=sign(area(i,r,e));var s=sign(area(i,r,t));if(n!==a&&o!==s)return true;if(n===0&&onSegment(e,i,t))return true;if(a===0&&onSegment(e,r,t))return true;if(o===0&&onSegment(i,e,r))return true;if(s===0&&onSegment(i,t,r))return true;return false}function onSegment(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function sign(e){return e>0?1:e<0?-1:0}function intersectsPolygon(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&intersects(i,i.next,e,t))return true;i=i.next}while(i!==e);return false}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function middleInside(e,t){var i=e,r=false,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{if(i.y>a!==i.next.y>a&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x)r=!r;i=i.next}while(i!==e);return r}function splitPolygon(e,t){var i=new Node(e.i,e.x,e.y),r=new Node(t.i,t.x,t.y),n=e.next,a=t.prev;e.next=t;t.prev=e;i.next=n;n.prev=i;r.next=i;i.prev=r;a.next=r;r.prev=a;return r}function insertNode(e,t,i,r){var n=new Node(e,t,i);if(!r){n.prev=n;n.next=n}else{n.next=r.next;n.prev=r;r.next.prev=n;r.next=n}return n}function removeNode(e){e.next.prev=e.prev;e.prev.next=e.next;if(e.prevZ)e.prevZ.nextZ=e.nextZ;if(e.nextZ)e.nextZ.prevZ=e.prevZ}function Node(e,t,i){this.i=e;this.x=t;this.y=i;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}function signedArea(e,t,i,r){var n=0;for(var a=t,o=i-r;a<i;a+=r){n+=(e[o]-e[a])*(e[a+1]+e[o+1]);o=a}return n}var ShapeUtils={area:function(e){var t=e.length;var i=0;for(var r=t-1,n=0;n<t;r=n++){i+=e[r].x*e[n].y-e[n].x*e[r].y}return i*.5},isClockWise:function(e){return ShapeUtils.area(e)<0},triangulateShape:function(e,t){var i=[];var r=[];var n=[];removeDupEndPts(e);addContour(i,e);var a=e.length;t.forEach(removeDupEndPts);for(var o=0;o<t.length;o++){r.push(a);a+=t[o].length;addContour(i,t[o])}var s=Earcut.triangulate(i,r);for(var o=0;o<s.length;o+=3){n.push(s.slice(o,o+3))}return n}};function removeDupEndPts(e){var t=e.length;if(t>2&&e[t-1].equals(e[0])){e.pop()}}function addContour(e,t){for(var i=0;i<t.length;i++){e.push(t[i].x);e.push(t[i].y)}}function ExtrudeGeometry(e,t){Geometry.call(this);this.type="ExtrudeGeometry";this.parameters={shapes:e,options:t};this.fromBufferGeometry(new ExtrudeBufferGeometry(e,t));this.mergeVertices()}ExtrudeGeometry.prototype=Object.create(Geometry.prototype);ExtrudeGeometry.prototype.constructor=ExtrudeGeometry;ExtrudeGeometry.prototype.toJSON=function(){var e=Geometry.prototype.toJSON.call(this);var t=this.parameters.shapes;var i=this.parameters.options;return toJSON(t,i,e)};function ExtrudeBufferGeometry(e,t){BufferGeometry.call(this);this.type="ExtrudeBufferGeometry";this.parameters={shapes:e,options:t};e=Array.isArray(e)?e:[e];var i=this;var r=[];var n=[];for(var a=0,o=e.length;a<o;a++){var s=e[a];l(s)}this.setAttribute("position",new Float32BufferAttribute(r,3));this.setAttribute("uv",new Float32BufferAttribute(n,2));this.computeVertexNormals();function l(e){var a=[];var o=t.curveSegments!==undefined?t.curveSegments:12;var s=t.steps!==undefined?t.steps:1;var l=t.depth!==undefined?t.depth:100;var c=t.bevelEnabled!==undefined?t.bevelEnabled:true;var u=t.bevelThickness!==undefined?t.bevelThickness:6;var h=t.bevelSize!==undefined?t.bevelSize:u-2;var p=t.bevelOffset!==undefined?t.bevelOffset:0;var m=t.bevelSegments!==undefined?t.bevelSegments:3;var f=t.extrudePath;var d=t.UVGenerator!==undefined?t.UVGenerator:WorldUVGenerator;if(t.amount!==undefined){console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth.");l=t.amount}var _,y=false;var v,g,x,b;if(f){_=f.getSpacedPoints(s);y=true;c=false;v=f.computeFrenetFrames(s,false);g=new Vector3;x=new Vector3;b=new Vector3}if(!c){m=0;u=0;h=0;p=0}var M,w,S;var A=e.extractPoints(o);var C=A.shape;var T=A.holes;var B=!ShapeUtils.isClockWise(C);if(B){C=C.reverse();for(w=0,S=T.length;w<S;w++){M=T[w];if(ShapeUtils.isClockWise(M)){T[w]=M.reverse()}}}var L=ShapeUtils.triangulateShape(C,T);var D=C;for(w=0,S=T.length;w<S;w++){M=T[w];C=C.concat(M)}function E(e,t,i){if(!t)console.error("THREE.ExtrudeGeometry: vec does not exist");return t.clone().multiplyScalar(i).add(e)}var R,P,G,I,V,F=C.length,O,N=L.length;function U(e,t,i){var r,n,a;var o=e.x-t.x,s=e.y-t.y;var l=i.x-e.x,c=i.y-e.y;var u=o*o+s*s;var h=o*c-s*l;if(Math.abs(h)>Number.EPSILON){var p=Math.sqrt(u);var m=Math.sqrt(l*l+c*c);var f=t.x-s/p;var d=t.y+o/p;var _=i.x-c/m;var y=i.y+l/m;var v=((_-f)*c-(y-d)*l)/(o*c-s*l);r=f+o*v-e.x;n=d+s*v-e.y;var g=r*r+n*n;if(g<=2){return new Vector2(r,n)}else{a=Math.sqrt(g/2)}}else{var x=false;if(o>Number.EPSILON){if(l>Number.EPSILON){x=true}}else{if(o<-Number.EPSILON){if(l<-Number.EPSILON){x=true}}else{if(Math.sign(s)===Math.sign(c)){x=true}}}if(x){r=-s;n=o;a=Math.sqrt(u)}else{r=o;n=s;a=Math.sqrt(u/2)}}return new Vector2(r/a,n/a)}var z=[];for(var k=0,H=D.length,j=H-1,W=k+1;k<H;k++,j++,W++){if(j===H)j=0;if(W===H)W=0;z[k]=U(D[k],D[j],D[W])}var J=[],q,X=z.concat();for(w=0,S=T.length;w<S;w++){M=T[w];q=[];for(k=0,H=M.length,j=H-1,W=k+1;k<H;k++,j++,W++){if(j===H)j=0;if(W===H)W=0;q[k]=U(M[k],M[j],M[W])}J.push(q);X=X.concat(q)}for(R=0;R<m;R++){G=R/m;I=u*Math.cos(G*Math.PI/2);P=h*Math.sin(G*Math.PI/2)+p;for(k=0,H=D.length;k<H;k++){V=E(D[k],z[k],P);Q(V.x,V.y,-I)}for(w=0,S=T.length;w<S;w++){M=T[w];q=J[w];for(k=0,H=M.length;k<H;k++){V=E(M[k],q[k],P);Q(V.x,V.y,-I)}}}P=h+p;for(k=0;k<F;k++){V=c?E(C[k],X[k],P):C[k];if(!y){Q(V.x,V.y,0)}else{x.copy(v.normals[0]).multiplyScalar(V.x);g.copy(v.binormals[0]).multiplyScalar(V.y);b.copy(_[0]).add(x).add(g);Q(b.x,b.y,b.z)}}var $;for($=1;$<=s;$++){for(k=0;k<F;k++){V=c?E(C[k],X[k],P):C[k];if(!y){Q(V.x,V.y,l/s*$)}else{x.copy(v.normals[$]).multiplyScalar(V.x);g.copy(v.binormals[$]).multiplyScalar(V.y);b.copy(_[$]).add(x).add(g);Q(b.x,b.y,b.z)}}}for(R=m-1;R>=0;R--){G=R/m;I=u*Math.cos(G*Math.PI/2);P=h*Math.sin(G*Math.PI/2)+p;for(k=0,H=D.length;k<H;k++){V=E(D[k],z[k],P);Q(V.x,V.y,l+I)}for(w=0,S=T.length;w<S;w++){M=T[w];q=J[w];for(k=0,H=M.length;k<H;k++){V=E(M[k],q[k],P);if(!y){Q(V.x,V.y,l+I)}else{Q(V.x,V.y+_[s-1].y,_[s-1].x+I)}}}}Z();Y();function Z(){var e=r.length/3;if(c){var t=0;var n=F*t;for(k=0;k<N;k++){O=L[k];ee(O[2]+n,O[1]+n,O[0]+n)}t=s+m*2;n=F*t;for(k=0;k<N;k++){O=L[k];ee(O[0]+n,O[1]+n,O[2]+n)}}else{for(k=0;k<N;k++){O=L[k];ee(O[2],O[1],O[0])}for(k=0;k<N;k++){O=L[k];ee(O[0]+F*s,O[1]+F*s,O[2]+F*s)}}i.addGroup(e,r.length/3-e,0)}function Y(){var e=r.length/3;var t=0;K(D,t);t+=D.length;for(w=0,S=T.length;w<S;w++){M=T[w];K(M,t);t+=M.length}i.addGroup(e,r.length/3-e,1)}function K(e,t){var i,r;k=e.length;while(--k>=0){i=k;r=k-1;if(r<0)r=e.length-1;var n=0,a=s+m*2;for(n=0;n<a;n++){var o=F*n;var l=F*(n+1);var c=t+i+o,u=t+r+o,h=t+r+l,p=t+i+l;te(c,u,h,p)}}}function Q(e,t,i){a.push(e);a.push(t);a.push(i)}function ee(e,t,n){ie(e);ie(t);ie(n);var a=r.length/3;var o=d.generateTopUV(i,r,a-3,a-2,a-1);re(o[0]);re(o[1]);re(o[2])}function te(e,t,n,a){ie(e);ie(t);ie(a);ie(t);ie(n);ie(a);var o=r.length/3;var s=d.generateSideWallUV(i,r,o-6,o-3,o-2,o-1);re(s[0]);re(s[1]);re(s[3]);re(s[1]);re(s[2]);re(s[3])}function ie(e){r.push(a[e*3+0]);r.push(a[e*3+1]);r.push(a[e*3+2])}function re(e){n.push(e.x);n.push(e.y)}}}ExtrudeBufferGeometry.prototype=Object.create(BufferGeometry.prototype);ExtrudeBufferGeometry.prototype.constructor=ExtrudeBufferGeometry;ExtrudeBufferGeometry.prototype.toJSON=function(){var e=BufferGeometry.prototype.toJSON.call(this);var t=this.parameters.shapes;var i=this.parameters.options;return toJSON(t,i,e)};var WorldUVGenerator={generateTopUV:function(e,t,i,r,n){var a=t[i*3];var o=t[i*3+1];var s=t[r*3];var l=t[r*3+1];var c=t[n*3];var u=t[n*3+1];return[new Vector2(a,o),new Vector2(s,l),new Vector2(c,u)]},generateSideWallUV:function(e,t,i,r,n,a){var o=t[i*3];var s=t[i*3+1];var l=t[i*3+2];var c=t[r*3];var u=t[r*3+1];var h=t[r*3+2];var p=t[n*3];var m=t[n*3+1];var f=t[n*3+2];var d=t[a*3];var _=t[a*3+1];var y=t[a*3+2];if(Math.abs(s-u)<.01){return[new Vector2(o,1-l),new Vector2(c,1-h),new Vector2(p,1-f),new Vector2(d,1-y)]}else{return[new Vector2(s,1-l),new Vector2(u,1-h),new Vector2(m,1-f),new Vector2(_,1-y)]}}};function toJSON(e,t,i){i.shapes=[];if(Array.isArray(e)){for(var r=0,n=e.length;r<n;r++){var a=e[r];i.shapes.push(a.uuid)}}else{i.shapes.push(e.uuid)}if(t.extrudePath!==undefined)i.options.extrudePath=t.extrudePath.toJSON();return i}function TextGeometry(e,t){Geometry.call(this);this.type="TextGeometry";this.parameters={text:e,parameters:t};this.fromBufferGeometry(new TextBufferGeometry(e,t));this.mergeVertices()}TextGeometry.prototype=Object.create(Geometry.prototype);TextGeometry.prototype.constructor=TextGeometry;function TextBufferGeometry(e,t){t=t||{};var i=t.font;if(!(i&&i.isFont)){console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font.");return new Geometry}var r=i.generateShapes(e,t.size);t.depth=t.height!==undefined?t.height:50;if(t.bevelThickness===undefined)t.bevelThickness=10;if(t.bevelSize===undefined)t.bevelSize=8;if(t.bevelEnabled===undefined)t.bevelEnabled=false;ExtrudeBufferGeometry.call(this,r,t);this.type="TextBufferGeometry"}TextBufferGeometry.prototype=Object.create(ExtrudeBufferGeometry.prototype);TextBufferGeometry.prototype.constructor=TextBufferGeometry;function SphereGeometry(e,t,i,r,n,a,o){Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:a,thetaLength:o};this.fromBufferGeometry(new SphereBufferGeometry(e,t,i,r,n,a,o));this.mergeVertices()}SphereGeometry.prototype=Object.create(Geometry.prototype);SphereGeometry.prototype.constructor=SphereGeometry;function SphereBufferGeometry(e,t,i,r,n,a,o){BufferGeometry.call(this);this.type="SphereBufferGeometry";this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:a,thetaLength:o};e=e||1;t=Math.max(3,Math.floor(t)||8);i=Math.max(2,Math.floor(i)||6);r=r!==undefined?r:0;n=n!==undefined?n:Math.PI*2;a=a!==undefined?a:0;o=o!==undefined?o:Math.PI;var s=Math.min(a+o,Math.PI);var l,c;var u=0;var h=[];var p=new Vector3;var m=new Vector3;var f=[];var d=[];var _=[];var y=[];for(c=0;c<=i;c++){var v=[];var g=c/i;var x=0;if(c==0&&a==0){x=.5/t}else if(c==i&&s==Math.PI){x=-.5/t}for(l=0;l<=t;l++){var b=l/t;p.x=-e*Math.cos(r+b*n)*Math.sin(a+g*o);p.y=e*Math.cos(a+g*o);p.z=e*Math.sin(r+b*n)*Math.sin(a+g*o);d.push(p.x,p.y,p.z);m.copy(p).normalize();_.push(m.x,m.y,m.z);y.push(b+x,1-g);v.push(u++)}h.push(v)}for(c=0;c<i;c++){for(l=0;l<t;l++){var M=h[c][l+1];var w=h[c][l];var S=h[c+1][l];var A=h[c+1][l+1];if(c!==0||a>0)f.push(M,w,A);if(c!==i-1||s<Math.PI)f.push(w,S,A)}}this.setIndex(f);this.setAttribute("position",new Float32BufferAttribute(d,3));this.setAttribute("normal",new Float32BufferAttribute(_,3));this.setAttribute("uv",new Float32BufferAttribute(y,2))}SphereBufferGeometry.prototype=Object.create(BufferGeometry.prototype);SphereBufferGeometry.prototype.constructor=SphereBufferGeometry;function RingGeometry(e,t,i,r,n,a){Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:a};this.fromBufferGeometry(new RingBufferGeometry(e,t,i,r,n,a));this.mergeVertices()}RingGeometry.prototype=Object.create(Geometry.prototype);RingGeometry.prototype.constructor=RingGeometry;function RingBufferGeometry(e,t,i,r,n,a){BufferGeometry.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:a};e=e||.5;t=t||1;n=n!==undefined?n:0;a=a!==undefined?a:Math.PI*2;i=i!==undefined?Math.max(3,i):8;r=r!==undefined?Math.max(1,r):1;var o=[];var s=[];var l=[];var c=[];var u;var h=e;var p=(t-e)/r;var m=new Vector3;var f=new Vector2;var d,_;for(d=0;d<=r;d++){for(_=0;_<=i;_++){u=n+_/i*a;m.x=h*Math.cos(u);m.y=h*Math.sin(u);s.push(m.x,m.y,m.z);l.push(0,0,1);f.x=(m.x/t+1)/2;f.y=(m.y/t+1)/2;c.push(f.x,f.y)}h+=p}for(d=0;d<r;d++){var y=d*(i+1);for(_=0;_<i;_++){u=_+y;var v=u;var g=u+i+1;var x=u+i+2;var b=u+1;o.push(v,g,b);o.push(g,x,b)}}this.setIndex(o);this.setAttribute("position",new Float32BufferAttribute(s,3));this.setAttribute("normal",new Float32BufferAttribute(l,3));this.setAttribute("uv",new Float32BufferAttribute(c,2))}RingBufferGeometry.prototype=Object.create(BufferGeometry.prototype);RingBufferGeometry.prototype.constructor=RingBufferGeometry;function LatheGeometry(e,t,i,r){Geometry.call(this);this.type="LatheGeometry";this.parameters={points:e,segments:t,phiStart:i,phiLength:r};this.fromBufferGeometry(new LatheBufferGeometry(e,t,i,r));this.mergeVertices()}LatheGeometry.prototype=Object.create(Geometry.prototype);LatheGeometry.prototype.constructor=LatheGeometry;function LatheBufferGeometry(e,t,i,r){BufferGeometry.call(this);this.type="LatheBufferGeometry";this.parameters={points:e,segments:t,phiStart:i,phiLength:r};t=Math.floor(t)||12;i=i||0;r=r||Math.PI*2;r=MathUtils.clamp(r,0,Math.PI*2);var n=[];var a=[];var o=[];var s;var l=1/t;var c=new Vector3;var u=new Vector2;var h,p;for(h=0;h<=t;h++){var m=i+h*l*r;var f=Math.sin(m);var d=Math.cos(m);for(p=0;p<=e.length-1;p++){c.x=e[p].x*f;c.y=e[p].y;c.z=e[p].x*d;a.push(c.x,c.y,c.z);u.x=h/t;u.y=p/(e.length-1);o.push(u.x,u.y)}}for(h=0;h<t;h++){for(p=0;p<e.length-1;p++){s=p+h*e.length;var _=s;var y=s+e.length;var v=s+e.length+1;var g=s+1;n.push(_,y,g);n.push(y,v,g)}}this.setIndex(n);this.setAttribute("position",new Float32BufferAttribute(a,3));this.setAttribute("uv",new Float32BufferAttribute(o,2));this.computeVertexNormals();if(r===Math.PI*2){var x=this.attributes.normal.array;var b=new Vector3;var M=new Vector3;var w=new Vector3;s=t*e.length*3;for(h=0,p=0;h<e.length;h++,p+=3){b.x=x[p+0];b.y=x[p+1];b.z=x[p+2];M.x=x[s+p+0];M.y=x[s+p+1];M.z=x[s+p+2];w.addVectors(b,M).normalize();x[p+0]=x[s+p+0]=w.x;x[p+1]=x[s+p+1]=w.y;x[p+2]=x[s+p+2]=w.z}}}LatheBufferGeometry.prototype=Object.create(BufferGeometry.prototype);LatheBufferGeometry.prototype.constructor=LatheBufferGeometry;function ShapeGeometry(e,t){Geometry.call(this);this.type="ShapeGeometry";if(typeof t==="object"){console.warn("THREE.ShapeGeometry: Options parameter has been removed.");t=t.curveSegments}this.parameters={shapes:e,curveSegments:t};this.fromBufferGeometry(new ShapeBufferGeometry(e,t));this.mergeVertices()}ShapeGeometry.prototype=Object.create(Geometry.prototype);ShapeGeometry.prototype.constructor=ShapeGeometry;ShapeGeometry.prototype.toJSON=function(){var e=Geometry.prototype.toJSON.call(this);var t=this.parameters.shapes;return toJSON$1(t,e)};function ShapeBufferGeometry(e,t){BufferGeometry.call(this);this.type="ShapeBufferGeometry";this.parameters={shapes:e,curveSegments:t};t=t||12;var i=[];var r=[];var n=[];var a=[];var o=0;var s=0;if(Array.isArray(e)===false){c(e)}else{for(var l=0;l<e.length;l++){c(e[l]);this.addGroup(o,s,l);o+=s;s=0}}this.setIndex(i);this.setAttribute("position",new Float32BufferAttribute(r,3));this.setAttribute("normal",new Float32BufferAttribute(n,3));this.setAttribute("uv",new Float32BufferAttribute(a,2));function c(e){var o,l,c;var u=r.length/3;var h=e.extractPoints(t);var p=h.shape;var m=h.holes;if(ShapeUtils.isClockWise(p)===false){p=p.reverse()}for(o=0,l=m.length;o<l;o++){c=m[o];if(ShapeUtils.isClockWise(c)===true){m[o]=c.reverse()}}var f=ShapeUtils.triangulateShape(p,m);for(o=0,l=m.length;o<l;o++){c=m[o];p=p.concat(c)}for(o=0,l=p.length;o<l;o++){var d=p[o];r.push(d.x,d.y,0);n.push(0,0,1);a.push(d.x,d.y)}for(o=0,l=f.length;o<l;o++){var _=f[o];var y=_[0]+u;var v=_[1]+u;var g=_[2]+u;i.push(y,v,g);s+=3}}}ShapeBufferGeometry.prototype=Object.create(BufferGeometry.prototype);ShapeBufferGeometry.prototype.constructor=ShapeBufferGeometry;ShapeBufferGeometry.prototype.toJSON=function(){var e=BufferGeometry.prototype.toJSON.call(this);var t=this.parameters.shapes;return toJSON$1(t,e)};function toJSON$1(e,t){t.shapes=[];if(Array.isArray(e)){for(var i=0,r=e.length;i<r;i++){var n=e[i];t.shapes.push(n.uuid)}}else{t.shapes.push(e.uuid)}return t}function EdgesGeometry(e,t){BufferGeometry.call(this);this.type="EdgesGeometry";this.parameters={thresholdAngle:t};t=t!==undefined?t:1;var i=[];var r=Math.cos(MathUtils.DEG2RAD*t);var n=[0,0],a={},o,s;var l,c=["a","b","c"];var u;if(e.isBufferGeometry){u=new Geometry;u.fromBufferGeometry(e)}else{u=e.clone()}u.mergeVertices();u.computeFaceNormals();var h=u.vertices;var p=u.faces;for(var m=0,f=p.length;m<f;m++){var d=p[m];for(var _=0;_<3;_++){o=d[c[_]];s=d[c[(_+1)%3]];n[0]=Math.min(o,s);n[1]=Math.max(o,s);l=n[0]+","+n[1];if(a[l]===undefined){a[l]={index1:n[0],index2:n[1],face1:m,face2:undefined}}else{a[l].face2=m}}}for(l in a){var y=a[l];if(y.face2===undefined||p[y.face1].normal.dot(p[y.face2].normal)<=r){var v=h[y.index1];i.push(v.x,v.y,v.z);v=h[y.index2];i.push(v.x,v.y,v.z)}}this.setAttribute("position",new Float32BufferAttribute(i,3))}EdgesGeometry.prototype=Object.create(BufferGeometry.prototype);EdgesGeometry.prototype.constructor=EdgesGeometry;function CylinderGeometry(e,t,i,r,n,a,o,s){Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s};this.fromBufferGeometry(new CylinderBufferGeometry(e,t,i,r,n,a,o,s));this.mergeVertices()}CylinderGeometry.prototype=Object.create(Geometry.prototype);CylinderGeometry.prototype.constructor=CylinderGeometry;function CylinderBufferGeometry(e,t,i,r,n,a,o,s){BufferGeometry.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s};var l=this;e=e!==undefined?e:1;t=t!==undefined?t:1;i=i||1;r=Math.floor(r)||8;n=Math.floor(n)||1;a=a!==undefined?a:false;o=o!==undefined?o:0;s=s!==undefined?s:Math.PI*2;var c=[];var u=[];var h=[];var p=[];var m=0;var f=[];var d=i/2;var _=0;y();if(a===false){if(e>0)v(true);if(t>0)v(false)}this.setIndex(c);this.setAttribute("position",new Float32BufferAttribute(u,3));this.setAttribute("normal",new Float32BufferAttribute(h,3));this.setAttribute("uv",new Float32BufferAttribute(p,2));function y(){var a,y;var v=new Vector3;var g=new Vector3;var x=0;var b=(t-e)/i;for(y=0;y<=n;y++){var M=[];var w=y/n;var S=w*(t-e)+e;for(a=0;a<=r;a++){var A=a/r;var C=A*s+o;var T=Math.sin(C);var B=Math.cos(C);g.x=S*T;g.y=-w*i+d;g.z=S*B;u.push(g.x,g.y,g.z);v.set(T,b,B).normalize();h.push(v.x,v.y,v.z);p.push(A,1-w);M.push(m++)}f.push(M)}for(a=0;a<r;a++){for(y=0;y<n;y++){var L=f[y][a];var D=f[y+1][a];var E=f[y+1][a+1];var R=f[y][a+1];c.push(L,D,R);c.push(D,E,R);x+=6}}l.addGroup(_,x,0);_+=x}function v(i){var n,a,f;var y=new Vector2;var v=new Vector3;var g=0;var x=i===true?e:t;var b=i===true?1:-1;a=m;for(n=1;n<=r;n++){u.push(0,d*b,0);h.push(0,b,0);p.push(.5,.5);m++}f=m;for(n=0;n<=r;n++){var M=n/r;var w=M*s+o;var S=Math.cos(w);var A=Math.sin(w);v.x=x*A;v.y=d*b;v.z=x*S;u.push(v.x,v.y,v.z);h.push(0,b,0);y.x=S*.5+.5;y.y=A*.5*b+.5;p.push(y.x,y.y);m++}for(n=0;n<r;n++){var C=a+n;var T=f+n;if(i===true){c.push(T,T+1,C)}else{c.push(T+1,T,C)}g+=3}l.addGroup(_,g,i===true?1:2);_+=g}}CylinderBufferGeometry.prototype=Object.create(BufferGeometry.prototype);CylinderBufferGeometry.prototype.constructor=CylinderBufferGeometry;function ConeGeometry(e,t,i,r,n,a,o){CylinderGeometry.call(this,0,e,t,i,r,n,a,o);this.type="ConeGeometry";this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:a,thetaLength:o}}ConeGeometry.prototype=Object.create(CylinderGeometry.prototype);ConeGeometry.prototype.constructor=ConeGeometry;function ConeBufferGeometry(e,t,i,r,n,a,o){CylinderBufferGeometry.call(this,0,e,t,i,r,n,a,o);this.type="ConeBufferGeometry";this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:a,thetaLength:o}}ConeBufferGeometry.prototype=Object.create(CylinderBufferGeometry.prototype);ConeBufferGeometry.prototype.constructor=ConeBufferGeometry;function CircleGeometry(e,t,i,r){Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r};this.fromBufferGeometry(new CircleBufferGeometry(e,t,i,r));this.mergeVertices()}CircleGeometry.prototype=Object.create(Geometry.prototype);CircleGeometry.prototype.constructor=CircleGeometry;function CircleBufferGeometry(e,t,i,r){BufferGeometry.call(this);this.type="CircleBufferGeometry";this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r};e=e||1;t=t!==undefined?Math.max(3,t):8;i=i!==undefined?i:0;r=r!==undefined?r:Math.PI*2;var n=[];var a=[];var o=[];var s=[];var l,c;var u=new Vector3;var h=new Vector2;a.push(0,0,0);o.push(0,0,1);s.push(.5,.5);for(c=0,l=3;c<=t;c++,l+=3){var p=i+c/t*r;u.x=e*Math.cos(p);u.y=e*Math.sin(p);a.push(u.x,u.y,u.z);o.push(0,0,1);h.x=(a[l]/e+1)/2;h.y=(a[l+1]/e+1)/2;s.push(h.x,h.y)}for(l=1;l<=t;l++){n.push(l,l+1,0)}this.setIndex(n);this.setAttribute("position",new Float32BufferAttribute(a,3));this.setAttribute("normal",new Float32BufferAttribute(o,3));this.setAttribute("uv",new Float32BufferAttribute(s,2))}CircleBufferGeometry.prototype=Object.create(BufferGeometry.prototype);CircleBufferGeometry.prototype.constructor=CircleBufferGeometry;var Geometries=Object.freeze({__proto__:null,WireframeGeometry:WireframeGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextBufferGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereBufferGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneBufferGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeBufferGeometry,EdgesGeometry:EdgesGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleBufferGeometry,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxBufferGeometry});function ShadowMaterial(e){Material.call(this);this.type="ShadowMaterial";this.color=new Color(0);this.transparent=true;this.setValues(e)}ShadowMaterial.prototype=Object.create(Material.prototype);ShadowMaterial.prototype.constructor=ShadowMaterial;ShadowMaterial.prototype.isShadowMaterial=true;ShadowMaterial.prototype.copy=function(e){Material.prototype.copy.call(this,e);this.color.copy(e.color);return this};function RawShaderMaterial(e){ShaderMaterial.call(this,e);this.type="RawShaderMaterial"}RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype);RawShaderMaterial.prototype.constructor=RawShaderMaterial;RawShaderMaterial.prototype.isRawShaderMaterial=true;function MeshStandardMaterial(e){Material.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new Color(16777215);this.roughness=1;this.metalness=0;this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Color(0);this.emissiveIntensity=1;this.emissiveMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=TangentSpaceNormalMap;this.normalScale=new Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.roughnessMap=null;this.metalnessMap=null;this.alphaMap=null;this.envMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.vertexTangents=false;this.setValues(e)}MeshStandardMaterial.prototype=Object.create(Material.prototype);MeshStandardMaterial.prototype.constructor=MeshStandardMaterial;MeshStandardMaterial.prototype.isMeshStandardMaterial=true;MeshStandardMaterial.prototype.copy=function(e){Material.prototype.copy.call(this,e);this.defines={STANDARD:""};this.color.copy(e.color);this.roughness=e.roughness;this.metalness=e.metalness;this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.roughnessMap=e.roughnessMap;this.metalnessMap=e.metalnessMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.envMapIntensity=e.envMapIntensity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;this.vertexTangents=e.vertexTangents;return this};function MeshPhysicalMaterial(e){MeshStandardMaterial.call(this);this.defines={STANDARD:"",PHYSICAL:""};this.type="MeshPhysicalMaterial";this.clearcoat=0;this.clearcoatMap=null;this.clearcoatRoughness=0;this.clearcoatRoughnessMap=null;this.clearcoatNormalScale=new Vector2(1,1);this.clearcoatNormalMap=null;this.reflectivity=.5;this.sheen=null;this.transparency=0;this.setValues(e)}MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype);MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial;MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=true;MeshPhysicalMaterial.prototype.copy=function(e){MeshStandardMaterial.prototype.copy.call(this,e);this.defines={STANDARD:"",PHYSICAL:""};this.clearcoat=e.clearcoat;this.clearcoatMap=e.clearcoatMap;this.clearcoatRoughness=e.clearcoatRoughness;this.clearcoatRoughnessMap=e.clearcoatRoughnessMap;this.clearcoatNormalMap=e.clearcoatNormalMap;this.clearcoatNormalScale.copy(e.clearcoatNormalScale);this.reflectivity=e.reflectivity;if(e.sheen){this.sheen=(this.sheen||new Color).copy(e.sheen)}else{this.sheen=null}this.transparency=e.transparency;return this};function MeshPhongMaterial(e){Material.call(this);this.type="MeshPhongMaterial";this.color=new Color(16777215);this.specular=new Color(1118481);this.shininess=30;this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Color(0);this.emissiveIntensity=1;this.emissiveMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=TangentSpaceNormalMap;this.normalScale=new Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)}MeshPhongMaterial.prototype=Object.create(Material.prototype);MeshPhongMaterial.prototype.constructor=MeshPhongMaterial;MeshPhongMaterial.prototype.isMeshPhongMaterial=true;MeshPhongMaterial.prototype.copy=function(e){Material.prototype.copy.call(this,e);this.color.copy(e.color);this.specular.copy(e.specular);this.shininess=e.shininess;this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};function MeshToonMaterial(e){Material.call(this);this.defines={TOON:""};this.type="MeshToonMaterial";this.color=new Color(16777215);this.specular=new Color(1118481);this.shininess=30;this.map=null;this.gradientMap=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Color(0);this.emissiveIntensity=1;this.emissiveMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=TangentSpaceNormalMap;this.normalScale=new Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.specularMap=null;this.alphaMap=null;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)}MeshToonMaterial.prototype=Object.create(Material.prototype);MeshToonMaterial.prototype.constructor=MeshToonMaterial;MeshToonMaterial.prototype.isMeshToonMaterial=true;MeshToonMaterial.prototype.copy=function(e){Material.prototype.copy.call(this,e);this.color.copy(e.color);this.specular.copy(e.specular);this.shininess=e.shininess;this.map=e.map;this.gradientMap=e.gradientMap;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};function MeshNormalMaterial(e){Material.call(this);this.type="MeshNormalMaterial";this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=TangentSpaceNormalMap;this.normalScale=new Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)}MeshNormalMaterial.prototype=Object.create(Material.prototype);MeshNormalMaterial.prototype.constructor=MeshNormalMaterial;MeshNormalMaterial.prototype.isMeshNormalMaterial=true;MeshNormalMaterial.prototype.copy=function(e){Material.prototype.copy.call(this,e);this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};function MeshLambertMaterial(e){Material.call(this);this.type="MeshLambertMaterial";this.color=new Color(16777215);this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Color(0);this.emissiveIntensity=1;this.emissiveMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)}MeshLambertMaterial.prototype=Object.create(Material.prototype);MeshLambertMaterial.prototype.constructor=MeshLambertMaterial;MeshLambertMaterial.prototype.isMeshLambertMaterial=true;MeshLambertMaterial.prototype.copy=function(e){Material.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};function MeshMatcapMaterial(e){Material.call(this);this.defines={MATCAP:""};this.type="MeshMatcapMaterial";this.color=new Color(16777215);this.matcap=null;this.map=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=TangentSpaceNormalMap;this.normalScale=new Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.alphaMap=null;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)}MeshMatcapMaterial.prototype=Object.create(Material.prototype);MeshMatcapMaterial.prototype.constructor=MeshMatcapMaterial;MeshMatcapMaterial.prototype.isMeshMatcapMaterial=true;MeshMatcapMaterial.prototype.copy=function(e){Material.prototype.copy.call(this,e);this.defines={MATCAP:""};this.color.copy(e.color);this.matcap=e.matcap;this.map=e.map;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.alphaMap=e.alphaMap;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};function LineDashedMaterial(e){LineBasicMaterial.call(this);this.type="LineDashedMaterial";this.scale=1;this.dashSize=3;this.gapSize=1;this.setValues(e)}LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype);LineDashedMaterial.prototype.constructor=LineDashedMaterial;LineDashedMaterial.prototype.isLineDashedMaterial=true;LineDashedMaterial.prototype.copy=function(e){LineBasicMaterial.prototype.copy.call(this,e);this.scale=e.scale;this.dashSize=e.dashSize;this.gapSize=e.gapSize;return this};var Materials=Object.freeze({__proto__:null,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material});var AnimationUtils={arraySlice:function(e,t,i){if(AnimationUtils.isTypedArray(e)){return new e.constructor(e.subarray(t,i!==undefined?i:e.length))}return e.slice(t,i)},convertArray:function(e,t,i){if(!e||!i&&e.constructor===t)return e;if(typeof t.BYTES_PER_ELEMENT==="number"){return new t(e)}return Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(t,i){return e[t]-e[i]}var i=e.length;var r=new Array(i);for(var n=0;n!==i;++n)r[n]=n;r.sort(t);return r},sortedArray:function(e,t,i){var r=e.length;var n=new e.constructor(r);for(var a=0,o=0;o!==r;++a){var s=i[a]*t;for(var l=0;l!==t;++l){n[o++]=e[s+l]}}return n},flattenJSON:function(e,t,i,r){var n=1,a=e[0];while(a!==undefined&&a[r]===undefined){a=e[n++]}if(a===undefined)return;var o=a[r];if(o===undefined)return;if(Array.isArray(o)){do{o=a[r];if(o!==undefined){t.push(a.time);i.push.apply(i,o)}a=e[n++]}while(a!==undefined)}else if(o.toArray!==undefined){do{o=a[r];if(o!==undefined){t.push(a.time);o.toArray(i,i.length)}a=e[n++]}while(a!==undefined)}else{do{o=a[r];if(o!==undefined){t.push(a.time);i.push(o)}a=e[n++]}while(a!==undefined)}},subclip:function(e,t,i,r,n){n=n||30;var a=e.clone();a.name=t;var o=[];for(var s=0;s<a.tracks.length;++s){var l=a.tracks[s];var c=l.getValueSize();var u=[];var h=[];for(var p=0;p<l.times.length;++p){var m=l.times[p]*n;if(m<i||m>=r)continue;u.push(l.times[p]);for(var f=0;f<c;++f){h.push(l.values[p*c+f])}}if(u.length===0)continue;l.times=AnimationUtils.convertArray(u,l.times.constructor);l.values=AnimationUtils.convertArray(h,l.values.constructor);o.push(l)}a.tracks=o;var d=Infinity;for(var s=0;s<a.tracks.length;++s){if(d>a.tracks[s].times[0]){d=a.tracks[s].times[0]}}for(var s=0;s<a.tracks.length;++s){a.tracks[s].shift(-1*d)}a.resetDuration();return a},makeClipAdditive:function(e,t,i,r){if(t===undefined)t=0;if(i===undefined)i=e;if(r===undefined||r<=0)r=30;var n=e.tracks.length;var a=t/r;for(var o=0;o<n;++o){var s=i.tracks[o];var l=s.ValueTypeName;if(l==="bool"||l==="string")continue;var c=e.tracks.find((function(e){return e.name===s.name&&e.ValueTypeName===l}));if(c===undefined)continue;var u=s.getValueSize();var h=s.times.length-1;var p;if(a<=s.times[0]){p=AnimationUtils.arraySlice(s.values,0,s.valueSize)}else if(a>=s.times[h]){var m=h*u;p=AnimationUtils.arraySlice(s.values,m)}else{var f=s.createInterpolant();f.evaluate(a);p=f.resultBuffer}if(l==="quaternion"){var d=new Quaternion(p[0],p[1],p[2],p[3]).normalize().conjugate();d.toArray(p)}var _=c.times.length;for(var y=0;y<_;++y){var v=y*u;if(l==="quaternion"){Quaternion.multiplyQuaternionsFlat(c.values,v,p,0,c.values,v)}else{for(var g=0;g<u;++g){c.values[v+g]-=p[g]}}}}e.blendMode=AdditiveAnimationBlendMode;return e}};function Interpolant(e,t,i,r){this.parameterPositions=e;this._cachedIndex=0;this.resultBuffer=r!==undefined?r:new t.constructor(i);this.sampleValues=t;this.valueSize=i}Object.assign(Interpolant.prototype,{evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{var a;i:{r:if(!(e<r)){for(var o=i+2;;){if(r===undefined){if(e<n)break r;i=t.length;this._cachedIndex=i;return this.afterEnd_(i-1,e,n)}if(i===o)break;n=r;r=t[++i];if(e<r){break t}}a=t.length;break i}if(!(e>=n)){var s=t[1];if(e<s){i=2;n=s}for(var o=i-2;;){if(n===undefined){this._cachedIndex=0;return this.beforeStart_(0,e,r)}if(i===o)break;r=n;n=t[--i-1];if(e>=n){break t}}a=i;i=0;break i}break e}while(i<a){var l=i+a>>>1;if(e<t[l]){a=l}else{i=l+1}}r=t[i];n=t[i-1];if(n===undefined){this._cachedIndex=0;return this.beforeStart_(0,e,r)}if(r===undefined){i=t.length;this._cachedIndex=i;return this.afterEnd_(i-1,n,e)}}this._cachedIndex=i;this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r;for(var a=0;a!==r;++a){t[a]=i[n+a]}return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}});Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_});function CubicInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r);this._weightPrev=-0;this._offsetPrev=-0;this._weightNext=-0;this._offsetNext=-0}CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},intervalChanged_:function(e,t,i){var r=this.parameterPositions,n=e-2,a=e+1,o=r[n],s=r[a];if(o===undefined){switch(this.getSettings_().endingStart){case ZeroSlopeEnding:n=e;o=2*t-i;break;case WrapAroundEnding:n=r.length-2;o=t+r[n]-r[n+1];break;default:n=e;o=i}}if(s===undefined){switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:a=e;s=2*i-t;break;case WrapAroundEnding:a=1;s=i+r[1]-r[0];break;default:a=e-1;s=t}}var l=(i-t)*.5,c=this.valueSize;this._weightPrev=l/(t-o);this._weightNext=l/(s-i);this._offsetPrev=n*c;this._offsetNext=a*c},interpolate_:function(e,t,i,r){var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,p=this._weightNext,m=(i-t)/(r-t),f=m*m,d=f*m;var _=-h*d+2*h*f-h*m;var y=(1+h)*d+(-1.5-2*h)*f+(-.5+h)*m+1;var v=(-1-p)*d+(1.5+p)*f+.5*m;var g=p*d-p*f;for(var x=0;x!==o;++x){n[x]=_*a[c+x]+y*a[l+x]+v*a[s+x]+g*a[u+x]}return n}});function LinearInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(e,t,i,r){var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(i-t)/(r-t),u=1-c;for(var h=0;h!==o;++h){n[h]=a[l+h]*u+a[s+h]*c}return n}});function DiscreteInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(e){return this.copySampleValue_(e-1)}});function KeyframeTrack(e,t,i,r){if(e===undefined)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===undefined||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e;this.times=AnimationUtils.convertArray(t,this.TimeBufferType);this.values=AnimationUtils.convertArray(i,this.ValueBufferType);this.setInterpolation(r||this.DefaultInterpolation)}Object.assign(KeyframeTrack,{toJSON:function(e){var t=e.constructor;var i;if(t.toJSON!==undefined){i=t.toJSON(e)}else{i={name:e.name,times:AnimationUtils.convertArray(e.times,Array),values:AnimationUtils.convertArray(e.values,Array)};var r=e.getInterpolation();if(r!==e.DefaultInterpolation){i.interpolation=r}}i.type=e.ValueTypeName;return i}});Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodDiscrete:function(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth;break}if(t===undefined){var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===undefined){if(e!==this.DefaultInterpolation){this.setInterpolation(this.DefaultInterpolation)}else{throw new Error(i)}}console.warn("THREE.KeyframeTrack:",i);return this}this.createInterpolant=t;return this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(e!==0){var t=this.times;for(var i=0,r=t.length;i!==r;++i){t[i]+=e}}return this},scale:function(e){if(e!==1){var t=this.times;for(var i=0,r=t.length;i!==r;++i){t[i]*=e}}return this},trim:function(e,t){var i=this.times,r=i.length,n=0,a=r-1;while(n!==r&&i[n]<e){++n}while(a!==-1&&i[a]>t){--a}++a;if(n!==0||a!==r){if(n>=a){a=Math.max(a,1);n=a-1}var o=this.getValueSize();this.times=AnimationUtils.arraySlice(i,n,a);this.values=AnimationUtils.arraySlice(this.values,n*o,a*o)}return this},validate:function(){var e=true;var t=this.getValueSize();if(t-Math.floor(t)!==0){console.error("THREE.KeyframeTrack: Invalid value size in track.",this);e=false}var i=this.times,r=this.values,n=i.length;if(n===0){console.error("THREE.KeyframeTrack: Track is empty.",this);e=false}var a=null;for(var o=0;o!==n;o++){var s=i[o];if(typeof s==="number"&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s);e=false;break}if(a!==null&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a);e=false;break}a=s}if(r!==undefined){if(AnimationUtils.isTypedArray(r)){for(var o=0,l=r.length;o!==l;++o){var c=r[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c);e=false;break}}}}return e},optimize:function(){var e=AnimationUtils.arraySlice(this.times),t=AnimationUtils.arraySlice(this.values),i=this.getValueSize(),r=this.getInterpolation()===InterpolateSmooth,n=1,a=e.length-1;for(var o=1;o<a;++o){var s=false;var l=e[o];var c=e[o+1];if(l!==c&&(o!==1||l!==l[0])){if(!r){var u=o*i,h=u-i,p=u+i;for(var m=0;m!==i;++m){var f=t[u+m];if(f!==t[h+m]||f!==t[p+m]){s=true;break}}}else{s=true}}if(s){if(o!==n){e[n]=e[o];var d=o*i,_=n*i;for(var m=0;m!==i;++m){t[_+m]=t[d+m]}}++n}}if(a>0){e[n]=e[a];for(var d=a*i,_=n*i,m=0;m!==i;++m){t[_+m]=t[d+m]}++n}if(n!==e.length){this.times=AnimationUtils.arraySlice(e,0,n);this.values=AnimationUtils.arraySlice(t,0,n*i)}else{this.times=e;this.values=t}return this},clone:function(){var e=AnimationUtils.arraySlice(this.times,0);var t=AnimationUtils.arraySlice(this.values,0);var i=this.constructor;var r=new i(this.name,e,t);r.createInterpolant=this.createInterpolant;return r}});function BooleanKeyframeTrack(e,t,i){KeyframeTrack.call(this,e,t,i)}BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:undefined,InterpolantFactoryMethodSmooth:undefined});function ColorKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"});function NumberKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"});function QuaternionLinearInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(e,t,i,r){var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=(i-t)/(r-t);for(var c=s+o;s!==c;s+=4){Quaternion.slerpFlat(n,0,a,s-o,a,s,l)}return n}});function QuaternionKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodLinear:function(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:undefined});function StringKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:undefined,InterpolantFactoryMethodSmooth:undefined});function VectorKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"});function AnimationClip(e,t,i,r){this.name=e;this.tracks=i;this.duration=t!==undefined?t:-1;this.blendMode=r!==undefined?r:NormalAnimationBlendMode;this.uuid=MathUtils.generateUUID();if(this.duration<0){this.resetDuration()}}function getTrackTypeForValueTypeName(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function parseKeyframeTrack(e){if(e.type===undefined){throw new Error("THREE.KeyframeTrack: track type undefined, can not parse")}var t=getTrackTypeForValueTypeName(e.type);if(e.times===undefined){var i=[],r=[];AnimationUtils.flattenJSON(e.keys,i,r,"value");e.times=i;e.values=r}if(t.parse!==undefined){return t.parse(e)}else{return new t(e.name,e.times,e.values,e.interpolation)}}Object.assign(AnimationClip,{parse:function(e){var t=[],i=e.tracks,r=1/(e.fps||1);for(var n=0,a=i.length;n!==a;++n){t.push(parseKeyframeTrack(i[n]).scale(r))}return new AnimationClip(e.name,e.duration,t,e.blendMode)},toJSON:function(e){var t=[],i=e.tracks;var r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(var n=0,a=i.length;n!==a;++n){t.push(KeyframeTrack.toJSON(i[n]))}return r},CreateFromMorphTargetSequence:function(e,t,i,r){var n=t.length;var a=[];for(var o=0;o<n;o++){var s=[];var l=[];s.push((o+n-1)%n,o,(o+1)%n);l.push(0,1,0);var c=AnimationUtils.getKeyframeOrder(s);s=AnimationUtils.sortedArray(s,1,c);l=AnimationUtils.sortedArray(l,1,c);if(!r&&s[0]===0){s.push(n);l.push(l[0])}a.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/i))}return new AnimationClip(e,-1,a)},findByName:function(e,t){var i=e;if(!Array.isArray(e)){var r=e;i=r.geometry&&r.geometry.animations||r.animations}for(var n=0;n<i.length;n++){if(i[n].name===t){return i[n]}}return null},CreateClipsFromMorphTargetSequences:function(e,t,i){var r={};var n=/^([\w-]*?)([\d]+)$/;for(var a=0,o=e.length;a<o;a++){var s=e[a];var l=s.name.match(n);if(l&&l.length>1){var c=l[1];var u=r[c];if(!u){r[c]=u=[]}u.push(s)}}var h=[];for(var c in r){h.push(AnimationClip.CreateFromMorphTargetSequence(c,r[c],t,i))}return h},parseAnimation:function(e,t){if(!e){console.error("THREE.AnimationClip: No animation in JSONLoader data.");return null}var i=function(e,t,i,r,n){if(i.length!==0){var a=[];var o=[];AnimationUtils.flattenJSON(i,a,o,r);if(a.length!==0){n.push(new e(t,a,o))}}};var r=[];var n=e.name||"default";var a=e.length||-1;var o=e.fps||30;var s=e.blendMode;var l=e.hierarchy||[];for(var c=0;c<l.length;c++){var u=l[c].keys;if(!u||u.length===0)continue;if(u[0].morphTargets){var h={};for(var p=0;p<u.length;p++){if(u[p].morphTargets){for(var m=0;m<u[p].morphTargets.length;m++){h[u[p].morphTargets[m]]=-1}}}for(var f in h){var d=[];var _=[];for(var m=0;m!==u[p].morphTargets.length;++m){var y=u[p];d.push(y.time);_.push(y.morphTarget===f?1:0)}r.push(new NumberKeyframeTrack(".morphTargetInfluence["+f+"]",d,_))}a=h.length*(o||1)}else{var v=".bones["+t[c].name+"]";i(VectorKeyframeTrack,v+".position",u,"pos",r);i(QuaternionKeyframeTrack,v+".quaternion",u,"rot",r);i(VectorKeyframeTrack,v+".scale",u,"scl",r)}}if(r.length===0){return null}var g=new AnimationClip(n,a,r,s);return g}});Object.assign(AnimationClip.prototype,{resetDuration:function(){var e=this.tracks,t=0;for(var i=0,r=e.length;i!==r;++i){var n=this.tracks[i];t=Math.max(t,n.times[n.times.length-1])}this.duration=t;return this},trim:function(){for(var e=0;e<this.tracks.length;e++){this.tracks[e].trim(0,this.duration)}return this},validate:function(){var e=true;for(var t=0;t<this.tracks.length;t++){e=e&&this.tracks[t].validate()}return e},optimize:function(){for(var e=0;e<this.tracks.length;e++){this.tracks[e].optimize()}return this},clone:function(){var e=[];for(var t=0;t<this.tracks.length;t++){e.push(this.tracks[t].clone())}return new AnimationClip(this.name,this.duration,e,this.blendMode)}});var Cache={enabled:false,files:{},add:function(e,t){if(this.enabled===false)return;this.files[e]=t},get:function(e){if(this.enabled===false)return;return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function LoadingManager(e,t,i){var r=this;var n=false;var a=0;var o=0;var s=undefined;var l=[];this.onStart=undefined;this.onLoad=e;this.onProgress=t;this.onError=i;this.itemStart=function(e){o++;if(n===false){if(r.onStart!==undefined){r.onStart(e,a,o)}}n=true};this.itemEnd=function(e){a++;if(r.onProgress!==undefined){r.onProgress(e,a,o)}if(a===o){n=false;if(r.onLoad!==undefined){r.onLoad()}}};this.itemError=function(e){if(r.onError!==undefined){r.onError(e)}};this.resolveURL=function(e){if(s){return s(e)}return e};this.setURLModifier=function(e){s=e;return this};this.addHandler=function(e,t){l.push(e,t);return this};this.removeHandler=function(e){var t=l.indexOf(e);if(t!==-1){l.splice(t,2)}return this};this.getHandler=function(e){for(var t=0,i=l.length;t<i;t+=2){var r=l[t];var n=l[t+1];if(r.global)r.lastIndex=0;if(r.test(e)){return n}}return null}}var DefaultLoadingManager=new LoadingManager;function Loader(e){this.manager=e!==undefined?e:DefaultLoadingManager;this.crossOrigin="anonymous";this.path="";this.resourcePath=""}Object.assign(Loader.prototype,{load:function(){},loadAsync:function(e,t){var i=this;return new Promise((function(r,n){i.load(e,r,t,n)}))},parse:function(){},setCrossOrigin:function(e){this.crossOrigin=e;return this},setPath:function(e){this.path=e;return this},setResourcePath:function(e){this.resourcePath=e;return this}});var loading={};function FileLoader(e){Loader.call(this,e)}FileLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FileLoader,load:function(e,t,i,r){if(e===undefined)e="";if(this.path!==undefined)e=this.path+e;e=this.manager.resolveURL(e);var n=this;var a=Cache.get(e);if(a!==undefined){n.manager.itemStart(e);setTimeout((function(){if(t)t(a);n.manager.itemEnd(e)}),0);return a}if(loading[e]!==undefined){loading[e].push({onLoad:t,onProgress:i,onError:r});return}var o=/^data:(.*?)(;base64)?,(.*)$/;var s=e.match(o);if(s){var l=s[1];var c=!!s[2];var u=s[3];u=decodeURIComponent(u);if(c)u=atob(u);try{var h;var p=(this.responseType||"").toLowerCase();switch(p){case"arraybuffer":case"blob":var m=new Uint8Array(u.length);for(var f=0;f<u.length;f++){m[f]=u.charCodeAt(f)}if(p==="blob"){h=new Blob([m.buffer],{type:l})}else{h=m.buffer}break;case"document":var d=new DOMParser;h=d.parseFromString(u,l);break;case"json":h=JSON.parse(u);break;default:h=u;break}setTimeout((function(){if(t)t(h);n.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){if(r)r(t);n.manager.itemError(e);n.manager.itemEnd(e)}),0)}}else{loading[e]=[];loading[e].push({onLoad:t,onProgress:i,onError:r});var _=new XMLHttpRequest;_.open("GET",e,true);_.addEventListener("load",(function(t){var i=this.response;var r=loading[e];delete loading[e];if(this.status===200||this.status===0){if(this.status===0)console.warn("THREE.FileLoader: HTTP Status 0 received.");Cache.add(e,i);for(var a=0,o=r.length;a<o;a++){var s=r[a];if(s.onLoad)s.onLoad(i)}n.manager.itemEnd(e)}else{for(var a=0,o=r.length;a<o;a++){var s=r[a];if(s.onError)s.onError(t)}n.manager.itemError(e);n.manager.itemEnd(e)}}),false);_.addEventListener("progress",(function(t){var i=loading[e];for(var r=0,n=i.length;r<n;r++){var a=i[r];if(a.onProgress)a.onProgress(t)}}),false);_.addEventListener("error",(function(t){var i=loading[e];delete loading[e];for(var r=0,a=i.length;r<a;r++){var o=i[r];if(o.onError)o.onError(t)}n.manager.itemError(e);n.manager.itemEnd(e)}),false);_.addEventListener("abort",(function(t){var i=loading[e];delete loading[e];for(var r=0,a=i.length;r<a;r++){var o=i[r];if(o.onError)o.onError(t)}n.manager.itemError(e);n.manager.itemEnd(e)}),false);if(this.responseType!==undefined)_.responseType=this.responseType;if(this.withCredentials!==undefined)_.withCredentials=this.withCredentials;if(_.overrideMimeType)_.overrideMimeType(this.mimeType!==undefined?this.mimeType:"text/plain");for(var y in this.requestHeader){_.setRequestHeader(y,this.requestHeader[y])}_.send(null)}n.manager.itemStart(e);return _},setResponseType:function(e){this.responseType=e;return this},setWithCredentials:function(e){this.withCredentials=e;return this},setMimeType:function(e){this.mimeType=e;return this},setRequestHeader:function(e){this.requestHeader=e;return this}});function AnimationLoader(e){Loader.call(this,e)}AnimationLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AnimationLoader,load:function(e,t,i,r){var n=this;var a=new FileLoader(n.manager);a.setPath(n.path);a.load(e,(function(e){t(n.parse(JSON.parse(e)))}),i,r)},parse:function(e){var t=[];for(var i=0;i<e.length;i++){var r=AnimationClip.parse(e[i]);t.push(r)}return t}});function CompressedTextureLoader(e){Loader.call(this,e)}CompressedTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CompressedTextureLoader,load:function(e,t,i,r){var n=this;var a=[];var o=new CompressedTexture;o.image=a;var s=new FileLoader(this.manager);s.setPath(this.path);s.setResponseType("arraybuffer");function l(l){s.load(e[l],(function(e){var i=n.parse(e,true);a[l]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps};c+=1;if(c===6){if(i.mipmapCount===1)o.minFilter=LinearFilter;o.format=i.format;o.needsUpdate=true;if(t)t(o)}}),i,r)}if(Array.isArray(e)){var c=0;for(var u=0,h=e.length;u<h;++u){l(u)}}else{s.load(e,(function(e){var i=n.parse(e,true);if(i.isCubemap){var r=i.mipmaps.length/i.mipmapCount;for(var s=0;s<r;s++){a[s]={mipmaps:[]};for(var l=0;l<i.mipmapCount;l++){a[s].mipmaps.push(i.mipmaps[s*i.mipmapCount+l]);a[s].format=i.format;a[s].width=i.width;a[s].height=i.height}}}else{o.image.width=i.width;o.image.height=i.height;o.mipmaps=i.mipmaps}if(i.mipmapCount===1){o.minFilter=LinearFilter}o.format=i.format;o.needsUpdate=true;if(t)t(o)}),i,r)}return o}});function DataTextureLoader(e){Loader.call(this,e)}DataTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DataTextureLoader,load:function(e,t,i,r){var n=this;var a=new DataTexture;var o=new FileLoader(this.manager);o.setResponseType("arraybuffer");o.setPath(this.path);o.load(e,(function(e){var i=n.parse(e);if(!i)return;if(i.image!==undefined){a.image=i.image}else if(i.data!==undefined){a.image.width=i.width;a.image.height=i.height;a.image.data=i.data}a.wrapS=i.wrapS!==undefined?i.wrapS:ClampToEdgeWrapping;a.wrapT=i.wrapT!==undefined?i.wrapT:ClampToEdgeWrapping;a.magFilter=i.magFilter!==undefined?i.magFilter:LinearFilter;a.minFilter=i.minFilter!==undefined?i.minFilter:LinearFilter;a.anisotropy=i.anisotropy!==undefined?i.anisotropy:1;if(i.format!==undefined){a.format=i.format}if(i.type!==undefined){a.type=i.type}if(i.mipmaps!==undefined){a.mipmaps=i.mipmaps;a.minFilter=LinearMipmapLinearFilter}if(i.mipmapCount===1){a.minFilter=LinearFilter}a.needsUpdate=true;if(t)t(a,i)}),i,r);return a}});function ImageLoader(e){Loader.call(this,e)}ImageLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageLoader,load:function(e,t,i,r){if(this.path!==undefined)e=this.path+e;e=this.manager.resolveURL(e);var n=this;var a=Cache.get(e);if(a!==undefined){n.manager.itemStart(e);setTimeout((function(){if(t)t(a);n.manager.itemEnd(e)}),0);return a}var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,false);o.removeEventListener("error",l,false);Cache.add(e,this);if(t)t(this);n.manager.itemEnd(e)}function l(t){o.removeEventListener("load",s,false);o.removeEventListener("error",l,false);if(r)r(t);n.manager.itemError(e);n.manager.itemEnd(e)}o.addEventListener("load",s,false);o.addEventListener("error",l,false);if(e.substr(0,5)!=="data:"){if(this.crossOrigin!==undefined)o.crossOrigin=this.crossOrigin}n.manager.itemStart(e);o.src=e;return o}});function CubeTextureLoader(e){Loader.call(this,e)}CubeTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CubeTextureLoader,load:function(e,t,i,r){var n=new CubeTexture;var a=new ImageLoader(this.manager);a.setCrossOrigin(this.crossOrigin);a.setPath(this.path);var o=0;function s(i){a.load(e[i],(function(e){n.images[i]=e;o++;if(o===6){n.needsUpdate=true;if(t)t(n)}}),undefined,r)}for(var l=0;l<e.length;++l){s(l)}return n}});function TextureLoader(e){Loader.call(this,e)}TextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TextureLoader,load:function(e,t,i,r){var n=new Texture;var a=new ImageLoader(this.manager);a.setCrossOrigin(this.crossOrigin);a.setPath(this.path);a.load(e,(function(i){n.image=i;var r=e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0;n.format=r?RGBFormat:RGBAFormat;n.needsUpdate=true;if(t!==undefined){t(n)}}),i,r);return n}});function Curve(){this.type="Curve";this.arcLengthDivisions=200}Object.assign(Curve.prototype,{getPoint:function(){console.warn("THREE.Curve: .getPoint() not implemented.");return null},getPointAt:function(e,t){var i=this.getUtoTmapping(e);return this.getPoint(i,t)},getPoints:function(e){if(e===undefined)e=5;var t=[];for(var i=0;i<=e;i++){t.push(this.getPoint(i/e))}return t},getSpacedPoints:function(e){if(e===undefined)e=5;var t=[];for(var i=0;i<=e;i++){t.push(this.getPointAt(i/e))}return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e===undefined)e=this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var t=[];var i,r=this.getPoint(0);var n,a=0;t.push(0);for(n=1;n<=e;n++){i=this.getPoint(n/e);a+=i.distanceTo(r);t.push(a);r=i}this.cacheArcLengths=t;return t},updateArcLengths:function(){this.needsUpdate=true;this.getLengths()},getUtoTmapping:function(e,t){var i=this.getLengths();var r=0,n=i.length;var a;if(t){a=t}else{a=e*i[n-1]}var o=0,s=n-1,l;while(o<=s){r=Math.floor(o+(s-o)/2);l=i[r]-a;if(l<0){o=r+1}else if(l>0){s=r-1}else{s=r;break}}r=s;if(i[r]===a){return r/(n-1)}var c=i[r];var u=i[r+1];var h=u-c;var p=(a-c)/h;var m=(r+p)/(n-1);return m},getTangent:function(e,t){var i=1e-4;var r=e-i;var n=e+i;if(r<0)r=0;if(n>1)n=1;var a=this.getPoint(r);var o=this.getPoint(n);var s=t||(a.isVector2?new Vector2:new Vector3);s.copy(o).sub(a).normalize();return s},getTangentAt:function(e,t){var i=this.getUtoTmapping(e);return this.getTangent(i,t)},computeFrenetFrames:function(e,t){var i=new Vector3;var r=[];var n=[];var a=[];var o=new Vector3;var s=new Matrix4;var l,c,u;for(l=0;l<=e;l++){c=l/e;r[l]=this.getTangentAt(c,new Vector3);r[l].normalize()}n[0]=new Vector3;a[0]=new Vector3;var h=Number.MAX_VALUE;var p=Math.abs(r[0].x);var m=Math.abs(r[0].y);var f=Math.abs(r[0].z);if(p<=h){h=p;i.set(1,0,0)}if(m<=h){h=m;i.set(0,1,0)}if(f<=h){i.set(0,0,1)}o.crossVectors(r[0],i).normalize();n[0].crossVectors(r[0],o);a[0].crossVectors(r[0],n[0]);for(l=1;l<=e;l++){n[l]=n[l-1].clone();a[l]=a[l-1].clone();o.crossVectors(r[l-1],r[l]);if(o.length()>Number.EPSILON){o.normalize();u=Math.acos(MathUtils.clamp(r[l-1].dot(r[l]),-1,1));n[l].applyMatrix4(s.makeRotationAxis(o,u))}a[l].crossVectors(r[l],n[l])}if(t===true){u=Math.acos(MathUtils.clamp(n[0].dot(n[e]),-1,1));u/=e;if(r[0].dot(o.crossVectors(n[0],n[e]))>0){u=-u}for(l=1;l<=e;l++){n[l].applyMatrix4(s.makeRotationAxis(r[l],u*l));a[l].crossVectors(r[l],n[l])}}return{tangents:r,normals:n,binormals:a}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.arcLengthDivisions=e.arcLengthDivisions;return this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};e.arcLengthDivisions=this.arcLengthDivisions;e.type=this.type;return e},fromJSON:function(e){this.arcLengthDivisions=e.arcLengthDivisions;return this}});function EllipseCurve(e,t,i,r,n,a,o,s){Curve.call(this);this.type="EllipseCurve";this.aX=e||0;this.aY=t||0;this.xRadius=i||1;this.yRadius=r||1;this.aStartAngle=n||0;this.aEndAngle=a||2*Math.PI;this.aClockwise=o||false;this.aRotation=s||0}EllipseCurve.prototype=Object.create(Curve.prototype);EllipseCurve.prototype.constructor=EllipseCurve;EllipseCurve.prototype.isEllipseCurve=true;EllipseCurve.prototype.getPoint=function(e,t){var i=t||new Vector2;var r=Math.PI*2;var n=this.aEndAngle-this.aStartAngle;var a=Math.abs(n)<Number.EPSILON;while(n<0)n+=r;while(n>r)n-=r;if(n<Number.EPSILON){if(a){n=0}else{n=r}}if(this.aClockwise===true&&!a){if(n===r){n=-r}else{n=n-r}}var o=this.aStartAngle+e*n;var s=this.aX+this.xRadius*Math.cos(o);var l=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){var c=Math.cos(this.aRotation);var u=Math.sin(this.aRotation);var h=s-this.aX;var p=l-this.aY;s=h*c-p*u+this.aX;l=h*u+p*c+this.aY}return i.set(s,l)};EllipseCurve.prototype.copy=function(e){Curve.prototype.copy.call(this,e);this.aX=e.aX;this.aY=e.aY;this.xRadius=e.xRadius;this.yRadius=e.yRadius;this.aStartAngle=e.aStartAngle;this.aEndAngle=e.aEndAngle;this.aClockwise=e.aClockwise;this.aRotation=e.aRotation;return this};EllipseCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.aX=this.aX;e.aY=this.aY;e.xRadius=this.xRadius;e.yRadius=this.yRadius;e.aStartAngle=this.aStartAngle;e.aEndAngle=this.aEndAngle;e.aClockwise=this.aClockwise;e.aRotation=this.aRotation;return e};EllipseCurve.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e);this.aX=e.aX;this.aY=e.aY;this.xRadius=e.xRadius;this.yRadius=e.yRadius;this.aStartAngle=e.aStartAngle;this.aEndAngle=e.aEndAngle;this.aClockwise=e.aClockwise;this.aRotation=e.aRotation;return this};function ArcCurve(e,t,i,r,n,a){EllipseCurve.call(this,e,t,i,i,r,n,a);this.type="ArcCurve"}ArcCurve.prototype=Object.create(EllipseCurve.prototype);ArcCurve.prototype.constructor=ArcCurve;ArcCurve.prototype.isArcCurve=true;function CubicPoly(){var e=0,t=0,i=0,r=0;function n(n,a,o,s){e=n;t=o;i=-3*n+3*a-2*o-s;r=2*n-2*a+o+s}return{initCatmullRom:function(e,t,i,r,a){n(t,i,a*(i-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,i,r,a,o,s){var l=(t-e)/a-(i-e)/(a+o)+(i-t)/o;var c=(i-t)/o-(r-t)/(o+s)+(r-i)/s;l*=o;c*=o;n(t,i,l,c)},calc:function(n){var a=n*n;var o=a*n;return e+t*n+i*a+r*o}}}var tmp=new Vector3;var px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;function CatmullRomCurve3(e,t,i,r){Curve.call(this);this.type="CatmullRomCurve3";this.points=e||[];this.closed=t||false;this.curveType=i||"centripetal";this.tension=r||.5}CatmullRomCurve3.prototype=Object.create(Curve.prototype);CatmullRomCurve3.prototype.constructor=CatmullRomCurve3;CatmullRomCurve3.prototype.isCatmullRomCurve3=true;CatmullRomCurve3.prototype.getPoint=function(e,t){var i=t||new Vector3;var r=this.points;var n=r.length;var a=(n-(this.closed?0:1))*e;var o=Math.floor(a);var s=a-o;if(this.closed){o+=o>0?0:(Math.floor(Math.abs(o)/n)+1)*n}else if(s===0&&o===n-1){o=n-2;s=1}var l,c,u,h;if(this.closed||o>0){l=r[(o-1)%n]}else{tmp.subVectors(r[0],r[1]).add(r[0]);l=tmp}c=r[o%n];u=r[(o+1)%n];if(this.closed||o+2<n){h=r[(o+2)%n]}else{tmp.subVectors(r[n-1],r[n-2]).add(r[n-1]);h=tmp}if(this.curveType==="centripetal"||this.curveType==="chordal"){var p=this.curveType==="chordal"?.5:.25;var m=Math.pow(l.distanceToSquared(c),p);var f=Math.pow(c.distanceToSquared(u),p);var d=Math.pow(u.distanceToSquared(h),p);if(f<1e-4)f=1;if(m<1e-4)m=f;if(d<1e-4)d=f;px.initNonuniformCatmullRom(l.x,c.x,u.x,h.x,m,f,d);py.initNonuniformCatmullRom(l.y,c.y,u.y,h.y,m,f,d);pz.initNonuniformCatmullRom(l.z,c.z,u.z,h.z,m,f,d)}else if(this.curveType==="catmullrom"){px.initCatmullRom(l.x,c.x,u.x,h.x,this.tension);py.initCatmullRom(l.y,c.y,u.y,h.y,this.tension);pz.initCatmullRom(l.z,c.z,u.z,h.z,this.tension)}i.set(px.calc(s),py.calc(s),pz.calc(s));return i};CatmullRomCurve3.prototype.copy=function(e){Curve.prototype.copy.call(this,e);this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}this.closed=e.closed;this.curveType=e.curveType;this.tension=e.tension;return this};CatmullRomCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}e.closed=this.closed;e.curveType=this.curveType;e.tension=this.tension;return e};CatmullRomCurve3.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e);this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new Vector3).fromArray(r))}this.closed=e.closed;this.curveType=e.curveType;this.tension=e.tension;return this};function CatmullRom(e,t,i,r,n){var a=(r-t)*.5;var o=(n-i)*.5;var s=e*e;var l=e*s;return(2*i-2*r+a+o)*l+(-3*i+3*r-2*a-o)*s+a*e+i}function QuadraticBezierP0(e,t){var i=1-e;return i*i*t}function QuadraticBezierP1(e,t){return 2*(1-e)*e*t}function QuadraticBezierP2(e,t){return e*e*t}function QuadraticBezier(e,t,i,r){return QuadraticBezierP0(e,t)+QuadraticBezierP1(e,i)+QuadraticBezierP2(e,r)}function CubicBezierP0(e,t){var i=1-e;return i*i*i*t}function CubicBezierP1(e,t){var i=1-e;return 3*i*i*e*t}function CubicBezierP2(e,t){return 3*(1-e)*e*e*t}function CubicBezierP3(e,t){return e*e*e*t}function CubicBezier(e,t,i,r,n){return CubicBezierP0(e,t)+CubicBezierP1(e,i)+CubicBezierP2(e,r)+CubicBezierP3(e,n)}function CubicBezierCurve(e,t,i,r){Curve.call(this);this.type="CubicBezierCurve";this.v0=e||new Vector2;this.v1=t||new Vector2;this.v2=i||new Vector2;this.v3=r||new Vector2}CubicBezierCurve.prototype=Object.create(Curve.prototype);CubicBezierCurve.prototype.constructor=CubicBezierCurve;CubicBezierCurve.prototype.isCubicBezierCurve=true;CubicBezierCurve.prototype.getPoint=function(e,t){var i=t||new Vector2;var r=this.v0,n=this.v1,a=this.v2,o=this.v3;i.set(CubicBezier(e,r.x,n.x,a.x,o.x),CubicBezier(e,r.y,n.y,a.y,o.y));return i};CubicBezierCurve.prototype.copy=function(e){Curve.prototype.copy.call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);this.v3.copy(e.v3);return this};CubicBezierCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();e.v3=this.v3.toArray();return e};CubicBezierCurve.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);this.v3.fromArray(e.v3);return this};function CubicBezierCurve3(e,t,i,r){Curve.call(this);this.type="CubicBezierCurve3";this.v0=e||new Vector3;this.v1=t||new Vector3;this.v2=i||new Vector3;this.v3=r||new Vector3}CubicBezierCurve3.prototype=Object.create(Curve.prototype);CubicBezierCurve3.prototype.constructor=CubicBezierCurve3;CubicBezierCurve3.prototype.isCubicBezierCurve3=true;CubicBezierCurve3.prototype.getPoint=function(e,t){var i=t||new Vector3;var r=this.v0,n=this.v1,a=this.v2,o=this.v3;i.set(CubicBezier(e,r.x,n.x,a.x,o.x),CubicBezier(e,r.y,n.y,a.y,o.y),CubicBezier(e,r.z,n.z,a.z,o.z));return i};CubicBezierCurve3.prototype.copy=function(e){Curve.prototype.copy.call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);this.v3.copy(e.v3);return this};CubicBezierCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();e.v3=this.v3.toArray();return e};CubicBezierCurve3.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);this.v3.fromArray(e.v3);return this};function LineCurve(e,t){Curve.call(this);this.type="LineCurve";this.v1=e||new Vector2;this.v2=t||new Vector2}LineCurve.prototype=Object.create(Curve.prototype);LineCurve.prototype.constructor=LineCurve;LineCurve.prototype.isLineCurve=true;LineCurve.prototype.getPoint=function(e,t){var i=t||new Vector2;if(e===1){i.copy(this.v2)}else{i.copy(this.v2).sub(this.v1);i.multiplyScalar(e).add(this.v1)}return i};LineCurve.prototype.getPointAt=function(e,t){return this.getPoint(e,t)};LineCurve.prototype.getTangent=function(e,t){var i=t||new Vector2;var i=i.copy(this.v2).sub(this.v1).normalize();return i};LineCurve.prototype.copy=function(e){Curve.prototype.copy.call(this,e);this.v1.copy(e.v1);this.v2.copy(e.v2);return this};LineCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e};LineCurve.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this};function LineCurve3(e,t){Curve.call(this);this.type="LineCurve3";this.v1=e||new Vector3;this.v2=t||new Vector3}LineCurve3.prototype=Object.create(Curve.prototype);LineCurve3.prototype.constructor=LineCurve3;LineCurve3.prototype.isLineCurve3=true;LineCurve3.prototype.getPoint=function(e,t){var i=t||new Vector3;if(e===1){i.copy(this.v2)}else{i.copy(this.v2).sub(this.v1);i.multiplyScalar(e).add(this.v1)}return i};LineCurve3.prototype.getPointAt=function(e,t){return this.getPoint(e,t)};LineCurve3.prototype.copy=function(e){Curve.prototype.copy.call(this,e);this.v1.copy(e.v1);this.v2.copy(e.v2);return this};LineCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e};LineCurve3.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this};function QuadraticBezierCurve(e,t,i){Curve.call(this);this.type="QuadraticBezierCurve";this.v0=e||new Vector2;this.v1=t||new Vector2;this.v2=i||new Vector2}QuadraticBezierCurve.prototype=Object.create(Curve.prototype);QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve;QuadraticBezierCurve.prototype.isQuadraticBezierCurve=true;QuadraticBezierCurve.prototype.getPoint=function(e,t){var i=t||new Vector2;var r=this.v0,n=this.v1,a=this.v2;i.set(QuadraticBezier(e,r.x,n.x,a.x),QuadraticBezier(e,r.y,n.y,a.y));return i};QuadraticBezierCurve.prototype.copy=function(e){Curve.prototype.copy.call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);return this};QuadraticBezierCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e};QuadraticBezierCurve.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this};function QuadraticBezierCurve3(e,t,i){Curve.call(this);this.type="QuadraticBezierCurve3";this.v0=e||new Vector3;this.v1=t||new Vector3;this.v2=i||new Vector3}QuadraticBezierCurve3.prototype=Object.create(Curve.prototype);QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3;QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=true;QuadraticBezierCurve3.prototype.getPoint=function(e,t){var i=t||new Vector3;var r=this.v0,n=this.v1,a=this.v2;i.set(QuadraticBezier(e,r.x,n.x,a.x),QuadraticBezier(e,r.y,n.y,a.y),QuadraticBezier(e,r.z,n.z,a.z));return i};QuadraticBezierCurve3.prototype.copy=function(e){Curve.prototype.copy.call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);return this};QuadraticBezierCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e};QuadraticBezierCurve3.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this};function SplineCurve(e){Curve.call(this);this.type="SplineCurve";this.points=e||[]}SplineCurve.prototype=Object.create(Curve.prototype);SplineCurve.prototype.constructor=SplineCurve;SplineCurve.prototype.isSplineCurve=true;SplineCurve.prototype.getPoint=function(e,t){var i=t||new Vector2;var r=this.points;var n=(r.length-1)*e;var a=Math.floor(n);var o=n-a;var s=r[a===0?a:a-1];var l=r[a];var c=r[a>r.length-2?r.length-1:a+1];var u=r[a>r.length-3?r.length-1:a+2];i.set(CatmullRom(o,s.x,l.x,c.x,u.x),CatmullRom(o,s.y,l.y,c.y,u.y));return i};SplineCurve.prototype.copy=function(e){Curve.prototype.copy.call(this,e);this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this};SplineCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e};SplineCurve.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e);this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new Vector2).fromArray(r))}return this};var Curves=Object.freeze({__proto__:null,ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});function CurvePath(){Curve.call(this);this.type="CurvePath";this.curves=[];this.autoClose=false}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0);var t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){this.curves.push(new LineCurve(t,e))}},getPoint:function(e){var t=e*this.getLength();var i=this.getCurveLengths();var r=0;while(r<i.length){if(i[r]>=t){var n=i[r]-t;var a=this.curves[r];var o=a.getLength();var s=o===0?0:1-n/o;return a.getPointAt(s)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=true;this.cacheLengths=null;this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length){return this.cacheLengths}var e=[],t=0;for(var i=0,r=this.curves.length;i<r;i++){t+=this.curves[i].getLength();e.push(t)}this.cacheLengths=e;return e},getSpacedPoints:function(e){if(e===undefined)e=40;var t=[];for(var i=0;i<=e;i++){t.push(this.getPoint(i/e))}if(this.autoClose){t.push(t[0])}return t},getPoints:function(e){e=e||12;var t=[],i;for(var r=0,n=this.curves;r<n.length;r++){var a=n[r];var o=a&&a.isEllipseCurve?e*2:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e;var s=a.getPoints(o);for(var l=0;l<s.length;l++){var c=s[l];if(i&&i.equals(c))continue;t.push(c);i=c}}if(this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])){t.push(t[0])}return t},copy:function(e){Curve.prototype.copy.call(this,e);this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push(r.clone())}this.autoClose=e.autoClose;return this},toJSON:function(){var e=Curve.prototype.toJSON.call(this);e.autoClose=this.autoClose;e.curves=[];for(var t=0,i=this.curves.length;t<i;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){Curve.prototype.fromJSON.call(this,e);this.autoClose=e.autoClose;this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push((new Curves[r.type]).fromJSON(r))}return this}});function Path(e){CurvePath.call(this);this.type="Path";this.currentPoint=new Vector2;if(e){this.setFromPoints(e)}}Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++){this.lineTo(e[t].x,e[t].y)}return this},moveTo:function(e,t){this.currentPoint.set(e,t);return this},lineTo:function(e,t){var i=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));this.curves.push(i);this.currentPoint.set(e,t);return this},quadraticCurveTo:function(e,t,i,r){var n=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,r));this.curves.push(n);this.currentPoint.set(i,r);return this},bezierCurveTo:function(e,t,i,r,n,a){var o=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,r),new Vector2(n,a));this.curves.push(o);this.currentPoint.set(n,a);return this},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e);var i=new SplineCurve(t);this.curves.push(i);this.currentPoint.copy(e[e.length-1]);return this},arc:function(e,t,i,r,n,a){var o=this.currentPoint.x;var s=this.currentPoint.y;this.absarc(e+o,t+s,i,r,n,a);return this},absarc:function(e,t,i,r,n,a){this.absellipse(e,t,i,i,r,n,a);return this},ellipse:function(e,t,i,r,n,a,o,s){var l=this.currentPoint.x;var c=this.currentPoint.y;this.absellipse(e+l,t+c,i,r,n,a,o,s);return this},absellipse:function(e,t,i,r,n,a,o,s){var l=new EllipseCurve(e,t,i,r,n,a,o,s);if(this.curves.length>0){var c=l.getPoint(0);if(!c.equals(this.currentPoint)){this.lineTo(c.x,c.y)}}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u);return this},copy:function(e){CurvePath.prototype.copy.call(this,e);this.currentPoint.copy(e.currentPoint);return this},toJSON:function(){var e=CurvePath.prototype.toJSON.call(this);e.currentPoint=this.currentPoint.toArray();return e},fromJSON:function(e){CurvePath.prototype.fromJSON.call(this,e);this.currentPoint.fromArray(e.currentPoint);return this}});function Shape(e){Path.call(this,e);this.uuid=MathUtils.generateUUID();this.type="Shape";this.holes=[]}Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function(e){var t=[];for(var i=0,r=this.holes.length;i<r;i++){t[i]=this.holes[i].getPoints(e)}return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Path.prototype.copy.call(this,e);this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=Path.prototype.toJSON.call(this);e.uuid=this.uuid;e.holes=[];for(var t=0,i=this.holes.length;t<i;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){Path.prototype.fromJSON.call(this,e);this.uuid=e.uuid;this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push((new Path).fromJSON(r))}return this}});function Light(e,t){Object3D.call(this);this.type="Light";this.color=new Color(e);this.intensity=t!==undefined?t:1;this.receiveShadow=undefined}Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:true,copy:function(e){Object3D.prototype.copy.call(this,e);this.color.copy(e.color);this.intensity=e.intensity;return this},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);t.object.color=this.color.getHex();t.object.intensity=this.intensity;if(this.groundColor!==undefined)t.object.groundColor=this.groundColor.getHex();if(this.distance!==undefined)t.object.distance=this.distance;if(this.angle!==undefined)t.object.angle=this.angle;if(this.decay!==undefined)t.object.decay=this.decay;if(this.penumbra!==undefined)t.object.penumbra=this.penumbra;if(this.shadow!==undefined)t.object.shadow=this.shadow.toJSON();return t}});function HemisphereLight(e,t,i){Light.call(this,e,i);this.type="HemisphereLight";this.castShadow=undefined;this.position.copy(Object3D.DefaultUp);this.updateMatrix();this.groundColor=new Color(t)}HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:true,copy:function(e){Light.prototype.copy.call(this,e);this.groundColor.copy(e.groundColor);return this}});function LightShadow(e){this.camera=e;this.bias=0;this.radius=1;this.mapSize=new Vector2(512,512);this.map=null;this.mapPass=null;this.matrix=new Matrix4;this._frustum=new Frustum;this._frameExtents=new Vector2(1,1);this._viewportCount=1;this._viewports=[new Vector4(0,0,1,1)]}Object.assign(LightShadow.prototype,{_projScreenMatrix:new Matrix4,_lightPositionWorld:new Vector3,_lookTarget:new Vector3,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,i=this.matrix,r=this._projScreenMatrix,n=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(e.matrixWorld);t.position.copy(a);n.setFromMatrixPosition(e.target.matrixWorld);t.lookAt(n);t.updateMatrixWorld();r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);this._frustum.setFromProjectionMatrix(r);i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);i.multiply(t.projectionMatrix);i.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){this.camera=e.camera.clone();this.bias=e.bias;this.radius=e.radius;this.mapSize.copy(e.mapSize);return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};if(this.bias!==0)e.bias=this.bias;if(this.radius!==1)e.radius=this.radius;if(this.mapSize.x!==512||this.mapSize.y!==512)e.mapSize=this.mapSize.toArray();e.camera=this.camera.toJSON(false).object;delete e.camera.matrix;return e}});function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500))}SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:true,updateMatrices:function(e){var t=this.camera;var i=MathUtils.RAD2DEG*2*e.angle;var r=this.mapSize.width/this.mapSize.height;var n=e.distance||t.far;if(i!==t.fov||r!==t.aspect||n!==t.far){t.fov=i;t.aspect=r;t.far=n;t.updateProjectionMatrix()}LightShadow.prototype.updateMatrices.call(this,e)}});function SpotLight(e,t,i,r,n,a){Light.call(this,e,t);this.type="SpotLight";this.position.copy(Object3D.DefaultUp);this.updateMatrix();this.target=new Object3D;Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}});this.distance=i!==undefined?i:0;this.angle=r!==undefined?r:Math.PI/3;this.penumbra=n!==undefined?n:0;this.decay=a!==undefined?a:1;this.shadow=new SpotLightShadow}SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:true,copy:function(e){Light.prototype.copy.call(this,e);this.distance=e.distance;this.angle=e.angle;this.penumbra=e.penumbra;this.decay=e.decay;this.target=e.target.clone();this.shadow=e.shadow.clone();return this}});function PointLightShadow(){LightShadow.call(this,new PerspectiveCamera(90,1,.5,500));this._frameExtents=new Vector2(4,2);this._viewportCount=6;this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)];this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)];this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}PointLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:PointLightShadow,isPointLightShadow:true,updateMatrices:function(e,t){if(t===undefined)t=0;var i=this.camera,r=this.matrix,n=this._lightPositionWorld,a=this._lookTarget,o=this._projScreenMatrix;n.setFromMatrixPosition(e.matrixWorld);i.position.copy(n);a.copy(i.position);a.add(this._cubeDirections[t]);i.up.copy(this._cubeUps[t]);i.lookAt(a);i.updateMatrixWorld();r.makeTranslation(-n.x,-n.y,-n.z);o.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse);this._frustum.setFromProjectionMatrix(o)}});function PointLight(e,t,i,r){Light.call(this,e,t);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return this.intensity*4*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}});this.distance=i!==undefined?i:0;this.decay=r!==undefined?r:1;this.shadow=new PointLightShadow}PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:true,copy:function(e){Light.prototype.copy.call(this,e);this.distance=e.distance;this.decay=e.decay;this.shadow=e.shadow.clone();return this}});function OrthographicCamera(e,t,i,r,n,a){Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=e!==undefined?e:-1;this.right=t!==undefined?t:1;this.top=i!==undefined?i:1;this.bottom=r!==undefined?r:-1;this.near=n!==undefined?n:.1;this.far=a!==undefined?a:2e3;this.updateProjectionMatrix()}OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:true,copy:function(e,t){Camera.prototype.copy.call(this,e,t);this.left=e.left;this.right=e.right;this.top=e.top;this.bottom=e.bottom;this.near=e.near;this.far=e.far;this.zoom=e.zoom;this.view=e.view===null?null:Object.assign({},e.view);return this},setViewOffset:function(e,t,i,r,n,a){if(this.view===null){this.view={enabled:true,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}this.view.enabled=true;this.view.fullWidth=e;this.view.fullHeight=t;this.view.offsetX=i;this.view.offsetY=r;this.view.width=n;this.view.height=a;this.updateProjectionMatrix()},clearViewOffset:function(){if(this.view!==null){this.view.enabled=false}this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom);var t=(this.top-this.bottom)/(2*this.zoom);var i=(this.right+this.left)/2;var r=(this.top+this.bottom)/2;var n=i-e;var a=i+e;var o=r+t;var s=r-t;if(this.view!==null&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom;var c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX;a=n+l*this.view.width;o-=c*this.view.offsetY;s=o-c*this.view.height}this.projectionMatrix.makeOrthographic(n,a,o,s,this.near,this.far);this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);t.object.zoom=this.zoom;t.object.left=this.left;t.object.right=this.right;t.object.top=this.top;t.object.bottom=this.bottom;t.object.near=this.near;t.object.far=this.far;if(this.view!==null)t.object.view=Object.assign({},this.view);return t}});function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow,isDirectionalLightShadow:true,updateMatrices:function(e){LightShadow.prototype.updateMatrices.call(this,e)}});function DirectionalLight(e,t){Light.call(this,e,t);this.type="DirectionalLight";this.position.copy(Object3D.DefaultUp);this.updateMatrix();this.target=new Object3D;this.shadow=new DirectionalLightShadow}DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:true,copy:function(e){Light.prototype.copy.call(this,e);this.target=e.target.clone();this.shadow=e.shadow.clone();return this}});function AmbientLight(e,t){Light.call(this,e,t);this.type="AmbientLight";this.castShadow=undefined}AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:true});function RectAreaLight(e,t,i,r){Light.call(this,e,t);this.type="RectAreaLight";this.width=i!==undefined?i:10;this.height=r!==undefined?r:10}RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:true,copy:function(e){Light.prototype.copy.call(this,e);this.width=e.width;this.height=e.height;return this},toJSON:function(e){var t=Light.prototype.toJSON.call(this,e);t.object.width=this.width;t.object.height=this.height;return t}});function SphericalHarmonics3(){this.coefficients=[];for(var e=0;e<9;e++){this.coefficients.push(new Vector3)}}Object.assign(SphericalHarmonics3.prototype,{isSphericalHarmonics3:true,set:function(e){for(var t=0;t<9;t++){this.coefficients[t].copy(e[t])}return this},zero:function(){for(var e=0;e<9;e++){this.coefficients[e].set(0,0,0)}return this},getAt:function(e,t){var i=e.x,r=e.y,n=e.z;var a=this.coefficients;t.copy(a[0]).multiplyScalar(.282095);t.addScaledVector(a[1],.488603*r);t.addScaledVector(a[2],.488603*n);t.addScaledVector(a[3],.488603*i);t.addScaledVector(a[4],1.092548*(i*r));t.addScaledVector(a[5],1.092548*(r*n));t.addScaledVector(a[6],.315392*(3*n*n-1));t.addScaledVector(a[7],1.092548*(i*n));t.addScaledVector(a[8],.546274*(i*i-r*r));return t},getIrradianceAt:function(e,t){var i=e.x,r=e.y,n=e.z;var a=this.coefficients;t.copy(a[0]).multiplyScalar(.886227);t.addScaledVector(a[1],2*.511664*r);t.addScaledVector(a[2],2*.511664*n);t.addScaledVector(a[3],2*.511664*i);t.addScaledVector(a[4],2*.429043*i*r);t.addScaledVector(a[5],2*.429043*r*n);t.addScaledVector(a[6],.743125*n*n-.247708);t.addScaledVector(a[7],2*.429043*i*n);t.addScaledVector(a[8],.429043*(i*i-r*r));return t},add:function(e){for(var t=0;t<9;t++){this.coefficients[t].add(e.coefficients[t])}return this},addScaledSH:function(e,t){for(var i=0;i<9;i++){this.coefficients[i].addScaledVector(e.coefficients[i],t)}return this},scale:function(e){for(var t=0;t<9;t++){this.coefficients[t].multiplyScalar(e)}return this},lerp:function(e,t){for(var i=0;i<9;i++){this.coefficients[i].lerp(e.coefficients[i],t)}return this},equals:function(e){for(var t=0;t<9;t++){if(!this.coefficients[t].equals(e.coefficients[t])){return false}}return true},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){if(t===undefined)t=0;var i=this.coefficients;for(var r=0;r<9;r++){i[r].fromArray(e,t+r*3)}return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;var i=this.coefficients;for(var r=0;r<9;r++){i[r].toArray(e,t+r*3)}return e}});Object.assign(SphericalHarmonics3,{getBasisAt:function(e,t){var i=e.x,r=e.y,n=e.z;t[0]=.282095;t[1]=.488603*r;t[2]=.488603*n;t[3]=.488603*i;t[4]=1.092548*i*r;t[5]=1.092548*r*n;t[6]=.315392*(3*n*n-1);t[7]=1.092548*i*n;t[8]=.546274*(i*i-r*r)}});function LightProbe(e,t){Light.call(this,undefined,t);this.type="LightProbe";this.sh=e!==undefined?e:new SphericalHarmonics3}LightProbe.prototype=Object.assign(Object.create(Light.prototype),{constructor:LightProbe,isLightProbe:true,copy:function(e){Light.prototype.copy.call(this,e);this.sh.copy(e.sh);return this},fromJSON:function(e){this.intensity=e.intensity;this.sh.fromArray(e.sh);return this},toJSON:function(e){var t=Light.prototype.toJSON.call(this,e);t.object.sh=this.sh.toArray();return t}});function MaterialLoader(e){Loader.call(this,e);this.textures={}}MaterialLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:MaterialLoader,load:function(e,t,i,r){var n=this;var a=new FileLoader(n.manager);a.setPath(n.path);a.load(e,(function(e){t(n.parse(JSON.parse(e)))}),i,r)},parse:function(e){var t=this.textures;function i(e){if(t[e]===undefined){console.warn("THREE.MaterialLoader: Undefined texture",e)}return t[e]}var r=new Materials[e.type];if(e.uuid!==undefined)r.uuid=e.uuid;if(e.name!==undefined)r.name=e.name;if(e.color!==undefined)r.color.setHex(e.color);if(e.roughness!==undefined)r.roughness=e.roughness;if(e.metalness!==undefined)r.metalness=e.metalness;if(e.sheen!==undefined)r.sheen=(new Color).setHex(e.sheen);if(e.emissive!==undefined)r.emissive.setHex(e.emissive);if(e.specular!==undefined)r.specular.setHex(e.specular);if(e.shininess!==undefined)r.shininess=e.shininess;if(e.clearcoat!==undefined)r.clearcoat=e.clearcoat;if(e.clearcoatRoughness!==undefined)r.clearcoatRoughness=e.clearcoatRoughness;if(e.fog!==undefined)r.fog=e.fog;if(e.flatShading!==undefined)r.flatShading=e.flatShading;if(e.blending!==undefined)r.blending=e.blending;if(e.combine!==undefined)r.combine=e.combine;if(e.side!==undefined)r.side=e.side;if(e.opacity!==undefined)r.opacity=e.opacity;if(e.transparent!==undefined)r.transparent=e.transparent;if(e.alphaTest!==undefined)r.alphaTest=e.alphaTest;if(e.depthTest!==undefined)r.depthTest=e.depthTest;if(e.depthWrite!==undefined)r.depthWrite=e.depthWrite;if(e.colorWrite!==undefined)r.colorWrite=e.colorWrite;if(e.stencilWrite!==undefined)r.stencilWrite=e.stencilWrite;if(e.stencilWriteMask!==undefined)r.stencilWriteMask=e.stencilWriteMask;if(e.stencilFunc!==undefined)r.stencilFunc=e.stencilFunc;if(e.stencilRef!==undefined)r.stencilRef=e.stencilRef;if(e.stencilFuncMask!==undefined)r.stencilFuncMask=e.stencilFuncMask;if(e.stencilFail!==undefined)r.stencilFail=e.stencilFail;if(e.stencilZFail!==undefined)r.stencilZFail=e.stencilZFail;if(e.stencilZPass!==undefined)r.stencilZPass=e.stencilZPass;if(e.wireframe!==undefined)r.wireframe=e.wireframe;if(e.wireframeLinewidth!==undefined)r.wireframeLinewidth=e.wireframeLinewidth;if(e.wireframeLinecap!==undefined)r.wireframeLinecap=e.wireframeLinecap;if(e.wireframeLinejoin!==undefined)r.wireframeLinejoin=e.wireframeLinejoin;if(e.rotation!==undefined)r.rotation=e.rotation;if(e.linewidth!==1)r.linewidth=e.linewidth;if(e.dashSize!==undefined)r.dashSize=e.dashSize;if(e.gapSize!==undefined)r.gapSize=e.gapSize;if(e.scale!==undefined)r.scale=e.scale;if(e.polygonOffset!==undefined)r.polygonOffset=e.polygonOffset;if(e.polygonOffsetFactor!==undefined)r.polygonOffsetFactor=e.polygonOffsetFactor;if(e.polygonOffsetUnits!==undefined)r.polygonOffsetUnits=e.polygonOffsetUnits;if(e.skinning!==undefined)r.skinning=e.skinning;if(e.morphTargets!==undefined)r.morphTargets=e.morphTargets;if(e.morphNormals!==undefined)r.morphNormals=e.morphNormals;if(e.dithering!==undefined)r.dithering=e.dithering;if(e.vertexTangents!==undefined)r.vertexTangents=e.vertexTangents;if(e.visible!==undefined)r.visible=e.visible;if(e.toneMapped!==undefined)r.toneMapped=e.toneMapped;if(e.userData!==undefined)r.userData=e.userData;if(e.vertexColors!==undefined){if(typeof e.vertexColors==="number"){r.vertexColors=e.vertexColors>0?true:false}else{r.vertexColors=e.vertexColors}}if(e.uniforms!==undefined){for(var n in e.uniforms){var a=e.uniforms[n];r.uniforms[n]={};switch(a.type){case"t":r.uniforms[n].value=i(a.value);break;case"c":r.uniforms[n].value=(new Color).setHex(a.value);break;case"v2":r.uniforms[n].value=(new Vector2).fromArray(a.value);break;case"v3":r.uniforms[n].value=(new Vector3).fromArray(a.value);break;case"v4":r.uniforms[n].value=(new Vector4).fromArray(a.value);break;case"m3":r.uniforms[n].value=(new Matrix3).fromArray(a.value);case"m4":r.uniforms[n].value=(new Matrix4).fromArray(a.value);break;default:r.uniforms[n].value=a.value}}}if(e.defines!==undefined)r.defines=e.defines;if(e.vertexShader!==undefined)r.vertexShader=e.vertexShader;if(e.fragmentShader!==undefined)r.fragmentShader=e.fragmentShader;if(e.extensions!==undefined){for(var o in e.extensions){r.extensions[o]=e.extensions[o]}}if(e.shading!==undefined)r.flatShading=e.shading===1;if(e.size!==undefined)r.size=e.size;if(e.sizeAttenuation!==undefined)r.sizeAttenuation=e.sizeAttenuation;if(e.map!==undefined)r.map=i(e.map);if(e.matcap!==undefined)r.matcap=i(e.matcap);if(e.alphaMap!==undefined)r.alphaMap=i(e.alphaMap);if(e.bumpMap!==undefined)r.bumpMap=i(e.bumpMap);if(e.bumpScale!==undefined)r.bumpScale=e.bumpScale;if(e.normalMap!==undefined)r.normalMap=i(e.normalMap);if(e.normalMapType!==undefined)r.normalMapType=e.normalMapType;if(e.normalScale!==undefined){var s=e.normalScale;if(Array.isArray(s)===false){s=[s,s]}r.normalScale=(new Vector2).fromArray(s)}if(e.displacementMap!==undefined)r.displacementMap=i(e.displacementMap);if(e.displacementScale!==undefined)r.displacementScale=e.displacementScale;if(e.displacementBias!==undefined)r.displacementBias=e.displacementBias;if(e.roughnessMap!==undefined)r.roughnessMap=i(e.roughnessMap);if(e.metalnessMap!==undefined)r.metalnessMap=i(e.metalnessMap);if(e.emissiveMap!==undefined)r.emissiveMap=i(e.emissiveMap);if(e.emissiveIntensity!==undefined)r.emissiveIntensity=e.emissiveIntensity;if(e.specularMap!==undefined)r.specularMap=i(e.specularMap);if(e.envMap!==undefined)r.envMap=i(e.envMap);if(e.envMapIntensity!==undefined)r.envMapIntensity=e.envMapIntensity;if(e.reflectivity!==undefined)r.reflectivity=e.reflectivity;if(e.refractionRatio!==undefined)r.refractionRatio=e.refractionRatio;if(e.lightMap!==undefined)r.lightMap=i(e.lightMap);if(e.lightMapIntensity!==undefined)r.lightMapIntensity=e.lightMapIntensity;if(e.aoMap!==undefined)r.aoMap=i(e.aoMap);if(e.aoMapIntensity!==undefined)r.aoMapIntensity=e.aoMapIntensity;if(e.gradientMap!==undefined)r.gradientMap=i(e.gradientMap);if(e.clearcoatMap!==undefined)r.clearcoatMap=i(e.clearcoatMap);if(e.clearcoatRoughnessMap!==undefined)r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap);if(e.clearcoatNormalMap!==undefined)r.clearcoatNormalMap=i(e.clearcoatNormalMap);if(e.clearcoatNormalScale!==undefined)r.clearcoatNormalScale=(new Vector2).fromArray(e.clearcoatNormalScale);return r},setTextures:function(e){this.textures=e;return this}});var LoaderUtils={decodeText:function(e){if(typeof TextDecoder!=="undefined"){return(new TextDecoder).decode(e)}var t="";for(var i=0,r=e.length;i<r;i++){t+=String.fromCharCode(e[i])}try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");if(t===-1)return"./";return e.substr(0,t+1)}};function InstancedBufferGeometry(){BufferGeometry.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=undefined}InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:true,copy:function(e){BufferGeometry.prototype.copy.call(this,e);this.maxInstancedCount=e.maxInstancedCount;return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=BufferGeometry.prototype.toJSON.call(this);e.maxInstancedCount=this.maxInstancedCount;e.isInstancedBufferGeometry=true;return e}});function InstancedBufferAttribute(e,t,i,r){if(typeof i==="number"){r=i;i=false;console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")}BufferAttribute.call(this,e,t,i);this.meshPerAttribute=r||1}InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:true,copy:function(e){BufferAttribute.prototype.copy.call(this,e);this.meshPerAttribute=e.meshPerAttribute;return this},toJSON:function(){var e=BufferAttribute.prototype.toJSON.call(this);e.meshPerAttribute=this.meshPerAttribute;e.isInstancedBufferAttribute=true;return e}});function BufferGeometryLoader(e){Loader.call(this,e)}BufferGeometryLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:BufferGeometryLoader,load:function(e,t,i,r){var n=this;var a=new FileLoader(n.manager);a.setPath(n.path);a.load(e,(function(e){t(n.parse(JSON.parse(e)))}),i,r)},parse:function(e){var t=e.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry;var i=e.data.index;if(i!==undefined){var r=new TYPED_ARRAYS[i.type](i.array);t.setIndex(new BufferAttribute(r,1))}var n=e.data.attributes;for(var a in n){var o=n[a];var r=new TYPED_ARRAYS[o.type](o.array);var s=o.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute;var l=new s(r,o.itemSize,o.normalized);if(o.name!==undefined)l.name=o.name;t.setAttribute(a,l)}var c=e.data.morphAttributes;if(c){for(var a in c){var u=c[a];var h=[];for(var p=0,m=u.length;p<m;p++){var o=u[p];var r=new TYPED_ARRAYS[o.type](o.array);var l=new BufferAttribute(r,o.itemSize,o.normalized);if(o.name!==undefined)l.name=o.name;h.push(l)}t.morphAttributes[a]=h}}var f=e.data.morphTargetsRelative;if(f){t.morphTargetsRelative=true}var d=e.data.groups||e.data.drawcalls||e.data.offsets;if(d!==undefined){for(var p=0,_=d.length;p!==_;++p){var y=d[p];t.addGroup(y.start,y.count,y.materialIndex)}}var v=e.data.boundingSphere;if(v!==undefined){var g=new Vector3;if(v.center!==undefined){g.fromArray(v.center)}t.boundingSphere=new Sphere(g,v.radius)}if(e.name)t.name=e.name;if(e.userData)t.userData=e.userData;return t}});var TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray!=="undefined"?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ObjectLoader(e){Loader.call(this,e)}ObjectLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ObjectLoader,load:function(e,t,i,r){var n=this;var a=this.path===""?LoaderUtils.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;var o=new FileLoader(n.manager);o.setPath(this.path);o.load(e,(function(i){var a=null;try{a=JSON.parse(i)}catch(t){if(r!==undefined)r(t);console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message);return}var o=a.metadata;if(o===undefined||o.type===undefined||o.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e);return}n.parse(a,t)}),i,r)},parse:function(e,t){var i=this.parseShape(e.shapes);var r=this.parseGeometries(e.geometries,i);var n=this.parseImages(e.images,(function(){if(t!==undefined)t(s)}));var a=this.parseTextures(e.textures,n);var o=this.parseMaterials(e.materials,a);var s=this.parseObject(e.object,r,o);if(e.animations){s.animations=this.parseAnimations(e.animations)}if(e.images===undefined||e.images.length===0){if(t!==undefined)t(s)}return s},parseShape:function(e){var t={};if(e!==undefined){for(var i=0,r=e.length;i<r;i++){var n=(new Shape).fromJSON(e[i]);t[n.uuid]=n}}return t},parseGeometries:function(e,t){var i={};if(e!==undefined){var r=new BufferGeometryLoader;for(var n=0,a=e.length;n<a;n++){var o;var s=e[n];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new Geometries[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new Geometries[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new Geometries[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new Geometries[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new Geometries[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new Geometries[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new Geometries[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new Geometries[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new Geometries[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new Geometries[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new Geometries[s.type]((new Curves[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new Geometries[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new Geometries[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":var l=[];for(var c=0,u=s.shapes.length;c<u;c++){var h=t[s.shapes[c]];l.push(h)}o=new Geometries[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":var l=[];for(var c=0,u=s.shapes.length;c<u;c++){var h=t[s.shapes[c]];l.push(h)}var p=s.options.extrudePath;if(p!==undefined){s.options.extrudePath=(new Curves[p.type]).fromJSON(p)}o=new Geometries[s.type](l,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(s);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid;if(s.name!==undefined)o.name=s.name;if(o.isBufferGeometry===true&&s.userData!==undefined)o.userData=s.userData;i[s.uuid]=o}}return i},parseMaterials:function(e,t){var i={};var r={};if(e!==undefined){var n=new MaterialLoader;n.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=e[a];if(s.type==="MultiMaterial"){var l=[];for(var c=0;c<s.materials.length;c++){var u=s.materials[c];if(i[u.uuid]===undefined){i[u.uuid]=n.parse(u)}l.push(i[u.uuid])}r[s.uuid]=l}else{if(i[s.uuid]===undefined){i[s.uuid]=n.parse(s)}r[s.uuid]=i[s.uuid]}}}return r},parseAnimations:function(e){var t=[];for(var i=0;i<e.length;i++){var r=e[i];var n=AnimationClip.parse(r);if(r.uuid!==undefined)n.uuid=r.uuid;t.push(n)}return t},parseImages:function(e,t){var i=this;var r={};function n(e){i.manager.itemStart(e);return o.load(e,(function(){i.manager.itemEnd(e)}),undefined,(function(){i.manager.itemError(e);i.manager.itemEnd(e)}))}if(e!==undefined&&e.length>0){var a=new LoadingManager(t);var o=new ImageLoader(a);o.setCrossOrigin(this.crossOrigin);for(var s=0,l=e.length;s<l;s++){var c=e[s];var u=c.url;if(Array.isArray(u)){r[c.uuid]=[];for(var h=0,p=u.length;h<p;h++){var m=u[h];var f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(m)?m:i.resourcePath+m;r[c.uuid].push(n(f))}}else{var f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:i.resourcePath+c.url;r[c.uuid]=n(f)}}}return r},parseTextures:function(e,t){function i(e,t){if(typeof e==="number")return e;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e);return t[e]}var r={};if(e!==undefined){for(var n=0,a=e.length;n<a;n++){var o=e[n];if(o.image===undefined){console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid)}if(t[o.image]===undefined){console.warn("THREE.ObjectLoader: Undefined image",o.image)}var s;if(Array.isArray(t[o.image])){s=new CubeTexture(t[o.image])}else{s=new Texture(t[o.image])}s.needsUpdate=true;s.uuid=o.uuid;if(o.name!==undefined)s.name=o.name;if(o.mapping!==undefined)s.mapping=i(o.mapping,TEXTURE_MAPPING);if(o.offset!==undefined)s.offset.fromArray(o.offset);if(o.repeat!==undefined)s.repeat.fromArray(o.repeat);if(o.center!==undefined)s.center.fromArray(o.center);if(o.rotation!==undefined)s.rotation=o.rotation;if(o.wrap!==undefined){s.wrapS=i(o.wrap[0],TEXTURE_WRAPPING);s.wrapT=i(o.wrap[1],TEXTURE_WRAPPING)}if(o.format!==undefined)s.format=o.format;if(o.type!==undefined)s.type=o.type;if(o.encoding!==undefined)s.encoding=o.encoding;if(o.minFilter!==undefined)s.minFilter=i(o.minFilter,TEXTURE_FILTER);if(o.magFilter!==undefined)s.magFilter=i(o.magFilter,TEXTURE_FILTER);if(o.anisotropy!==undefined)s.anisotropy=o.anisotropy;if(o.flipY!==undefined)s.flipY=o.flipY;if(o.premultiplyAlpha!==undefined)s.premultiplyAlpha=o.premultiplyAlpha;if(o.unpackAlignment!==undefined)s.unpackAlignment=o.unpackAlignment;r[o.uuid]=s}}return r},parseObject:function(e,t,i){var r;function n(e){if(t[e]===undefined){console.warn("THREE.ObjectLoader: Undefined geometry",e)}return t[e]}function a(e){if(e===undefined)return undefined;if(Array.isArray(e)){var t=[];for(var r=0,n=e.length;r<n;r++){var a=e[r];if(i[a]===undefined){console.warn("THREE.ObjectLoader: Undefined material",a)}t.push(i[a])}return t}if(i[e]===undefined){console.warn("THREE.ObjectLoader: Undefined material",e)}return i[e]}switch(e.type){case"Scene":r=new Scene;if(e.background!==undefined){if(Number.isInteger(e.background)){r.background=new Color(e.background)}}if(e.fog!==undefined){if(e.fog.type==="Fog"){r.fog=new Fog(e.fog.color,e.fog.near,e.fog.far)}else if(e.fog.type==="FogExp2"){r.fog=new FogExp2(e.fog.color,e.fog.density)}}break;case"PerspectiveCamera":r=new PerspectiveCamera(e.fov,e.aspect,e.near,e.far);if(e.focus!==undefined)r.focus=e.focus;if(e.zoom!==undefined)r.zoom=e.zoom;if(e.filmGauge!==undefined)r.filmGauge=e.filmGauge;if(e.filmOffset!==undefined)r.filmOffset=e.filmOffset;if(e.view!==undefined)r.view=Object.assign({},e.view);break;case"OrthographicCamera":r=new OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far);if(e.zoom!==undefined)r.zoom=e.zoom;if(e.view!==undefined)r.view=Object.assign({},e.view);break;case"AmbientLight":r=new AmbientLight(e.color,e.intensity);break;case"DirectionalLight":r=new DirectionalLight(e.color,e.intensity);break;case"PointLight":r=new PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new HemisphereLight(e.color,e.groundColor,e.intensity);break;case"LightProbe":r=(new LightProbe).fromJSON(e);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=n(e.geometry);var s=a(e.material);r=new Mesh(o,s);break;case"InstancedMesh":var o=n(e.geometry);var s=a(e.material);var l=e.count;var c=e.instanceMatrix;r=new InstancedMesh(o,s,l);r.instanceMatrix=new BufferAttribute(new Float32Array(c.array),16);break;case"LOD":r=new LOD;break;case"Line":r=new Line(n(e.geometry),a(e.material),e.mode);break;case"LineLoop":r=new LineLoop(n(e.geometry),a(e.material));break;case"LineSegments":r=new LineSegments(n(e.geometry),a(e.material));break;case"PointCloud":case"Points":r=new Points(n(e.geometry),a(e.material));break;case"Sprite":r=new Sprite(a(e.material));break;case"Group":r=new Group;break;default:r=new Object3D}r.uuid=e.uuid;if(e.name!==undefined)r.name=e.name;if(e.matrix!==undefined){r.matrix.fromArray(e.matrix);if(e.matrixAutoUpdate!==undefined)r.matrixAutoUpdate=e.matrixAutoUpdate;if(r.matrixAutoUpdate)r.matrix.decompose(r.position,r.quaternion,r.scale)}else{if(e.position!==undefined)r.position.fromArray(e.position);if(e.rotation!==undefined)r.rotation.fromArray(e.rotation);if(e.quaternion!==undefined)r.quaternion.fromArray(e.quaternion);if(e.scale!==undefined)r.scale.fromArray(e.scale)}if(e.castShadow!==undefined)r.castShadow=e.castShadow;if(e.receiveShadow!==undefined)r.receiveShadow=e.receiveShadow;if(e.shadow){if(e.shadow.bias!==undefined)r.shadow.bias=e.shadow.bias;if(e.shadow.radius!==undefined)r.shadow.radius=e.shadow.radius;if(e.shadow.mapSize!==undefined)r.shadow.mapSize.fromArray(e.shadow.mapSize);if(e.shadow.camera!==undefined)r.shadow.camera=this.parseObject(e.shadow.camera)}if(e.visible!==undefined)r.visible=e.visible;if(e.frustumCulled!==undefined)r.frustumCulled=e.frustumCulled;if(e.renderOrder!==undefined)r.renderOrder=e.renderOrder;if(e.userData!==undefined)r.userData=e.userData;if(e.layers!==undefined)r.layers.mask=e.layers;if(e.children!==undefined){var u=e.children;for(var h=0;h<u.length;h++){r.add(this.parseObject(u[h],t,i))}}if(e.type==="LOD"){if(e.autoUpdate!==undefined)r.autoUpdate=e.autoUpdate;var p=e.levels;for(var m=0;m<p.length;m++){var f=p[m];var d=r.getObjectByProperty("uuid",f.object);if(d!==undefined){r.addLevel(d,f.distance)}}}return r}});var TEXTURE_MAPPING={UVMapping:UVMapping,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,SphericalReflectionMapping:SphericalReflectionMapping,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping};var TEXTURE_WRAPPING={RepeatWrapping:RepeatWrapping,ClampToEdgeWrapping:ClampToEdgeWrapping,MirroredRepeatWrapping:MirroredRepeatWrapping};var TEXTURE_FILTER={NearestFilter:NearestFilter,NearestMipmapNearestFilter:NearestMipmapNearestFilter,NearestMipmapLinearFilter:NearestMipmapLinearFilter,LinearFilter:LinearFilter,LinearMipmapNearestFilter:LinearMipmapNearestFilter,LinearMipmapLinearFilter:LinearMipmapLinearFilter};function ImageBitmapLoader(e){if(typeof createImageBitmap==="undefined"){console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported.")}if(typeof fetch==="undefined"){console.warn("THREE.ImageBitmapLoader: fetch() not supported.")}Loader.call(this,e);this.options=undefined}ImageBitmapLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageBitmapLoader,setOptions:function e(t){this.options=t;return this},load:function(e,t,i,r){if(e===undefined)e="";if(this.path!==undefined)e=this.path+e;e=this.manager.resolveURL(e);var n=this;var a=Cache.get(e);if(a!==undefined){n.manager.itemStart(e);setTimeout((function(){if(t)t(a);n.manager.itemEnd(e)}),0);return a}fetch(e).then((function(e){return e.blob()})).then((function(e){if(n.options===undefined){return createImageBitmap(e)}else{return createImageBitmap(e,n.options)}})).then((function(i){Cache.add(e,i);if(t)t(i);n.manager.itemEnd(e)})).catch((function(t){if(r)r(t);n.manager.itemError(e);n.manager.itemEnd(e)}));n.manager.itemStart(e)}});function ShapePath(){this.type="ShapePath";this.color=new Color;this.subPaths=[];this.currentPath=null}Object.assign(ShapePath.prototype,{moveTo:function(e,t){this.currentPath=new Path;this.subPaths.push(this.currentPath);this.currentPath.moveTo(e,t);return this},lineTo:function(e,t){this.currentPath.lineTo(e,t);return this},quadraticCurveTo:function(e,t,i,r){this.currentPath.quadraticCurveTo(e,t,i,r);return this},bezierCurveTo:function(e,t,i,r,n,a){this.currentPath.bezierCurveTo(e,t,i,r,n,a);return this},splineThru:function(e){this.currentPath.splineThru(e);return this},toShapes:function(e,t){function i(e){var t=[];for(var i=0,r=e.length;i<r;i++){var n=e[i];var a=new Shape;a.curves=n.curves;t.push(a)}return t}function r(e,t){var i=t.length;var r=false;for(var n=i-1,a=0;a<i;n=a++){var o=t[n];var s=t[a];var l=s.x-o.x;var c=s.y-o.y;if(Math.abs(c)>Number.EPSILON){if(c<0){o=t[a];l=-l;s=t[n];c=-c}if(e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return true}else{var u=c*(e.x-o.x)-l*(e.y-o.y);if(u===0)return true;if(u<0)continue;r=!r}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return true}}return r}var n=ShapeUtils.isClockWise;var a=this.subPaths;if(a.length===0)return[];if(t===true)return i(a);var o,s,l,c=[];if(a.length===1){s=a[0];l=new Shape;l.curves=s.curves;c.push(l);return c}var u=!n(a[0].getPoints());u=e?!u:u;var h=[];var p=[];var m=[];var f=0;var d;p[f]=undefined;m[f]=[];for(var _=0,y=a.length;_<y;_++){s=a[_];d=s.getPoints();o=n(d);o=e?!o:o;if(o){if(!u&&p[f])f++;p[f]={s:new Shape,p:d};p[f].s.curves=s.curves;if(u)f++;m[f]=[]}else{m[f].push({h:s,p:d[0]})}}if(!p[0])return i(a);if(p.length>1){var v=false;var g=[];for(var x=0,b=p.length;x<b;x++){h[x]=[]}for(var x=0,b=p.length;x<b;x++){var M=m[x];for(var w=0;w<M.length;w++){var S=M[w];var A=true;for(var C=0;C<p.length;C++){if(r(S.p,p[C].p)){if(x!==C)g.push({froms:x,tos:C,hole:w});if(A){A=false;h[C].push(S)}else{v=true}}}if(A){h[x].push(S)}}}if(g.length>0){if(!v)m=h}}var T;for(var _=0,B=p.length;_<B;_++){l=p[_].s;c.push(l);T=m[_];for(var L=0,D=T.length;L<D;L++){l.holes.push(T[L].h)}}return c}});function Font(e){this.type="Font";this.data=e}Object.assign(Font.prototype,{isFont:true,generateShapes:function(e,t){if(t===undefined)t=100;var i=[];var r=createPaths(e,t,this.data);for(var n=0,a=r.length;n<a;n++){Array.prototype.push.apply(i,r[n].toShapes())}return i}});function createPaths(e,t,i){var r=Array.from?Array.from(e):String(e).split("");var n=t/i.resolution;var a=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*n;var o=[];var s=0,l=0;for(var c=0;c<r.length;c++){var u=r[c];if(u==="\n"){s=0;l-=a}else{var h=createPath(u,n,s,l,i);s+=h.offsetX;o.push(h.path)}}return o}function createPath(e,t,i,r,n){var a=n.glyphs[e]||n.glyphs["?"];if(!a){console.error('THREE.Font: character "'+e+'" does not exists in font family '+n.familyName+".");return}var o=new ShapePath;var s,l,c,u,h,p,m,f;if(a.o){var d=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(var _=0,y=d.length;_<y;){var v=d[_++];switch(v){case"m":s=d[_++]*t+i;l=d[_++]*t+r;o.moveTo(s,l);break;case"l":s=d[_++]*t+i;l=d[_++]*t+r;o.lineTo(s,l);break;case"q":c=d[_++]*t+i;u=d[_++]*t+r;h=d[_++]*t+i;p=d[_++]*t+r;o.quadraticCurveTo(h,p,c,u);break;case"b":c=d[_++]*t+i;u=d[_++]*t+r;h=d[_++]*t+i;p=d[_++]*t+r;m=d[_++]*t+i;f=d[_++]*t+r;o.bezierCurveTo(h,p,m,f,c,u);break}}}return{offsetX:a.ha*t,path:o}}function FontLoader(e){Loader.call(this,e)}FontLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FontLoader,load:function(e,t,i,r){var n=this;var a=new FileLoader(this.manager);a.setPath(this.path);a.load(e,(function(e){var i;try{i=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead.");i=JSON.parse(e.substring(65,e.length-2))}var r=n.parse(i);if(t)t(r)}),i,r)},parse:function(e){return new Font(e)}});var _context;var AudioContext={getContext:function(){if(_context===undefined){_context=new(window.AudioContext||window.webkitAudioContext)}return _context},setContext:function(e){_context=e}};function AudioLoader(e){Loader.call(this,e)}AudioLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AudioLoader,load:function(e,t,i,r){var n=new FileLoader(this.manager);n.setResponseType("arraybuffer");n.setPath(this.path);n.load(e,(function(e){var i=e.slice(0);var r=AudioContext.getContext();r.decodeAudioData(i,(function(e){t(e)}))}),i,r)}});function HemisphereLightProbe(e,t,i){LightProbe.call(this,undefined,i);var r=(new Color).set(e);var n=(new Color).set(t);var a=new Vector3(r.r,r.g,r.b);var o=new Vector3(n.r,n.g,n.b);var s=Math.sqrt(Math.PI);var l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s);this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}HemisphereLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:HemisphereLightProbe,isHemisphereLightProbe:true,copy:function(e){LightProbe.prototype.copy.call(this,e);return this},toJSON:function(e){var t=LightProbe.prototype.toJSON.call(this,e);return t}});function AmbientLightProbe(e,t){LightProbe.call(this,undefined,t);var i=(new Color).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}AmbientLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:AmbientLightProbe,isAmbientLightProbe:true,copy:function(e){LightProbe.prototype.copy.call(this,e);return this},toJSON:function(e){var t=LightProbe.prototype.toJSON.call(this,e);return t}});var _eyeRight=new Matrix4;var _eyeLeft=new Matrix4;function StereoCamera(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new PerspectiveCamera;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=false;this.cameraR=new PerspectiveCamera;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=false;this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(StereoCamera.prototype,{update:function(e){var t=this._cache;var i=t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep;if(i){t.focus=e.focus;t.fov=e.fov;t.aspect=e.aspect*this.aspect;t.near=e.near;t.far=e.far;t.zoom=e.zoom;t.eyeSep=this.eyeSep;var r=e.projectionMatrix.clone();var n=t.eyeSep/2;var a=n*t.near/t.focus;var o=t.near*Math.tan(MathUtils.DEG2RAD*t.fov*.5)/t.zoom;var s,l;_eyeLeft.elements[12]=-n;_eyeRight.elements[12]=n;s=-o*t.aspect+a;l=o*t.aspect+a;r.elements[0]=2*t.near/(l-s);r.elements[8]=(l+s)/(l-s);this.cameraL.projectionMatrix.copy(r);s=-o*t.aspect-a;l=o*t.aspect-a;r.elements[0]=2*t.near/(l-s);r.elements[8]=(l+s)/(l-s);this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(_eyeLeft);this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_eyeRight)}});function Clock(e){this.autoStart=e!==undefined?e:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false}Object.assign(Clock.prototype,{start:function(){this.startTime=(typeof performance==="undefined"?Date:performance).now();this.oldTime=this.startTime;this.elapsedTime=0;this.running=true},stop:function(){this.getElapsedTime();this.running=false;this.autoStart=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running){this.start();return 0}if(this.running){var t=(typeof performance==="undefined"?Date:performance).now();e=(t-this.oldTime)/1e3;this.oldTime=t;this.elapsedTime+=e}return e}});var _position$2=new Vector3;var _quaternion$3=new Quaternion;var _scale$1=new Vector3;var _orientation=new Vector3;function AudioListener(){Object3D.call(this);this.type="AudioListener";this.context=AudioContext.getContext();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null;this.timeDelta=0;this._clock=new Clock}AudioListener.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:AudioListener,getInput:function(){return this.gain},removeFilter:function(){if(this.filter!==null){this.gain.disconnect(this.filter);this.filter.disconnect(this.context.destination);this.gain.connect(this.context.destination);this.filter=null}return this},getFilter:function(){return this.filter},setFilter:function(e){if(this.filter!==null){this.gain.disconnect(this.filter);this.filter.disconnect(this.context.destination)}else{this.gain.disconnect(this.context.destination)}this.filter=e;this.gain.connect(this.filter);this.filter.connect(this.context.destination);return this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01);return this},updateMatrixWorld:function(e){Object3D.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener;var i=this.up;this.timeDelta=this._clock.getDelta();this.matrixWorld.decompose(_position$2,_quaternion$3,_scale$1);_orientation.set(0,0,-1).applyQuaternion(_quaternion$3);if(t.positionX){var r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(_position$2.x,r);t.positionY.linearRampToValueAtTime(_position$2.y,r);t.positionZ.linearRampToValueAtTime(_position$2.z,r);t.forwardX.linearRampToValueAtTime(_orientation.x,r);t.forwardY.linearRampToValueAtTime(_orientation.y,r);t.forwardZ.linearRampToValueAtTime(_orientation.z,r);t.upX.linearRampToValueAtTime(i.x,r);t.upY.linearRampToValueAtTime(i.y,r);t.upZ.linearRampToValueAtTime(i.z,r)}else{t.setPosition(_position$2.x,_position$2.y,_position$2.z);t.setOrientation(_orientation.x,_orientation.y,_orientation.z,i.x,i.y,i.z)}}});function Audio(e){Object3D.call(this);this.type="Audio";this.listener=e;this.context=e.context;this.gain=this.context.createGain();this.gain.connect(e.getInput());this.autoplay=false;this.buffer=null;this.detune=0;this.loop=false;this.loopStart=0;this.loopEnd=0;this.offset=0;this.duration=undefined;this.playbackRate=1;this.isPlaying=false;this.hasPlaybackControl=true;this.sourceType="empty";this._startedAt=0;this._progress=0;this.filters=[]}Audio.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Audio,getOutput:function(){return this.gain},setNodeSource:function(e){this.hasPlaybackControl=false;this.sourceType="audioNode";this.source=e;this.connect();return this},setMediaElementSource:function(e){this.hasPlaybackControl=false;this.sourceType="mediaNode";this.source=this.context.createMediaElementSource(e);this.connect();return this},setMediaStreamSource:function(e){this.hasPlaybackControl=false;this.sourceType="mediaStreamNode";this.source=this.context.createMediaStreamSource(e);this.connect();return this},setBuffer:function(e){this.buffer=e;this.sourceType="buffer";if(this.autoplay)this.play();return this},play:function(e){if(e===undefined)e=0;if(this.isPlaying===true){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===false){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();t.buffer=this.buffer;t.loop=this.loop;t.loopStart=this.loopStart;t.loopEnd=this.loopEnd;t.onended=this.onEnded.bind(this);t.start(this._startedAt,this._progress+this.offset,this.duration);this.isPlaying=true;this.source=t;this.setDetune(this.detune);this.setPlaybackRate(this.playbackRate);return this.connect()},pause:function(){if(this.hasPlaybackControl===false){console.warn("THREE.Audio: this Audio has no playback control.");return}if(this.isPlaying===true){this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate;if(this.loop===true){this._progress=this._progress%(this.duration||this.buffer.duration)}this.source.stop();this.source.onended=null;this.isPlaying=false}return this},stop:function(){if(this.hasPlaybackControl===false){console.warn("THREE.Audio: this Audio has no playback control.");return}this._progress=0;this.source.stop();this.source.onended=null;this.isPlaying=false;return this},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++){this.filters[e-1].connect(this.filters[e])}this.filters[this.filters.length-1].connect(this.getOutput())}else{this.source.connect(this.getOutput())}return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++){this.filters[e-1].disconnect(this.filters[e])}this.filters[this.filters.length-1].disconnect(this.getOutput())}else{this.source.disconnect(this.getOutput())}return this},getFilters:function(){return this.filters},setFilters:function(e){if(!e)e=[];if(this.isPlaying===true){this.disconnect();this.filters=e;this.connect()}else{this.filters=e}return this},setDetune:function(e){this.detune=e;if(this.source.detune===undefined)return;if(this.isPlaying===true){this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01)}return this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(this.hasPlaybackControl===false){console.warn("THREE.Audio: this Audio has no playback control.");return}this.playbackRate=e;if(this.isPlaying===true){this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01)}return this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=false},getLoop:function(){if(this.hasPlaybackControl===false){console.warn("THREE.Audio: this Audio has no playback control.");return false}return this.loop},setLoop:function(e){if(this.hasPlaybackControl===false){console.warn("THREE.Audio: this Audio has no playback control.");return}this.loop=e;if(this.isPlaying===true){this.source.loop=this.loop}return this},setLoopStart:function(e){this.loopStart=e;return this},setLoopEnd:function(e){this.loopEnd=e;return this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01);return this}});var _position$3=new Vector3;var _quaternion$4=new Quaternion;var _scale$2=new Vector3;var _orientation$1=new Vector3;function PositionalAudio(e){Audio.call(this,e);this.panner=this.context.createPanner();this.panner.panningModel="HRTF";this.panner.connect(this.gain)}PositionalAudio.prototype=Object.assign(Object.create(Audio.prototype),{constructor:PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){this.panner.refDistance=e;return this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){this.panner.rolloffFactor=e;return this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){this.panner.distanceModel=e;return this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){this.panner.maxDistance=e;return this},setDirectionalCone:function(e,t,i){this.panner.coneInnerAngle=e;this.panner.coneOuterAngle=t;this.panner.coneOuterGain=i;return this},updateMatrixWorld:function(e){Object3D.prototype.updateMatrixWorld.call(this,e);if(this.hasPlaybackControl===true&&this.isPlaying===false)return;this.matrixWorld.decompose(_position$3,_quaternion$4,_scale$2);_orientation$1.set(0,0,1).applyQuaternion(_quaternion$4);var t=this.panner;if(t.positionX){var i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(_position$3.x,i);t.positionY.linearRampToValueAtTime(_position$3.y,i);t.positionZ.linearRampToValueAtTime(_position$3.z,i);t.orientationX.linearRampToValueAtTime(_orientation$1.x,i);t.orientationY.linearRampToValueAtTime(_orientation$1.y,i);t.orientationZ.linearRampToValueAtTime(_orientation$1.z,i)}else{t.setPosition(_position$3.x,_position$3.y,_position$3.z);t.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z)}}});function AudioAnalyser(e,t){this.analyser=e.context.createAnalyser();this.analyser.fftSize=t!==undefined?t:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);e.getOutput().connect(this.analyser)}Object.assign(AudioAnalyser.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){var e=0,t=this.getFrequencyData();for(var i=0;i<t.length;i++){e+=t[i]}return e/t.length}});function PropertyMixer(e,t,i){this.binding=e;this.valueSize=i;var r,n,a;switch(t){case"quaternion":r=this._slerp;n=this._slerpAdditive;a=this._setAdditiveIdentityQuaternion;this.buffer=new Float64Array(i*6);this._workIndex=5;break;case"string":case"bool":r=this._select;n=this._select;a=this._setAdditiveIdentityOther;this.buffer=new Array(i*5);break;default:r=this._lerp;n=this._lerpAdditive;a=this._setAdditiveIdentityNumeric;this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r;this._mixBufferRegionAdditive=n;this._setIdentity=a;this._origIndex=3;this._addIndex=4;this.cumulativeWeight=0;this.cumulativeWeightAdditive=0;this.useCount=0;this.referenceCount=0}Object.assign(PropertyMixer.prototype,{accumulate:function(e,t){var i=this.buffer,r=this.valueSize,n=e*r+r,a=this.cumulativeWeight;if(a===0){for(var o=0;o!==r;++o){i[n+o]=i[o]}a=t}else{a+=t;var s=t/a;this._mixBufferRegion(i,n,0,s,r)}this.cumulativeWeight=a},accumulateAdditive:function(e){var t=this.buffer,i=this.valueSize,r=i*this._addIndex;if(this.cumulativeWeightAdditive===0){this._setIdentity()}this._mixBufferRegionAdditive(t,r,0,e,i);this.cumulativeWeightAdditive+=e},apply:function(e){var t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;this.cumulativeWeight=0;this.cumulativeWeightAdditive=0;if(n<1){var s=t*this._origIndex;this._mixBufferRegion(i,r,s,1-n,t)}if(a>0){this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t)}for(var l=t,c=t+t;l!==c;++l){if(i[l]!==i[l+t]){o.setValue(i,r);break}}},saveOriginalState:function(){var e=this.binding;var t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(var n=i,a=r;n!==a;++n){t[n]=t[r+n%i]}this._setIdentity();this.cumulativeWeight=0;this.cumulativeWeightAdditive=0},restoreOriginalState:function(){var e=this.valueSize*3;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){var e=this._addIndex*this.valueSize;this.buffer.fill(0,e,e+this.valueSize)},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric();this.buffer[this._addIndex*4+3]=1},_setAdditiveIdentityOther:function(){var e=this._origIndex*this.valueSize;var t=this._addIndex*this.valueSize;this.buffer.copyWithin(t,e,this.valueSize)},_select:function(e,t,i,r,n){if(r>=.5){for(var a=0;a!==n;++a){e[t+a]=e[i+a]}}},_slerp:function(e,t,i,r){Quaternion.slerpFlat(e,t,e,t,e,i,r)},_slerpAdditive:function(e,t,i,r,n){var a=this._workIndex*n;Quaternion.multiplyQuaternionsFlat(e,a,e,t,e,i);Quaternion.slerpFlat(e,t,e,t,e,a,r)},_lerp:function(e,t,i,r,n){var a=1-r;for(var o=0;o!==n;++o){var s=t+o;e[s]=e[s]*a+e[i+o]*r}},_lerpAdditive:function(e,t,i,r,n){for(var a=0;a!==n;++a){var o=t+a;e[o]=e[o]+e[i+a]*r}}});var _RESERVED_CHARS_RE="\\[\\]\\.:\\/";var _reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g");var _wordChar="[^"+_RESERVED_CHARS_RE+"]";var _wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]";var _directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar);var _nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot);var _objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar);var _propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar);var _trackRe=new RegExp(""+"^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$");var _supportedObjectNames=["material","materials","bones"];function Composite(e,t,i){var r=i||PropertyBinding.parseTrackName(t);this._targetGroup=e;this._bindings=e.subscribe_(t,r)}Object.assign(Composite.prototype,{getValue:function(e,t){this.bind();var i=this._targetGroup.nCachedObjects_,r=this._bindings[i];if(r!==undefined)r.getValue(e,t)},setValue:function(e,t){var i=this._bindings;for(var r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r){i[r].setValue(e,t)}},bind:function(){var e=this._bindings;for(var t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t){e[t].bind()}},unbind:function(){var e=this._bindings;for(var t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t){e[t].unbind()}}});function PropertyBinding(e,t,i){this.path=t;this.parsedPath=i||PropertyBinding.parseTrackName(t);this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName)||e;this.rootNode=e}Object.assign(PropertyBinding,{Composite:Composite,create:function(e,t,i){if(!(e&&e.isAnimationObjectGroup)){return new PropertyBinding(e,t,i)}else{return new PropertyBinding.Composite(e,t,i)}},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(_reservedRe,"")},parseTrackName:function(e){var t=_trackRe.exec(e);if(!t){throw new Error("PropertyBinding: Cannot parse trackName: "+e)}var i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]};var r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==undefined&&r!==-1){var n=i.nodeName.substring(r+1);if(_supportedObjectNames.indexOf(n)!==-1){i.nodeName=i.nodeName.substring(0,r);i.objectName=n}}if(i.propertyName===null||i.propertyName.length===0){throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e)}return i},findNode:function(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid){return e}if(e.skeleton){var i=e.skeleton.getBoneByName(t);if(i!==undefined){return i}}if(e.children){var r=function(e){for(var i=0;i<e.length;i++){var n=e[i];if(n.name===t||n.uuid===t){return n}var a=r(n.children);if(a)return a}return null};var n=r(e.children);if(n){return n}}return null}});Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function e(t,i){t[i]=this.node[this.propertyName]},function e(t,i){var r=this.resolvedProperty;for(var n=0,a=r.length;n!==a;++n){t[i++]=r[n]}},function e(t,i){t[i]=this.resolvedProperty[this.propertyIndex]},function e(t,i){this.resolvedProperty.toArray(t,i)}],SetterByBindingTypeAndVersioning:[[function e(t,i){this.targetObject[this.propertyName]=t[i]},function e(t,i){this.targetObject[this.propertyName]=t[i];this.targetObject.needsUpdate=true},function e(t,i){this.targetObject[this.propertyName]=t[i];this.targetObject.matrixWorldNeedsUpdate=true}],[function e(t,i){var r=this.resolvedProperty;for(var n=0,a=r.length;n!==a;++n){r[n]=t[i++]}},function e(t,i){var r=this.resolvedProperty;for(var n=0,a=r.length;n!==a;++n){r[n]=t[i++]}this.targetObject.needsUpdate=true},function e(t,i){var r=this.resolvedProperty;for(var n=0,a=r.length;n!==a;++n){r[n]=t[i++]}this.targetObject.matrixWorldNeedsUpdate=true}],[function e(t,i){this.resolvedProperty[this.propertyIndex]=t[i]},function e(t,i){this.resolvedProperty[this.propertyIndex]=t[i];this.targetObject.needsUpdate=true},function e(t,i){this.resolvedProperty[this.propertyIndex]=t[i];this.targetObject.matrixWorldNeedsUpdate=true}],[function e(t,i){this.resolvedProperty.fromArray(t,i)},function e(t,i){this.resolvedProperty.fromArray(t,i);this.targetObject.needsUpdate=true},function e(t,i){this.resolvedProperty.fromArray(t,i);this.targetObject.matrixWorldNeedsUpdate=true}]],getValue:function e(t,i){this.bind();this.getValue(t,i)},setValue:function e(t,i){this.bind();this.setValue(t,i)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(!e){e=PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode;this.node=e}this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){var a=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(var o=0;o<e.length;o++){if(e[o].name===a){a=o;break}}break;default:if(e[i]===undefined){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(a!==undefined){if(e[a]===undefined){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[a]}}var s=e[r];if(s===undefined){var l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",e);return}var c=this.Versioning.None;this.targetObject=e;if(e.needsUpdate!==undefined){c=this.Versioning.NeedsUpdate}else if(e.matrixWorldNeedsUpdate!==undefined){c=this.Versioning.MatrixWorldNeedsUpdate}var u=this.BindingType.Direct;if(n!==undefined){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}for(var o=0;o<this.node.geometry.morphAttributes.position.length;o++){if(e.geometry.morphAttributes.position[o].name===n){n=o;break}}}else{if(!e.geometry.morphTargets){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);return}for(var o=0;o<this.node.geometry.morphTargets.length;o++){if(e.geometry.morphTargets[o].name===n){n=o;break}}}}u=this.BindingType.ArrayElement;this.resolvedProperty=s;this.propertyIndex=n}else if(s.fromArray!==undefined&&s.toArray!==undefined){u=this.BindingType.HasFromToArray;this.resolvedProperty=s}else if(Array.isArray(s)){u=this.BindingType.EntireArray;this.resolvedProperty=s}else{this.propertyName=r}this.getValue=this.GetterByBindingType[u];this.setValue=this.SetterByBindingTypeAndVersioning[u][c]},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}});Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue});function AnimationObjectGroup(){this.uuid=MathUtils.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,i=arguments.length;t!==i;++t){e[arguments[t].uuid]=t}this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:true,add:function(){var e=this._objects,t=e.length,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,l=undefined;for(var c=0,u=arguments.length;c!==u;++c){var h=arguments[c],p=h.uuid,m=r[p];if(m===undefined){m=t++;r[p]=m;e.push(h);for(var f=0,d=s;f!==d;++f){o[f].push(new PropertyBinding(h,n[f],a[f]))}}else if(m<i){l=e[m];var _=--i,y=e[_];r[y.uuid]=m;e[m]=y;r[p]=_;e[_]=h;for(var f=0,d=s;f!==d;++f){var v=o[f],g=v[_],x=v[m];v[m]=g;if(x===undefined){x=new PropertyBinding(h,n[f],a[f])}v[_]=x}}else if(e[m]!==l){console.error("THREE.AnimationObjectGroup: Different objects with the same UUID "+"detected. Clean the caches or recreate your infrastructure when reloading scenes.")}}this.nCachedObjects_=i},remove:function(){var e=this._objects,t=this.nCachedObjects_,i=this._indicesByUUID,r=this._bindings,n=r.length;for(var a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,c=i[l];if(c!==undefined&&c>=t){var u=t++,h=e[u];i[h.uuid]=c;e[c]=h;i[l]=u;e[u]=s;for(var p=0,m=n;p!==m;++p){var f=r[p],d=f[u],_=f[c];f[c]=d;f[u]=_}}}this.nCachedObjects_=t},uncache:function(){var e=this._objects,t=e.length,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,a=n.length;for(var o=0,s=arguments.length;o!==s;++o){var l=arguments[o],c=l.uuid,u=r[c];if(u!==undefined){delete r[c];if(u<i){var h=--i,p=e[h],m=--t,f=e[m];r[p.uuid]=u;e[u]=p;r[f.uuid]=h;e[h]=f;e.pop();for(var d=0,_=a;d!==_;++d){var y=n[d],v=y[h],g=y[m];y[u]=v;y[h]=g;y.pop()}}else{var m=--t,f=e[m];r[f.uuid]=u;e[u]=f;e.pop();for(var d=0,_=a;d!==_;++d){var y=n[d];y[u]=y[m];y.pop()}}}}this.nCachedObjects_=i},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,r=i[e],n=this._bindings;if(r!==undefined)return n[r];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);r=n.length;i[e]=r;a.push(e);o.push(t);n.push(u);for(var h=c,p=s.length;h!==p;++h){var m=s[h];u[h]=new PropertyBinding(m,e,t)}return u},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(i!==undefined){var r=this._paths,n=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o],l=e[o];t[l]=i;a[i]=s;a.pop();n[i]=n[o];n.pop();r[i]=r[o];r.pop()}}});function AnimationAction(e,t,i,r){this._mixer=e;this._clip=t;this._localRoot=i||null;this.blendMode=r||t.blendMode;var n=t.tracks,a=n.length,o=new Array(a);var s={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(var l=0;l!==a;++l){var c=n[l].createInterpolant(null);o[l]=c;c.settings=s}this._interpolantSettings=s;this._interpolants=o;this._propertyBindings=new Array(a);this._cacheIndex=null;this._byClipCacheIndex=null;this._timeScaleInterpolant=null;this._weightInterpolant=null;this.loop=LoopRepeat;this._loopCount=-1;this._startTime=null;this.time=0;this.timeScale=1;this._effectiveTimeScale=1;this.weight=1;this._effectiveWeight=1;this.repetitions=Infinity;this.paused=false;this.enabled=true;this.clampWhenFinished=false;this.zeroSlopeAtStart=true;this.zeroSlopeAtEnd=true}Object.assign(AnimationAction.prototype,{play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=false;this.enabled=true;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){this._startTime=e;return this},setLoop:function(e,t){this.loop=e;this.repetitions=t;return this},setEffectiveWeight:function(e){this.weight=e;this._effectiveWeight=this.enabled?e:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,i){e.fadeOut(t);this.fadeIn(t);if(i){var r=this._clip.duration,n=e._clip.duration,a=n/r,o=r/n;e.warp(1,a,t);this.warp(o,1,t)}return this},crossFadeTo:function(e,t,i){return e.crossFadeFrom(this,t,i)},stopFading:function(){var e=this._weightInterpolant;if(e!==null){this._weightInterpolant=null;this._mixer._takeBackControlInterpolant(e)}return this},setEffectiveTimeScale:function(e){this.timeScale=e;this._effectiveTimeScale=this.paused?0:e;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){this.timeScale=this._clip.duration/e;return this.stopWarping()},syncWith:function(e){this.time=e.time;this.timeScale=e.timeScale;return this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,i){var r=this._mixer,n=r.time,a=this._timeScaleInterpolant,o=this.timeScale;if(a===null){a=r._lendControlInterpolant();this._timeScaleInterpolant=a}var s=a.parameterPositions,l=a.sampleValues;s[0]=n;s[1]=n+i;l[0]=e/o;l[1]=t/o;return this},stopWarping:function(){var e=this._timeScaleInterpolant;if(e!==null){this._timeScaleInterpolant=null;this._mixer._takeBackControlInterpolant(e)}return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}var n=this._startTime;if(n!==null){var a=(e-n)*i;if(a<0||i===0){return}this._startTime=null;t=i*a}t*=this._updateTimeScale(e);var o=this._updateTime(t);var s=this._updateWeight(e);if(s>0){var l=this._interpolants;var c=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(var u=0,h=l.length;u!==h;++u){l[u].evaluate(o);c[u].accumulateAdditive(s)}break;case NormalAnimationBlendMode:default:for(var u=0,h=l.length;u!==h;++u){l[u].evaluate(o);c[u].accumulate(r,s)}}}},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(i!==null){var r=i.evaluate(e)[0];t*=r;if(e>i.parameterPositions[1]){this.stopFading();if(r===0){this.enabled=false}}}}this._effectiveWeight=t;return t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;if(i!==null){var r=i.evaluate(e)[0];t*=r;if(e>i.parameterPositions[1]){this.stopWarping();if(t===0){this.paused=true}else{this.timeScale=t}}}}this._effectiveTimeScale=t;return t},_updateTime:function(e){var t=this.time+e;var i=this._clip.duration;var r=this.loop;var n=this._loopCount;var a=r===LoopPingPong;if(e===0){if(n===-1)return t;return a&&(n&1)===1?i-t:t}if(r===LoopOnce){if(n===-1){this._loopCount=0;this._setEndings(true,true,false)}e:{if(t>=i){t=i}else if(t<0){t=0}else{this.time=t;break e}if(this.clampWhenFinished)this.paused=true;else this.enabled=false;this.time=t;this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(n===-1){if(e>=0){n=0;this._setEndings(true,this.repetitions===0,a)}else{this._setEndings(this.repetitions===0,true,a)}}if(t>=i||t<0){var o=Math.floor(t/i);t-=i*o;n+=Math.abs(o);var s=this.repetitions-n;if(s<=0){if(this.clampWhenFinished)this.paused=true;else this.enabled=false;t=e>0?i:0;this.time=t;this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1})}else{if(s===1){var l=e<0;this._setEndings(l,!l,a)}else{this._setEndings(false,false,a)}this._loopCount=n;this.time=t;this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else{this.time=t}if(a&&(n&1)===1){return i-t}}return t},_setEndings:function(e,t,i){var r=this._interpolantSettings;if(i){r.endingStart=ZeroSlopeEnding;r.endingEnd=ZeroSlopeEnding}else{if(e){r.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding}else{r.endingStart=WrapAroundEnding}if(t){r.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding}else{r.endingEnd=WrapAroundEnding}}},_scheduleFading:function(e,t,i){var r=this._mixer,n=r.time,a=this._weightInterpolant;if(a===null){a=r._lendControlInterpolant();this._weightInterpolant=a}var o=a.parameterPositions,s=a.sampleValues;o[0]=n;s[0]=t;o[1]=n+e;s[1]=i;return this}});function AnimationMixer(e){this._root=e;this._initMemoryManager();this._accuIndex=0;this.time=0;this.timeScale=1}AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function(e,t){var i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,a=e._propertyBindings,o=e._interpolants,s=i.uuid,l=this._bindingsByRootAndName,c=l[s];if(c===undefined){c={};l[s]=c}for(var u=0;u!==n;++u){var h=r[u],p=h.name,m=c[p];if(m!==undefined){a[u]=m}else{m=a[u];if(m!==undefined){if(m._cacheIndex===null){++m.referenceCount;this._addInactiveBinding(m,s,p)}continue}var f=t&&t._propertyBindings[u].binding.parsedPath;m=new PropertyMixer(PropertyBinding.create(i,p,f),h.ValueTypeName,h.getValueSize());++m.referenceCount;this._addInactiveBinding(m,s,p);a[u]=m}o[u].resultBuffer=m.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]);this._addInactiveAction(e,i,t)}var n=e._propertyBindings;for(var a=0,o=n.length;a!==o;++a){var s=n[a];if(s.useCount++===0){this._lendBinding(s);s.saveOriginalState()}}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){var t=e._propertyBindings;for(var i=0,r=t.length;i!==r;++i){var n=t[i];if(--n.useCount===0){n.restoreOriginalState();this._takeBackBinding(n)}}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return t!==null&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){var r=this._actions,n=this._actionsByClip,a=n[t];if(a===undefined){a={knownActions:[e],actionByRoot:{}};e._byClipCacheIndex=0;n[t]=a}else{var o=a.knownActions;e._byClipCacheIndex=o.length;o.push(e)}e._cacheIndex=r.length;r.push(e);a.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r;t[r]=i;t.pop();e._cacheIndex=null;var n=e._clip.uuid,a=this._actionsByClip,o=a[n],s=o.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c;s[c]=l;s.pop();e._byClipCacheIndex=null;var u=o.actionByRoot,h=(e._localRoot||this._root).uuid;delete u[h];if(s.length===0){delete a[n]}this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){var t=e._propertyBindings;for(var i=0,r=t.length;i!==r;++i){var n=t[i];if(--n.referenceCount===0){this._removeInactiveBinding(n)}}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r;t[r]=e;n._cacheIndex=i;t[i]=n},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r;t[r]=e;n._cacheIndex=i;t[i]=n},_addInactiveBinding:function(e,t,i){var r=this._bindingsByRootAndName,n=r[t],a=this._bindings;if(n===undefined){n={};r[t]=n}n[i]=e;e._cacheIndex=a.length;a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,a=this._bindingsByRootAndName,o=a[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l;t[l]=s;t.pop();delete o[n];if(Object.keys(o).length===0){delete a[r]}},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r;t[r]=e;n._cacheIndex=i;t[i]=n},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r;t[r]=e;n._cacheIndex=i;t[i]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];if(i===undefined){i=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer);i.__cacheIndex=t;e[t]=i}return i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r;t[r]=e;n.__cacheIndex=i;t[i]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,i){var r=t||this._root,n=r.uuid,a=typeof e==="string"?AnimationClip.findByName(r,e):e,o=a!==null?a.uuid:e,s=this._actionsByClip[o],l=null;if(i===undefined){if(a!==null){i=a.blendMode}else{i=NormalAnimationBlendMode}}if(s!==undefined){var c=s.actionByRoot[n];if(c!==undefined&&c.blendMode===i){return c}l=s.knownActions[0];if(a===null)a=l._clip}if(a===null)return null;var u=new AnimationAction(this,a,t,i);this._bindAction(u,l);this._addInactiveAction(u,o,n);return u},existingAction:function(e,t){var i=t||this._root,r=i.uuid,n=typeof e==="string"?AnimationClip.findByName(i,e):e,a=n?n.uuid:e,o=this._actionsByClip[a];if(o!==undefined){return o.actionByRoot[r]||null}return null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,i=this._bindings,r=this._nActiveBindings;this._nActiveActions=0;this._nActiveBindings=0;for(var n=0;n!==t;++n){e[n].reset()}for(var n=0;n!==r;++n){i[n].useCount=0}return this},update:function(e){e*=this.timeScale;var t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),a=this._accuIndex^=1;for(var o=0;o!==i;++o){var s=t[o];s._update(r,e,n,a)}var l=this._bindings,c=this._nActiveBindings;for(var o=0;o!==c;++o){l[o].apply(a)}return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++){this._actions[t].time=0}return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(n!==undefined){var a=n.knownActions;for(var o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null;l._byClipCacheIndex=null;u._cacheIndex=c;t[c]=u;t.pop();this._removeInactiveBindingsForAction(l)}delete r[i]}},uncacheRoot:function(e){var t=e.uuid,i=this._actionsByClip;for(var r in i){var n=i[r].actionByRoot,a=n[t];if(a!==undefined){this._deactivateAction(a);this._removeInactiveAction(a)}}var o=this._bindingsByRootAndName,s=o[t];if(s!==undefined){for(var l in s){var c=s[l];c.restoreOriginalState();this._removeInactiveBinding(c)}}},uncacheAction:function(e,t){var i=this.existingAction(e,t);if(i!==null){this._deactivateAction(i);this._removeInactiveAction(i)}}});function Uniform(e){if(typeof e==="string"){console.warn("THREE.Uniform: Type parameter is no longer needed.");e=arguments[1]}this.value=e}Uniform.prototype.clone=function(){return new Uniform(this.value.clone===undefined?this.value:this.value.clone())};function InstancedInterleavedBuffer(e,t,i){InterleavedBuffer.call(this,e,t);this.meshPerAttribute=i||1}InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:true,copy:function(e){InterleavedBuffer.prototype.copy.call(this,e);this.meshPerAttribute=e.meshPerAttribute;return this}});function Raycaster(e,t,i,r){this.ray=new Ray(e,t);this.near=i||0;this.far=r||Infinity;this.camera=null;this.layers=new Layers;this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})}function ascSort(e,t){return e.distance-t.distance}function intersectObject(e,t,i,r){if(e.layers.test(t.layers)){e.raycast(t,i)}if(r===true){var n=e.children;for(var a=0,o=n.length;a<o;a++){intersectObject(n[a],t,i,true)}}}Object.assign(Raycaster.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){if(t&&t.isPerspectiveCamera){this.ray.origin.setFromMatrixPosition(t.matrixWorld);this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize();this.camera=t}else if(t&&t.isOrthographicCamera){this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t);this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld);this.camera=t}else{console.error("THREE.Raycaster: Unsupported camera type.")}},intersectObject:function(e,t,i){var r=i||[];intersectObject(e,this,r,t);r.sort(ascSort);return r},intersectObjects:function(e,t,i){var r=i||[];if(Array.isArray(e)===false){console.warn("THREE.Raycaster.intersectObjects: objects is not an Array.");return r}for(var n=0,a=e.length;n<a;n++){intersectObject(e[n],this,r,t)}r.sort(ascSort);return r}});function Spherical(e,t,i){this.radius=e!==undefined?e:1;this.phi=t!==undefined?t:0;this.theta=i!==undefined?i:0;return this}Object.assign(Spherical.prototype,{set:function(e,t,i){this.radius=e;this.phi=t;this.theta=i;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.radius=e.radius;this.phi=e.phi;this.theta=e.theta;return this},makeSafe:function(){var e=1e-6;this.phi=Math.max(e,Math.min(Math.PI-e,this.phi));return this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){this.radius=Math.sqrt(e*e+t*t+i*i);if(this.radius===0){this.theta=0;this.phi=0}else{this.theta=Math.atan2(e,i);this.phi=Math.acos(MathUtils.clamp(t/this.radius,-1,1))}return this}});function Cylindrical(e,t,i){this.radius=e!==undefined?e:1;this.theta=t!==undefined?t:0;this.y=i!==undefined?i:0;return this}Object.assign(Cylindrical.prototype,{set:function(e,t,i){this.radius=e;this.theta=t;this.y=i;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.radius=e.radius;this.theta=e.theta;this.y=e.y;return this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){this.radius=Math.sqrt(e*e+i*i);this.theta=Math.atan2(e,i);this.y=t;return this}});var _vector$7=new Vector2;function Box2(e,t){this.min=e!==undefined?e:new Vector2(+Infinity,+Infinity);this.max=t!==undefined?t:new Vector2(-Infinity,-Infinity)}Object.assign(Box2.prototype,{set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++){this.expandByPoint(e[t])}return this},setFromCenterAndSize:function(e,t){var i=_vector$7.copy(t).multiplyScalar(.5);this.min.copy(e).sub(i);this.max.copy(e).add(i);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=+Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){if(e===undefined){console.warn("THREE.Box2: .getCenter() target is now required");e=new Vector2}return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){if(e===undefined){console.warn("THREE.Box2: .getSize() target is now required");e=new Vector2}return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?false:true},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){if(t===undefined){console.warn("THREE.Box2: .getParameter() target is now required");t=new Vector2}return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?false:true},clampPoint:function(e,t){if(t===undefined){console.warn("THREE.Box2: .clampPoint() target is now required");t=new Vector2}return t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){var t=_vector$7.copy(e).clamp(this.min,this.max);return t.sub(e).length()},intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var _startP=new Vector3;var _startEnd=new Vector3;function Line3(e,t){this.start=e!==undefined?e:new Vector3;this.end=t!==undefined?t:new Vector3}Object.assign(Line3.prototype,{set:function(e,t){this.start.copy(e);this.end.copy(t);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.start.copy(e.start);this.end.copy(e.end);return this},getCenter:function(e){if(e===undefined){console.warn("THREE.Line3: .getCenter() target is now required");e=new Vector3}return e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){if(e===undefined){console.warn("THREE.Line3: .delta() target is now required");e=new Vector3}return e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){if(t===undefined){console.warn("THREE.Line3: .at() target is now required");t=new Vector3}return this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){_startP.subVectors(e,this.start);_startEnd.subVectors(this.end,this.start);var i=_startEnd.dot(_startEnd);var r=_startEnd.dot(_startP);var n=r/i;if(t){n=MathUtils.clamp(n,0,1)}return n},closestPointToPoint:function(e,t,i){var r=this.closestPointToPointParameter(e,t);if(i===undefined){console.warn("THREE.Line3: .closestPointToPoint() target is now required");i=new Vector3}return this.delta(i).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){this.start.applyMatrix4(e);this.end.applyMatrix4(e);return this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}});function ImmediateRenderObject(e){Object3D.call(this);this.material=e;this.render=function(){}}ImmediateRenderObject.prototype=Object.create(Object3D.prototype);ImmediateRenderObject.prototype.constructor=ImmediateRenderObject;ImmediateRenderObject.prototype.isImmediateRenderObject=true;var _vector$8=new Vector3;function SpotLightHelper(e,t){Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.color=t;var i=new BufferGeometry;var r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var n=0,a=1,o=32;n<o;n++,a++){var s=n/o*Math.PI*2;var l=a/o*Math.PI*2;r.push(Math.cos(s),Math.sin(s),1,Math.cos(l),Math.sin(l),1)}i.setAttribute("position",new Float32BufferAttribute(r,3));var c=new LineBasicMaterial({fog:false,toneMapped:false});this.cone=new LineSegments(i,c);this.add(this.cone);this.update()}SpotLightHelper.prototype=Object.create(Object3D.prototype);SpotLightHelper.prototype.constructor=SpotLightHelper;SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};SpotLightHelper.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3;var t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e);_vector$8.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(_vector$8);if(this.color!==undefined){this.cone.material.color.set(this.color)}else{this.cone.material.color.copy(this.light.color)}};var _vector$9=new Vector3;var _boneMatrix=new Matrix4;var _matrixWorldInv=new Matrix4;function getBoneList(e){var t=[];if(e&&e.isBone){t.push(e)}for(var i=0;i<e.children.length;i++){t.push.apply(t,getBoneList(e.children[i]))}return t}function SkeletonHelper(e){var t=getBoneList(e);var i=new BufferGeometry;var r=[];var n=[];var a=new Color(0,0,1);var o=new Color(0,1,0);for(var s=0;s<t.length;s++){var l=t[s];if(l.parent&&l.parent.isBone){r.push(0,0,0);r.push(0,0,0);n.push(a.r,a.g,a.b);n.push(o.r,o.g,o.b)}}i.setAttribute("position",new Float32BufferAttribute(r,3));i.setAttribute("color",new Float32BufferAttribute(n,3));var c=new LineBasicMaterial({vertexColors:true,depthTest:false,depthWrite:false,toneMapped:false,transparent:true});LineSegments.call(this,i,c);this.type="SkeletonHelper";this.root=e;this.bones=t;this.matrix=e.matrixWorld;this.matrixAutoUpdate=false}SkeletonHelper.prototype=Object.create(LineSegments.prototype);SkeletonHelper.prototype.constructor=SkeletonHelper;SkeletonHelper.prototype.isSkeletonHelper=true;SkeletonHelper.prototype.updateMatrixWorld=function(e){var t=this.bones;var i=this.geometry;var r=i.getAttribute("position");_matrixWorldInv.getInverse(this.root.matrixWorld);for(var n=0,a=0;n<t.length;n++){var o=t[n];if(o.parent&&o.parent.isBone){_boneMatrix.multiplyMatrices(_matrixWorldInv,o.matrixWorld);_vector$9.setFromMatrixPosition(_boneMatrix);r.setXYZ(a,_vector$9.x,_vector$9.y,_vector$9.z);_boneMatrix.multiplyMatrices(_matrixWorldInv,o.parent.matrixWorld);_vector$9.setFromMatrixPosition(_boneMatrix);r.setXYZ(a+1,_vector$9.x,_vector$9.y,_vector$9.z);a+=2}}i.getAttribute("position").needsUpdate=true;Object3D.prototype.updateMatrixWorld.call(this,e)};function PointLightHelper(e,t,i){this.light=e;this.light.updateMatrixWorld();this.color=i;var r=new SphereBufferGeometry(t,4,2);var n=new MeshBasicMaterial({wireframe:true,fog:false,toneMapped:false});Mesh.call(this,r,n);this.type="PointLightHelper";this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=false;this.update()}PointLightHelper.prototype=Object.create(Mesh.prototype);PointLightHelper.prototype.constructor=PointLightHelper;PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};PointLightHelper.prototype.update=function(){if(this.color!==undefined){this.material.color.set(this.color)}else{this.material.color.copy(this.light.color)}};var _vector$a=new Vector3;var _color1=new Color;var _color2=new Color;function HemisphereLightHelper(e,t,i){Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.color=i;var r=new OctahedronBufferGeometry(t);r.rotateY(Math.PI*.5);this.material=new MeshBasicMaterial({wireframe:true,fog:false,toneMapped:false});if(this.color===undefined)this.material.vertexColors=true;var n=r.getAttribute("position");var a=new Float32Array(n.count*3);r.setAttribute("color",new BufferAttribute(a,3));this.add(new Mesh(r,this.material));this.update()}HemisphereLightHelper.prototype=Object.create(Object3D.prototype);HemisphereLightHelper.prototype.constructor=HemisphereLightHelper;HemisphereLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};HemisphereLightHelper.prototype.update=function(){var e=this.children[0];if(this.color!==undefined){this.material.color.set(this.color)}else{var t=e.geometry.getAttribute("color");_color1.copy(this.light.color);_color2.copy(this.light.groundColor);for(var i=0,r=t.count;i<r;i++){var n=i<r/2?_color1:_color2;t.setXYZ(i,n.r,n.g,n.b)}t.needsUpdate=true}e.lookAt(_vector$a.setFromMatrixPosition(this.light.matrixWorld).negate())};function GridHelper(e,t,i,r){e=e||10;t=t||10;i=new Color(i!==undefined?i:4473924);r=new Color(r!==undefined?r:8947848);var n=t/2;var a=e/t;var o=e/2;var s=[],l=[];for(var c=0,u=0,h=-o;c<=t;c++,h+=a){s.push(-o,0,h,o,0,h);s.push(h,0,-o,h,0,o);var p=c===n?i:r;p.toArray(l,u);u+=3;p.toArray(l,u);u+=3;p.toArray(l,u);u+=3;p.toArray(l,u);u+=3}var m=new BufferGeometry;m.setAttribute("position",new Float32BufferAttribute(s,3));m.setAttribute("color",new Float32BufferAttribute(l,3));var f=new LineBasicMaterial({vertexColors:true,toneMapped:false});LineSegments.call(this,m,f);this.type="GridHelper"}GridHelper.prototype=Object.assign(Object.create(LineSegments.prototype),{constructor:GridHelper,copy:function(e){LineSegments.prototype.copy.call(this,e);this.geometry.copy(e.geometry);this.material.copy(e.material);return this},clone:function(){return(new this.constructor).copy(this)}});function PolarGridHelper(e,t,i,r,n,a){e=e||10;t=t||16;i=i||8;r=r||64;n=new Color(n!==undefined?n:4473924);a=new Color(a!==undefined?a:8947848);var o=[];var s=[];var l,c;var u,h,p,m,f;for(h=0;h<=t;h++){u=h/t*(Math.PI*2);l=Math.sin(u)*e;c=Math.cos(u)*e;o.push(0,0,0);o.push(l,0,c);f=h&1?n:a;s.push(f.r,f.g,f.b);s.push(f.r,f.g,f.b)}for(h=0;h<=i;h++){f=h&1?n:a;m=e-e/i*h;for(p=0;p<r;p++){u=p/r*(Math.PI*2);l=Math.sin(u)*m;c=Math.cos(u)*m;o.push(l,0,c);s.push(f.r,f.g,f.b);u=(p+1)/r*(Math.PI*2);l=Math.sin(u)*m;c=Math.cos(u)*m;o.push(l,0,c);s.push(f.r,f.g,f.b)}}var d=new BufferGeometry;d.setAttribute("position",new Float32BufferAttribute(o,3));d.setAttribute("color",new Float32BufferAttribute(s,3));var _=new LineBasicMaterial({vertexColors:true,toneMapped:false});LineSegments.call(this,d,_);this.type="PolarGridHelper"}PolarGridHelper.prototype=Object.create(LineSegments.prototype);PolarGridHelper.prototype.constructor=PolarGridHelper;var _v1$5=new Vector3;var _v2$3=new Vector3;var _v3$1=new Vector3;function DirectionalLightHelper(e,t,i){Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.color=i;if(t===undefined)t=1;var r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var n=new LineBasicMaterial({fog:false,toneMapped:false});this.lightPlane=new Line(r,n);this.add(this.lightPlane);r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3));this.targetLine=new Line(r,n);this.add(this.targetLine);this.update()}DirectionalLightHelper.prototype=Object.create(Object3D.prototype);DirectionalLightHelper.prototype.constructor=DirectionalLightHelper;DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};DirectionalLightHelper.prototype.update=function(){_v1$5.setFromMatrixPosition(this.light.matrixWorld);_v2$3.setFromMatrixPosition(this.light.target.matrixWorld);_v3$1.subVectors(_v2$3,_v1$5);this.lightPlane.lookAt(_v2$3);if(this.color!==undefined){this.lightPlane.material.color.set(this.color);this.targetLine.material.color.set(this.color)}else{this.lightPlane.material.color.copy(this.light.color);this.targetLine.material.color.copy(this.light.color)}this.targetLine.lookAt(_v2$3);this.targetLine.scale.z=_v3$1.length()};var _vector$b=new Vector3;var _camera=new Camera;function CameraHelper(e){var t=new BufferGeometry;var i=new LineBasicMaterial({color:16777215,vertexColors:true,toneMapped:false});var r=[];var n=[];var a={};var o=new Color(16755200);var s=new Color(16711680);var l=new Color(43775);var c=new Color(16777215);var u=new Color(3355443);h("n1","n2",o);h("n2","n4",o);h("n4","n3",o);h("n3","n1",o);h("f1","f2",o);h("f2","f4",o);h("f4","f3",o);h("f3","f1",o);h("n1","f1",o);h("n2","f2",o);h("n3","f3",o);h("n4","f4",o);h("p","n1",s);h("p","n2",s);h("p","n3",s);h("p","n4",s);h("u1","u2",l);h("u2","u3",l);h("u3","u1",l);h("c","t",c);h("p","c",u);h("cn1","cn2",u);h("cn3","cn4",u);h("cf1","cf2",u);h("cf3","cf4",u);function h(e,t,i){p(e,i);p(t,i)}function p(e,t){r.push(0,0,0);n.push(t.r,t.g,t.b);if(a[e]===undefined){a[e]=[]}a[e].push(r.length/3-1)}t.setAttribute("position",new Float32BufferAttribute(r,3));t.setAttribute("color",new Float32BufferAttribute(n,3));LineSegments.call(this,t,i);this.type="CameraHelper";this.camera=e;if(this.camera.updateProjectionMatrix)this.camera.updateProjectionMatrix();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=a;this.update()}CameraHelper.prototype=Object.create(LineSegments.prototype);CameraHelper.prototype.constructor=CameraHelper;CameraHelper.prototype.update=function(){var e=this.geometry;var t=this.pointMap;var i=1,r=1;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);setPoint("c",t,e,_camera,0,0,-1);setPoint("t",t,e,_camera,0,0,1);setPoint("n1",t,e,_camera,-i,-r,-1);setPoint("n2",t,e,_camera,i,-r,-1);setPoint("n3",t,e,_camera,-i,r,-1);setPoint("n4",t,e,_camera,i,r,-1);setPoint("f1",t,e,_camera,-i,-r,1);setPoint("f2",t,e,_camera,i,-r,1);setPoint("f3",t,e,_camera,-i,r,1);setPoint("f4",t,e,_camera,i,r,1);setPoint("u1",t,e,_camera,i*.7,r*1.1,-1);setPoint("u2",t,e,_camera,-i*.7,r*1.1,-1);setPoint("u3",t,e,_camera,0,r*2,-1);setPoint("cf1",t,e,_camera,-i,0,1);setPoint("cf2",t,e,_camera,i,0,1);setPoint("cf3",t,e,_camera,0,-r,1);setPoint("cf4",t,e,_camera,0,r,1);setPoint("cn1",t,e,_camera,-i,0,-1);setPoint("cn2",t,e,_camera,i,0,-1);setPoint("cn3",t,e,_camera,0,-r,-1);setPoint("cn4",t,e,_camera,0,r,-1);e.getAttribute("position").needsUpdate=true};function setPoint(e,t,i,r,n,a,o){_vector$b.set(n,a,o).unproject(r);var s=t[e];if(s!==undefined){var l=i.getAttribute("position");for(var c=0,u=s.length;c<u;c++){l.setXYZ(s[c],_vector$b.x,_vector$b.y,_vector$b.z)}}}var _box$3=new Box3;function BoxHelper(e,t){this.object=e;if(t===undefined)t=16776960;var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var r=new Float32Array(8*3);var n=new BufferGeometry;n.setIndex(new BufferAttribute(i,1));n.setAttribute("position",new BufferAttribute(r,3));LineSegments.call(this,n,new LineBasicMaterial({color:t,toneMapped:false}));this.type="BoxHelper";this.matrixAutoUpdate=false;this.update()}BoxHelper.prototype=Object.create(LineSegments.prototype);BoxHelper.prototype.constructor=BoxHelper;BoxHelper.prototype.update=function(e){if(e!==undefined){console.warn("THREE.BoxHelper: .update() has no longer arguments.")}if(this.object!==undefined){_box$3.setFromObject(this.object)}if(_box$3.isEmpty())return;var t=_box$3.min;var i=_box$3.max;var r=this.geometry.attributes.position;var n=r.array;n[0]=i.x;n[1]=i.y;n[2]=i.z;n[3]=t.x;n[4]=i.y;n[5]=i.z;n[6]=t.x;n[7]=t.y;n[8]=i.z;n[9]=i.x;n[10]=t.y;n[11]=i.z;n[12]=i.x;n[13]=i.y;n[14]=t.z;n[15]=t.x;n[16]=i.y;n[17]=t.z;n[18]=t.x;n[19]=t.y;n[20]=t.z;n[21]=i.x;n[22]=t.y;n[23]=t.z;r.needsUpdate=true;this.geometry.computeBoundingSphere()};BoxHelper.prototype.setFromObject=function(e){this.object=e;this.update();return this};BoxHelper.prototype.copy=function(e){LineSegments.prototype.copy.call(this,e);this.object=e.object;return this};BoxHelper.prototype.clone=function(){return(new this.constructor).copy(this)};function Box3Helper(e,t){this.type="Box3Helper";this.box=e;t=t||16776960;var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1];var n=new BufferGeometry;n.setIndex(new BufferAttribute(i,1));n.setAttribute("position",new Float32BufferAttribute(r,3));LineSegments.call(this,n,new LineBasicMaterial({color:t,toneMapped:false}));this.type="Box3Helper";this.geometry.computeBoundingSphere()}Box3Helper.prototype=Object.create(LineSegments.prototype);Box3Helper.prototype.constructor=Box3Helper;Box3Helper.prototype.updateMatrixWorld=function(e){var t=this.box;if(t.isEmpty())return;t.getCenter(this.position);t.getSize(this.scale);this.scale.multiplyScalar(.5);Object3D.prototype.updateMatrixWorld.call(this,e)};function PlaneHelper(e,t,i){this.plane=e;this.size=t===undefined?1:t;var r=i!==undefined?i:16776960;var n=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0];var a=new BufferGeometry;a.setAttribute("position",new Float32BufferAttribute(n,3));a.computeBoundingSphere();Line.call(this,a,new LineBasicMaterial({color:r,toneMapped:false}));this.type="PlaneHelper";var o=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1];var s=new BufferGeometry;s.setAttribute("position",new Float32BufferAttribute(o,3));s.computeBoundingSphere();this.add(new Mesh(s,new MeshBasicMaterial({color:r,opacity:.2,transparent:true,depthWrite:false,toneMapped:false})))}PlaneHelper.prototype=Object.create(Line.prototype);PlaneHelper.prototype.constructor=PlaneHelper;PlaneHelper.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;if(Math.abs(t)<1e-8)t=1e-8;this.scale.set(.5*this.size,.5*this.size,t);this.children[0].material.side=t<0?BackSide:FrontSide;this.lookAt(this.plane.normal);Object3D.prototype.updateMatrixWorld.call(this,e)};var _axis=new Vector3;var _lineGeometry,_coneGeometry;function ArrowHelper(e,t,i,r,n,a){Object3D.call(this);this.type="ArrowHelper";if(e===undefined)e=new Vector3(0,0,1);if(t===undefined)t=new Vector3(0,0,0);if(i===undefined)i=1;if(r===undefined)r=16776960;if(n===undefined)n=.2*i;if(a===undefined)a=.2*n;if(_lineGeometry===undefined){_lineGeometry=new BufferGeometry;_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3));_coneGeometry=new CylinderBufferGeometry(0,.5,1,5,1);_coneGeometry.translate(0,-.5,0)}this.position.copy(t);this.line=new Line(_lineGeometry,new LineBasicMaterial({color:r,toneMapped:false}));this.line.matrixAutoUpdate=false;this.add(this.line);this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:r,toneMapped:false}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(e);this.setLength(i,n,a)}ArrowHelper.prototype=Object.create(Object3D.prototype);ArrowHelper.prototype.constructor=ArrowHelper;ArrowHelper.prototype.setDirection=function(e){if(e.y>.99999){this.quaternion.set(0,0,0,1)}else if(e.y<-.99999){this.quaternion.set(1,0,0,0)}else{_axis.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(_axis,t)}};ArrowHelper.prototype.setLength=function(e,t,i){if(t===undefined)t=.2*e;if(i===undefined)i=.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1);this.line.updateMatrix();this.cone.scale.set(i,t,i);this.cone.position.y=e;this.cone.updateMatrix()};ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e);this.cone.material.color.set(e)};ArrowHelper.prototype.copy=function(e){Object3D.prototype.copy.call(this,e,false);this.line.copy(e.line);this.cone.copy(e.cone);return this};ArrowHelper.prototype.clone=function(){return(new this.constructor).copy(this)};function AxesHelper(e){e=e||1;var t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e];var i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1];var r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute(t,3));r.setAttribute("color",new Float32BufferAttribute(i,3));var n=new LineBasicMaterial({vertexColors:true,toneMapped:false});LineSegments.call(this,r,n);this.type="AxesHelper"}AxesHelper.prototype=Object.create(LineSegments.prototype);AxesHelper.prototype.constructor=AxesHelper;var LOD_MIN=4;var LOD_MAX=8;var SIZE_MAX=Math.pow(2,LOD_MAX);var EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582];var TOTAL_LODS=LOD_MAX-LOD_MIN+1+EXTRA_LOD_SIGMA.length;var MAX_SAMPLES=20;var ENCODINGS={[LinearEncoding]:0,[sRGBEncoding]:1,[RGBEEncoding]:2,[RGBM7Encoding]:3,[RGBM16Encoding]:4,[RGBDEncoding]:5,[GammaEncoding]:6};var _flatCamera=new OrthographicCamera;var{_lodPlanes:_lodPlanes,_sizeLods:_sizeLods,_sigmas:_sigmas}=_createPlanes();var _oldTarget=null;var PHI=(1+Math.sqrt(5))/2;var INV_PHI=1/PHI;var _axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];function PMREMGenerator(e){this._renderer=e;this._pingPongRenderTarget=null;this._blurMaterial=_getBlurShader(MAX_SAMPLES);this._equirectShader=null;this._cubemapShader=null;this._compileMaterial(this._blurMaterial)}PMREMGenerator.prototype={constructor:PMREMGenerator,fromScene:function(e,t=0,i=.1,r=100){_oldTarget=this._renderer.getRenderTarget();var n=this._allocateTargets();this._sceneToCubeUV(e,i,r,n);if(t>0){this._blur(n,0,0,t)}this._applyPMREM(n);this._cleanup(n);return n},fromEquirectangular:function(e){e.magFilter=NearestFilter;e.minFilter=NearestFilter;e.generateMipmaps=false;return this.fromCubemap(e)},fromCubemap:function(e){_oldTarget=this._renderer.getRenderTarget();var t=this._allocateTargets(e);this._textureToCubeUV(e,t);this._applyPMREM(t);this._cleanup(t);return t},compileCubemapShader:function(){if(this._cubemapShader===null){this._cubemapShader=_getCubemapShader();this._compileMaterial(this._cubemapShader)}},compileEquirectangularShader:function(){if(this._equirectShader===null){this._equirectShader=_getEquirectShader();this._compileMaterial(this._equirectShader)}},dispose:function(){this._blurMaterial.dispose();if(this._cubemapShader!==null)this._cubemapShader.dispose();if(this._equirectShader!==null)this._equirectShader.dispose();for(var e=0;e<_lodPlanes.length;e++){_lodPlanes[e].dispose()}},_cleanup:function(e){this._pingPongRenderTarget.dispose();this._renderer.setRenderTarget(_oldTarget);e.scissorTest=false;e.setSize(e.width,e.height)},_allocateTargets:function(e){var t={magFilter:NearestFilter,minFilter:NearestFilter,generateMipmaps:false,type:UnsignedByteType,format:RGBEFormat,encoding:_isLDR(e)?e.encoding:RGBEEncoding,depthBuffer:false,stencilBuffer:false};var i=_createRenderTarget(t);i.depthBuffer=e?false:true;this._pingPongRenderTarget=_createRenderTarget(t);return i},_compileMaterial:function(e){var t=new Scene;t.add(new Mesh(_lodPlanes[0],e));this._renderer.compile(t,_flatCamera)},_sceneToCubeUV:function(e,t,i,r){var n=90;var a=1;var o=new PerspectiveCamera(n,a,t,i);var s=[1,1,1,1,-1,1];var l=[1,1,-1,-1,-1,1];var c=this._renderer;var u=c.outputEncoding;var h=c.toneMapping;var p=c.toneMappingExposure;var m=c.getClearColor();var f=c.getClearAlpha();c.toneMapping=LinearToneMapping;c.toneMappingExposure=1;c.outputEncoding=LinearEncoding;e.scale.z*=-1;var d=e.background;if(d&&d.isColor){d.convertSRGBToLinear();var _=Math.max(d.r,d.g,d.b);var y=Math.min(Math.max(Math.ceil(Math.log2(_)),-128),127);d=d.multiplyScalar(Math.pow(2,-y));var v=(y+128)/255;c.setClearColor(d,v);e.background=null}for(var g=0;g<6;g++){var x=g%3;if(x==0){o.up.set(0,s[g],0);o.lookAt(l[g],0,0)}else if(x==1){o.up.set(0,0,s[g]);o.lookAt(0,l[g],0)}else{o.up.set(0,s[g],0);o.lookAt(0,0,l[g])}_setViewport(r,x*SIZE_MAX,g>2?SIZE_MAX:0,SIZE_MAX,SIZE_MAX);c.setRenderTarget(r);c.render(e,o)}c.toneMapping=h;c.toneMappingExposure=p;c.outputEncoding=u;c.setClearColor(m,f);e.scale.z*=-1},_textureToCubeUV:function(e,t){var i=new Scene;var r=this._renderer;if(e.isCubeTexture){if(this._cubemapShader==null){this._cubemapShader=_getCubemapShader()}}else{if(this._equirectShader==null){this._equirectShader=_getEquirectShader()}}var n=e.isCubeTexture?this._cubemapShader:this._equirectShader;i.add(new Mesh(_lodPlanes[0],n));var a=n.uniforms;a["envMap"].value=e;if(!e.isCubeTexture){a["texelSize"].value.set(1/e.image.width,1/e.image.height)}a["inputEncoding"].value=ENCODINGS[e.encoding];a["outputEncoding"].value=ENCODINGS[t.texture.encoding];_setViewport(t,0,0,3*SIZE_MAX,2*SIZE_MAX);r.setRenderTarget(t);r.render(i,_flatCamera)},_applyPMREM:function(e){var t=this._renderer;var i=t.autoClear;t.autoClear=false;for(var r=1;r<TOTAL_LODS;r++){var n=Math.sqrt(_sigmas[r]*_sigmas[r]-_sigmas[r-1]*_sigmas[r-1]);var a=_axisDirections[(r-1)%_axisDirections.length];this._blur(e,r-1,r,n,a)}t.autoClear=i},_blur:function(e,t,i,r,n){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,r,"latitudinal",n);this._halfBlur(a,e,i,i,r,"longitudinal",n)},_halfBlur:function(e,t,i,r,n,a,o){var s=this._renderer;var l=this._blurMaterial;if(a!=="latitudinal"&&a!=="longitudinal"){console.error("blur direction must be either latitudinal or longitudinal!")}var c=3;var u=new Scene;u.add(new Mesh(_lodPlanes[r],l));var h=l.uniforms;var p=_sizeLods[i]-1;var m=isFinite(n)?Math.PI/(2*p):2*Math.PI/(2*MAX_SAMPLES-1);var f=n/m;var d=isFinite(n)?1+Math.floor(c*f):MAX_SAMPLES;if(d>MAX_SAMPLES){console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${d} samples when the maximum is set to ${MAX_SAMPLES}`)}var _=[];var y=0;for(var v=0;v<MAX_SAMPLES;++v){var g=v/f;var x=Math.exp(-g*g/2);_.push(x);if(v==0){y+=x}else if(v<d){y+=2*x}}for(var v=0;v<_.length;v++){_[v]=_[v]/y}h["envMap"].value=e.texture;h["samples"].value=d;h["weights"].value=_;h["latitudinal"].value=a==="latitudinal";if(o){h["poleAxis"].value=o}h["dTheta"].value=m;h["mipInt"].value=LOD_MAX-i;h["inputEncoding"].value=ENCODINGS[e.texture.encoding];h["outputEncoding"].value=ENCODINGS[e.texture.encoding];var b=_sizeLods[r];var g=3*Math.max(0,SIZE_MAX-2*b);var M=(r===0?0:2*SIZE_MAX)+2*b*(r>LOD_MAX-LOD_MIN?r-LOD_MAX+LOD_MIN:0);_setViewport(t,g,M,3*b,2*b);s.setRenderTarget(t);s.render(u,_flatCamera)}};function _isLDR(e){if(e===undefined||e.type!==UnsignedByteType)return false;return e.encoding===LinearEncoding||e.encoding===sRGBEncoding||e.encoding===GammaEncoding}function _createPlanes(){var e=[];var t=[];var i=[];var r=LOD_MAX;for(var n=0;n<TOTAL_LODS;n++){var a=Math.pow(2,r);t.push(a);var o=1/a;if(n>LOD_MAX-LOD_MIN){o=EXTRA_LOD_SIGMA[n-LOD_MAX+LOD_MIN-1]}else if(n==0){o=0}i.push(o);var s=1/(a-1);var l=-s/2;var c=1+s/2;var u=[l,l,c,l,c,c,l,l,c,c,l,c];var h=6;var p=6;var m=3;var f=2;var d=1;var _=new Float32Array(m*p*h);var y=new Float32Array(f*p*h);var v=new Float32Array(d*p*h);for(var g=0;g<h;g++){var x=g%3*2/3-1;var b=g>2?0:-1;var M=[x,b,0,x+2/3,b,0,x+2/3,b+1,0,x,b,0,x+2/3,b+1,0,x,b+1,0];_.set(M,m*p*g);y.set(u,f*p*g);var w=[g,g,g,g,g,g];v.set(w,d*p*g)}var S=new BufferGeometry;S.setAttribute("position",new BufferAttribute(_,m));S.setAttribute("uv",new BufferAttribute(y,f));S.setAttribute("faceIndex",new BufferAttribute(v,d));e.push(S);if(r>LOD_MIN){r--}}return{_lodPlanes:e,_sizeLods:t,_sigmas:i}}function _createRenderTarget(e){var t=new WebGLRenderTarget(3*SIZE_MAX,3*SIZE_MAX,e);t.texture.mapping=CubeUVReflectionMapping;t.texture.name="PMREM.cubeUv";t.scissorTest=true;return t}function _setViewport(e,t,i,r,n){e.viewport.set(t,i,r,n);e.scissor.set(t,i,r,n)}function _getBlurShader(e){var t=new Float32Array(e);var i=new Vector3(0,1,0);var r=new RawShaderMaterial({defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:false},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n${_getEncodings()}\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvec3 getSample(float theta, vec3 axis) {\n\tfloat cosTheta = cos(theta);\n\t// Rodrigues' axis-angle rotation\n\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\treturn bilinearCubeUV(envMap, sampleDirection, mipInt);\n}\n\nvoid main() {\n\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\tif (all(equal(axis, vec3(0.0))))\n\t\taxis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);\n\taxis = normalize(axis);\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb += weights[0] * getSample(0.0, axis);\n\tfor (int i = 1; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfloat theta = dTheta * float(i);\n\t\tgl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);\n\t\tgl_FragColor.rgb += weights[i] * getSample(theta, axis);\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:NoBlending,depthTest:false,depthWrite:false});r.type="SphericalGaussianBlur";return r}function _getEquirectShader(){var e=new Vector2(1,1);var t=new RawShaderMaterial({uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n${_getEncodings()}\n\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv;\n\tuv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;\n\tuv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:NoBlending,depthTest:false,depthWrite:false});t.type="EquirectangularToCubeUV";return t}function _getCubemapShader(){var e=new RawShaderMaterial({uniforms:{envMap:{value:null},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n${_getEncodings()}\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:NoBlending,depthTest:false,depthWrite:false});e.type="CubemapToCubeUV";return e}function _getCommonVertexShader(){return`\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t`}function _getEncodings(){return`\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t`}function Face4(e,t,i,r,n,a,o){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new Face3(e,t,i,n,a,o)}var LineStrip=0;var LinePieces=1;var NoColors=0;var FaceColors=1;var VertexColors=2;function MeshFaceMaterial(e){console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead.");return e}function MultiMaterial(e){if(e===undefined)e=[];console.warn("THREE.MultiMaterial has been removed. Use an Array instead.");e.isMultiMaterial=true;e.materials=e;e.clone=function(){return e.slice()};return e}function PointCloud(e,t){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new Points(e,t)}function Particle(e){console.warn("THREE.Particle has been renamed to THREE.Sprite.");return new Sprite(e)}function ParticleSystem(e,t){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new Points(e,t)}function PointCloudMaterial(e){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new PointsMaterial(e)}function ParticleBasicMaterial(e){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new PointsMaterial(e)}function ParticleSystemMaterial(e){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new PointsMaterial(e)}function Vertex(e,t,i){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new Vector3(e,t,i)}function DynamicBufferAttribute(e,t){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead.");return new BufferAttribute(e,t).setUsage(DynamicDrawUsage)}function Int8Attribute(e,t){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.");return new Int8BufferAttribute(e,t)}function Uint8Attribute(e,t){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.");return new Uint8BufferAttribute(e,t)}function Uint8ClampedAttribute(e,t){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.");return new Uint8ClampedBufferAttribute(e,t)}function Int16Attribute(e,t){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.");return new Int16BufferAttribute(e,t)}function Uint16Attribute(e,t){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.");return new Uint16BufferAttribute(e,t)}function Int32Attribute(e,t){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.");return new Int32BufferAttribute(e,t)}function Uint32Attribute(e,t){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.");return new Uint32BufferAttribute(e,t)}function Float32Attribute(e,t){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.");return new Float32BufferAttribute(e,t)}function Float64Attribute(e,t){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.");return new Float64BufferAttribute(e,t)}Curve.create=function(e,t){console.log("THREE.Curve.create() has been deprecated");e.prototype=Object.create(Curve.prototype);e.prototype.constructor=e;e.prototype.getPoint=t;return e};Object.assign(CurvePath.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=new Geometry;for(var i=0,r=e.length;i<r;i++){var n=e[i];t.vertices.push(new Vector3(n.x,n.y,n.z||0))}return t}});Object.assign(Path.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints().");return this.setFromPoints(e)}});function ClosedSplineCurve3(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");CatmullRomCurve3.call(this,e);this.type="catmullrom";this.closed=true}ClosedSplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype);function SplineCurve3(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");CatmullRomCurve3.call(this,e);this.type="catmullrom"}SplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype);function Spline(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead.");CatmullRomCurve3.call(this,e);this.type="catmullrom"}Spline.prototype=Object.create(CatmullRomCurve3.prototype);Object.assign(Spline.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});function AxisHelper(e){console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper.");return new AxesHelper(e)}function BoundingBoxHelper(e,t){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.");return new BoxHelper(e,t)}function EdgesHelper(e,t){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new LineSegments(new EdgesGeometry(e.geometry),new LineBasicMaterial({color:t!==undefined?t:16777215}))}GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};function WireframeHelper(e,t){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new LineSegments(new WireframeGeometry(e.geometry),new LineBasicMaterial({color:t!==undefined?t:16777215}))}Object.assign(Loader.prototype,{extractUrlBase:function(e){console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.");return LoaderUtils.extractUrlBase(e)}});Loader.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};function XHRLoader(e){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader.");return new FileLoader(e)}function BinaryTextureLoader(e){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.");return new DataTextureLoader(e)}Object.assign(ObjectLoader.prototype,{setTexturePath:function(e){console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath().");return this.setResourcePath(e)}});Object.assign(Box2.prototype,{center:function(e){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(e)},empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(e){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(e)},size:function(e){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(e)}});Object.assign(Box3.prototype,{center:function(e){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(e)},empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(e){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(e)},isIntersectionSphere:function(e){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(e)},size:function(e){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(e)}});Object.assign(Sphere.prototype,{empty:function(){console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty().");return this.isEmpty()}});Frustum.prototype.setFromMatrix=function(e){console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix().");return this.setFromProjectionMatrix(e)};Line3.prototype.center=function(e){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");return this.getCenter(e)};Object.assign(MathUtils,{random16:function(){console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead.");return Math.random()},nearestPowerOfTwo:function(e){console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo().");return MathUtils.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo().");return MathUtils.ceilPowerOfTwo(e)}});Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(e,t){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(e,t)},multiplyVector3:function(e){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});Object.assign(Matrix4.prototype,{extractPosition:function(e){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(e)},flattenToArrayOffset:function(e,t){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(e,t)},getPosition:function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return(new Vector3).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},multiplyVector4:function(e){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");e.transformDirection(this)},crossVector:function(e){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,i,r,n,a){console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.");return this.makePerspective(e,t,r,i,n,a)}});Plane.prototype.isIntersectionLine=function(e){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(e)};Quaternion.prototype.multiplyVector3=function(e){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return e.applyQuaternion(this)};Object.assign(Ray.prototype,{isIntersectionBox:function(e){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(e)},isIntersectionPlane:function(e){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(e)},isIntersectionSphere:function(e){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(e)}});Object.assign(Triangle.prototype,{area:function(){console.warn("THREE.Triangle: .area() has been renamed to .getArea().");return this.getArea()},barycoordFromPoint:function(e,t){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return this.getBarycoord(e,t)},midpoint:function(e){console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint().");return this.getMidpoint(e)},normal:function(e){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return this.getNormal(e)},plane:function(e){console.warn("THREE.Triangle: .plane() has been renamed to .getPlane().");return this.getPlane(e)}});Object.assign(Triangle,{barycoordFromPoint:function(e,t,i,r,n){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return Triangle.getBarycoord(e,t,i,r,n)},normal:function(e,t,i,r){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return Triangle.getNormal(e,t,i,r)}});Object.assign(Shape.prototype,{extractAllPoints:function(e){console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.");return this.extractPoints(e)},extrude:function(e){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new ExtrudeGeometry(this,e)},makeGeometry:function(e){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new ShapeGeometry(this,e)}});Object.assign(Vector2.prototype,{fromAttribute:function(e,t,i){console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(e)},lengthManhattan:function(){console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(t,e)},applyProjection:function(e){console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.");return this.applyMatrix4(e)},fromAttribute:function(e,t,i){console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(e)},lengthManhattan:function(){console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(Vector4.prototype,{fromAttribute:function(e,t,i){console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(Geometry.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4().");return this.applyMatrix4(e)}});Object.assign(Object3D.prototype,{getChildByName:function(e){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4().");return this.applyMatrix4(e)}});Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.assign(Mesh.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}});Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode.");return TrianglesDrawMode},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Object.defineProperties(LOD.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});Object.defineProperty(Skeleton.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function(){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");return this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");this.arcLengthDivisions=e}});PerspectiveCamera.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. "+"Use .setFocalLength and .filmGauge for a photographic setup.");if(t!==undefined)this.filmGauge=t;this.setFocalLength(e)};Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=e}}});Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");return this.array.length}},dynamic:{get:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.");return this.usage===DynamicDrawUsage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.");this.setUsage(DynamicDrawUsage)}}});Object.assign(BufferAttribute.prototype,{setDynamic:function(e){console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead.");this.setUsage(e===true?DynamicDrawUsage:StaticDrawUsage);return this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(BufferGeometry.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(e)},addAttribute:function(e,t){console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute().");if(!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");return this.setAttribute(e,new BufferAttribute(arguments[1],arguments[2]))}if(e==="index"){console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.");this.setIndex(t);return this}return this.setAttribute(e,t)},addDrawCall:function(e,t,i){if(i!==undefined){console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.")}console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute().");return this.deleteAttribute(e)},applyMatrix:function(e){console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4().");return this.applyMatrix4(e)}});Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});Object.defineProperties(Raycaster.prototype,{linePrecision:{get:function(){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead.");return this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead.");this.params.Line.threshold=e}}});Object.defineProperties(InterleavedBuffer.prototype,{dynamic:{get:function(){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead.");return this.usage===DynamicDrawUsage},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead.");this.setUsage(e)}}});Object.assign(InterleavedBuffer.prototype,{setDynamic:function(e){console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead.");this.setUsage(e===true?DynamicDrawUsage:StaticDrawUsage);return this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(ExtrudeBufferGeometry.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}});Object.defineProperties(Uniform.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this}}});Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){console.warn("THREE.Material: .wrapRGB has been removed.");return new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=e===FlatShading}},stencilMask:{get:function(){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead.");return this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead.");this.stencilFuncMask=e}}});Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return false},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=e}}});Object.assign(WebGLRenderer.prototype,{clearTarget:function(e,t,i,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead.");this.setRenderTarget(e);this.clear(t,i,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop().");this.setAnimationLoop(e)},getCurrentRenderTarget:function(){console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().");return this.getRenderTarget()},getMaxAnisotropy:function(){console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().");return this.capabilities.getMaxAnisotropy()},getPrecision:function(){console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.");return this.capabilities.precision},resetGLState:function(){console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset().");return this.state.reset()},supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel().");return this.getActiveMipmapLevel()}});Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.");return undefined},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead.");return this.getContext()}},vr:{get:function(){console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr");return this.xr}},gammaInput:{get:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.");return false},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.");return false},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.");this.outputEncoding=e===true?sRGBEncoding:LinearEncoding}}});Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.");return undefined},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.");return undefined},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.");return undefined},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});function WebGLRenderTargetCube(e,t,i){console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options ).");return new WebGLCubeRenderTarget(e,i)}Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=e}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=e}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=e}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=e}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=e}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=e}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=e}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=e}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=e}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=e}}});Object.defineProperties(Audio.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;var i=new AudioLoader;i.load(e,(function(e){t.setBuffer(e)}));return this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}});AudioAnalyser.prototype.getData=function(){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()};CubeCamera.prototype.updateCubeMap=function(e,t){console.warn("THREE.CubeCamera: .updateCubeMap() is now .update().");return this.update(e,t)};var GeometryUtils={merge:function(e,t,i){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var r;if(t.isMesh){t.matrixAutoUpdate&&t.updateMatrix();r=t.matrix;t=t.geometry}e.merge(t,r,i)},center:function(e){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return e.center()}};ImageUtils.crossOrigin=undefined;ImageUtils.loadTexture=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new TextureLoader;n.setCrossOrigin(this.crossOrigin);var a=n.load(e,i,undefined,r);if(t)a.mapping=t;return a};ImageUtils.loadTextureCube=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new CubeTextureLoader;n.setCrossOrigin(this.crossOrigin);var a=n.load(e,i,undefined,r);if(t)a.mapping=t;return a};ImageUtils.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};ImageUtils.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};function CanvasRenderer(){console.error("THREE.CanvasRenderer has been removed")}function JSONLoader(){console.error("THREE.JSONLoader has been removed.")}var SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function LensFlare(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}if(typeof __THREE_DEVTOOLS__!=="undefined"){__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}))}var THREE=Object.freeze({__proto__:null,ACESFilmicToneMapping:ACESFilmicToneMapping,AddEquation:AddEquation,AddOperation:AddOperation,AdditiveAnimationBlendMode:AdditiveAnimationBlendMode,AdditiveBlending:AdditiveBlending,AlphaFormat:AlphaFormat,AlwaysDepth:AlwaysDepth,AlwaysStencilFunc:AlwaysStencilFunc,AmbientLight:AmbientLight,AmbientLightProbe:AmbientLightProbe,AnimationClip:AnimationClip,AnimationLoader:AnimationLoader,AnimationMixer:AnimationMixer,AnimationObjectGroup:AnimationObjectGroup,AnimationUtils:AnimationUtils,ArcCurve:ArcCurve,ArrayCamera:ArrayCamera,ArrowHelper:ArrowHelper,Audio:Audio,AudioAnalyser:AudioAnalyser,AudioContext:AudioContext,AudioListener:AudioListener,AudioLoader:AudioLoader,AxesHelper:AxesHelper,AxisHelper:AxisHelper,BackSide:BackSide,BasicDepthPacking:BasicDepthPacking,BasicShadowMap:BasicShadowMap,BinaryTextureLoader:BinaryTextureLoader,Bone:Bone,BooleanKeyframeTrack:BooleanKeyframeTrack,BoundingBoxHelper:BoundingBoxHelper,Box2:Box2,Box3:Box3,Box3Helper:Box3Helper,BoxBufferGeometry:BoxBufferGeometry,BoxGeometry:BoxGeometry,BoxHelper:BoxHelper,BufferAttribute:BufferAttribute,BufferGeometry:BufferGeometry,BufferGeometryLoader:BufferGeometryLoader,ByteType:ByteType,Cache:Cache,Camera:Camera,CameraHelper:CameraHelper,CanvasRenderer:CanvasRenderer,CanvasTexture:CanvasTexture,CatmullRomCurve3:CatmullRomCurve3,CineonToneMapping:CineonToneMapping,CircleBufferGeometry:CircleBufferGeometry,CircleGeometry:CircleGeometry,ClampToEdgeWrapping:ClampToEdgeWrapping,Clock:Clock,ClosedSplineCurve3:ClosedSplineCurve3,Color:Color,ColorKeyframeTrack:ColorKeyframeTrack,CompressedTexture:CompressedTexture,CompressedTextureLoader:CompressedTextureLoader,ConeBufferGeometry:ConeBufferGeometry,ConeGeometry:ConeGeometry,CubeCamera:CubeCamera,CubeGeometry:BoxGeometry,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,CubeTexture:CubeTexture,CubeTextureLoader:CubeTextureLoader,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,CubicInterpolant:CubicInterpolant,CullFaceBack:CullFaceBack,CullFaceFront:CullFaceFront,CullFaceFrontBack:CullFaceFrontBack,CullFaceNone:CullFaceNone,Curve:Curve,CurvePath:CurvePath,CustomBlending:CustomBlending,CylinderBufferGeometry:CylinderBufferGeometry,CylinderGeometry:CylinderGeometry,Cylindrical:Cylindrical,DataTexture:DataTexture,DataTexture2DArray:DataTexture2DArray,DataTexture3D:DataTexture3D,DataTextureLoader:DataTextureLoader,DecrementStencilOp:DecrementStencilOp,DecrementWrapStencilOp:DecrementWrapStencilOp,DefaultLoadingManager:DefaultLoadingManager,DepthFormat:DepthFormat,DepthStencilFormat:DepthStencilFormat,DepthTexture:DepthTexture,DirectionalLight:DirectionalLight,DirectionalLightHelper:DirectionalLightHelper,DirectionalLightShadow:DirectionalLightShadow,DiscreteInterpolant:DiscreteInterpolant,DodecahedronBufferGeometry:DodecahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DoubleSide:DoubleSide,DstAlphaFactor:DstAlphaFactor,DstColorFactor:DstColorFactor,DynamicBufferAttribute:DynamicBufferAttribute,DynamicCopyUsage:DynamicCopyUsage,DynamicDrawUsage:DynamicDrawUsage,DynamicReadUsage:DynamicReadUsage,EdgesGeometry:EdgesGeometry,EdgesHelper:EdgesHelper,EllipseCurve:EllipseCurve,EqualDepth:EqualDepth,EqualStencilFunc:EqualStencilFunc,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,Euler:Euler,EventDispatcher:EventDispatcher,ExtrudeBufferGeometry:ExtrudeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,Face3:Face3,Face4:Face4,FaceColors:FaceColors,FileLoader:FileLoader,FlatShading:FlatShading,Float32Attribute:Float32Attribute,Float32BufferAttribute:Float32BufferAttribute,Float64Attribute:Float64Attribute,Float64BufferAttribute:Float64BufferAttribute,FloatType:FloatType,Fog:Fog,FogExp2:FogExp2,Font:Font,FontLoader:FontLoader,FrontFaceDirectionCCW:FrontFaceDirectionCCW,FrontFaceDirectionCW:FrontFaceDirectionCW,FrontSide:FrontSide,Frustum:Frustum,GammaEncoding:GammaEncoding,Geometry:Geometry,GeometryUtils:GeometryUtils,GreaterDepth:GreaterDepth,GreaterEqualDepth:GreaterEqualDepth,GreaterEqualStencilFunc:GreaterEqualStencilFunc,GreaterStencilFunc:GreaterStencilFunc,GridHelper:GridHelper,Group:Group,HalfFloatType:HalfFloatType,HemisphereLight:HemisphereLight,HemisphereLightHelper:HemisphereLightHelper,HemisphereLightProbe:HemisphereLightProbe,IcosahedronBufferGeometry:IcosahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,ImageBitmapLoader:ImageBitmapLoader,ImageLoader:ImageLoader,ImageUtils:ImageUtils,ImmediateRenderObject:ImmediateRenderObject,IncrementStencilOp:IncrementStencilOp,IncrementWrapStencilOp:IncrementWrapStencilOp,InstancedBufferAttribute:InstancedBufferAttribute,InstancedBufferGeometry:InstancedBufferGeometry,InstancedInterleavedBuffer:InstancedInterleavedBuffer,InstancedMesh:InstancedMesh,Int16Attribute:Int16Attribute,Int16BufferAttribute:Int16BufferAttribute,Int32Attribute:Int32Attribute,Int32BufferAttribute:Int32BufferAttribute,Int8Attribute:Int8Attribute,Int8BufferAttribute:Int8BufferAttribute,IntType:IntType,InterleavedBuffer:InterleavedBuffer,InterleavedBufferAttribute:InterleavedBufferAttribute,Interpolant:Interpolant,InterpolateDiscrete:InterpolateDiscrete,InterpolateLinear:InterpolateLinear,InterpolateSmooth:InterpolateSmooth,InvertStencilOp:InvertStencilOp,JSONLoader:JSONLoader,KeepStencilOp:KeepStencilOp,KeyframeTrack:KeyframeTrack,LOD:LOD,LatheBufferGeometry:LatheBufferGeometry,LatheGeometry:LatheGeometry,Layers:Layers,LensFlare:LensFlare,LessDepth:LessDepth,LessEqualDepth:LessEqualDepth,LessEqualStencilFunc:LessEqualStencilFunc,LessStencilFunc:LessStencilFunc,Light:Light,LightProbe:LightProbe,LightShadow:LightShadow,Line:Line,Line3:Line3,LineBasicMaterial:LineBasicMaterial,LineCurve:LineCurve,LineCurve3:LineCurve3,LineDashedMaterial:LineDashedMaterial,LineLoop:LineLoop,LinePieces:LinePieces,LineSegments:LineSegments,LineStrip:LineStrip,LinearEncoding:LinearEncoding,LinearFilter:LinearFilter,LinearInterpolant:LinearInterpolant,LinearMipMapLinearFilter:LinearMipMapLinearFilter,LinearMipMapNearestFilter:LinearMipMapNearestFilter,LinearMipmapLinearFilter:LinearMipmapLinearFilter,LinearMipmapNearestFilter:LinearMipmapNearestFilter,LinearToneMapping:LinearToneMapping,Loader:Loader,LoaderUtils:LoaderUtils,LoadingManager:LoadingManager,LogLuvEncoding:LogLuvEncoding,LoopOnce:LoopOnce,LoopPingPong:LoopPingPong,LoopRepeat:LoopRepeat,LuminanceAlphaFormat:LuminanceAlphaFormat,LuminanceFormat:LuminanceFormat,MOUSE:MOUSE,Material:Material,MaterialLoader:MaterialLoader,Math:MathUtils,MathUtils:MathUtils,Matrix3:Matrix3,Matrix4:Matrix4,MaxEquation:MaxEquation,Mesh:Mesh,MeshBasicMaterial:MeshBasicMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshFaceMaterial:MeshFaceMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshMatcapMaterial:MeshMatcapMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshToonMaterial:MeshToonMaterial,MinEquation:MinEquation,MirroredRepeatWrapping:MirroredRepeatWrapping,MixOperation:MixOperation,MultiMaterial:MultiMaterial,MultiplyBlending:MultiplyBlending,MultiplyOperation:MultiplyOperation,NearestFilter:NearestFilter,NearestMipMapLinearFilter:NearestMipMapLinearFilter,NearestMipMapNearestFilter:NearestMipMapNearestFilter,NearestMipmapLinearFilter:NearestMipmapLinearFilter,NearestMipmapNearestFilter:NearestMipmapNearestFilter,NeverDepth:NeverDepth,NeverStencilFunc:NeverStencilFunc,NoBlending:NoBlending,NoColors:NoColors,NoToneMapping:NoToneMapping,NormalAnimationBlendMode:NormalAnimationBlendMode,NormalBlending:NormalBlending,NotEqualDepth:NotEqualDepth,NotEqualStencilFunc:NotEqualStencilFunc,NumberKeyframeTrack:NumberKeyframeTrack,Object3D:Object3D,ObjectLoader:ObjectLoader,ObjectSpaceNormalMap:ObjectSpaceNormalMap,OctahedronBufferGeometry:OctahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OneFactor:OneFactor,OneMinusDstAlphaFactor:OneMinusDstAlphaFactor,OneMinusDstColorFactor:OneMinusDstColorFactor,OneMinusSrcAlphaFactor:OneMinusSrcAlphaFactor,OneMinusSrcColorFactor:OneMinusSrcColorFactor,OrthographicCamera:OrthographicCamera,PCFShadowMap:PCFShadowMap,PCFSoftShadowMap:PCFSoftShadowMap,PMREMGenerator:PMREMGenerator,ParametricBufferGeometry:ParametricBufferGeometry,ParametricGeometry:ParametricGeometry,Particle:Particle,ParticleBasicMaterial:ParticleBasicMaterial,ParticleSystem:ParticleSystem,ParticleSystemMaterial:ParticleSystemMaterial,Path:Path,PerspectiveCamera:PerspectiveCamera,Plane:Plane,PlaneBufferGeometry:PlaneBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneHelper:PlaneHelper,PointCloud:PointCloud,PointCloudMaterial:PointCloudMaterial,PointLight:PointLight,PointLightHelper:PointLightHelper,Points:Points,PointsMaterial:PointsMaterial,PolarGridHelper:PolarGridHelper,PolyhedronBufferGeometry:PolyhedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PositionalAudio:PositionalAudio,PropertyBinding:PropertyBinding,PropertyMixer:PropertyMixer,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,Quaternion:Quaternion,QuaternionKeyframeTrack:QuaternionKeyframeTrack,QuaternionLinearInterpolant:QuaternionLinearInterpolant,REVISION:REVISION,RGBADepthPacking:RGBADepthPacking,RGBAFormat:RGBAFormat,RGBAIntegerFormat:RGBAIntegerFormat,RGBA_ASTC_10x10_Format:RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format:RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format:RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format:RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format:RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format:RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format:RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format:RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format:RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format:RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format:RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format:RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format:RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format:RGBA_ASTC_8x8_Format,RGBA_BPTC_Format:RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format:RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format:RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format:RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format:RGBA_S3TC_DXT5_Format,RGBDEncoding:RGBDEncoding,RGBEEncoding:RGBEEncoding,RGBEFormat:RGBEFormat,RGBFormat:RGBFormat,RGBIntegerFormat:RGBIntegerFormat,RGBM16Encoding:RGBM16Encoding,RGBM7Encoding:RGBM7Encoding,RGB_ETC1_Format:RGB_ETC1_Format,RGB_ETC2_Format:RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format:RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format:RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:RGB_S3TC_DXT1_Format,RGFormat:RGFormat,RGIntegerFormat:RGIntegerFormat,RawShaderMaterial:RawShaderMaterial,Ray:Ray,Raycaster:Raycaster,RectAreaLight:RectAreaLight,RedFormat:RedFormat,RedIntegerFormat:RedIntegerFormat,ReinhardToneMapping:ReinhardToneMapping,RepeatWrapping:RepeatWrapping,ReplaceStencilOp:ReplaceStencilOp,ReverseSubtractEquation:ReverseSubtractEquation,RingBufferGeometry:RingBufferGeometry,RingGeometry:RingGeometry,SRGB8_ALPHA8_ASTC_10x10_Format:SRGB8_ALPHA8_ASTC_10x10_Format,SRGB8_ALPHA8_ASTC_10x5_Format:SRGB8_ALPHA8_ASTC_10x5_Format,SRGB8_ALPHA8_ASTC_10x6_Format:SRGB8_ALPHA8_ASTC_10x6_Format,SRGB8_ALPHA8_ASTC_10x8_Format:SRGB8_ALPHA8_ASTC_10x8_Format,SRGB8_ALPHA8_ASTC_12x10_Format:SRGB8_ALPHA8_ASTC_12x10_Format,SRGB8_ALPHA8_ASTC_12x12_Format:SRGB8_ALPHA8_ASTC_12x12_Format,SRGB8_ALPHA8_ASTC_4x4_Format:SRGB8_ALPHA8_ASTC_4x4_Format,SRGB8_ALPHA8_ASTC_5x4_Format:SRGB8_ALPHA8_ASTC_5x4_Format,SRGB8_ALPHA8_ASTC_5x5_Format:SRGB8_ALPHA8_ASTC_5x5_Format,SRGB8_ALPHA8_ASTC_6x5_Format:SRGB8_ALPHA8_ASTC_6x5_Format,SRGB8_ALPHA8_ASTC_6x6_Format:SRGB8_ALPHA8_ASTC_6x6_Format,SRGB8_ALPHA8_ASTC_8x5_Format:SRGB8_ALPHA8_ASTC_8x5_Format,SRGB8_ALPHA8_ASTC_8x6_Format:SRGB8_ALPHA8_ASTC_8x6_Format,SRGB8_ALPHA8_ASTC_8x8_Format:SRGB8_ALPHA8_ASTC_8x8_Format,Scene:Scene,SceneUtils:SceneUtils,ShaderChunk:ShaderChunk,ShaderLib:ShaderLib,ShaderMaterial:ShaderMaterial,ShadowMaterial:ShadowMaterial,Shape:Shape,ShapeBufferGeometry:ShapeBufferGeometry,ShapeGeometry:ShapeGeometry,ShapePath:ShapePath,ShapeUtils:ShapeUtils,ShortType:ShortType,Skeleton:Skeleton,SkeletonHelper:SkeletonHelper,SkinnedMesh:SkinnedMesh,SmoothShading:SmoothShading,Sphere:Sphere,SphereBufferGeometry:SphereBufferGeometry,SphereGeometry:SphereGeometry,Spherical:Spherical,SphericalHarmonics3:SphericalHarmonics3,SphericalReflectionMapping:SphericalReflectionMapping,Spline:Spline,SplineCurve:SplineCurve,SplineCurve3:SplineCurve3,SpotLight:SpotLight,SpotLightHelper:SpotLightHelper,SpotLightShadow:SpotLightShadow,Sprite:Sprite,SpriteMaterial:SpriteMaterial,SrcAlphaFactor:SrcAlphaFactor,SrcAlphaSaturateFactor:SrcAlphaSaturateFactor,SrcColorFactor:SrcColorFactor,StaticCopyUsage:StaticCopyUsage,StaticDrawUsage:StaticDrawUsage,StaticReadUsage:StaticReadUsage,StereoCamera:StereoCamera,StreamCopyUsage:StreamCopyUsage,StreamDrawUsage:StreamDrawUsage,StreamReadUsage:StreamReadUsage,StringKeyframeTrack:StringKeyframeTrack,SubtractEquation:SubtractEquation,SubtractiveBlending:SubtractiveBlending,TOUCH:TOUCH,TangentSpaceNormalMap:TangentSpaceNormalMap,TetrahedronBufferGeometry:TetrahedronBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TextBufferGeometry:TextBufferGeometry,TextGeometry:TextGeometry,Texture:Texture,TextureLoader:TextureLoader,TorusBufferGeometry:TorusBufferGeometry,TorusGeometry:TorusGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,Triangle:Triangle,TriangleFanDrawMode:TriangleFanDrawMode,TriangleStripDrawMode:TriangleStripDrawMode,TrianglesDrawMode:TrianglesDrawMode,TubeBufferGeometry:TubeBufferGeometry,TubeGeometry:TubeGeometry,UVMapping:UVMapping,Uint16Attribute:Uint16Attribute,Uint16BufferAttribute:Uint16BufferAttribute,Uint32Attribute:Uint32Attribute,Uint32BufferAttribute:Uint32BufferAttribute,Uint8Attribute:Uint8Attribute,Uint8BufferAttribute:Uint8BufferAttribute,Uint8ClampedAttribute:Uint8ClampedAttribute,Uint8ClampedBufferAttribute:Uint8ClampedBufferAttribute,Uncharted2ToneMapping:Uncharted2ToneMapping,Uniform:Uniform,UniformsLib:UniformsLib,UniformsUtils:UniformsUtils,UnsignedByteType:UnsignedByteType,UnsignedInt248Type:UnsignedInt248Type,UnsignedIntType:UnsignedIntType,UnsignedShort4444Type:UnsignedShort4444Type,UnsignedShort5551Type:UnsignedShort5551Type,UnsignedShort565Type:UnsignedShort565Type,UnsignedShortType:UnsignedShortType,VSMShadowMap:VSMShadowMap,Vector2:Vector2,Vector3:Vector3,Vector4:Vector4,VectorKeyframeTrack:VectorKeyframeTrack,Vertex:Vertex,VertexColors:VertexColors,VideoTexture:VideoTexture,WebGLCubeRenderTarget:WebGLCubeRenderTarget,WebGLMultisampleRenderTarget:WebGLMultisampleRenderTarget,WebGLRenderTarget:WebGLRenderTarget,WebGLRenderTargetCube:WebGLRenderTargetCube,WebGLRenderer:WebGLRenderer,WebGLUtils:WebGLUtils,WireframeGeometry:WireframeGeometry,WireframeHelper:WireframeHelper,WrapAroundEnding:WrapAroundEnding,XHRLoader:XHRLoader,ZeroCurvatureEnding:ZeroCurvatureEnding,ZeroFactor:ZeroFactor,ZeroSlopeEnding:ZeroSlopeEnding,ZeroStencilOp:ZeroStencilOp,sRGBEncoding:sRGBEncoding});const Maze={generate(e){var t=new Array(e);t.dimension=e;for(var i=0;i<e;i++){t[i]=new Array(e);for(var r=0;r<e;r++){t[i][r]=true}}t=this.iterate(t,1,1);return t},iterate(e,t,i){e[t][i]=false;while(true){let r=[];if(t>1&&e[t-2][i]==true){r.push([-1,0])}if(t<e.dimension-2&&e[t+2][i]==true){r.push([1,0])}if(i>1&&e[t][i-2]==true){r.push([0,-1])}if(i<e.dimension-2&&e[t][i+2]==true){r.push([0,1])}if(r.length==0){return e}let n=r[Math.floor(Math.random()*r.length)];e[t+n[0]][i+n[1]]=false;e=this.iterate(e,t+n[0]*2,i+n[1]*2)}}};var Box2D={};(function(e,t){function i(){}if(!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function)Object.defineProperty=function(e,t,i){i.get instanceof Function&&e.__defineGetter__(t,i.get);i.set instanceof Function&&e.__defineSetter__(t,i.set)};e.inherit=function(e,t){i.prototype=t.prototype;e.prototype=new i;e.prototype.constructor=e};e.generateCallback=function(e,t){return function(){t.apply(e,arguments)}};e.NVector=function(e){if(e===t)e=0;for(var i=Array(e||0),r=0;r<e;++r)i[r]=0;return i};e.is=function(e,i){if(e===null)return false;if(i instanceof Function&&e instanceof i)return true;if(e.constructor.__implements!=t&&e.constructor.__implements[i])return true;return false};e.parseUInt=function(e){return Math.abs(parseInt(e))}})(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;if(typeof Box2D==="undefined")Box2D={};if(typeof Box2D.Collision==="undefined")Box2D.Collision={};if(typeof Box2D.Collision.Shapes==="undefined")Box2D.Collision.Shapes={};if(typeof Box2D.Common==="undefined")Box2D.Common={};if(typeof Box2D.Common.Math==="undefined")Box2D.Common.Math={};if(typeof Box2D.Dynamics==="undefined")Box2D.Dynamics={};if(typeof Box2D.Dynamics.Contacts==="undefined")Box2D.Dynamics.Contacts={};if(typeof Box2D.Dynamics.Controllers==="undefined")Box2D.Dynamics.Controllers={};if(typeof Box2D.Dynamics.Joints==="undefined")Box2D.Dynamics.Joints={};(function(){function e(){e.b2AABB.apply(this,arguments)}function t(){t.b2Bound.apply(this,arguments)}function i(){i.b2BoundValues.apply(this,arguments);this.constructor===i&&this.b2BoundValues.apply(this,arguments)}function r(){r.b2Collision.apply(this,arguments)}function n(){n.b2ContactID.apply(this,arguments);this.constructor===n&&this.b2ContactID.apply(this,arguments)}function a(){a.b2ContactPoint.apply(this,arguments)}function o(){o.b2Distance.apply(this,arguments)}function s(){s.b2DistanceInput.apply(this,arguments)}function l(){l.b2DistanceOutput.apply(this,arguments)}function c(){c.b2DistanceProxy.apply(this,arguments)}function u(){u.b2DynamicTree.apply(this,arguments);this.constructor===u&&this.b2DynamicTree.apply(this,arguments)}function h(){h.b2DynamicTreeBroadPhase.apply(this,arguments)}function p(){p.b2DynamicTreeNode.apply(this,arguments)}function m(){m.b2DynamicTreePair.apply(this,arguments)}function f(){f.b2Manifold.apply(this,arguments);this.constructor===f&&this.b2Manifold.apply(this,arguments)}function d(){d.b2ManifoldPoint.apply(this,arguments);this.constructor===d&&this.b2ManifoldPoint.apply(this,arguments)}function _(){_.b2Point.apply(this,arguments)}function y(){y.b2RayCastInput.apply(this,arguments);this.constructor===y&&this.b2RayCastInput.apply(this,arguments)}function v(){v.b2RayCastOutput.apply(this,arguments)}function g(){g.b2Segment.apply(this,arguments)}function x(){x.b2SeparationFunction.apply(this,arguments)}function b(){b.b2Simplex.apply(this,arguments);this.constructor===b&&this.b2Simplex.apply(this,arguments)}function M(){M.b2SimplexCache.apply(this,arguments)}function w(){w.b2SimplexVertex.apply(this,arguments)}function S(){S.b2TimeOfImpact.apply(this,arguments)}function A(){A.b2TOIInput.apply(this,arguments)}function C(){C.b2WorldManifold.apply(this,arguments);this.constructor===C&&this.b2WorldManifold.apply(this,arguments)}function T(){T.ClipVertex.apply(this,arguments)}function B(){B.Features.apply(this,arguments)}function L(){L.b2CircleShape.apply(this,arguments);this.constructor===L&&this.b2CircleShape.apply(this,arguments)}function D(){D.b2EdgeChainDef.apply(this,arguments);this.constructor===D&&this.b2EdgeChainDef.apply(this,arguments)}function E(){E.b2EdgeShape.apply(this,arguments);this.constructor===E&&this.b2EdgeShape.apply(this,arguments)}function R(){R.b2MassData.apply(this,arguments)}function P(){P.b2PolygonShape.apply(this,arguments);this.constructor===P&&this.b2PolygonShape.apply(this,arguments)}function G(){G.b2Shape.apply(this,arguments);this.constructor===G&&this.b2Shape.apply(this,arguments)}function I(){I.b2Color.apply(this,arguments);this.constructor===I&&this.b2Color.apply(this,arguments)}function V(){V.b2Settings.apply(this,arguments)}function F(){F.b2Mat22.apply(this,arguments);this.constructor===F&&this.b2Mat22.apply(this,arguments)}function O(){O.b2Mat33.apply(this,arguments);this.constructor===O&&this.b2Mat33.apply(this,arguments)}function N(){N.b2Math.apply(this,arguments)}function U(){U.b2Sweep.apply(this,arguments)}function z(){z.b2Transform.apply(this,arguments);this.constructor===z&&this.b2Transform.apply(this,arguments)}function k(){k.b2Vec2.apply(this,arguments);this.constructor===k&&this.b2Vec2.apply(this,arguments)}function H(){H.b2Vec3.apply(this,arguments);this.constructor===H&&this.b2Vec3.apply(this,arguments)}function j(){j.b2Body.apply(this,arguments);this.constructor===j&&this.b2Body.apply(this,arguments)}function W(){W.b2BodyDef.apply(this,arguments);this.constructor===W&&this.b2BodyDef.apply(this,arguments)}function J(){J.b2ContactFilter.apply(this,arguments)}function q(){q.b2ContactImpulse.apply(this,arguments)}function X(){X.b2ContactListener.apply(this,arguments)}function $(){$.b2ContactManager.apply(this,arguments);this.constructor===$&&this.b2ContactManager.apply(this,arguments)}function Z(){Z.b2DebugDraw.apply(this,arguments);this.constructor===Z&&this.b2DebugDraw.apply(this,arguments)}function Y(){Y.b2DestructionListener.apply(this,arguments)}function K(){K.b2FilterData.apply(this,arguments)}function Q(){Q.b2Fixture.apply(this,arguments);this.constructor===Q&&this.b2Fixture.apply(this,arguments)}function ee(){ee.b2FixtureDef.apply(this,arguments);this.constructor===ee&&this.b2FixtureDef.apply(this,arguments)}function te(){te.b2Island.apply(this,arguments);this.constructor===te&&this.b2Island.apply(this,arguments)}function ie(){ie.b2TimeStep.apply(this,arguments)}function re(){re.b2World.apply(this,arguments);this.constructor===re&&this.b2World.apply(this,arguments)}function ne(){ne.b2CircleContact.apply(this,arguments)}function ae(){ae.b2Contact.apply(this,arguments);this.constructor===ae&&this.b2Contact.apply(this,arguments)}function oe(){oe.b2ContactConstraint.apply(this,arguments);this.constructor===oe&&this.b2ContactConstraint.apply(this,arguments)}function se(){se.b2ContactConstraintPoint.apply(this,arguments)}function le(){le.b2ContactEdge.apply(this,arguments)}function ce(){ce.b2ContactFactory.apply(this,arguments);this.constructor===ce&&this.b2ContactFactory.apply(this,arguments)}function ue(){ue.b2ContactRegister.apply(this,arguments)}function he(){he.b2ContactResult.apply(this,arguments)}function pe(){pe.b2ContactSolver.apply(this,arguments);this.constructor===pe&&this.b2ContactSolver.apply(this,arguments)}function me(){me.b2EdgeAndCircleContact.apply(this,arguments)}function fe(){fe.b2NullContact.apply(this,arguments);this.constructor===fe&&this.b2NullContact.apply(this,arguments)}function de(){de.b2PolyAndCircleContact.apply(this,arguments)}function _e(){_e.b2PolyAndEdgeContact.apply(this,arguments)}function ye(){ye.b2PolygonContact.apply(this,arguments)}function ve(){ve.b2PositionSolverManifold.apply(this,arguments);this.constructor===ve&&this.b2PositionSolverManifold.apply(this,arguments)}function ge(){ge.b2BuoyancyController.apply(this,arguments)}function xe(){xe.b2ConstantAccelController.apply(this,arguments)}function be(){be.b2ConstantForceController.apply(this,arguments)}function Me(){Me.b2Controller.apply(this,arguments)}function we(){we.b2ControllerEdge.apply(this,arguments)}function Se(){Se.b2GravityController.apply(this,arguments)}function Ae(){Ae.b2TensorDampingController.apply(this,arguments)}function Ce(){Ce.b2DistanceJoint.apply(this,arguments);this.constructor===Ce&&this.b2DistanceJoint.apply(this,arguments)}function Te(){Te.b2DistanceJointDef.apply(this,arguments);this.constructor===Te&&this.b2DistanceJointDef.apply(this,arguments)}function Be(){Be.b2FrictionJoint.apply(this,arguments);this.constructor===Be&&this.b2FrictionJoint.apply(this,arguments)}function Le(){Le.b2FrictionJointDef.apply(this,arguments);this.constructor===Le&&this.b2FrictionJointDef.apply(this,arguments)}function De(){De.b2GearJoint.apply(this,arguments);this.constructor===De&&this.b2GearJoint.apply(this,arguments)}function Ee(){Ee.b2GearJointDef.apply(this,arguments);this.constructor===Ee&&this.b2GearJointDef.apply(this,arguments)}function Re(){Re.b2Jacobian.apply(this,arguments)}function Pe(){Pe.b2Joint.apply(this,arguments);this.constructor===Pe&&this.b2Joint.apply(this,arguments)}function Ge(){Ge.b2JointDef.apply(this,arguments);this.constructor===Ge&&this.b2JointDef.apply(this,arguments)}function Ie(){Ie.b2JointEdge.apply(this,arguments)}function Ve(){Ve.b2LineJoint.apply(this,arguments);this.constructor===Ve&&this.b2LineJoint.apply(this,arguments)}function Fe(){Fe.b2LineJointDef.apply(this,arguments);this.constructor===Fe&&this.b2LineJointDef.apply(this,arguments)}function Oe(){Oe.b2MouseJoint.apply(this,arguments);this.constructor===Oe&&this.b2MouseJoint.apply(this,arguments)}function Ne(){Ne.b2MouseJointDef.apply(this,arguments);this.constructor===Ne&&this.b2MouseJointDef.apply(this,arguments)}function Ue(){Ue.b2PrismaticJoint.apply(this,arguments);this.constructor===Ue&&this.b2PrismaticJoint.apply(this,arguments)}function ze(){ze.b2PrismaticJointDef.apply(this,arguments);this.constructor===ze&&this.b2PrismaticJointDef.apply(this,arguments)}function ke(){ke.b2PulleyJoint.apply(this,arguments);this.constructor===ke&&this.b2PulleyJoint.apply(this,arguments)}function He(){He.b2PulleyJointDef.apply(this,arguments);this.constructor===He&&this.b2PulleyJointDef.apply(this,arguments)}function je(){je.b2RevoluteJoint.apply(this,arguments);this.constructor===je&&this.b2RevoluteJoint.apply(this,arguments)}function We(){We.b2RevoluteJointDef.apply(this,arguments);this.constructor===We&&this.b2RevoluteJointDef.apply(this,arguments)}function Je(){Je.b2WeldJoint.apply(this,arguments);this.constructor===Je&&this.b2WeldJoint.apply(this,arguments)}function qe(){qe.b2WeldJointDef.apply(this,arguments);this.constructor===qe&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";Box2D.Collision.b2AABB=e;Box2D.Collision.b2Bound=t;Box2D.Collision.b2BoundValues=i;Box2D.Collision.b2Collision=r;Box2D.Collision.b2ContactID=n;Box2D.Collision.b2ContactPoint=a;Box2D.Collision.b2Distance=o;Box2D.Collision.b2DistanceInput=s;Box2D.Collision.b2DistanceOutput=l;Box2D.Collision.b2DistanceProxy=c;Box2D.Collision.b2DynamicTree=u;Box2D.Collision.b2DynamicTreeBroadPhase=h;Box2D.Collision.b2DynamicTreeNode=p;Box2D.Collision.b2DynamicTreePair=m;Box2D.Collision.b2Manifold=f;Box2D.Collision.b2ManifoldPoint=d;Box2D.Collision.b2Point=_;Box2D.Collision.b2RayCastInput=y;Box2D.Collision.b2RayCastOutput=v;Box2D.Collision.b2Segment=g;Box2D.Collision.b2SeparationFunction=x;Box2D.Collision.b2Simplex=b;Box2D.Collision.b2SimplexCache=M;Box2D.Collision.b2SimplexVertex=w;Box2D.Collision.b2TimeOfImpact=S;Box2D.Collision.b2TOIInput=A;Box2D.Collision.b2WorldManifold=C;Box2D.Collision.ClipVertex=T;Box2D.Collision.Features=B;Box2D.Collision.Shapes.b2CircleShape=L;Box2D.Collision.Shapes.b2EdgeChainDef=D;Box2D.Collision.Shapes.b2EdgeShape=E;Box2D.Collision.Shapes.b2MassData=R;Box2D.Collision.Shapes.b2PolygonShape=P;Box2D.Collision.Shapes.b2Shape=G;Box2D.Common.b2internal="Box2D.Common.b2internal";Box2D.Common.b2Color=I;Box2D.Common.b2Settings=V;Box2D.Common.Math.b2Mat22=F;Box2D.Common.Math.b2Mat33=O;Box2D.Common.Math.b2Math=N;Box2D.Common.Math.b2Sweep=U;Box2D.Common.Math.b2Transform=z;Box2D.Common.Math.b2Vec2=k;Box2D.Common.Math.b2Vec3=H;Box2D.Dynamics.b2Body=j;Box2D.Dynamics.b2BodyDef=W;Box2D.Dynamics.b2ContactFilter=J;Box2D.Dynamics.b2ContactImpulse=q;Box2D.Dynamics.b2ContactListener=X;Box2D.Dynamics.b2ContactManager=$;Box2D.Dynamics.b2DebugDraw=Z;Box2D.Dynamics.b2DestructionListener=Y;Box2D.Dynamics.b2FilterData=K;Box2D.Dynamics.b2Fixture=Q;Box2D.Dynamics.b2FixtureDef=ee;Box2D.Dynamics.b2Island=te;Box2D.Dynamics.b2TimeStep=ie;Box2D.Dynamics.b2World=re;Box2D.Dynamics.Contacts.b2CircleContact=ne;Box2D.Dynamics.Contacts.b2Contact=ae;Box2D.Dynamics.Contacts.b2ContactConstraint=oe;Box2D.Dynamics.Contacts.b2ContactConstraintPoint=se;Box2D.Dynamics.Contacts.b2ContactEdge=le;Box2D.Dynamics.Contacts.b2ContactFactory=ce;Box2D.Dynamics.Contacts.b2ContactRegister=ue;Box2D.Dynamics.Contacts.b2ContactResult=he;Box2D.Dynamics.Contacts.b2ContactSolver=pe;Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=me;Box2D.Dynamics.Contacts.b2NullContact=fe;Box2D.Dynamics.Contacts.b2PolyAndCircleContact=de;Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=_e;Box2D.Dynamics.Contacts.b2PolygonContact=ye;Box2D.Dynamics.Contacts.b2PositionSolverManifold=ve;Box2D.Dynamics.Controllers.b2BuoyancyController=ge;Box2D.Dynamics.Controllers.b2ConstantAccelController=xe;Box2D.Dynamics.Controllers.b2ConstantForceController=be;Box2D.Dynamics.Controllers.b2Controller=Me;Box2D.Dynamics.Controllers.b2ControllerEdge=we;Box2D.Dynamics.Controllers.b2GravityController=Se;Box2D.Dynamics.Controllers.b2TensorDampingController=Ae;Box2D.Dynamics.Joints.b2DistanceJoint=Ce;Box2D.Dynamics.Joints.b2DistanceJointDef=Te;Box2D.Dynamics.Joints.b2FrictionJoint=Be;Box2D.Dynamics.Joints.b2FrictionJointDef=Le;Box2D.Dynamics.Joints.b2GearJoint=De;Box2D.Dynamics.Joints.b2GearJointDef=Ee;Box2D.Dynamics.Joints.b2Jacobian=Re;Box2D.Dynamics.Joints.b2Joint=Pe;Box2D.Dynamics.Joints.b2JointDef=Ge;Box2D.Dynamics.Joints.b2JointEdge=Ie;Box2D.Dynamics.Joints.b2LineJoint=Ve;Box2D.Dynamics.Joints.b2LineJointDef=Fe;Box2D.Dynamics.Joints.b2MouseJoint=Oe;Box2D.Dynamics.Joints.b2MouseJointDef=Ne;Box2D.Dynamics.Joints.b2PrismaticJoint=Ue;Box2D.Dynamics.Joints.b2PrismaticJointDef=ze;Box2D.Dynamics.Joints.b2PulleyJoint=ke;Box2D.Dynamics.Joints.b2PulleyJointDef=He;Box2D.Dynamics.Joints.b2RevoluteJoint=je;Box2D.Dynamics.Joints.b2RevoluteJointDef=We;Box2D.Dynamics.Joints.b2WeldJoint=Je;Box2D.Dynamics.Joints.b2WeldJointDef=qe})();Box2D.postDefs=[];(function(){var e=Box2D.Collision.Shapes.b2CircleShape,t=Box2D.Collision.Shapes.b2PolygonShape,i=Box2D.Collision.Shapes.b2Shape,r=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Math,a=Box2D.Common.Math.b2Sweep,o=Box2D.Common.Math.b2Transform,s=Box2D.Common.Math.b2Vec2,l=Box2D.Collision.b2AABB,c=Box2D.Collision.b2Bound,u=Box2D.Collision.b2BoundValues,h=Box2D.Collision.b2Collision,p=Box2D.Collision.b2ContactID,m=Box2D.Collision.b2ContactPoint,f=Box2D.Collision.b2Distance,d=Box2D.Collision.b2DistanceInput,_=Box2D.Collision.b2DistanceOutput,y=Box2D.Collision.b2DistanceProxy,v=Box2D.Collision.b2DynamicTree,g=Box2D.Collision.b2DynamicTreeBroadPhase,x=Box2D.Collision.b2DynamicTreeNode,b=Box2D.Collision.b2DynamicTreePair,M=Box2D.Collision.b2Manifold,w=Box2D.Collision.b2ManifoldPoint,S=Box2D.Collision.b2Point,A=Box2D.Collision.b2RayCastInput,C=Box2D.Collision.b2RayCastOutput,T=Box2D.Collision.b2Segment,B=Box2D.Collision.b2SeparationFunction,L=Box2D.Collision.b2Simplex,D=Box2D.Collision.b2SimplexCache,E=Box2D.Collision.b2SimplexVertex,R=Box2D.Collision.b2TimeOfImpact,P=Box2D.Collision.b2TOIInput,G=Box2D.Collision.b2WorldManifold,I=Box2D.Collision.ClipVertex,V=Box2D.Collision.Features,F=Box2D.Collision.IBroadPhase;l.b2AABB=function(){this.lowerBound=new s;this.upperBound=new s};l.prototype.IsValid=function(){var e=this.upperBound.y-this.lowerBound.y;return e=(e=this.upperBound.x-this.lowerBound.x>=0&&e>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};l.prototype.GetCenter=function(){return new s((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};l.prototype.GetExtents=function(){return new s((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};l.prototype.Contains=function(e){var t=true;return t=(t=(t=(t=t&&this.lowerBound.x<=e.lowerBound.x)&&this.lowerBound.y<=e.lowerBound.y)&&e.upperBound.x<=this.upperBound.x)&&e.upperBound.y<=this.upperBound.y};l.prototype.RayCast=function(e,t){var i=-Number.MAX_VALUE,r=Number.MAX_VALUE,n=t.p1.x,a=t.p1.y,o=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y,l=Math.abs(s),c=e.normal,u=0,h=0,p=u=0;p=0;if(Math.abs(o)<Number.MIN_VALUE){if(n<this.lowerBound.x||this.upperBound.x<n)return false}else{u=1/o;h=(this.lowerBound.x-n)*u;u=(this.upperBound.x-n)*u;p=-1;if(h>u){p=h;h=u;u=p;p=1}if(h>i){c.x=p;c.y=0;i=h}r=Math.min(r,u);if(i>r)return false}if(l<Number.MIN_VALUE){if(a<this.lowerBound.y||this.upperBound.y<a)return false}else{u=1/s;h=(this.lowerBound.y-a)*u;u=(this.upperBound.y-a)*u;p=-1;if(h>u){p=h;h=u;u=p;p=1}if(h>i){c.y=p;c.x=0;i=h}r=Math.min(r,u);if(i>r)return false}e.fraction=i;return true};l.prototype.TestOverlap=function(e){var t=e.lowerBound.y-this.upperBound.y,i=this.lowerBound.y-e.upperBound.y;if(e.lowerBound.x-this.upperBound.x>0||t>0)return false;if(this.lowerBound.x-e.upperBound.x>0||i>0)return false;return true};l.Combine=function(e,t){var i=new l;i.Combine(e,t);return i};l.prototype.Combine=function(e,t){this.lowerBound.x=Math.min(e.lowerBound.x,t.lowerBound.x);this.lowerBound.y=Math.min(e.lowerBound.y,t.lowerBound.y);this.upperBound.x=Math.max(e.upperBound.x,t.upperBound.x);this.upperBound.y=Math.max(e.upperBound.y,t.upperBound.y)};c.b2Bound=function(){};c.prototype.IsLower=function(){return(this.value&1)==0};c.prototype.IsUpper=function(){return(this.value&1)==1};c.prototype.Swap=function(e){var t=this.value,i=this.proxy,r=this.stabbingCount;this.value=e.value;this.proxy=e.proxy;this.stabbingCount=e.stabbingCount;e.value=t;e.proxy=i;e.stabbingCount=r};u.b2BoundValues=function(){};u.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};h.b2Collision=function(){};h.ClipSegmentToLine=function(e,t,i,r){if(r===undefined)r=0;var n,a=0;n=t[0];var o=n.v;n=t[1];var s=n.v,l=i.x*o.x+i.y*o.y-r;n=i.x*s.x+i.y*s.y-r;l<=0&&e[a++].Set(t[0]);n<=0&&e[a++].Set(t[1]);if(l*n<0){i=l/(l-n);n=e[a];n=n.v;n.x=o.x+i*(s.x-o.x);n.y=o.y+i*(s.y-o.y);n=e[a];n.id=(l>0?t[0]:t[1]).id;++a}return a};h.EdgeSeparation=function(e,t,i,r,n){if(i===undefined)i=0;parseInt(e.m_vertexCount);var a=e.m_vertices;e=e.m_normals;var o=parseInt(r.m_vertexCount),s=r.m_vertices,l,c;l=t.R;c=e[i];e=l.col1.x*c.x+l.col2.x*c.y;r=l.col1.y*c.x+l.col2.y*c.y;l=n.R;var u=l.col1.x*e+l.col1.y*r;l=l.col2.x*e+l.col2.y*r;for(var h=0,p=Number.MAX_VALUE,m=0;m<o;++m){c=s[m];c=c.x*u+c.y*l;if(c<p){p=c;h=m}}c=a[i];l=t.R;i=t.position.x+(l.col1.x*c.x+l.col2.x*c.y);t=t.position.y+(l.col1.y*c.x+l.col2.y*c.y);c=s[h];l=n.R;a=n.position.x+(l.col1.x*c.x+l.col2.x*c.y);n=n.position.y+(l.col1.y*c.x+l.col2.y*c.y);a-=i;n-=t;return a*e+n*r};h.FindMaxSeparation=function(e,t,i,r,n){var a=parseInt(t.m_vertexCount),o=t.m_normals,s,l;l=n.R;s=r.m_centroid;var c=n.position.x+(l.col1.x*s.x+l.col2.x*s.y),u=n.position.y+(l.col1.y*s.x+l.col2.y*s.y);l=i.R;s=t.m_centroid;c-=i.position.x+(l.col1.x*s.x+l.col2.x*s.y);u-=i.position.y+(l.col1.y*s.x+l.col2.y*s.y);l=c*i.R.col1.x+u*i.R.col1.y;u=c*i.R.col2.x+u*i.R.col2.y;c=0;for(var p=-Number.MAX_VALUE,m=0;m<a;++m){s=o[m];s=s.x*l+s.y*u;if(s>p){p=s;c=m}}o=h.EdgeSeparation(t,i,c,r,n);s=parseInt(c-1>=0?c-1:a-1);l=h.EdgeSeparation(t,i,s,r,n);u=parseInt(c+1<a?c+1:0);p=h.EdgeSeparation(t,i,u,r,n);var f=m=0,d=0;if(l>o&&l>p){d=-1;m=s;f=l}else if(p>o){d=1;m=u;f=p}else{e[0]=c;return o}for(;;){c=d==-1?m-1>=0?m-1:a-1:m+1<a?m+1:0;o=h.EdgeSeparation(t,i,c,r,n);if(o>f){m=c;f=o}else break}e[0]=m;return f};h.FindIncidentEdge=function(e,t,i,r,n,a){if(r===undefined)r=0;parseInt(t.m_vertexCount);var o=t.m_normals,s=parseInt(n.m_vertexCount);t=n.m_vertices;n=n.m_normals;var l;l=i.R;i=o[r];o=l.col1.x*i.x+l.col2.x*i.y;var c=l.col1.y*i.x+l.col2.y*i.y;l=a.R;i=l.col1.x*o+l.col1.y*c;c=l.col2.x*o+l.col2.y*c;o=i;l=0;for(var u=Number.MAX_VALUE,h=0;h<s;++h){i=n[h];i=o*i.x+c*i.y;if(i<u){u=i;l=h}}n=parseInt(l);o=parseInt(n+1<s?n+1:0);s=e[0];i=t[n];l=a.R;s.v.x=a.position.x+(l.col1.x*i.x+l.col2.x*i.y);s.v.y=a.position.y+(l.col1.y*i.x+l.col2.y*i.y);s.id.features.referenceEdge=r;s.id.features.incidentEdge=n;s.id.features.incidentVertex=0;s=e[1];i=t[o];l=a.R;s.v.x=a.position.x+(l.col1.x*i.x+l.col2.x*i.y);s.v.y=a.position.y+(l.col1.y*i.x+l.col2.y*i.y);s.id.features.referenceEdge=r;s.id.features.incidentEdge=o;s.id.features.incidentVertex=1};h.MakeClipPointVector=function(){var e=new Vector(2);e[0]=new I;e[1]=new I;return e};h.CollidePolygons=function(e,t,i,n,a){var o;e.m_pointCount=0;var s=t.m_radius+n.m_radius;o=0;h.s_edgeAO[0]=o;var l=h.FindMaxSeparation(h.s_edgeAO,t,i,n,a);o=h.s_edgeAO[0];if(!(l>s)){var c=0;h.s_edgeBO[0]=c;var u=h.FindMaxSeparation(h.s_edgeBO,n,a,t,i);c=h.s_edgeBO[0];if(!(u>s)){var p=0,m=0;if(u>.98*l+.001){l=n;n=t;t=a;i=i;p=c;e.m_type=M.e_faceB;m=1}else{l=t;n=n;t=i;i=a;p=o;e.m_type=M.e_faceA;m=0}o=h.s_incidentEdge;h.FindIncidentEdge(o,l,t,p,n,i);c=parseInt(l.m_vertexCount);a=l.m_vertices;l=a[p];var f;f=p+1<c?a[parseInt(p+1)]:a[0];p=h.s_localTangent;p.Set(f.x-l.x,f.y-l.y);p.Normalize();a=h.s_localNormal;a.x=p.y;a.y=-p.x;n=h.s_planePoint;n.Set(.5*(l.x+f.x),.5*(l.y+f.y));u=h.s_tangent;c=t.R;u.x=c.col1.x*p.x+c.col2.x*p.y;u.y=c.col1.y*p.x+c.col2.y*p.y;var d=h.s_tangent2;d.x=-u.x;d.y=-u.y;p=h.s_normal;p.x=u.y;p.y=-u.x;var _=h.s_v11,y=h.s_v12;_.x=t.position.x+(c.col1.x*l.x+c.col2.x*l.y);_.y=t.position.y+(c.col1.y*l.x+c.col2.y*l.y);y.x=t.position.x+(c.col1.x*f.x+c.col2.x*f.y);y.y=t.position.y+(c.col1.y*f.x+c.col2.y*f.y);t=p.x*_.x+p.y*_.y;c=u.x*y.x+u.y*y.y+s;f=h.s_clipPoints1;l=h.s_clipPoints2;y=0;y=h.ClipSegmentToLine(f,o,d,-u.x*_.x-u.y*_.y+s);if(!(y<2)){y=h.ClipSegmentToLine(l,f,u,c);if(!(y<2)){e.m_localPlaneNormal.SetV(a);e.m_localPoint.SetV(n);for(n=a=0;n<r.b2_maxManifoldPoints;++n){o=l[n];if(p.x*o.v.x+p.y*o.v.y-t<=s){u=e.m_points[a];c=i.R;d=o.v.x-i.position.x;_=o.v.y-i.position.y;u.m_localPoint.x=d*c.col1.x+_*c.col1.y;u.m_localPoint.y=d*c.col2.x+_*c.col2.y;u.m_id.Set(o.id);u.m_id.features.flip=m;++a}}e.m_pointCount=a}}}}};h.CollideCircles=function(e,t,i,r,n){e.m_pointCount=0;var a,o;a=i.R;o=t.m_p;var s=i.position.x+(a.col1.x*o.x+a.col2.x*o.y);i=i.position.y+(a.col1.y*o.x+a.col2.y*o.y);a=n.R;o=r.m_p;s=n.position.x+(a.col1.x*o.x+a.col2.x*o.y)-s;n=n.position.y+(a.col1.y*o.x+a.col2.y*o.y)-i;a=t.m_radius+r.m_radius;if(!(s*s+n*n>a*a)){e.m_type=M.e_circles;e.m_localPoint.SetV(t.m_p);e.m_localPlaneNormal.SetZero();e.m_pointCount=1;e.m_points[0].m_localPoint.SetV(r.m_p);e.m_points[0].m_id.key=0}};h.CollidePolygonAndCircle=function(e,t,i,r,n){var a=e.m_pointCount=0,o=0,s,l;l=n.R;s=r.m_p;var c=n.position.y+(l.col1.y*s.x+l.col2.y*s.y);a=n.position.x+(l.col1.x*s.x+l.col2.x*s.y)-i.position.x;o=c-i.position.y;l=i.R;i=a*l.col1.x+o*l.col1.y;l=a*l.col2.x+o*l.col2.y;var u=0;c=-Number.MAX_VALUE;n=t.m_radius+r.m_radius;var h=parseInt(t.m_vertexCount),p=t.m_vertices;t=t.m_normals;for(var m=0;m<h;++m){s=p[m];a=i-s.x;o=l-s.y;s=t[m];a=s.x*a+s.y*o;if(a>n)return;if(a>c){c=a;u=m}}a=parseInt(u);o=parseInt(a+1<h?a+1:0);s=p[a];p=p[o];if(c<Number.MIN_VALUE){e.m_pointCount=1;e.m_type=M.e_faceA;e.m_localPlaneNormal.SetV(t[u]);e.m_localPoint.x=.5*(s.x+p.x);e.m_localPoint.y=.5*(s.y+p.y)}else{c=(i-p.x)*(s.x-p.x)+(l-p.y)*(s.y-p.y);if((i-s.x)*(p.x-s.x)+(l-s.y)*(p.y-s.y)<=0){if((i-s.x)*(i-s.x)+(l-s.y)*(l-s.y)>n*n)return;e.m_pointCount=1;e.m_type=M.e_faceA;e.m_localPlaneNormal.x=i-s.x;e.m_localPlaneNormal.y=l-s.y;e.m_localPlaneNormal.Normalize();e.m_localPoint.SetV(s)}else if(c<=0){if((i-p.x)*(i-p.x)+(l-p.y)*(l-p.y)>n*n)return;e.m_pointCount=1;e.m_type=M.e_faceA;e.m_localPlaneNormal.x=i-p.x;e.m_localPlaneNormal.y=l-p.y;e.m_localPlaneNormal.Normalize();e.m_localPoint.SetV(p)}else{u=.5*(s.x+p.x);s=.5*(s.y+p.y);c=(i-u)*t[a].x+(l-s)*t[a].y;if(c>n)return;e.m_pointCount=1;e.m_type=M.e_faceA;e.m_localPlaneNormal.x=t[a].x;e.m_localPlaneNormal.y=t[a].y;e.m_localPlaneNormal.Normalize();e.m_localPoint.Set(u,s)}}e.m_points[0].m_localPoint.SetV(r.m_p);e.m_points[0].m_id.key=0};h.TestOverlap=function(e,t){var i=t.lowerBound,r=e.upperBound,n=i.x-r.x,a=i.y-r.y;i=e.lowerBound;r=t.upperBound;var o=i.y-r.y;if(n>0||a>0)return false;if(i.x-r.x>0||o>0)return false;return true};Box2D.postDefs.push((function(){Box2D.Collision.b2Collision.s_incidentEdge=h.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=h.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=h.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new s;Box2D.Collision.b2Collision.s_localNormal=new s;Box2D.Collision.b2Collision.s_planePoint=new s;Box2D.Collision.b2Collision.s_normal=new s;Box2D.Collision.b2Collision.s_tangent=new s;Box2D.Collision.b2Collision.s_tangent2=new s;Box2D.Collision.b2Collision.s_v11=new s;Box2D.Collision.b2Collision.s_v12=new s;Box2D.Collision.b2Collision.b2CollidePolyTempVec=new s;Box2D.Collision.b2Collision.b2_nullFeature=255}));p.b2ContactID=function(){this.features=new V};p.prototype.b2ContactID=function(){this.features._m_id=this};p.prototype.Set=function(e){this.key=e._key};p.prototype.Copy=function(){var e=new p;e.key=this.key;return e};Object.defineProperty(p.prototype,"key",{enumerable:false,configurable:true,get:function(){return this._key}});Object.defineProperty(p.prototype,"key",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._key=e;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});m.b2ContactPoint=function(){this.position=new s;this.velocity=new s;this.normal=new s;this.id=new p};f.b2Distance=function(){};f.Distance=function(e,t,i){++f.b2_gjkCalls;var a=i.proxyA,o=i.proxyB,l=i.transformA,c=i.transformB,u=f.s_simplex;u.ReadCache(t,a,l,o,c);var h=u.m_vertices,p=f.s_saveA,m=f.s_saveB,d=0;u.GetClosestPoint().LengthSquared();for(var _=0,y,v=0;v<20;){d=u.m_count;for(_=0;_<d;_++){p[_]=h[_].indexA;m[_]=h[_].indexB}switch(u.m_count){case 1:break;case 2:u.Solve2();break;case 3:u.Solve3();break;default:r.b2Assert(false)}if(u.m_count==3)break;y=u.GetClosestPoint();y.LengthSquared();_=u.GetSearchDirection();if(_.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;y=h[u.m_count];y.indexA=a.GetSupport(n.MulTMV(l.R,_.GetNegative()));y.wA=n.MulX(l,a.GetVertex(y.indexA));y.indexB=o.GetSupport(n.MulTMV(c.R,_));y.wB=n.MulX(c,o.GetVertex(y.indexB));y.w=n.SubtractVV(y.wB,y.wA);++v;++f.b2_gjkIters;var g=false;for(_=0;_<d;_++)if(y.indexA==p[_]&&y.indexB==m[_]){g=true;break}if(g)break;++u.m_count}f.b2_gjkMaxIters=n.Max(f.b2_gjkMaxIters,v);u.GetWitnessPoints(e.pointA,e.pointB);e.distance=n.SubtractVV(e.pointA,e.pointB).Length();e.iterations=v;u.WriteCache(t);if(i.useRadii){t=a.m_radius;o=o.m_radius;if(e.distance>t+o&&e.distance>Number.MIN_VALUE){e.distance-=t+o;i=n.SubtractVV(e.pointB,e.pointA);i.Normalize();e.pointA.x+=t*i.x;e.pointA.y+=t*i.y;e.pointB.x-=o*i.x;e.pointB.y-=o*i.y}else{y=new s;y.x=.5*(e.pointA.x+e.pointB.x);y.y=.5*(e.pointA.y+e.pointB.y);e.pointA.x=e.pointB.x=y.x;e.pointA.y=e.pointB.y=y.y;e.distance=0}}};Box2D.postDefs.push((function(){Box2D.Collision.b2Distance.s_simplex=new L;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}));d.b2DistanceInput=function(){};_.b2DistanceOutput=function(){this.pointA=new s;this.pointB=new s};y.b2DistanceProxy=function(){};y.prototype.Set=function(n){switch(n.GetType()){case i.e_circleShape:n=n instanceof e?n:null;this.m_vertices=new Vector(1,true);this.m_vertices[0]=n.m_p;this.m_count=1;this.m_radius=n.m_radius;break;case i.e_polygonShape:n=n instanceof t?n:null;this.m_vertices=n.m_vertices;this.m_count=n.m_vertexCount;this.m_radius=n.m_radius;break;default:r.b2Assert(false)}};y.prototype.GetSupport=function(e){for(var t=0,i=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_count;++r){var n=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;if(n>i){t=r;i=n}}return t};y.prototype.GetSupportVertex=function(e){for(var t=0,i=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_count;++r){var n=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;if(n>i){t=r;i=n}}return this.m_vertices[t]};y.prototype.GetVertexCount=function(){return this.m_count};y.prototype.GetVertex=function(e){if(e===undefined)e=0;r.b2Assert(0<=e&&e<this.m_count);return this.m_vertices[e]};v.b2DynamicTree=function(){};v.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null;this.m_insertionCount=this.m_path=0};v.prototype.CreateProxy=function(e,t){var i=this.AllocateNode(),n=r.b2_aabbExtension,a=r.b2_aabbExtension;i.aabb.lowerBound.x=e.lowerBound.x-n;i.aabb.lowerBound.y=e.lowerBound.y-a;i.aabb.upperBound.x=e.upperBound.x+n;i.aabb.upperBound.y=e.upperBound.y+a;i.userData=t;this.InsertLeaf(i);return i};v.prototype.DestroyProxy=function(e){this.RemoveLeaf(e);this.FreeNode(e)};v.prototype.MoveProxy=function(e,t,i){r.b2Assert(e.IsLeaf());if(e.aabb.Contains(t))return false;this.RemoveLeaf(e);var n=r.b2_aabbExtension+r.b2_aabbMultiplier*(i.x>0?i.x:-i.x);i=r.b2_aabbExtension+r.b2_aabbMultiplier*(i.y>0?i.y:-i.y);e.aabb.lowerBound.x=t.lowerBound.x-n;e.aabb.lowerBound.y=t.lowerBound.y-i;e.aabb.upperBound.x=t.upperBound.x+n;e.aabb.upperBound.y=t.upperBound.y+i;this.InsertLeaf(e);return true};v.prototype.Rebalance=function(e){if(e===undefined)e=0;if(this.m_root!=null)for(var t=0;t<e;t++){for(var i=this.m_root,r=0;i.IsLeaf()==false;){i=this.m_path>>r&1?i.child2:i.child1;r=r+1&31}++this.m_path;this.RemoveLeaf(i);this.InsertLeaf(i)}};v.prototype.GetFatAABB=function(e){return e.aabb};v.prototype.GetUserData=function(e){return e.userData};v.prototype.Query=function(e,t){if(this.m_root!=null){var i=new Vector,r=0;for(i[r++]=this.m_root;r>0;){var n=i[--r];if(n.aabb.TestOverlap(t))if(n.IsLeaf()){if(!e(n))break}else{i[r++]=n.child1;i[r++]=n.child2}}}};v.prototype.RayCast=function(e,t){if(this.m_root!=null){var i=t.p1,r=t.p2,a=n.SubtractVV(i,r);a.Normalize();a=n.CrossFV(1,a);var o=n.AbsV(a),s=t.maxFraction,c=new l,u=0,h=0;u=i.x+s*(r.x-i.x);h=i.y+s*(r.y-i.y);c.lowerBound.x=Math.min(i.x,u);c.lowerBound.y=Math.min(i.y,h);c.upperBound.x=Math.max(i.x,u);c.upperBound.y=Math.max(i.y,h);var p=new Vector,m=0;for(p[m++]=this.m_root;m>0;){s=p[--m];if(s.aabb.TestOverlap(c)!=false){u=s.aabb.GetCenter();h=s.aabb.GetExtents();if(!(Math.abs(a.x*(i.x-u.x)+a.y*(i.y-u.y))-o.x*h.x-o.y*h.y>0))if(s.IsLeaf()){u=new A;u.p1=t.p1;u.p2=t.p2;u.maxFraction=t.maxFraction;s=e(u,s);if(s==0)break;if(s>0){u=i.x+s*(r.x-i.x);h=i.y+s*(r.y-i.y);c.lowerBound.x=Math.min(i.x,u);c.lowerBound.y=Math.min(i.y,h);c.upperBound.x=Math.max(i.x,u);c.upperBound.y=Math.max(i.y,h)}}else{p[m++]=s.child1;p[m++]=s.child2}}}}};v.prototype.AllocateNode=function(){if(this.m_freeList){var e=this.m_freeList;this.m_freeList=e.parent;e.parent=null;e.child1=null;e.child2=null;return e}return new x};v.prototype.FreeNode=function(e){e.parent=this.m_freeList;this.m_freeList=e};v.prototype.InsertLeaf=function(e){++this.m_insertionCount;if(this.m_root==null){this.m_root=e;this.m_root.parent=null}else{var t=e.aabb.GetCenter(),i=this.m_root;if(i.IsLeaf()==false){do{var r=i.child1;i=i.child2;i=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-t.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-t.y)<Math.abs((i.aabb.lowerBound.x+i.aabb.upperBound.x)/2-t.x)+Math.abs((i.aabb.lowerBound.y+i.aabb.upperBound.y)/2-t.y)?r:i}while(i.IsLeaf()==false)}t=i.parent;r=this.AllocateNode();r.parent=t;r.userData=null;r.aabb.Combine(e.aabb,i.aabb);if(t){if(i.parent.child1==i)t.child1=r;else t.child2=r;r.child1=i;r.child2=e;i.parent=r;e.parent=r;do{if(t.aabb.Contains(r.aabb))break;t.aabb.Combine(t.child1.aabb,t.child2.aabb);r=t;t=t.parent}while(t)}else{r.child1=i;r.child2=e;i.parent=r;this.m_root=e.parent=r}}};v.prototype.RemoveLeaf=function(e){if(e==this.m_root)this.m_root=null;else{var t=e.parent,i=t.parent;e=t.child1==e?t.child2:t.child1;if(i){if(i.child1==t)i.child1=e;else i.child2=e;e.parent=i;for(this.FreeNode(t);i;){t=i.aabb;i.aabb=l.Combine(i.child1.aabb,i.child2.aabb);if(t.Contains(i.aabb))break;i=i.parent}}else{this.m_root=e;e.parent=null;this.FreeNode(t)}}};g.b2DynamicTreeBroadPhase=function(){this.m_tree=new v;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};g.prototype.CreateProxy=function(e,t){var i=this.m_tree.CreateProxy(e,t);++this.m_proxyCount;this.BufferMove(i);return i};g.prototype.DestroyProxy=function(e){this.UnBufferMove(e);--this.m_proxyCount;this.m_tree.DestroyProxy(e)};g.prototype.MoveProxy=function(e,t,i){this.m_tree.MoveProxy(e,t,i)&&this.BufferMove(e)};g.prototype.TestOverlap=function(e,t){var i=this.m_tree.GetFatAABB(e),r=this.m_tree.GetFatAABB(t);return i.TestOverlap(r)};g.prototype.GetUserData=function(e){return this.m_tree.GetUserData(e)};g.prototype.GetFatAABB=function(e){return this.m_tree.GetFatAABB(e)};g.prototype.GetProxyCount=function(){return this.m_proxyCount};g.prototype.UpdatePairs=function(e){var t=this;var i=t.m_pairCount=0,r;for(i=0;i<t.m_moveBuffer.length;++i){r=t.m_moveBuffer[i];var n=t.m_tree.GetFatAABB(r);t.m_tree.Query((function(e){if(e==r)return true;if(t.m_pairCount==t.m_pairBuffer.length)t.m_pairBuffer[t.m_pairCount]=new b;var i=t.m_pairBuffer[t.m_pairCount];i.proxyA=e<r?e:r;i.proxyB=e>=r?e:r;++t.m_pairCount;return true}),n)}for(i=t.m_moveBuffer.length=0;i<t.m_pairCount;){n=t.m_pairBuffer[i];var a=t.m_tree.GetUserData(n.proxyA),o=t.m_tree.GetUserData(n.proxyB);e(a,o);for(++i;i<t.m_pairCount;){a=t.m_pairBuffer[i];if(a.proxyA!=n.proxyA||a.proxyB!=n.proxyB)break;++i}}};g.prototype.Query=function(e,t){this.m_tree.Query(e,t)};g.prototype.RayCast=function(e,t){this.m_tree.RayCast(e,t)};g.prototype.Validate=function(){};g.prototype.Rebalance=function(e){if(e===undefined)e=0;this.m_tree.Rebalance(e)};g.prototype.BufferMove=function(e){this.m_moveBuffer[this.m_moveBuffer.length]=e};g.prototype.UnBufferMove=function(e){this.m_moveBuffer.splice(parseInt(this.m_moveBuffer.indexOf(e)),1)};g.prototype.ComparePairs=function(){return 0};g.__implements={};g.__implements[F]=true;x.b2DynamicTreeNode=function(){this.aabb=new l};x.prototype.IsLeaf=function(){return this.child1==null};b.b2DynamicTreePair=function(){};M.b2Manifold=function(){this.m_pointCount=0};M.prototype.b2Manifold=function(){this.m_points=new Vector(r.b2_maxManifoldPoints);for(var e=0;e<r.b2_maxManifoldPoints;e++)this.m_points[e]=new w;this.m_localPlaneNormal=new s;this.m_localPoint=new s};M.prototype.Reset=function(){for(var e=0;e<r.b2_maxManifoldPoints;e++)(this.m_points[e]instanceof w?this.m_points[e]:null).Reset();this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_pointCount=this.m_type=0};M.prototype.Set=function(e){this.m_pointCount=e.m_pointCount;for(var t=0;t<r.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof w?this.m_points[t]:null).Set(e.m_points[t]);this.m_localPlaneNormal.SetV(e.m_localPlaneNormal);this.m_localPoint.SetV(e.m_localPoint);this.m_type=e.m_type};M.prototype.Copy=function(){var e=new M;e.Set(this);return e};Box2D.postDefs.push((function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4}));w.b2ManifoldPoint=function(){this.m_localPoint=new s;this.m_id=new p};w.prototype.b2ManifoldPoint=function(){this.Reset()};w.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_tangentImpulse=this.m_normalImpulse=0;this.m_id.key=0};w.prototype.Set=function(e){this.m_localPoint.SetV(e.m_localPoint);this.m_normalImpulse=e.m_normalImpulse;this.m_tangentImpulse=e.m_tangentImpulse;this.m_id.Set(e.m_id)};S.b2Point=function(){this.p=new s};S.prototype.Support=function(){return this.p};S.prototype.GetFirstVertex=function(){return this.p};A.b2RayCastInput=function(){this.p1=new s;this.p2=new s};A.prototype.b2RayCastInput=function(e,t,i){if(e===undefined)e=null;if(t===undefined)t=null;if(i===undefined)i=1;e&&this.p1.SetV(e);t&&this.p2.SetV(t);this.maxFraction=i};C.b2RayCastOutput=function(){this.normal=new s};T.b2Segment=function(){this.p1=new s;this.p2=new s};T.prototype.TestSegment=function(e,t,i,r){if(r===undefined)r=0;var n=i.p1,a=i.p2.x-n.x,o=i.p2.y-n.y;i=this.p2.y-this.p1.y;var s=-(this.p2.x-this.p1.x),l=100*Number.MIN_VALUE,c=-(a*i+o*s);if(c>l){var u=n.x-this.p1.x,h=n.y-this.p1.y;n=u*i+h*s;if(0<=n&&n<=r*c){r=-a*h+o*u;if(-l*c<=r&&r<=c*(1+l)){n/=c;r=Math.sqrt(i*i+s*s);i/=r;s/=r;e[0]=n;t.Set(i,s);return true}}}return false};T.prototype.Extend=function(e){this.ExtendForward(e);this.ExtendBackward(e)};T.prototype.ExtendForward=function(e){var t=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y;e=Math.min(t>0?(e.upperBound.x-this.p1.x)/t:t<0?(e.lowerBound.x-this.p1.x)/t:Number.POSITIVE_INFINITY,i>0?(e.upperBound.y-this.p1.y)/i:i<0?(e.lowerBound.y-this.p1.y)/i:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+t*e;this.p2.y=this.p1.y+i*e};T.prototype.ExtendBackward=function(e){var t=-this.p2.x+this.p1.x,i=-this.p2.y+this.p1.y;e=Math.min(t>0?(e.upperBound.x-this.p2.x)/t:t<0?(e.lowerBound.x-this.p2.x)/t:Number.POSITIVE_INFINITY,i>0?(e.upperBound.y-this.p2.y)/i:i<0?(e.lowerBound.y-this.p2.y)/i:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+t*e;this.p1.y=this.p2.y+i*e};B.b2SeparationFunction=function(){this.m_localPoint=new s;this.m_axis=new s};B.prototype.Initialize=function(e,t,i,a,o){this.m_proxyA=t;this.m_proxyB=a;var l=parseInt(e.count);r.b2Assert(0<l&&l<3);var c,u,h,p,m=p=h=a=t=0,f=0;m=0;if(l==1){this.m_type=B.e_points;c=this.m_proxyA.GetVertex(e.indexA[0]);u=this.m_proxyB.GetVertex(e.indexB[0]);l=c;e=i.R;t=i.position.x+(e.col1.x*l.x+e.col2.x*l.y);a=i.position.y+(e.col1.y*l.x+e.col2.y*l.y);l=u;e=o.R;h=o.position.x+(e.col1.x*l.x+e.col2.x*l.y);p=o.position.y+(e.col1.y*l.x+e.col2.y*l.y);this.m_axis.x=h-t;this.m_axis.y=p-a;this.m_axis.Normalize()}else{if(e.indexB[0]==e.indexB[1]){this.m_type=B.e_faceA;t=this.m_proxyA.GetVertex(e.indexA[0]);a=this.m_proxyA.GetVertex(e.indexA[1]);u=this.m_proxyB.GetVertex(e.indexB[0]);this.m_localPoint.x=.5*(t.x+a.x);this.m_localPoint.y=.5*(t.y+a.y);this.m_axis=n.CrossVF(n.SubtractVV(a,t),1);this.m_axis.Normalize();l=this.m_axis;e=i.R;m=e.col1.x*l.x+e.col2.x*l.y;f=e.col1.y*l.x+e.col2.y*l.y;l=this.m_localPoint;e=i.R;t=i.position.x+(e.col1.x*l.x+e.col2.x*l.y);a=i.position.y+(e.col1.y*l.x+e.col2.y*l.y);l=u;e=o.R;h=o.position.x+(e.col1.x*l.x+e.col2.x*l.y);p=o.position.y+(e.col1.y*l.x+e.col2.y*l.y);m=(h-t)*m+(p-a)*f}else if(e.indexA[0]==e.indexA[0]){this.m_type=B.e_faceB;h=this.m_proxyB.GetVertex(e.indexB[0]);p=this.m_proxyB.GetVertex(e.indexB[1]);c=this.m_proxyA.GetVertex(e.indexA[0]);this.m_localPoint.x=.5*(h.x+p.x);this.m_localPoint.y=.5*(h.y+p.y);this.m_axis=n.CrossVF(n.SubtractVV(p,h),1);this.m_axis.Normalize();l=this.m_axis;e=o.R;m=e.col1.x*l.x+e.col2.x*l.y;f=e.col1.y*l.x+e.col2.y*l.y;l=this.m_localPoint;e=o.R;h=o.position.x+(e.col1.x*l.x+e.col2.x*l.y);p=o.position.y+(e.col1.y*l.x+e.col2.y*l.y);l=c;e=i.R;t=i.position.x+(e.col1.x*l.x+e.col2.x*l.y);a=i.position.y+(e.col1.y*l.x+e.col2.y*l.y);m=(t-h)*m+(a-p)*f}else{t=this.m_proxyA.GetVertex(e.indexA[0]);a=this.m_proxyA.GetVertex(e.indexA[1]);h=this.m_proxyB.GetVertex(e.indexB[0]);p=this.m_proxyB.GetVertex(e.indexB[1]);n.MulX(i,c);c=n.MulMV(i.R,n.SubtractVV(a,t));n.MulX(o,u);m=n.MulMV(o.R,n.SubtractVV(p,h));o=c.x*c.x+c.y*c.y;u=m.x*m.x+m.y*m.y;e=n.SubtractVV(m,c);i=c.x*e.x+c.y*e.y;e=m.x*e.x+m.y*e.y;c=c.x*m.x+c.y*m.y;f=o*u-c*c;m=0;if(f!=0)m=n.Clamp((c*e-i*u)/f,0,1);if((c*m+e)/u<0)m=n.Clamp((c-i)/o,0,1);c=new s;c.x=t.x+m*(a.x-t.x);c.y=t.y+m*(a.y-t.y);u=new s;u.x=h.x+m*(p.x-h.x);u.y=h.y+m*(p.y-h.y);if(m==0||m==1){this.m_type=B.e_faceB;this.m_axis=n.CrossVF(n.SubtractVV(p,h),1);this.m_axis.Normalize();this.m_localPoint=u}else{this.m_type=B.e_faceA;this.m_axis=n.CrossVF(n.SubtractVV(a,t),1);this.m_localPoint=c}}m<0&&this.m_axis.NegativeSelf()}};B.prototype.Evaluate=function(e,t){var i,a,o=0;switch(this.m_type){case B.e_points:i=n.MulTMV(e.R,this.m_axis);a=n.MulTMV(t.R,this.m_axis.GetNegative());i=this.m_proxyA.GetSupportVertex(i);a=this.m_proxyB.GetSupportVertex(a);i=n.MulX(e,i);a=n.MulX(t,a);return o=(a.x-i.x)*this.m_axis.x+(a.y-i.y)*this.m_axis.y;case B.e_faceA:o=n.MulMV(e.R,this.m_axis);i=n.MulX(e,this.m_localPoint);a=n.MulTMV(t.R,o.GetNegative());a=this.m_proxyB.GetSupportVertex(a);a=n.MulX(t,a);return o=(a.x-i.x)*o.x+(a.y-i.y)*o.y;case B.e_faceB:o=n.MulMV(t.R,this.m_axis);a=n.MulX(t,this.m_localPoint);i=n.MulTMV(e.R,o.GetNegative());i=this.m_proxyA.GetSupportVertex(i);i=n.MulX(e,i);return o=(i.x-a.x)*o.x+(i.y-a.y)*o.y;default:r.b2Assert(false);return 0}};Box2D.postDefs.push((function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4}));L.b2Simplex=function(){this.m_v1=new E;this.m_v2=new E;this.m_v3=new E;this.m_vertices=new Vector(3)};L.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};L.prototype.ReadCache=function(e,t,i,a,o){r.b2Assert(0<=e.count&&e.count<=3);var s,l;this.m_count=e.count;for(var c=this.m_vertices,u=0;u<this.m_count;u++){var h=c[u];h.indexA=e.indexA[u];h.indexB=e.indexB[u];s=t.GetVertex(h.indexA);l=a.GetVertex(h.indexB);h.wA=n.MulX(i,s);h.wB=n.MulX(o,l);h.w=n.SubtractVV(h.wB,h.wA);h.a=0}if(this.m_count>1){e=e.metric;s=this.GetMetric();if(s<.5*e||2*e<s||s<Number.MIN_VALUE)this.m_count=0}if(this.m_count==0){h=c[0];h.indexA=0;h.indexB=0;s=t.GetVertex(0);l=a.GetVertex(0);h.wA=n.MulX(i,s);h.wB=n.MulX(o,l);h.w=n.SubtractVV(h.wB,h.wA);this.m_count=1}};L.prototype.WriteCache=function(e){e.metric=this.GetMetric();e.count=Box2D.parseUInt(this.m_count);for(var t=this.m_vertices,i=0;i<this.m_count;i++){e.indexA[i]=Box2D.parseUInt(t[i].indexA);e.indexB[i]=Box2D.parseUInt(t[i].indexB)}};L.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var e=n.SubtractVV(this.m_v2.w,this.m_v1.w);return n.CrossVV(e,this.m_v1.w.GetNegative())>0?n.CrossFV(1,e):n.CrossVF(e,1);default:r.b2Assert(false);return new s}};L.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:r.b2Assert(false);return new s;case 1:return this.m_v1.w;case 2:return new s(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:r.b2Assert(false);return new s}};L.prototype.GetWitnessPoints=function(e,t){switch(this.m_count){case 0:r.b2Assert(false);break;case 1:e.SetV(this.m_v1.wA);t.SetV(this.m_v1.wB);break;case 2:e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:t.x=e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;t.y=e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:r.b2Assert(false)}};L.prototype.GetMetric=function(){switch(this.m_count){case 0:r.b2Assert(false);return 0;case 1:return 0;case 2:return n.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return n.CrossVV(n.SubtractVV(this.m_v2.w,this.m_v1.w),n.SubtractVV(this.m_v3.w,this.m_v1.w));default:r.b2Assert(false);return 0}};L.prototype.Solve2=function(){var e=this.m_v1.w,t=this.m_v2.w,i=n.SubtractVV(t,e);e=-(e.x*i.x+e.y*i.y);if(e<=0)this.m_count=this.m_v1.a=1;else{t=t.x*i.x+t.y*i.y;if(t<=0){this.m_count=this.m_v2.a=1;this.m_v1.Set(this.m_v2)}else{i=1/(t+e);this.m_v1.a=t*i;this.m_v2.a=e*i;this.m_count=2}}};L.prototype.Solve3=function(){var e=this.m_v1.w,t=this.m_v2.w,i=this.m_v3.w,r=n.SubtractVV(t,e),a=n.Dot(e,r),o=n.Dot(t,r);a=-a;var s=n.SubtractVV(i,e),l=n.Dot(e,s),c=n.Dot(i,s);l=-l;var u=n.SubtractVV(i,t),h=n.Dot(t,u);u=n.Dot(i,u);h=-h;s=n.CrossVV(r,s);r=s*n.CrossVV(t,i);i=s*n.CrossVV(i,e);e=s*n.CrossVV(e,t);if(a<=0&&l<=0)this.m_count=this.m_v1.a=1;else if(o>0&&a>0&&e<=0){c=1/(o+a);this.m_v1.a=o*c;this.m_v2.a=a*c;this.m_count=2}else if(c>0&&l>0&&i<=0){o=1/(c+l);this.m_v1.a=c*o;this.m_v3.a=l*o;this.m_count=2;this.m_v2.Set(this.m_v3)}else if(o<=0&&h<=0){this.m_count=this.m_v2.a=1;this.m_v1.Set(this.m_v2)}else if(c<=0&&u<=0){this.m_count=this.m_v3.a=1;this.m_v1.Set(this.m_v3)}else if(u>0&&h>0&&r<=0){o=1/(u+h);this.m_v2.a=u*o;this.m_v3.a=h*o;this.m_count=2;this.m_v1.Set(this.m_v3)}else{o=1/(r+i+e);this.m_v1.a=r*o;this.m_v2.a=i*o;this.m_v3.a=e*o;this.m_count=3}};D.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};E.b2SimplexVertex=function(){};E.prototype.Set=function(e){this.wA.SetV(e.wA);this.wB.SetV(e.wB);this.w.SetV(e.w);this.a=e.a;this.indexA=e.indexA;this.indexB=e.indexB};R.b2TimeOfImpact=function(){};R.TimeOfImpact=function(e){++R.b2_toiCalls;var t=e.proxyA,i=e.proxyB,a=e.sweepA,o=e.sweepB;r.b2Assert(a.t0==o.t0);r.b2Assert(1-a.t0>Number.MIN_VALUE);var s=t.m_radius+i.m_radius;e=e.tolerance;var l=0,c=0,u=0;R.s_cache.count=0;for(R.s_distanceInput.useRadii=false;;){a.GetTransform(R.s_xfA,l);o.GetTransform(R.s_xfB,l);R.s_distanceInput.proxyA=t;R.s_distanceInput.proxyB=i;R.s_distanceInput.transformA=R.s_xfA;R.s_distanceInput.transformB=R.s_xfB;f.Distance(R.s_distanceOutput,R.s_cache,R.s_distanceInput);if(R.s_distanceOutput.distance<=0){l=1;break}R.s_fcn.Initialize(R.s_cache,t,R.s_xfA,i,R.s_xfB);var h=R.s_fcn.Evaluate(R.s_xfA,R.s_xfB);if(h<=0){l=1;break}if(c==0)u=h>s?n.Max(s-e,.75*s):n.Max(h-e,.02*s);if(h-u<.5*e){if(c==0){l=1;break}break}var p=l,m=l,d=1;h=h;a.GetTransform(R.s_xfA,d);o.GetTransform(R.s_xfB,d);var _=R.s_fcn.Evaluate(R.s_xfA,R.s_xfB);if(_>=u){l=1;break}for(var y=0;;){var v=0;v=y&1?m+(u-h)*(d-m)/(_-h):.5*(m+d);a.GetTransform(R.s_xfA,v);o.GetTransform(R.s_xfB,v);var g=R.s_fcn.Evaluate(R.s_xfA,R.s_xfB);if(n.Abs(g-u)<.025*e){p=v;break}if(g>u){m=v;h=g}else{d=v;_=g}++y;++R.b2_toiRootIters;if(y==50)break}R.b2_toiMaxRootIters=n.Max(R.b2_toiMaxRootIters,y);if(p<(1+100*Number.MIN_VALUE)*l)break;l=p;c++;++R.b2_toiIters;if(c==1e3)break}R.b2_toiMaxIters=n.Max(R.b2_toiMaxIters,c);return l};Box2D.postDefs.push((function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new D;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new d;Box2D.Collision.b2TimeOfImpact.s_xfA=new o;Box2D.Collision.b2TimeOfImpact.s_xfB=new o;Box2D.Collision.b2TimeOfImpact.s_fcn=new B;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new _}));P.b2TOIInput=function(){this.proxyA=new y;this.proxyB=new y;this.sweepA=new a;this.sweepB=new a};G.b2WorldManifold=function(){this.m_normal=new s};G.prototype.b2WorldManifold=function(){this.m_points=new Vector(r.b2_maxManifoldPoints);for(var e=0;e<r.b2_maxManifoldPoints;e++)this.m_points[e]=new s};G.prototype.Initialize=function(e,t,i,r,n){if(i===undefined)i=0;if(n===undefined)n=0;if(e.m_pointCount!=0){var a=0,o,s,l=0,c=0,u=0,h=0,p=0;o=0;switch(e.m_type){case M.e_circles:s=t.R;o=e.m_localPoint;a=t.position.x+s.col1.x*o.x+s.col2.x*o.y;t=t.position.y+s.col1.y*o.x+s.col2.y*o.y;s=r.R;o=e.m_points[0].m_localPoint;e=r.position.x+s.col1.x*o.x+s.col2.x*o.y;r=r.position.y+s.col1.y*o.x+s.col2.y*o.y;o=e-a;s=r-t;l=o*o+s*s;if(l>Number.MIN_VALUE*Number.MIN_VALUE){l=Math.sqrt(l);this.m_normal.x=o/l;this.m_normal.y=s/l}else{this.m_normal.x=1;this.m_normal.y=0}o=t+i*this.m_normal.y;r=r-n*this.m_normal.y;this.m_points[0].x=.5*(a+i*this.m_normal.x+(e-n*this.m_normal.x));this.m_points[0].y=.5*(o+r);break;case M.e_faceA:s=t.R;o=e.m_localPlaneNormal;l=s.col1.x*o.x+s.col2.x*o.y;c=s.col1.y*o.x+s.col2.y*o.y;s=t.R;o=e.m_localPoint;u=t.position.x+s.col1.x*o.x+s.col2.x*o.y;h=t.position.y+s.col1.y*o.x+s.col2.y*o.y;this.m_normal.x=l;this.m_normal.y=c;for(a=0;a<e.m_pointCount;a++){s=r.R;o=e.m_points[a].m_localPoint;p=r.position.x+s.col1.x*o.x+s.col2.x*o.y;o=r.position.y+s.col1.y*o.x+s.col2.y*o.y;this.m_points[a].x=p+.5*(i-(p-u)*l-(o-h)*c-n)*l;this.m_points[a].y=o+.5*(i-(p-u)*l-(o-h)*c-n)*c}break;case M.e_faceB:s=r.R;o=e.m_localPlaneNormal;l=s.col1.x*o.x+s.col2.x*o.y;c=s.col1.y*o.x+s.col2.y*o.y;s=r.R;o=e.m_localPoint;u=r.position.x+s.col1.x*o.x+s.col2.x*o.y;h=r.position.y+s.col1.y*o.x+s.col2.y*o.y;this.m_normal.x=-l;this.m_normal.y=-c;for(a=0;a<e.m_pointCount;a++){s=t.R;o=e.m_points[a].m_localPoint;p=t.position.x+s.col1.x*o.x+s.col2.x*o.y;o=t.position.y+s.col1.y*o.x+s.col2.y*o.y;this.m_points[a].x=p+.5*(n-(p-u)*l-(o-h)*c-i)*l;this.m_points[a].y=o+.5*(n-(p-u)*l-(o-h)*c-i)*c}}}};I.ClipVertex=function(){this.v=new s;this.id=new p};I.prototype.Set=function(e){this.v.SetV(e.v);this.id.Set(e.id)};V.Features=function(){};Object.defineProperty(V.prototype,"referenceEdge",{enumerable:false,configurable:true,get:function(){return this._referenceEdge}});Object.defineProperty(V.prototype,"referenceEdge",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._referenceEdge=e;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(V.prototype,"incidentEdge",{enumerable:false,configurable:true,get:function(){return this._incidentEdge}});Object.defineProperty(V.prototype,"incidentEdge",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._incidentEdge=e;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(V.prototype,"incidentVertex",{enumerable:false,configurable:true,get:function(){return this._incidentVertex}});Object.defineProperty(V.prototype,"incidentVertex",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._incidentVertex=e;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(V.prototype,"flip",{enumerable:false,configurable:true,get:function(){return this._flip}});Object.defineProperty(V.prototype,"flip",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._flip=e;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();(function(){var e=Box2D.Common.b2Settings,t=Box2D.Collision.Shapes.b2CircleShape,i=Box2D.Collision.Shapes.b2EdgeChainDef,r=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2MassData,a=Box2D.Collision.Shapes.b2PolygonShape,o=Box2D.Collision.Shapes.b2Shape,s=Box2D.Common.Math.b2Mat22,l=Box2D.Common.Math.b2Math,c=Box2D.Common.Math.b2Transform,u=Box2D.Common.Math.b2Vec2,h=Box2D.Collision.b2Distance,p=Box2D.Collision.b2DistanceInput,m=Box2D.Collision.b2DistanceOutput,f=Box2D.Collision.b2DistanceProxy,d=Box2D.Collision.b2SimplexCache;Box2D.inherit(t,Box2D.Collision.Shapes.b2Shape);t.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;t.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new u};t.prototype.Copy=function(){var e=new t;e.Set(this);return e};t.prototype.Set=function(e){this.__super.Set.call(this,e);if(Box2D.is(e,t))this.m_p.SetV((e instanceof t?e:null).m_p)};t.prototype.TestPoint=function(e,t){var i=e.R,r=e.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y);i=e.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);r=t.x-r;i=t.y-i;return r*r+i*i<=this.m_radius*this.m_radius};t.prototype.RayCast=function(e,t,i){var r=i.R,n=t.p1.x-(i.position.x+(r.col1.x*this.m_p.x+r.col2.x*this.m_p.y));i=t.p1.y-(i.position.y+(r.col1.y*this.m_p.x+r.col2.y*this.m_p.y));r=t.p2.x-t.p1.x;var a=t.p2.y-t.p1.y,o=n*r+i*a,s=r*r+a*a,l=o*o-s*(n*n+i*i-this.m_radius*this.m_radius);if(l<0||s<Number.MIN_VALUE)return false;o=-(o+Math.sqrt(l));if(0<=o&&o<=t.maxFraction*s){o/=s;e.fraction=o;e.normal.x=n+o*r;e.normal.y=i+o*a;e.normal.Normalize();return true}return false};t.prototype.ComputeAABB=function(e,t){var i=t.R,r=t.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y);i=t.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);e.lowerBound.Set(r-this.m_radius,i-this.m_radius);e.upperBound.Set(r+this.m_radius,i+this.m_radius)};t.prototype.ComputeMass=function(t,i){if(i===undefined)i=0;t.mass=i*e.b2_pi*this.m_radius*this.m_radius;t.center.SetV(this.m_p);t.I=t.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};t.prototype.ComputeSubmergedArea=function(e,t,i,r){if(t===undefined)t=0;i=l.MulX(i,this.m_p);var n=-(l.Dot(e,i)-t);if(n<-this.m_radius+Number.MIN_VALUE)return 0;if(n>this.m_radius){r.SetV(i);return Math.PI*this.m_radius*this.m_radius}t=this.m_radius*this.m_radius;var a=n*n;n=t*(Math.asin(n/this.m_radius)+Math.PI/2)+n*Math.sqrt(t-a);t=-2/3*Math.pow(t-a,1.5)/n;r.x=i.x+e.x*t;r.y=i.y+e.y*t;return n};t.prototype.GetLocalPosition=function(){return this.m_p};t.prototype.SetLocalPosition=function(e){this.m_p.SetV(e)};t.prototype.GetRadius=function(){return this.m_radius};t.prototype.SetRadius=function(e){if(e===undefined)e=0;this.m_radius=e};t.prototype.b2CircleShape=function(e){if(e===undefined)e=0;this.__super.b2Shape.call(this);this.m_type=o.e_circleShape;this.m_radius=e};i.b2EdgeChainDef=function(){};i.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=true;this.vertices=[]};Box2D.inherit(r,Box2D.Collision.Shapes.b2Shape);r.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;r.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new u;this.m_v1=new u;this.m_v2=new u;this.m_coreV1=new u;this.m_coreV2=new u;this.m_normal=new u;this.m_direction=new u;this.m_cornerDir1=new u;this.m_cornerDir2=new u};r.prototype.TestPoint=function(){return false};r.prototype.RayCast=function(e,t,i){var r,n=t.p2.x-t.p1.x,a=t.p2.y-t.p1.y;r=i.R;var o=i.position.x+(r.col1.x*this.m_v1.x+r.col2.x*this.m_v1.y),s=i.position.y+(r.col1.y*this.m_v1.x+r.col2.y*this.m_v1.y),l=i.position.y+(r.col1.y*this.m_v2.x+r.col2.y*this.m_v2.y)-s;i=-(i.position.x+(r.col1.x*this.m_v2.x+r.col2.x*this.m_v2.y)-o);r=100*Number.MIN_VALUE;var c=-(n*l+a*i);if(c>r){o=t.p1.x-o;var u=t.p1.y-s;s=o*l+u*i;if(0<=s&&s<=t.maxFraction*c){t=-n*u+a*o;if(-r*c<=t&&t<=c*(1+r)){s/=c;e.fraction=s;t=Math.sqrt(l*l+i*i);e.normal.x=l/t;e.normal.y=i/t;return true}}}return false};r.prototype.ComputeAABB=function(e,t){var i=t.R,r=t.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y),n=t.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y),a=t.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y);i=t.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);if(r<a){e.lowerBound.x=r;e.upperBound.x=a}else{e.lowerBound.x=a;e.upperBound.x=r}if(n<i){e.lowerBound.y=n;e.upperBound.y=i}else{e.lowerBound.y=i;e.upperBound.y=n}};r.prototype.ComputeMass=function(e){e.mass=0;e.center.SetV(this.m_v1);e.I=0};r.prototype.ComputeSubmergedArea=function(e,t,i,r){if(t===undefined)t=0;var n=new u(e.x*t,e.y*t),a=l.MulX(i,this.m_v1);i=l.MulX(i,this.m_v2);var o=l.Dot(e,a)-t;e=l.Dot(e,i)-t;if(o>0)if(e>0)return 0;else{a.x=-e/(o-e)*a.x+o/(o-e)*i.x;a.y=-e/(o-e)*a.y+o/(o-e)*i.y}else if(e>0){i.x=-e/(o-e)*a.x+o/(o-e)*i.x;i.y=-e/(o-e)*a.y+o/(o-e)*i.y}r.x=(n.x+a.x+i.x)/3;r.y=(n.y+a.y+i.y)/3;return.5*((a.x-n.x)*(i.y-n.y)-(a.y-n.y)*(i.x-n.x))};r.prototype.GetLength=function(){return this.m_length};r.prototype.GetVertex1=function(){return this.m_v1};r.prototype.GetVertex2=function(){return this.m_v2};r.prototype.GetCoreVertex1=function(){return this.m_coreV1};r.prototype.GetCoreVertex2=function(){return this.m_coreV2};r.prototype.GetNormalVector=function(){return this.m_normal};r.prototype.GetDirectionVector=function(){return this.m_direction};r.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};r.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};r.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};r.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};r.prototype.GetFirstVertex=function(e){var t=e.R;return new u(e.position.x+(t.col1.x*this.m_coreV1.x+t.col2.x*this.m_coreV1.y),e.position.y+(t.col1.y*this.m_coreV1.x+t.col2.y*this.m_coreV1.y))};r.prototype.GetNextEdge=function(){return this.m_nextEdge};r.prototype.GetPrevEdge=function(){return this.m_prevEdge};r.prototype.Support=function(e,t,i){if(t===undefined)t=0;if(i===undefined)i=0;var r=e.R,n=e.position.x+(r.col1.x*this.m_coreV1.x+r.col2.x*this.m_coreV1.y),a=e.position.y+(r.col1.y*this.m_coreV1.x+r.col2.y*this.m_coreV1.y),o=e.position.x+(r.col1.x*this.m_coreV2.x+r.col2.x*this.m_coreV2.y);e=e.position.y+(r.col1.y*this.m_coreV2.x+r.col2.y*this.m_coreV2.y);if(n*t+a*i>o*t+e*i){this.s_supportVec.x=n;this.s_supportVec.y=a}else{this.s_supportVec.x=o;this.s_supportVec.y=e}return this.s_supportVec};r.prototype.b2EdgeShape=function(t,i){this.__super.b2Shape.call(this);this.m_type=o.e_edgeShape;this.m_nextEdge=this.m_prevEdge=null;this.m_v1=t;this.m_v2=i;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-e.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-e.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-e.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-e.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};r.prototype.SetPrevEdge=function(e,t,i,r){this.m_prevEdge=e;this.m_coreV1=t;this.m_cornerDir1=i;this.m_cornerConvex1=r};r.prototype.SetNextEdge=function(e,t,i,r){this.m_nextEdge=e;this.m_coreV2=t;this.m_cornerDir2=i;this.m_cornerConvex2=r};n.b2MassData=function(){this.mass=0;this.center=new u(0,0);this.I=0};Box2D.inherit(a,Box2D.Collision.Shapes.b2Shape);a.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;a.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};a.prototype.Copy=function(){var e=new a;e.Set(this);return e};a.prototype.Set=function(e){this.__super.Set.call(this,e);if(Box2D.is(e,a)){e=e instanceof a?e:null;this.m_centroid.SetV(e.m_centroid);this.m_vertexCount=e.m_vertexCount;this.Reserve(this.m_vertexCount);for(var t=0;t<this.m_vertexCount;t++){this.m_vertices[t].SetV(e.m_vertices[t]);this.m_normals[t].SetV(e.m_normals[t])}}};a.prototype.SetAsArray=function(e,t){if(t===undefined)t=0;var i=new Vector,r=0,n;for(r=0;r<e.length;++r){n=e[r];i.push(n)}this.SetAsVector(i,t)};a.AsArray=function(e,t){if(t===undefined)t=0;var i=new a;i.SetAsArray(e,t);return i};a.prototype.SetAsVector=function(t,i){if(i===undefined)i=0;if(i==0)i=t.length;e.b2Assert(2<=i);this.m_vertexCount=i;this.Reserve(i);var r=0;for(r=0;r<this.m_vertexCount;r++)this.m_vertices[r].SetV(t[r]);for(r=0;r<this.m_vertexCount;++r){var n=parseInt(r),o=parseInt(r+1<this.m_vertexCount?r+1:0);n=l.SubtractVV(this.m_vertices[o],this.m_vertices[n]);e.b2Assert(n.LengthSquared()>Number.MIN_VALUE);this.m_normals[r].SetV(l.CrossVF(n,1));this.m_normals[r].Normalize()}this.m_centroid=a.ComputeCentroid(this.m_vertices,this.m_vertexCount)};a.AsVector=function(e,t){if(t===undefined)t=0;var i=new a;i.SetAsVector(e,t);return i};a.prototype.SetAsBox=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-e,-t);this.m_vertices[1].Set(e,-t);this.m_vertices[2].Set(e,t);this.m_vertices[3].Set(-e,t);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};a.AsBox=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;var i=new a;i.SetAsBox(e,t);return i};a.prototype.SetAsOrientedBox=function(e,t,i,r){if(e===undefined)e=0;if(t===undefined)t=0;if(i===undefined)i=null;if(r===undefined)r=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-e,-t);this.m_vertices[1].Set(e,-t);this.m_vertices[2].Set(e,t);this.m_vertices[3].Set(-e,t);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=i;e=new c;e.position=i;e.R.Set(r);for(i=0;i<this.m_vertexCount;++i){this.m_vertices[i]=l.MulX(e,this.m_vertices[i]);this.m_normals[i]=l.MulMV(e.R,this.m_normals[i])}};a.AsOrientedBox=function(e,t,i,r){if(e===undefined)e=0;if(t===undefined)t=0;if(i===undefined)i=null;if(r===undefined)r=0;var n=new a;n.SetAsOrientedBox(e,t,i,r);return n};a.prototype.SetAsEdge=function(e,t){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(e);this.m_vertices[1].SetV(t);this.m_centroid.x=.5*(e.x+t.x);this.m_centroid.y=.5*(e.y+t.y);this.m_normals[0]=l.CrossVF(l.SubtractVV(t,e),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};a.AsEdge=function(e,t){var i=new a;i.SetAsEdge(e,t);return i};a.prototype.TestPoint=function(e,t){var i;i=e.R;for(var r=t.x-e.position.x,n=t.y-e.position.y,a=r*i.col1.x+n*i.col1.y,o=r*i.col2.x+n*i.col2.y,s=0;s<this.m_vertexCount;++s){i=this.m_vertices[s];r=a-i.x;n=o-i.y;i=this.m_normals[s];if(i.x*r+i.y*n>0)return false}return true};a.prototype.RayCast=function(e,t,i){var r=0,n=t.maxFraction,a=0,o=0,s,l;a=t.p1.x-i.position.x;o=t.p1.y-i.position.y;s=i.R;var c=a*s.col1.x+o*s.col1.y,u=a*s.col2.x+o*s.col2.y;a=t.p2.x-i.position.x;o=t.p2.y-i.position.y;s=i.R;t=a*s.col1.x+o*s.col1.y-c;s=a*s.col2.x+o*s.col2.y-u;for(var h=parseInt(-1),p=0;p<this.m_vertexCount;++p){l=this.m_vertices[p];a=l.x-c;o=l.y-u;l=this.m_normals[p];a=l.x*a+l.y*o;o=l.x*t+l.y*s;if(o==0){if(a<0)return false}else if(o<0&&a<r*o){r=a/o;h=p}else if(o>0&&a<n*o)n=a/o;if(n<r-Number.MIN_VALUE)return false}if(h>=0){e.fraction=r;s=i.R;l=this.m_normals[h];e.normal.x=s.col1.x*l.x+s.col2.x*l.y;e.normal.y=s.col1.y*l.x+s.col2.y*l.y;return true}return false};a.prototype.ComputeAABB=function(e,t){for(var i=t.R,r=this.m_vertices[0],n=t.position.x+(i.col1.x*r.x+i.col2.x*r.y),a=t.position.y+(i.col1.y*r.x+i.col2.y*r.y),o=n,s=a,l=1;l<this.m_vertexCount;++l){r=this.m_vertices[l];var c=t.position.x+(i.col1.x*r.x+i.col2.x*r.y);r=t.position.y+(i.col1.y*r.x+i.col2.y*r.y);n=n<c?n:c;a=a<r?a:r;o=o>c?o:c;s=s>r?s:r}e.lowerBound.x=n-this.m_radius;e.lowerBound.y=a-this.m_radius;e.upperBound.x=o+this.m_radius;e.upperBound.y=s+this.m_radius};a.prototype.ComputeMass=function(e,t){if(t===undefined)t=0;if(this.m_vertexCount==2){e.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x);e.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y);e.mass=0;e.I=0}else{for(var i=0,r=0,n=0,a=0,o=1/3,s=0;s<this.m_vertexCount;++s){var l=this.m_vertices[s],c=s+1<this.m_vertexCount?this.m_vertices[parseInt(s+1)]:this.m_vertices[0],u=l.x-0,h=l.y-0,p=c.x-0,m=c.y-0,f=u*m-h*p,d=.5*f;n+=d;i+=d*o*(0+l.x+c.x);r+=d*o*(0+l.y+c.y);l=u;h=h;p=p;m=m;a+=f*(o*(.25*(l*l+p*l+p*p)+(0*l+0*p))+0+(o*(.25*(h*h+m*h+m*m)+(0*h+0*m))+0))}e.mass=t*n;i*=1/n;r*=1/n;e.center.Set(i,r);e.I=t*a}};a.prototype.ComputeSubmergedArea=function(e,t,i,r){if(t===undefined)t=0;var a=l.MulTMV(i.R,e),o=t-l.Dot(e,i.position),s=new Vector_a2j_Number,c=0,h=parseInt(-1);t=parseInt(-1);var p=false;for(e=e=0;e<this.m_vertexCount;++e){s[e]=l.Dot(a,this.m_vertices[e])-o;var m=s[e]<-Number.MIN_VALUE;if(e>0)if(m){if(!p){h=e-1;c++}}else if(p){t=e-1;c++}p=m}switch(c){case 0:if(p){e=new n;this.ComputeMass(e,1);r.SetV(l.MulX(i,e.center));return e.mass}else return 0;case 1:if(h==-1)h=this.m_vertexCount-1;else t=this.m_vertexCount-1}e=parseInt((h+1)%this.m_vertexCount);a=parseInt((t+1)%this.m_vertexCount);o=(0-s[h])/(s[e]-s[h]);s=(0-s[t])/(s[a]-s[t]);h=new u(this.m_vertices[h].x*(1-o)+this.m_vertices[e].x*o,this.m_vertices[h].y*(1-o)+this.m_vertices[e].y*o);t=new u(this.m_vertices[t].x*(1-s)+this.m_vertices[a].x*s,this.m_vertices[t].y*(1-s)+this.m_vertices[a].y*s);s=0;o=new u;c=this.m_vertices[e];for(e=e;e!=a;){e=(e+1)%this.m_vertexCount;p=e==a?t:this.m_vertices[e];m=.5*((c.x-h.x)*(p.y-h.y)-(c.y-h.y)*(p.x-h.x));s+=m;o.x+=m*(h.x+c.x+p.x)/3;o.y+=m*(h.y+c.y+p.y)/3;c=p}o.Multiply(1/s);r.SetV(l.MulX(i,o));return s};a.prototype.GetVertexCount=function(){return this.m_vertexCount};a.prototype.GetVertices=function(){return this.m_vertices};a.prototype.GetNormals=function(){return this.m_normals};a.prototype.GetSupport=function(e){for(var t=0,i=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_vertexCount;++r){var n=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;if(n>i){t=r;i=n}}return t};a.prototype.GetSupportVertex=function(e){for(var t=0,i=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_vertexCount;++r){var n=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;if(n>i){t=r;i=n}}return this.m_vertices[t]};a.prototype.Validate=function(){return false};a.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=o.e_polygonShape;this.m_centroid=new u;this.m_vertices=new Vector;this.m_normals=new Vector};a.prototype.Reserve=function(e){if(e===undefined)e=0;for(var t=parseInt(this.m_vertices.length);t<e;t++){this.m_vertices[t]=new u;this.m_normals[t]=new u}};a.ComputeCentroid=function(e,t){if(t===undefined)t=0;for(var i=new u,r=0,n=1/3,a=0;a<t;++a){var o=e[a],s=a+1<t?e[parseInt(a+1)]:e[0],l=.5*((o.x-0)*(s.y-0)-(o.y-0)*(s.x-0));r+=l;i.x+=l*n*(0+o.x+s.x);i.y+=l*n*(0+o.y+s.y)}i.x*=1/r;i.y*=1/r;return i};a.ComputeOBB=function(e,t,i){if(i===undefined)i=0;var r=0,n=new Vector(i+1);for(r=0;r<i;++r)n[r]=t[r];n[i]=n[0];t=Number.MAX_VALUE;for(r=1;r<=i;++r){var a=n[parseInt(r-1)],o=n[r].x-a.x,s=n[r].y-a.y,l=Math.sqrt(o*o+s*s);o/=l;s/=l;for(var c=-s,u=o,h=l=Number.MAX_VALUE,p=-Number.MAX_VALUE,m=-Number.MAX_VALUE,f=0;f<i;++f){var d=n[f].x-a.x,_=n[f].y-a.y,y=o*d+s*_;d=c*d+u*_;if(y<l)l=y;if(d<h)h=d;if(y>p)p=y;if(d>m)m=d}f=(p-l)*(m-h);if(f<.95*t){t=f;e.R.col1.x=o;e.R.col1.y=s;e.R.col2.x=c;e.R.col2.y=u;o=.5*(l+p);s=.5*(h+m);c=e.R;e.center.x=a.x+(c.col1.x*o+c.col2.x*s);e.center.y=a.y+(c.col1.y*o+c.col2.y*s);e.extents.x=.5*(p-l);e.extents.y=.5*(m-h)}}};Box2D.postDefs.push((function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new s}));o.b2Shape=function(){};o.prototype.Copy=function(){return null};o.prototype.Set=function(e){this.m_radius=e.m_radius};o.prototype.GetType=function(){return this.m_type};o.prototype.TestPoint=function(){return false};o.prototype.RayCast=function(){return false};o.prototype.ComputeAABB=function(){};o.prototype.ComputeMass=function(){};o.prototype.ComputeSubmergedArea=function(){return 0};o.TestOverlap=function(e,t,i,r){var n=new p;n.proxyA=new f;n.proxyA.Set(e);n.proxyB=new f;n.proxyB.Set(i);n.transformA=t;n.transformB=r;n.useRadii=true;e=new d;e.count=0;t=new m;h.Distance(t,e,n);return t.distance<10*Number.MIN_VALUE};o.prototype.b2Shape=function(){this.m_type=o.e_unknownShape;this.m_radius=e.b2_linearSlop};Box2D.postDefs.push((function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)}))})();(function(){var e=Box2D.Common.b2Color,t=Box2D.Common.b2Settings,i=Box2D.Common.Math.b2Math;e.b2Color=function(){this._b=this._g=this._r=0};e.prototype.b2Color=function(e,t,r){if(e===undefined)e=0;if(t===undefined)t=0;if(r===undefined)r=0;this._r=Box2D.parseUInt(255*i.Clamp(e,0,1));this._g=Box2D.parseUInt(255*i.Clamp(t,0,1));this._b=Box2D.parseUInt(255*i.Clamp(r,0,1))};e.prototype.Set=function(e,t,r){if(e===undefined)e=0;if(t===undefined)t=0;if(r===undefined)r=0;this._r=Box2D.parseUInt(255*i.Clamp(e,0,1));this._g=Box2D.parseUInt(255*i.Clamp(t,0,1));this._b=Box2D.parseUInt(255*i.Clamp(r,0,1))};Object.defineProperty(e.prototype,"r",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._r=Box2D.parseUInt(255*i.Clamp(e,0,1))}});Object.defineProperty(e.prototype,"g",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._g=Box2D.parseUInt(255*i.Clamp(e,0,1))}});Object.defineProperty(e.prototype,"b",{enumerable:false,configurable:true,set:function(e){if(e===undefined)e=0;this._b=Box2D.parseUInt(255*i.Clamp(e,0,1))}});Object.defineProperty(e.prototype,"color",{enumerable:false,configurable:true,get:function(){return this._r<<16|this._g<<8|this._b}});t.b2Settings=function(){};t.b2MixFriction=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;return Math.sqrt(e*t)};t.b2MixRestitution=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;return e>t?e:t};t.b2Assert=function(e){if(!e)throw"Assertion Failed"};Box2D.postDefs.push((function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*t.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*t.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*t.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=1;Box2D.Common.b2Settings.b2_maxLinearCorrection=.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*t.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=t.b2_maxTranslation*t.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=.5*t.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=t.b2_maxRotation*t.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=.2;Box2D.Common.b2Settings.b2_timeToSleep=.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*t.b2_pi}))})();(function(){var e=Box2D.Common.Math.b2Mat22,t=Box2D.Common.Math.b2Mat33,i=Box2D.Common.Math.b2Math,r=Box2D.Common.Math.b2Sweep,n=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,o=Box2D.Common.Math.b2Vec3;e.b2Mat22=function(){this.col1=new a;this.col2=new a};e.prototype.b2Mat22=function(){this.SetIdentity()};e.FromAngle=function(t){if(t===undefined)t=0;var i=new e;i.Set(t);return i};e.FromVV=function(t,i){var r=new e;r.SetVV(t,i);return r};e.prototype.Set=function(e){if(e===undefined)e=0;var t=Math.cos(e);e=Math.sin(e);this.col1.x=t;this.col2.x=-e;this.col1.y=e;this.col2.y=t};e.prototype.SetVV=function(e,t){this.col1.SetV(e);this.col2.SetV(t)};e.prototype.Copy=function(){var t=new e;t.SetM(this);return t};e.prototype.SetM=function(e){this.col1.SetV(e.col1);this.col2.SetV(e.col2)};e.prototype.AddM=function(e){this.col1.x+=e.col1.x;this.col1.y+=e.col1.y;this.col2.x+=e.col2.x;this.col2.y+=e.col2.y};e.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};e.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};e.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};e.prototype.GetInverse=function(e){var t=this.col1.x,i=this.col2.x,r=this.col1.y,n=this.col2.y,a=t*n-i*r;if(a!=0)a=1/a;e.col1.x=a*n;e.col2.x=-a*i;e.col1.y=-a*r;e.col2.y=a*t;return e};e.prototype.Solve=function(e,t,i){if(t===undefined)t=0;if(i===undefined)i=0;var r=this.col1.x,n=this.col2.x,a=this.col1.y,o=this.col2.y,s=r*o-n*a;if(s!=0)s=1/s;e.x=s*(o*t-n*i);e.y=s*(r*i-a*t);return e};e.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};t.b2Mat33=function(){this.col1=new o;this.col2=new o;this.col3=new o};t.prototype.b2Mat33=function(e,t,i){if(e===undefined)e=null;if(t===undefined)t=null;if(i===undefined)i=null;if(!e&&!t&&!i){this.col1.SetZero();this.col2.SetZero();this.col3.SetZero()}else{this.col1.SetV(e);this.col2.SetV(t);this.col3.SetV(i)}};t.prototype.SetVVV=function(e,t,i){this.col1.SetV(e);this.col2.SetV(t);this.col3.SetV(i)};t.prototype.Copy=function(){return new t(this.col1,this.col2,this.col3)};t.prototype.SetM=function(e){this.col1.SetV(e.col1);this.col2.SetV(e.col2);this.col3.SetV(e.col3)};t.prototype.AddM=function(e){this.col1.x+=e.col1.x;this.col1.y+=e.col1.y;this.col1.z+=e.col1.z;this.col2.x+=e.col2.x;this.col2.y+=e.col2.y;this.col2.z+=e.col2.z;this.col3.x+=e.col3.x;this.col3.y+=e.col3.y;this.col3.z+=e.col3.z};t.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};t.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};t.prototype.Solve22=function(e,t,i){if(t===undefined)t=0;if(i===undefined)i=0;var r=this.col1.x,n=this.col2.x,a=this.col1.y,o=this.col2.y,s=r*o-n*a;if(s!=0)s=1/s;e.x=s*(o*t-n*i);e.y=s*(r*i-a*t);return e};t.prototype.Solve33=function(e,t,i,r){if(t===undefined)t=0;if(i===undefined)i=0;if(r===undefined)r=0;var n=this.col1.x,a=this.col1.y,o=this.col1.z,s=this.col2.x,l=this.col2.y,c=this.col2.z,u=this.col3.x,h=this.col3.y,p=this.col3.z,m=n*(l*p-c*h)+a*(c*u-s*p)+o*(s*h-l*u);if(m!=0)m=1/m;e.x=m*(t*(l*p-c*h)+i*(c*u-s*p)+r*(s*h-l*u));e.y=m*(n*(i*p-r*h)+a*(r*u-t*p)+o*(t*h-i*u));e.z=m*(n*(l*r-c*i)+a*(c*t-s*r)+o*(s*i-l*t));return e};i.b2Math=function(){};i.IsValid=function(e){if(e===undefined)e=0;return isFinite(e)};i.Dot=function(e,t){return e.x*t.x+e.y*t.y};i.CrossVV=function(e,t){return e.x*t.y-e.y*t.x};i.CrossVF=function(e,t){if(t===undefined)t=0;return new a(t*e.y,-t*e.x)};i.CrossFV=function(e,t){if(e===undefined)e=0;return new a(-e*t.y,e*t.x)};i.MulMV=function(e,t){return new a(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y)};i.MulTMV=function(e,t){return new a(i.Dot(t,e.col1),i.Dot(t,e.col2))};i.MulX=function(e,t){var r=i.MulMV(e.R,t);r.x+=e.position.x;r.y+=e.position.y;return r};i.MulXT=function(e,t){var r=i.SubtractVV(t,e.position),n=r.x*e.R.col1.x+r.y*e.R.col1.y;r.y=r.x*e.R.col2.x+r.y*e.R.col2.y;r.x=n;return r};i.AddVV=function(e,t){return new a(e.x+t.x,e.y+t.y)};i.SubtractVV=function(e,t){return new a(e.x-t.x,e.y-t.y)};i.Distance=function(e,t){var i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)};i.DistanceSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r};i.MulFV=function(e,t){if(e===undefined)e=0;return new a(e*t.x,e*t.y)};i.AddMM=function(t,r){return e.FromVV(i.AddVV(t.col1,r.col1),i.AddVV(t.col2,r.col2))};i.MulMM=function(t,r){return e.FromVV(i.MulMV(t,r.col1),i.MulMV(t,r.col2))};i.MulTMM=function(t,r){var n=new a(i.Dot(t.col1,r.col1),i.Dot(t.col2,r.col1)),o=new a(i.Dot(t.col1,r.col2),i.Dot(t.col2,r.col2));return e.FromVV(n,o)};i.Abs=function(e){if(e===undefined)e=0;return e>0?e:-e};i.AbsV=function(e){return new a(i.Abs(e.x),i.Abs(e.y))};i.AbsM=function(t){return e.FromVV(i.AbsV(t.col1),i.AbsV(t.col2))};i.Min=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;return e<t?e:t};i.MinV=function(e,t){return new a(i.Min(e.x,t.x),i.Min(e.y,t.y))};i.Max=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;return e>t?e:t};i.MaxV=function(e,t){return new a(i.Max(e.x,t.x),i.Max(e.y,t.y))};i.Clamp=function(e,t,i){if(e===undefined)e=0;if(t===undefined)t=0;if(i===undefined)i=0;return e<t?t:e>i?i:e};i.ClampV=function(e,t,r){return i.MaxV(t,i.MinV(e,r))};i.Swap=function(e,t){var i=e[0];e[0]=t[0];t[0]=i};i.Random=function(){return Math.random()*2-1};i.RandomRange=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;var i=Math.random();return i=(t-e)*i+e};i.NextPowerOfTwo=function(e){if(e===undefined)e=0;e|=e>>1&2147483647;e|=e>>2&1073741823;e|=e>>4&268435455;e|=e>>8&16777215;e|=e>>16&65535;return e+1};i.IsPowerOfTwo=function(e){if(e===undefined)e=0;return e>0&&(e&e-1)==0};Box2D.postDefs.push((function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new a(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=e.FromVV(new a(1,0),new a(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new n(i.b2Vec2_zero,i.b2Mat22_identity)}));r.b2Sweep=function(){this.localCenter=new a;this.c0=new a;this.c=new a};r.prototype.Set=function(e){this.localCenter.SetV(e.localCenter);this.c0.SetV(e.c0);this.c.SetV(e.c);this.a0=e.a0;this.a=e.a;this.t0=e.t0};r.prototype.Copy=function(){var e=new r;e.localCenter.SetV(this.localCenter);e.c0.SetV(this.c0);e.c.SetV(this.c);e.a0=this.a0;e.a=this.a;e.t0=this.t0;return e};r.prototype.GetTransform=function(e,t){if(t===undefined)t=0;e.position.x=(1-t)*this.c0.x+t*this.c.x;e.position.y=(1-t)*this.c0.y+t*this.c.y;e.R.Set((1-t)*this.a0+t*this.a);var i=e.R;e.position.x-=i.col1.x*this.localCenter.x+i.col2.x*this.localCenter.y;e.position.y-=i.col1.y*this.localCenter.x+i.col2.y*this.localCenter.y};r.prototype.Advance=function(e){if(e===undefined)e=0;if(this.t0<e&&1-this.t0>Number.MIN_VALUE){var t=(e-this.t0)/(1-this.t0);this.c0.x=(1-t)*this.c0.x+t*this.c.x;this.c0.y=(1-t)*this.c0.y+t*this.c.y;this.a0=(1-t)*this.a0+t*this.a;this.t0=e}};n.b2Transform=function(){this.position=new a;this.R=new e};n.prototype.b2Transform=function(e,t){if(e===undefined)e=null;if(t===undefined)t=null;if(e){this.position.SetV(e);this.R.SetM(t)}};n.prototype.Initialize=function(e,t){this.position.SetV(e);this.R.SetM(t)};n.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};n.prototype.Set=function(e){this.position.SetV(e.position);this.R.SetM(e.R)};n.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};a.b2Vec2=function(){};a.prototype.b2Vec2=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;this.x=e;this.y=t};a.prototype.SetZero=function(){this.y=this.x=0};a.prototype.Set=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;this.x=e;this.y=t};a.prototype.SetV=function(e){this.x=e.x;this.y=e.y};a.prototype.GetNegative=function(){return new a(-this.x,-this.y)};a.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};a.Make=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;return new a(e,t)};a.prototype.Copy=function(){return new a(this.x,this.y)};a.prototype.Add=function(e){this.x+=e.x;this.y+=e.y};a.prototype.Subtract=function(e){this.x-=e.x;this.y-=e.y};a.prototype.Multiply=function(e){if(e===undefined)e=0;this.x*=e;this.y*=e};a.prototype.MulM=function(e){var t=this.x;this.x=e.col1.x*t+e.col2.x*this.y;this.y=e.col1.y*t+e.col2.y*this.y};a.prototype.MulTM=function(e){var t=i.Dot(this,e.col1);this.y=i.Dot(this,e.col2);this.x=t};a.prototype.CrossVF=function(e){if(e===undefined)e=0;var t=this.x;this.x=e*this.y;this.y=-e*t};a.prototype.CrossFV=function(e){if(e===undefined)e=0;var t=this.x;this.x=-e*this.y;this.y=e*t};a.prototype.MinV=function(e){this.x=this.x<e.x?this.x:e.x;this.y=this.y<e.y?this.y:e.y};a.prototype.MaxV=function(e){this.x=this.x>e.x?this.x:e.x;this.y=this.y>e.y?this.y:e.y};a.prototype.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};a.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};a.prototype.Normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);if(e<Number.MIN_VALUE)return 0;var t=1/e;this.x*=t;this.y*=t;return e};a.prototype.IsValid=function(){return i.IsValid(this.x)&&i.IsValid(this.y)};o.b2Vec3=function(){};o.prototype.b2Vec3=function(e,t,i){if(e===undefined)e=0;if(t===undefined)t=0;if(i===undefined)i=0;this.x=e;this.y=t;this.z=i};o.prototype.SetZero=function(){this.x=this.y=this.z=0};o.prototype.Set=function(e,t,i){if(e===undefined)e=0;if(t===undefined)t=0;if(i===undefined)i=0;this.x=e;this.y=t;this.z=i};o.prototype.SetV=function(e){this.x=e.x;this.y=e.y;this.z=e.z};o.prototype.GetNegative=function(){return new o(-this.x,-this.y,-this.z)};o.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};o.prototype.Copy=function(){return new o(this.x,this.y,this.z)};o.prototype.Add=function(e){this.x+=e.x;this.y+=e.y;this.z+=e.z};o.prototype.Subtract=function(e){this.x-=e.x;this.y-=e.y;this.z-=e.z};o.prototype.Multiply=function(e){if(e===undefined)e=0;this.x*=e;this.y*=e;this.z*=e}})();(function(){var e=Box2D.Common.Math.b2Math,t=Box2D.Common.Math.b2Sweep,i=Box2D.Common.Math.b2Transform,r=Box2D.Common.Math.b2Vec2,n=Box2D.Common.b2Color,a=Box2D.Common.b2Settings,o=Box2D.Collision.b2AABB,s=Box2D.Collision.b2ContactPoint,l=Box2D.Collision.b2DynamicTreeBroadPhase,c=Box2D.Collision.b2RayCastInput,u=Box2D.Collision.b2RayCastOutput,h=Box2D.Collision.Shapes.b2CircleShape,p=Box2D.Collision.Shapes.b2EdgeShape,m=Box2D.Collision.Shapes.b2MassData,f=Box2D.Collision.Shapes.b2PolygonShape,d=Box2D.Collision.Shapes.b2Shape,_=Box2D.Dynamics.b2Body,y=Box2D.Dynamics.b2BodyDef,v=Box2D.Dynamics.b2ContactFilter,g=Box2D.Dynamics.b2ContactImpulse,x=Box2D.Dynamics.b2ContactListener,b=Box2D.Dynamics.b2ContactManager,M=Box2D.Dynamics.b2DebugDraw,w=Box2D.Dynamics.b2DestructionListener,S=Box2D.Dynamics.b2FilterData,A=Box2D.Dynamics.b2Fixture,C=Box2D.Dynamics.b2FixtureDef,T=Box2D.Dynamics.b2Island,B=Box2D.Dynamics.b2TimeStep,L=Box2D.Dynamics.b2World,D=Box2D.Dynamics.Contacts.b2Contact,E=Box2D.Dynamics.Contacts.b2ContactFactory,R=Box2D.Dynamics.Contacts.b2ContactSolver,P=Box2D.Dynamics.Joints.b2Joint,G=Box2D.Dynamics.Joints.b2PulleyJoint;_.b2Body=function(){this.m_xf=new i;this.m_sweep=new t;this.m_linearVelocity=new r;this.m_force=new r};_.prototype.connectEdges=function(t,i,r){if(r===undefined)r=0;var n=Math.atan2(i.GetDirectionVector().y,i.GetDirectionVector().x);r=e.MulFV(Math.tan((n-r)*.5),i.GetDirectionVector());r=e.SubtractVV(r,i.GetNormalVector());r=e.MulFV(a.b2_toiSlop,r);r=e.AddVV(r,i.GetVertex1());var o=e.AddVV(t.GetDirectionVector(),i.GetDirectionVector());o.Normalize();var s=e.Dot(t.GetDirectionVector(),i.GetNormalVector())>0;t.SetNextEdge(i,r,o,s);i.SetPrevEdge(t,r,o,s);return n};_.prototype.CreateFixture=function(e){if(this.m_world.IsLocked()==true)return null;var t=new A;t.Create(this,this.m_xf,e);this.m_flags&_.e_activeFlag&&t.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);t.m_next=this.m_fixtureList;this.m_fixtureList=t;++this.m_fixtureCount;t.m_body=this;t.m_density>0&&this.ResetMassData();this.m_world.m_flags|=L.e_newFixture;return t};_.prototype.CreateFixture2=function(e,t){if(t===undefined)t=0;var i=new C;i.shape=e;i.density=t;return this.CreateFixture(i)};_.prototype.DestroyFixture=function(e){if(this.m_world.IsLocked()!=true){for(var t=this.m_fixtureList,i=null;t!=null;){if(t==e){if(i)i.m_next=e.m_next;else this.m_fixtureList=e.m_next;break}i=t;t=t.m_next}for(t=this.m_contactList;t;){i=t.contact;t=t.next;var r=i.GetFixtureA(),n=i.GetFixtureB();if(e==r||e==n)this.m_world.m_contactManager.Destroy(i)}this.m_flags&_.e_activeFlag&&e.DestroyProxy(this.m_world.m_contactManager.m_broadPhase);e.Destroy();e.m_body=null;e.m_next=null;--this.m_fixtureCount;this.ResetMassData()}};_.prototype.SetPositionAndAngle=function(e,t){if(t===undefined)t=0;var i;if(this.m_world.IsLocked()!=true){this.m_xf.R.Set(t);this.m_xf.position.SetV(e);i=this.m_xf.R;var r=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*r.x+i.col2.x*r.y;this.m_sweep.c.y=i.col1.y*r.x+i.col2.y*r.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=t;r=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(r,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}};_.prototype.SetTransform=function(e){this.SetPositionAndAngle(e.position,e.GetAngle())};_.prototype.GetTransform=function(){return this.m_xf};_.prototype.GetPosition=function(){return this.m_xf.position};_.prototype.SetPosition=function(e){this.SetPositionAndAngle(e,this.GetAngle())};_.prototype.GetAngle=function(){return this.m_sweep.a};_.prototype.SetAngle=function(e){if(e===undefined)e=0;this.SetPositionAndAngle(this.GetPosition(),e)};_.prototype.GetWorldCenter=function(){return this.m_sweep.c};_.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};_.prototype.SetLinearVelocity=function(e){this.m_type!=_.b2_staticBody&&this.m_linearVelocity.SetV(e)};_.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};_.prototype.SetAngularVelocity=function(e){if(e===undefined)e=0;if(this.m_type!=_.b2_staticBody)this.m_angularVelocity=e};_.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};_.prototype.GetDefinition=function(){var e=new y;e.type=this.GetType();e.allowSleep=(this.m_flags&_.e_allowSleepFlag)==_.e_allowSleepFlag;e.angle=this.GetAngle();e.angularDamping=this.m_angularDamping;e.angularVelocity=this.m_angularVelocity;e.fixedRotation=(this.m_flags&_.e_fixedRotationFlag)==_.e_fixedRotationFlag;e.bullet=(this.m_flags&_.e_bulletFlag)==_.e_bulletFlag;e.awake=(this.m_flags&_.e_awakeFlag)==_.e_awakeFlag;e.linearDamping=this.m_linearDamping;e.linearVelocity.SetV(this.GetLinearVelocity());e.position=this.GetPosition();e.userData=this.GetUserData();return e};_.prototype.ApplyForce=function(e,t){if(this.m_type==_.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);this.m_force.x+=e.x;this.m_force.y+=e.y;this.m_torque+=(t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x}};_.prototype.ApplyTorque=function(e){if(e===undefined)e=0;if(this.m_type==_.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);this.m_torque+=e}};_.prototype.ApplyImpulse=function(e,t){if(this.m_type==_.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);this.m_linearVelocity.x+=this.m_invMass*e.x;this.m_linearVelocity.y+=this.m_invMass*e.y;this.m_angularVelocity+=this.m_invI*((t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x)}};_.prototype.Split=function(t){for(var i=this.GetLinearVelocity().Copy(),r=this.GetAngularVelocity(),n=this.GetWorldCenter(),a=this.m_world.CreateBody(this.GetDefinition()),o,s=this.m_fixtureList;s;)if(t(s)){var l=s.m_next;if(o)o.m_next=l;else this.m_fixtureList=l;this.m_fixtureCount--;s.m_next=a.m_fixtureList;a.m_fixtureList=s;a.m_fixtureCount++;s.m_body=a;s=l}else{o=s;s=s.m_next}this.ResetMassData();a.ResetMassData();o=this.GetWorldCenter();t=a.GetWorldCenter();o=e.AddVV(i,e.CrossFV(r,e.SubtractVV(o,n)));i=e.AddVV(i,e.CrossFV(r,e.SubtractVV(t,n)));this.SetLinearVelocity(o);a.SetLinearVelocity(i);this.SetAngularVelocity(r);a.SetAngularVelocity(r);this.SynchronizeFixtures();a.SynchronizeFixtures();return a};_.prototype.Merge=function(e){var t;for(t=e.m_fixtureList;t;){var i=t.m_next;e.m_fixtureCount--;t.m_next=this.m_fixtureList;this.m_fixtureList=t;this.m_fixtureCount++;t.m_body=n;t=i}r.m_fixtureCount=0;var r=this,n=e;r.GetWorldCenter();n.GetWorldCenter();r.GetLinearVelocity().Copy();n.GetLinearVelocity().Copy();r.GetAngularVelocity();n.GetAngularVelocity();r.ResetMassData();this.SynchronizeFixtures()};_.prototype.GetMass=function(){return this.m_mass};_.prototype.GetInertia=function(){return this.m_I};_.prototype.GetMassData=function(e){e.mass=this.m_mass;e.I=this.m_I;e.center.SetV(this.m_sweep.localCenter)};_.prototype.SetMassData=function(t){a.b2Assert(this.m_world.IsLocked()==false);if(this.m_world.IsLocked()!=true)if(this.m_type==_.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=t.mass;if(this.m_mass<=0)this.m_mass=1;this.m_invMass=1/this.m_mass;if(t.I>0&&(this.m_flags&_.e_fixedRotationFlag)==0){this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y);this.m_invI=1/this.m_I}var i=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t.center);this.m_sweep.c0.SetV(e.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-i.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-i.x)}};_.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(!(this.m_type==_.b2_staticBody||this.m_type==_.b2_kinematicBody)){for(var t=r.Make(0,0),i=this.m_fixtureList;i;i=i.m_next)if(i.m_density!=0){var n=i.GetMassData();this.m_mass+=n.mass;t.x+=n.center.x*n.mass;t.y+=n.center.y*n.mass;this.m_I+=n.I}if(this.m_mass>0){this.m_invMass=1/this.m_mass;t.x*=this.m_invMass;t.y*=this.m_invMass}else this.m_invMass=this.m_mass=1;if(this.m_I>0&&(this.m_flags&_.e_fixedRotationFlag)==0){this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y);this.m_I*=this.m_inertiaScale;a.b2Assert(this.m_I>0);this.m_invI=1/this.m_I}else this.m_invI=this.m_I=0;i=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t);this.m_sweep.c0.SetV(e.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-i.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-i.x)}};_.prototype.GetWorldPoint=function(e){var t=this.m_xf.R;e=new r(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);e.x+=this.m_xf.position.x;e.y+=this.m_xf.position.y;return e};_.prototype.GetWorldVector=function(t){return e.MulMV(this.m_xf.R,t)};_.prototype.GetLocalPoint=function(t){return e.MulXT(this.m_xf,t)};_.prototype.GetLocalVector=function(t){return e.MulTMV(this.m_xf.R,t)};_.prototype.GetLinearVelocityFromWorldPoint=function(e){return new r(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))};_.prototype.GetLinearVelocityFromLocalPoint=function(e){var t=this.m_xf.R;e=new r(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);e.x+=this.m_xf.position.x;e.y+=this.m_xf.position.y;return new r(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))};_.prototype.GetLinearDamping=function(){return this.m_linearDamping};_.prototype.SetLinearDamping=function(e){if(e===undefined)e=0;this.m_linearDamping=e};_.prototype.GetAngularDamping=function(){return this.m_angularDamping};_.prototype.SetAngularDamping=function(e){if(e===undefined)e=0;this.m_angularDamping=e};_.prototype.SetType=function(e){if(e===undefined)e=0;if(this.m_type!=e){this.m_type=e;this.ResetMassData();if(this.m_type==_.b2_staticBody){this.m_linearVelocity.SetZero();this.m_angularVelocity=0}this.SetAwake(true);this.m_force.SetZero();this.m_torque=0;for(e=this.m_contactList;e;e=e.next)e.contact.FlagForFiltering()}};_.prototype.GetType=function(){return this.m_type};_.prototype.SetBullet=function(e){if(e)this.m_flags|=_.e_bulletFlag;else this.m_flags&=~_.e_bulletFlag};_.prototype.IsBullet=function(){return(this.m_flags&_.e_bulletFlag)==_.e_bulletFlag};_.prototype.SetSleepingAllowed=function(e){if(e)this.m_flags|=_.e_allowSleepFlag;else{this.m_flags&=~_.e_allowSleepFlag;this.SetAwake(true)}};_.prototype.SetAwake=function(e){if(e){this.m_flags|=_.e_awakeFlag;this.m_sleepTime=0}else{this.m_flags&=~_.e_awakeFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0}};_.prototype.IsAwake=function(){return(this.m_flags&_.e_awakeFlag)==_.e_awakeFlag};_.prototype.SetFixedRotation=function(e){if(e)this.m_flags|=_.e_fixedRotationFlag;else this.m_flags&=~_.e_fixedRotationFlag;this.ResetMassData()};_.prototype.IsFixedRotation=function(){return(this.m_flags&_.e_fixedRotationFlag)==_.e_fixedRotationFlag};_.prototype.SetActive=function(e){if(e!=this.IsActive()){var t;if(e){this.m_flags|=_.e_activeFlag;e=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.CreateProxy(e,this.m_xf)}else{this.m_flags&=~_.e_activeFlag;e=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.DestroyProxy(e);for(e=this.m_contactList;e;){t=e;e=e.next;this.m_world.m_contactManager.Destroy(t.contact)}this.m_contactList=null}}};_.prototype.IsActive=function(){return(this.m_flags&_.e_activeFlag)==_.e_activeFlag};_.prototype.IsSleepingAllowed=function(){return(this.m_flags&_.e_allowSleepFlag)==_.e_allowSleepFlag};_.prototype.GetFixtureList=function(){return this.m_fixtureList};_.prototype.GetJointList=function(){return this.m_jointList};_.prototype.GetControllerList=function(){return this.m_controllerList};_.prototype.GetContactList=function(){return this.m_contactList};_.prototype.GetNext=function(){return this.m_next};_.prototype.GetUserData=function(){return this.m_userData};_.prototype.SetUserData=function(e){this.m_userData=e};_.prototype.GetWorld=function(){return this.m_world};_.prototype.b2Body=function(e,t){this.m_flags=0;if(e.bullet)this.m_flags|=_.e_bulletFlag;if(e.fixedRotation)this.m_flags|=_.e_fixedRotationFlag;if(e.allowSleep)this.m_flags|=_.e_allowSleepFlag;if(e.awake)this.m_flags|=_.e_awakeFlag;if(e.active)this.m_flags|=_.e_activeFlag;this.m_world=t;this.m_xf.position.SetV(e.position);this.m_xf.R.Set(e.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=e.angle;var i=this.m_xf.R,r=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*r.x+i.col2.x*r.y;this.m_sweep.c.y=i.col1.y*r.x+i.col2.y*r.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_contactList=this.m_controllerList=this.m_jointList=null;this.m_controllerCount=0;this.m_next=this.m_prev=null;this.m_linearVelocity.SetV(e.linearVelocity);this.m_angularVelocity=e.angularVelocity;this.m_linearDamping=e.linearDamping;this.m_angularDamping=e.angularDamping;this.m_force.Set(0,0);this.m_sleepTime=this.m_torque=0;this.m_type=e.type;if(this.m_type==_.b2_dynamicBody)this.m_invMass=this.m_mass=1;else this.m_invMass=this.m_mass=0;this.m_invI=this.m_I=0;this.m_inertiaScale=e.inertiaScale;this.m_userData=e.userData;this.m_fixtureList=null;this.m_fixtureCount=0};_.prototype.SynchronizeFixtures=function(){var e=_.s_xf1;e.R.Set(this.m_sweep.a0);var t=e.R,i=this.m_sweep.localCenter;e.position.x=this.m_sweep.c0.x-(t.col1.x*i.x+t.col2.x*i.y);e.position.y=this.m_sweep.c0.y-(t.col1.y*i.x+t.col2.y*i.y);i=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.Synchronize(i,e,this.m_xf)};_.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var e=this.m_xf.R,t=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(e.col1.x*t.x+e.col2.x*t.y);this.m_xf.position.y=this.m_sweep.c.y-(e.col1.y*t.x+e.col2.y*t.y)};_.prototype.ShouldCollide=function(e){if(this.m_type!=_.b2_dynamicBody&&e.m_type!=_.b2_dynamicBody)return false;for(var t=this.m_jointList;t;t=t.next)if(t.other==e)if(t.joint.m_collideConnected==false)return false;return true};_.prototype.Advance=function(e){if(e===undefined)e=0;this.m_sweep.Advance(e);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push((function(){Box2D.Dynamics.b2Body.s_xf1=new i;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2}));y.b2BodyDef=function(){this.position=new r;this.linearVelocity=new r};y.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=true;this.bullet=this.fixedRotation=false;this.type=_.b2_staticBody;this.active=true;this.inertiaScale=1};v.b2ContactFilter=function(){};v.prototype.ShouldCollide=function(e,t){var i=e.GetFilterData(),r=t.GetFilterData();if(i.groupIndex==r.groupIndex&&i.groupIndex!=0)return i.groupIndex>0;return(i.maskBits&r.categoryBits)!=0&&(i.categoryBits&r.maskBits)!=0};v.prototype.RayCollide=function(e,t){if(!e)return true;return this.ShouldCollide(e instanceof A?e:null,t)};Box2D.postDefs.push((function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new v}));g.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(a.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(a.b2_maxManifoldPoints)};x.b2ContactListener=function(){};x.prototype.BeginContact=function(){};x.prototype.EndContact=function(){};x.prototype.PreSolve=function(){};x.prototype.PostSolve=function(){};Box2D.postDefs.push((function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new x}));b.b2ContactManager=function(){};b.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=v.b2_defaultFilter;this.m_contactListener=x.b2_defaultListener;this.m_contactFactory=new E(this.m_allocator);this.m_broadPhase=new l};b.prototype.AddPair=function(e,t){var i=e instanceof A?e:null,r=t instanceof A?t:null,n=i.GetBody(),a=r.GetBody();if(n!=a){for(var o=a.GetContactList();o;){if(o.other==n){var s=o.contact.GetFixtureA(),l=o.contact.GetFixtureB();if(s==i&&l==r)return;if(s==r&&l==i)return}o=o.next}if(a.ShouldCollide(n)!=false)if(this.m_contactFilter.ShouldCollide(i,r)!=false){o=this.m_contactFactory.Create(i,r);i=o.GetFixtureA();r=o.GetFixtureB();n=i.m_body;a=r.m_body;o.m_prev=null;o.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null)this.m_world.m_contactList.m_prev=o;this.m_world.m_contactList=o;o.m_nodeA.contact=o;o.m_nodeA.other=a;o.m_nodeA.prev=null;o.m_nodeA.next=n.m_contactList;if(n.m_contactList!=null)n.m_contactList.prev=o.m_nodeA;n.m_contactList=o.m_nodeA;o.m_nodeB.contact=o;o.m_nodeB.other=n;o.m_nodeB.prev=null;o.m_nodeB.next=a.m_contactList;if(a.m_contactList!=null)a.m_contactList.prev=o.m_nodeB;a.m_contactList=o.m_nodeB;++this.m_world.m_contactCount}}};b.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};b.prototype.Destroy=function(e){var t=e.GetFixtureA(),i=e.GetFixtureB();t=t.GetBody();i=i.GetBody();e.IsTouching()&&this.m_contactListener.EndContact(e);if(e.m_prev)e.m_prev.m_next=e.m_next;if(e.m_next)e.m_next.m_prev=e.m_prev;if(e==this.m_world.m_contactList)this.m_world.m_contactList=e.m_next;if(e.m_nodeA.prev)e.m_nodeA.prev.next=e.m_nodeA.next;if(e.m_nodeA.next)e.m_nodeA.next.prev=e.m_nodeA.prev;if(e.m_nodeA==t.m_contactList)t.m_contactList=e.m_nodeA.next;if(e.m_nodeB.prev)e.m_nodeB.prev.next=e.m_nodeB.next;if(e.m_nodeB.next)e.m_nodeB.next.prev=e.m_nodeB.prev;if(e.m_nodeB==i.m_contactList)i.m_contactList=e.m_nodeB.next;this.m_contactFactory.Destroy(e);--this.m_contactCount};b.prototype.Collide=function(){for(var e=this.m_world.m_contactList;e;){var t=e.GetFixtureA(),i=e.GetFixtureB(),r=t.GetBody(),n=i.GetBody();if(r.IsAwake()==false&&n.IsAwake()==false)e=e.GetNext();else{if(e.m_flags&D.e_filterFlag){if(n.ShouldCollide(r)==false){t=e;e=t.GetNext();this.Destroy(t);continue}if(this.m_contactFilter.ShouldCollide(t,i)==false){t=e;e=t.GetNext();this.Destroy(t);continue}e.m_flags&=~D.e_filterFlag}if(this.m_broadPhase.TestOverlap(t.m_proxy,i.m_proxy)==false){t=e;e=t.GetNext();this.Destroy(t)}else{e.Update(this.m_contactListener);e=e.GetNext()}}}};Box2D.postDefs.push((function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new s}));M.b2DebugDraw=function(){};M.prototype.b2DebugDraw=function(){};M.prototype.SetFlags=function(){};M.prototype.GetFlags=function(){};M.prototype.AppendFlags=function(){};M.prototype.ClearFlags=function(){};M.prototype.SetSprite=function(){};M.prototype.GetSprite=function(){};M.prototype.SetDrawScale=function(){};M.prototype.GetDrawScale=function(){};M.prototype.SetLineThickness=function(){};M.prototype.GetLineThickness=function(){};M.prototype.SetAlpha=function(){};M.prototype.GetAlpha=function(){};M.prototype.SetFillAlpha=function(){};M.prototype.GetFillAlpha=function(){};M.prototype.SetXFormScale=function(){};M.prototype.GetXFormScale=function(){};M.prototype.DrawPolygon=function(){};M.prototype.DrawSolidPolygon=function(){};M.prototype.DrawCircle=function(){};M.prototype.DrawSolidCircle=function(){};M.prototype.DrawSegment=function(){};M.prototype.DrawTransform=function(){};Box2D.postDefs.push((function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32}));w.b2DestructionListener=function(){};w.prototype.SayGoodbyeJoint=function(){};w.prototype.SayGoodbyeFixture=function(){};S.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};S.prototype.Copy=function(){var e=new S;e.categoryBits=this.categoryBits;e.maskBits=this.maskBits;e.groupIndex=this.groupIndex;return e};A.b2Fixture=function(){this.m_filter=new S};A.prototype.GetType=function(){return this.m_shape.GetType()};A.prototype.GetShape=function(){return this.m_shape};A.prototype.SetSensor=function(e){if(this.m_isSensor!=e){this.m_isSensor=e;if(this.m_body!=null)for(e=this.m_body.GetContactList();e;){var t=e.contact,i=t.GetFixtureA(),r=t.GetFixtureB();if(i==this||r==this)t.SetSensor(i.IsSensor()||r.IsSensor());e=e.next}}};A.prototype.IsSensor=function(){return this.m_isSensor};A.prototype.SetFilterData=function(e){this.m_filter=e.Copy();if(!this.m_body)for(e=this.m_body.GetContactList();e;){var t=e.contact,i=t.GetFixtureA(),r=t.GetFixtureB();if(i==this||r==this)t.FlagForFiltering();e=e.next}};A.prototype.GetFilterData=function(){return this.m_filter.Copy()};A.prototype.GetBody=function(){return this.m_body};A.prototype.GetNext=function(){return this.m_next};A.prototype.GetUserData=function(){return this.m_userData};A.prototype.SetUserData=function(e){this.m_userData=e};A.prototype.TestPoint=function(e){return this.m_shape.TestPoint(this.m_body.GetTransform(),e)};A.prototype.RayCast=function(e,t){return this.m_shape.RayCast(e,t,this.m_body.GetTransform())};A.prototype.GetMassData=function(e){if(e===undefined)e=null;if(e==null)e=new m;this.m_shape.ComputeMass(e,this.m_density);return e};A.prototype.SetDensity=function(e){if(e===undefined)e=0;this.m_density=e};A.prototype.GetDensity=function(){return this.m_density};A.prototype.GetFriction=function(){return this.m_friction};A.prototype.SetFriction=function(e){if(e===undefined)e=0;this.m_friction=e};A.prototype.GetRestitution=function(){return this.m_restitution};A.prototype.SetRestitution=function(e){if(e===undefined)e=0;this.m_restitution=e};A.prototype.GetAABB=function(){return this.m_aabb};A.prototype.b2Fixture=function(){this.m_aabb=new o;this.m_shape=this.m_next=this.m_body=this.m_userData=null;this.m_restitution=this.m_friction=this.m_density=0};A.prototype.Create=function(e,t,i){this.m_userData=i.userData;this.m_friction=i.friction;this.m_restitution=i.restitution;this.m_body=e;this.m_next=null;this.m_filter=i.filter.Copy();this.m_isSensor=i.isSensor;this.m_shape=i.shape.Copy();this.m_density=i.density};A.prototype.Destroy=function(){this.m_shape=null};A.prototype.CreateProxy=function(e,t){this.m_shape.ComputeAABB(this.m_aabb,t);this.m_proxy=e.CreateProxy(this.m_aabb,this)};A.prototype.DestroyProxy=function(e){if(this.m_proxy!=null){e.DestroyProxy(this.m_proxy);this.m_proxy=null}};A.prototype.Synchronize=function(t,i,r){if(this.m_proxy){var n=new o,a=new o;this.m_shape.ComputeAABB(n,i);this.m_shape.ComputeAABB(a,r);this.m_aabb.Combine(n,a);i=e.SubtractVV(r.position,i.position);t.MoveProxy(this.m_proxy,this.m_aabb,i)}};C.b2FixtureDef=function(){this.filter=new S};C.prototype.b2FixtureDef=function(){this.userData=this.shape=null;this.friction=.2;this.density=this.restitution=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=false};T.b2Island=function(){};T.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};T.prototype.Initialize=function(e,t,i,r,n,a){if(e===undefined)e=0;if(t===undefined)t=0;if(i===undefined)i=0;var o=0;this.m_bodyCapacity=e;this.m_contactCapacity=t;this.m_jointCapacity=i;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=r;this.m_listener=n;this.m_contactSolver=a;for(o=this.m_bodies.length;o<e;o++)this.m_bodies[o]=null;for(o=this.m_contacts.length;o<t;o++)this.m_contacts[o]=null;for(o=this.m_joints.length;o<i;o++)this.m_joints[o]=null};T.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0};T.prototype.Solve=function(t,i,r){var n=0,o=0,s;for(n=0;n<this.m_bodyCount;++n){o=this.m_bodies[n];if(o.GetType()==_.b2_dynamicBody){o.m_linearVelocity.x+=t.dt*(i.x+o.m_invMass*o.m_force.x);o.m_linearVelocity.y+=t.dt*(i.y+o.m_invMass*o.m_force.y);o.m_angularVelocity+=t.dt*o.m_invI*o.m_torque;o.m_linearVelocity.Multiply(e.Clamp(1-t.dt*o.m_linearDamping,0,1));o.m_angularVelocity*=e.Clamp(1-t.dt*o.m_angularDamping,0,1)}}this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);i=this.m_contactSolver;i.InitVelocityConstraints(t);for(n=0;n<this.m_jointCount;++n){s=this.m_joints[n];s.InitVelocityConstraints(t)}for(n=0;n<t.velocityIterations;++n){for(o=0;o<this.m_jointCount;++o){s=this.m_joints[o];s.SolveVelocityConstraints(t)}i.SolveVelocityConstraints()}for(n=0;n<this.m_jointCount;++n){s=this.m_joints[n];s.FinalizeVelocityConstraints()}i.FinalizeVelocityConstraints();for(n=0;n<this.m_bodyCount;++n){o=this.m_bodies[n];if(o.GetType()!=_.b2_staticBody){var l=t.dt*o.m_linearVelocity.x,c=t.dt*o.m_linearVelocity.y;if(l*l+c*c>a.b2_maxTranslationSquared){o.m_linearVelocity.Normalize();o.m_linearVelocity.x*=a.b2_maxTranslation*t.inv_dt;o.m_linearVelocity.y*=a.b2_maxTranslation*t.inv_dt}l=t.dt*o.m_angularVelocity;if(l*l>a.b2_maxRotationSquared)o.m_angularVelocity=o.m_angularVelocity<0?-a.b2_maxRotation*t.inv_dt:a.b2_maxRotation*t.inv_dt;o.m_sweep.c0.SetV(o.m_sweep.c);o.m_sweep.a0=o.m_sweep.a;o.m_sweep.c.x+=t.dt*o.m_linearVelocity.x;o.m_sweep.c.y+=t.dt*o.m_linearVelocity.y;o.m_sweep.a+=t.dt*o.m_angularVelocity;o.SynchronizeTransform()}}for(n=0;n<t.positionIterations;++n){l=i.SolvePositionConstraints(a.b2_contactBaumgarte);c=true;for(o=0;o<this.m_jointCount;++o){s=this.m_joints[o];s=s.SolvePositionConstraints(a.b2_contactBaumgarte);c=c&&s}if(l&&c)break}this.Report(i.m_constraints);if(r){r=Number.MAX_VALUE;i=a.b2_linearSleepTolerance*a.b2_linearSleepTolerance;l=a.b2_angularSleepTolerance*a.b2_angularSleepTolerance;for(n=0;n<this.m_bodyCount;++n){o=this.m_bodies[n];if(o.GetType()!=_.b2_staticBody){if((o.m_flags&_.e_allowSleepFlag)==0)r=o.m_sleepTime=0;if((o.m_flags&_.e_allowSleepFlag)==0||o.m_angularVelocity*o.m_angularVelocity>l||e.Dot(o.m_linearVelocity,o.m_linearVelocity)>i)r=o.m_sleepTime=0;else{o.m_sleepTime+=t.dt;r=e.Min(r,o.m_sleepTime)}}}if(r>=a.b2_timeToSleep)for(n=0;n<this.m_bodyCount;++n){o=this.m_bodies[n];o.SetAwake(false)}}};T.prototype.SolveTOI=function(e){var t=0,i=0;this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var r=this.m_contactSolver;for(t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(e);for(t=0;t<e.velocityIterations;++t){r.SolveVelocityConstraints();for(i=0;i<this.m_jointCount;++i)this.m_joints[i].SolveVelocityConstraints(e)}for(t=0;t<this.m_bodyCount;++t){i=this.m_bodies[t];if(i.GetType()!=_.b2_staticBody){var n=e.dt*i.m_linearVelocity.x,o=e.dt*i.m_linearVelocity.y;if(n*n+o*o>a.b2_maxTranslationSquared){i.m_linearVelocity.Normalize();i.m_linearVelocity.x*=a.b2_maxTranslation*e.inv_dt;i.m_linearVelocity.y*=a.b2_maxTranslation*e.inv_dt}n=e.dt*i.m_angularVelocity;if(n*n>a.b2_maxRotationSquared)i.m_angularVelocity=i.m_angularVelocity<0?-a.b2_maxRotation*e.inv_dt:a.b2_maxRotation*e.inv_dt;i.m_sweep.c0.SetV(i.m_sweep.c);i.m_sweep.a0=i.m_sweep.a;i.m_sweep.c.x+=e.dt*i.m_linearVelocity.x;i.m_sweep.c.y+=e.dt*i.m_linearVelocity.y;i.m_sweep.a+=e.dt*i.m_angularVelocity;i.SynchronizeTransform()}}for(t=0;t<e.positionIterations;++t){n=r.SolvePositionConstraints(.75);o=true;for(i=0;i<this.m_jointCount;++i){var s=this.m_joints[i].SolvePositionConstraints(a.b2_contactBaumgarte);o=o&&s}if(n&&o)break}this.Report(r.m_constraints)};T.prototype.Report=function(e){if(this.m_listener!=null)for(var t=0;t<this.m_contactCount;++t){for(var i=this.m_contacts[t],r=e[t],n=0;n<r.pointCount;++n){T.s_impulse.normalImpulses[n]=r.points[n].normalImpulse;T.s_impulse.tangentImpulses[n]=r.points[n].tangentImpulse}this.m_listener.PostSolve(i,T.s_impulse)}};T.prototype.AddBody=function(e){e.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=e};T.prototype.AddContact=function(e){this.m_contacts[this.m_contactCount++]=e};T.prototype.AddJoint=function(e){this.m_joints[this.m_jointCount++]=e};Box2D.postDefs.push((function(){Box2D.Dynamics.b2Island.s_impulse=new g}));B.b2TimeStep=function(){};B.prototype.Set=function(e){this.dt=e.dt;this.inv_dt=e.inv_dt;this.positionIterations=e.positionIterations;this.velocityIterations=e.velocityIterations;this.warmStarting=e.warmStarting};L.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new b;this.m_contactSolver=new R;this.m_island=new T};L.prototype.b2World=function(e,t){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null;this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;L.m_warmStarting=true;L.m_continuousPhysics=true;this.m_allowSleep=t;this.m_gravity=e;this.m_inv_dt0=0;this.m_contactManager.m_world=this;this.m_groundBody=this.CreateBody(new y)};L.prototype.SetDestructionListener=function(e){this.m_destructionListener=e};L.prototype.SetContactFilter=function(e){this.m_contactManager.m_contactFilter=e};L.prototype.SetContactListener=function(e){this.m_contactManager.m_contactListener=e};L.prototype.SetDebugDraw=function(e){this.m_debugDraw=e};L.prototype.SetBroadPhase=function(e){var t=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=e;for(var i=this.m_bodyList;i;i=i.m_next)for(var r=i.m_fixtureList;r;r=r.m_next)r.m_proxy=e.CreateProxy(t.GetFatAABB(r.m_proxy),r)};L.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};L.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};L.prototype.CreateBody=function(e){if(this.IsLocked()==true)return null;e=new _(e,this);e.m_prev=null;if(e.m_next=this.m_bodyList)this.m_bodyList.m_prev=e;this.m_bodyList=e;++this.m_bodyCount;return e};L.prototype.DestroyBody=function(e){if(this.IsLocked()!=true){for(var t=e.m_jointList;t;){var i=t;t=t.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint);this.DestroyJoint(i.joint)}for(t=e.m_controllerList;t;){i=t;t=t.nextController;i.controller.RemoveBody(e)}for(t=e.m_contactList;t;){i=t;t=t.next;this.m_contactManager.Destroy(i.contact)}e.m_contactList=null;for(t=e.m_fixtureList;t;){i=t;t=t.m_next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(i);i.DestroyProxy(this.m_contactManager.m_broadPhase);i.Destroy()}e.m_fixtureList=null;e.m_fixtureCount=0;if(e.m_prev)e.m_prev.m_next=e.m_next;if(e.m_next)e.m_next.m_prev=e.m_prev;if(e==this.m_bodyList)this.m_bodyList=e.m_next;--this.m_bodyCount}};L.prototype.CreateJoint=function(e){var t=P.Create(e,null);t.m_prev=null;if(t.m_next=this.m_jointList)this.m_jointList.m_prev=t;this.m_jointList=t;++this.m_jointCount;t.m_edgeA.joint=t;t.m_edgeA.other=t.m_bodyB;t.m_edgeA.prev=null;if(t.m_edgeA.next=t.m_bodyA.m_jointList)t.m_bodyA.m_jointList.prev=t.m_edgeA;t.m_bodyA.m_jointList=t.m_edgeA;t.m_edgeB.joint=t;t.m_edgeB.other=t.m_bodyA;t.m_edgeB.prev=null;if(t.m_edgeB.next=t.m_bodyB.m_jointList)t.m_bodyB.m_jointList.prev=t.m_edgeB;t.m_bodyB.m_jointList=t.m_edgeB;var i=e.bodyA,r=e.bodyB;if(e.collideConnected==false)for(e=r.GetContactList();e;){e.other==i&&e.contact.FlagForFiltering();e=e.next}return t};L.prototype.DestroyJoint=function(e){var t=e.m_collideConnected;if(e.m_prev)e.m_prev.m_next=e.m_next;if(e.m_next)e.m_next.m_prev=e.m_prev;if(e==this.m_jointList)this.m_jointList=e.m_next;var i=e.m_bodyA,r=e.m_bodyB;i.SetAwake(true);r.SetAwake(true);if(e.m_edgeA.prev)e.m_edgeA.prev.next=e.m_edgeA.next;if(e.m_edgeA.next)e.m_edgeA.next.prev=e.m_edgeA.prev;if(e.m_edgeA==i.m_jointList)i.m_jointList=e.m_edgeA.next;e.m_edgeA.prev=null;e.m_edgeA.next=null;if(e.m_edgeB.prev)e.m_edgeB.prev.next=e.m_edgeB.next;if(e.m_edgeB.next)e.m_edgeB.next.prev=e.m_edgeB.prev;if(e.m_edgeB==r.m_jointList)r.m_jointList=e.m_edgeB.next;e.m_edgeB.prev=null;e.m_edgeB.next=null;P.Destroy(e,null);--this.m_jointCount;if(t==false)for(e=r.GetContactList();e;){e.other==i&&e.contact.FlagForFiltering();e=e.next}};L.prototype.AddController=function(e){e.m_next=this.m_controllerList;e.m_prev=null;this.m_controllerList=e;e.m_world=this;this.m_controllerCount++;return e};L.prototype.RemoveController=function(e){if(e.m_prev)e.m_prev.m_next=e.m_next;if(e.m_next)e.m_next.m_prev=e.m_prev;if(this.m_controllerList==e)this.m_controllerList=e.m_next;this.m_controllerCount--};L.prototype.CreateController=function(e){if(e.m_world!=this)throw Error("Controller can only be a member of one world");e.m_next=this.m_controllerList;e.m_prev=null;if(this.m_controllerList)this.m_controllerList.m_prev=e;this.m_controllerList=e;++this.m_controllerCount;e.m_world=this;return e};L.prototype.DestroyController=function(e){e.Clear();if(e.m_next)e.m_next.m_prev=e.m_prev;if(e.m_prev)e.m_prev.m_next=e.m_next;if(e==this.m_controllerList)this.m_controllerList=e.m_next;--this.m_controllerCount};L.prototype.SetWarmStarting=function(e){L.m_warmStarting=e};L.prototype.SetContinuousPhysics=function(e){L.m_continuousPhysics=e};L.prototype.GetBodyCount=function(){return this.m_bodyCount};L.prototype.GetJointCount=function(){return this.m_jointCount};L.prototype.GetContactCount=function(){return this.m_contactCount};L.prototype.SetGravity=function(e){this.m_gravity=e};L.prototype.GetGravity=function(){return this.m_gravity};L.prototype.GetGroundBody=function(){return this.m_groundBody};L.prototype.Step=function(e,t,i){if(e===undefined)e=0;if(t===undefined)t=0;if(i===undefined)i=0;if(this.m_flags&L.e_newFixture){this.m_contactManager.FindNewContacts();this.m_flags&=~L.e_newFixture}this.m_flags|=L.e_locked;var r=L.s_timestep2;r.dt=e;r.velocityIterations=t;r.positionIterations=i;r.inv_dt=e>0?1/e:0;r.dtRatio=this.m_inv_dt0*e;r.warmStarting=L.m_warmStarting;this.m_contactManager.Collide();r.dt>0&&this.Solve(r);L.m_continuousPhysics&&r.dt>0&&this.SolveTOI(r);if(r.dt>0)this.m_inv_dt0=r.inv_dt;this.m_flags&=~L.e_locked};L.prototype.ClearForces=function(){for(var e=this.m_bodyList;e;e=e.m_next){e.m_force.SetZero();e.m_torque=0}};L.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var e=this.m_debugDraw.GetFlags(),t,i,a;new r;new r;new r;var s;new o;new o;s=[new r,new r,new r,new r];var l=new n(0,0,0);if(e&M.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next){s=t.m_xf;for(i=t.GetFixtureList();i;i=i.m_next){a=i.GetShape();if(t.IsActive()==false)l.Set(.5,.5,.3);else if(t.GetType()==_.b2_staticBody)l.Set(.5,.9,.5);else if(t.GetType()==_.b2_kinematicBody)l.Set(.5,.5,.9);else t.IsAwake()==false?l.Set(.6,.6,.6):l.Set(.9,.7,.7);this.DrawShape(a,s,l)}}if(e&M.e_jointBit)for(t=this.m_jointList;t;t=t.m_next)this.DrawJoint(t);if(e&M.e_controllerBit)for(t=this.m_controllerList;t;t=t.m_next)t.Draw(this.m_debugDraw);if(e&M.e_pairBit){l.Set(.3,.9,.9);for(t=this.m_contactManager.m_contactList;t;t=t.GetNext()){a=t.GetFixtureA();i=t.GetFixtureB();a=a.GetAABB().GetCenter();i=i.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(a,i,l)}}if(e&M.e_aabbBit){a=this.m_contactManager.m_broadPhase;s=[new r,new r,new r,new r];for(t=this.m_bodyList;t;t=t.GetNext())if(t.IsActive()!=false)for(i=t.GetFixtureList();i;i=i.GetNext()){var c=a.GetFatAABB(i.m_proxy);s[0].Set(c.lowerBound.x,c.lowerBound.y);s[1].Set(c.upperBound.x,c.lowerBound.y);s[2].Set(c.upperBound.x,c.upperBound.y);s[3].Set(c.lowerBound.x,c.upperBound.y);this.m_debugDraw.DrawPolygon(s,4,l)}}if(e&M.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next){s=L.s_xf;s.R=t.m_xf.R;s.position=t.GetWorldCenter();this.m_debugDraw.DrawTransform(s)}}};L.prototype.QueryAABB=function(e,t){var i=this.m_contactManager.m_broadPhase;i.Query((function(t){return e(i.GetUserData(t))}),t)};L.prototype.QueryShape=function(e,t,r){if(r===undefined)r=null;if(r==null){r=new i;r.SetIdentity()}var n=this.m_contactManager.m_broadPhase,a=new o;t.ComputeAABB(a,r);n.Query((function(i){i=n.GetUserData(i)instanceof A?n.GetUserData(i):null;if(d.TestOverlap(t,r,i.GetShape(),i.GetBody().GetTransform()))return e(i);return true}),a)};L.prototype.QueryPoint=function(e,t){var i=this.m_contactManager.m_broadPhase,r=new o;r.lowerBound.Set(t.x-a.b2_linearSlop,t.y-a.b2_linearSlop);r.upperBound.Set(t.x+a.b2_linearSlop,t.y+a.b2_linearSlop);i.Query((function(r){r=i.GetUserData(r)instanceof A?i.GetUserData(r):null;if(r.TestPoint(t))return e(r);return true}),r)};L.prototype.RayCast=function(e,t,i){var n=this.m_contactManager.m_broadPhase,a=new u,o=new c(t,i);n.RayCast((function(o,s){var l=n.GetUserData(s);l=l instanceof A?l:null;if(l.RayCast(a,o)){var c=a.fraction,u=new r((1-c)*t.x+c*i.x,(1-c)*t.y+c*i.y);return e(l,u,a.normal,c)}return o.maxFraction}),o)};L.prototype.RayCastOne=function(e,t){var i;this.RayCast((function(e,t,r,n){if(n===undefined)n=0;i=e;return n}),e,t);return i};L.prototype.RayCastAll=function(e,t){var i=new Vector;this.RayCast((function(e){i[i.length]=e;return 1}),e,t);return i};L.prototype.GetBodyList=function(){return this.m_bodyList};L.prototype.GetJointList=function(){return this.m_jointList};L.prototype.GetContactList=function(){return this.m_contactList};L.prototype.IsLocked=function(){return(this.m_flags&L.e_locked)>0};L.prototype.Solve=function(e){for(var t,i=this.m_controllerList;i;i=i.m_next)i.Step(e);i=this.m_island;i.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~_.e_islandFlag;for(var r=this.m_contactList;r;r=r.m_next)r.m_flags&=~D.e_islandFlag;for(r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=false;parseInt(this.m_bodyCount);r=this.s_stack;for(var n=this.m_bodyList;n;n=n.m_next)if(!(n.m_flags&_.e_islandFlag))if(!(n.IsAwake()==false||n.IsActive()==false))if(n.GetType()!=_.b2_staticBody){i.Clear();var a=0;r[a++]=n;for(n.m_flags|=_.e_islandFlag;a>0;){t=r[--a];i.AddBody(t);t.IsAwake()==false&&t.SetAwake(true);if(t.GetType()!=_.b2_staticBody){for(var o,s=t.m_contactList;s;s=s.next)if(!(s.contact.m_flags&D.e_islandFlag))if(!(s.contact.IsSensor()==true||s.contact.IsEnabled()==false||s.contact.IsTouching()==false)){i.AddContact(s.contact);s.contact.m_flags|=D.e_islandFlag;o=s.other;if(!(o.m_flags&_.e_islandFlag)){r[a++]=o;o.m_flags|=_.e_islandFlag}}for(t=t.m_jointList;t;t=t.next)if(t.joint.m_islandFlag!=true){o=t.other;if(o.IsActive()!=false){i.AddJoint(t.joint);t.joint.m_islandFlag=true;if(!(o.m_flags&_.e_islandFlag)){r[a++]=o;o.m_flags|=_.e_islandFlag}}}}}i.Solve(e,this.m_gravity,this.m_allowSleep);for(a=0;a<i.m_bodyCount;++a){t=i.m_bodies[a];if(t.GetType()==_.b2_staticBody)t.m_flags&=~_.e_islandFlag}}for(a=0;a<r.length;++a){if(!r[a])break;r[a]=null}for(t=this.m_bodyList;t;t=t.m_next)t.IsAwake()==false||t.IsActive()==false||t.GetType()!=_.b2_staticBody&&t.SynchronizeFixtures();this.m_contactManager.FindNewContacts()};L.prototype.SolveTOI=function(e){var t,i,r,n=this.m_island;n.Initialize(this.m_bodyCount,a.b2_maxTOIContactsPerIsland,a.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var o=L.s_queue;for(t=this.m_bodyList;t;t=t.m_next){t.m_flags&=~_.e_islandFlag;t.m_sweep.t0=0}for(r=this.m_contactList;r;r=r.m_next)r.m_flags&=~(D.e_toiFlag|D.e_islandFlag);for(r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=false;for(;;){var s=null,l=1;for(r=this.m_contactList;r;r=r.m_next)if(!(r.IsSensor()==true||r.IsEnabled()==false||r.IsContinuous()==false)){t=1;if(r.m_flags&D.e_toiFlag)t=r.m_toi;else{t=r.m_fixtureA;i=r.m_fixtureB;t=t.m_body;i=i.m_body;if((t.GetType()!=_.b2_dynamicBody||t.IsAwake()==false)&&(i.GetType()!=_.b2_dynamicBody||i.IsAwake()==false))continue;var c=t.m_sweep.t0;if(t.m_sweep.t0<i.m_sweep.t0){c=i.m_sweep.t0;t.m_sweep.Advance(c)}else if(i.m_sweep.t0<t.m_sweep.t0){c=t.m_sweep.t0;i.m_sweep.Advance(c)}t=r.ComputeTOI(t.m_sweep,i.m_sweep);a.b2Assert(0<=t&&t<=1);if(t>0&&t<1){t=(1-t)*c+t;if(t>1)t=1}r.m_toi=t;r.m_flags|=D.e_toiFlag}if(Number.MIN_VALUE<t&&t<l){s=r;l=t}}if(s==null||1-100*Number.MIN_VALUE<l)break;t=s.m_fixtureA;i=s.m_fixtureB;t=t.m_body;i=i.m_body;L.s_backupA.Set(t.m_sweep);L.s_backupB.Set(i.m_sweep);t.Advance(l);i.Advance(l);s.Update(this.m_contactManager.m_contactListener);s.m_flags&=~D.e_toiFlag;if(s.IsSensor()==true||s.IsEnabled()==false){t.m_sweep.Set(L.s_backupA);i.m_sweep.Set(L.s_backupB);t.SynchronizeTransform();i.SynchronizeTransform()}else if(s.IsTouching()!=false){t=t;if(t.GetType()!=_.b2_dynamicBody)t=i;n.Clear();s=r=0;o[r+s++]=t;for(t.m_flags|=_.e_islandFlag;s>0;){t=o[r++];--s;n.AddBody(t);t.IsAwake()==false&&t.SetAwake(true);if(t.GetType()==_.b2_dynamicBody){for(i=t.m_contactList;i;i=i.next){if(n.m_contactCount==n.m_contactCapacity)break;if(!(i.contact.m_flags&D.e_islandFlag))if(!(i.contact.IsSensor()==true||i.contact.IsEnabled()==false||i.contact.IsTouching()==false)){n.AddContact(i.contact);i.contact.m_flags|=D.e_islandFlag;c=i.other;if(!(c.m_flags&_.e_islandFlag)){if(c.GetType()!=_.b2_staticBody){c.Advance(l);c.SetAwake(true)}o[r+s]=c;++s;c.m_flags|=_.e_islandFlag}}}for(t=t.m_jointList;t;t=t.next)if(n.m_jointCount!=n.m_jointCapacity)if(t.joint.m_islandFlag!=true){c=t.other;if(c.IsActive()!=false){n.AddJoint(t.joint);t.joint.m_islandFlag=true;if(!(c.m_flags&_.e_islandFlag)){if(c.GetType()!=_.b2_staticBody){c.Advance(l);c.SetAwake(true)}o[r+s]=c;++s;c.m_flags|=_.e_islandFlag}}}}}r=L.s_timestep;r.warmStarting=false;r.dt=(1-l)*e.dt;r.inv_dt=1/r.dt;r.dtRatio=0;r.velocityIterations=e.velocityIterations;r.positionIterations=e.positionIterations;n.SolveTOI(r);for(l=l=0;l<n.m_bodyCount;++l){t=n.m_bodies[l];t.m_flags&=~_.e_islandFlag;if(t.IsAwake()!=false)if(t.GetType()==_.b2_dynamicBody){t.SynchronizeFixtures();for(i=t.m_contactList;i;i=i.next)i.contact.m_flags&=~D.e_toiFlag}}for(l=0;l<n.m_contactCount;++l){r=n.m_contacts[l];r.m_flags&=~(D.e_toiFlag|D.e_islandFlag)}for(l=0;l<n.m_jointCount;++l){r=n.m_joints[l];r.m_islandFlag=false}this.m_contactManager.FindNewContacts()}}};L.prototype.DrawJoint=function(e){var t=e.GetBodyA(),i=e.GetBodyB(),r=t.m_xf.position,n=i.m_xf.position,a=e.GetAnchorA(),o=e.GetAnchorB(),s=L.s_jointColor;switch(e.m_type){case P.e_distanceJoint:this.m_debugDraw.DrawSegment(a,o,s);break;case P.e_pulleyJoint:t=e instanceof G?e:null;e=t.GetGroundAnchorA();t=t.GetGroundAnchorB();this.m_debugDraw.DrawSegment(e,a,s);this.m_debugDraw.DrawSegment(t,o,s);this.m_debugDraw.DrawSegment(e,t,s);break;case P.e_mouseJoint:this.m_debugDraw.DrawSegment(a,o,s);break;default:t!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,a,s);this.m_debugDraw.DrawSegment(a,o,s);i!=this.m_groundBody&&this.m_debugDraw.DrawSegment(n,o,s)}};L.prototype.DrawShape=function(t,i,r){switch(t.m_type){case d.e_circleShape:var n=t instanceof h?t:null;this.m_debugDraw.DrawSolidCircle(e.MulX(i,n.m_p),n.m_radius,i.R.col1,r);break;case d.e_polygonShape:n=0;n=t instanceof f?t:null;t=parseInt(n.GetVertexCount());var a=n.GetVertices(),o=new Vector(t);for(n=0;n<t;++n)o[n]=e.MulX(i,a[n]);this.m_debugDraw.DrawSolidPolygon(o,t,r);break;case d.e_edgeShape:n=t instanceof p?t:null;this.m_debugDraw.DrawSegment(e.MulX(i,n.GetVertex1()),e.MulX(i,n.GetVertex2()),r)}};Box2D.postDefs.push((function(){Box2D.Dynamics.b2World.s_timestep2=new B;Box2D.Dynamics.b2World.s_xf=new i;Box2D.Dynamics.b2World.s_backupA=new t;Box2D.Dynamics.b2World.s_backupB=new t;Box2D.Dynamics.b2World.s_timestep=new B;Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new n(.5,.8,.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2}))})();(function(){var e=Box2D.Collision.Shapes.b2CircleShape,t=Box2D.Collision.Shapes.b2EdgeShape,i=Box2D.Collision.Shapes.b2PolygonShape,r=Box2D.Collision.Shapes.b2Shape,n=Box2D.Dynamics.Contacts.b2CircleContact,a=Box2D.Dynamics.Contacts.b2Contact,o=Box2D.Dynamics.Contacts.b2ContactConstraint,s=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,l=Box2D.Dynamics.Contacts.b2ContactEdge,c=Box2D.Dynamics.Contacts.b2ContactFactory,u=Box2D.Dynamics.Contacts.b2ContactRegister,h=Box2D.Dynamics.Contacts.b2ContactResult,p=Box2D.Dynamics.Contacts.b2ContactSolver,m=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,f=Box2D.Dynamics.Contacts.b2NullContact,d=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,_=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,y=Box2D.Dynamics.Contacts.b2PolygonContact,v=Box2D.Dynamics.Contacts.b2PositionSolverManifold,g=Box2D.Dynamics.b2Body,x=Box2D.Dynamics.b2TimeStep,b=Box2D.Common.b2Settings,M=Box2D.Common.Math.b2Mat22,w=Box2D.Common.Math.b2Math,S=Box2D.Common.Math.b2Vec2,A=Box2D.Collision.b2Collision,C=Box2D.Collision.b2ContactID,T=Box2D.Collision.b2Manifold,B=Box2D.Collision.b2TimeOfImpact,L=Box2D.Collision.b2TOIInput,D=Box2D.Collision.b2WorldManifold;Box2D.inherit(n,Box2D.Dynamics.Contacts.b2Contact);n.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;n.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};n.Create=function(){return new n};n.Destroy=function(){};n.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)};n.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody();A.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,i.m_xf)};a.b2Contact=function(){this.m_nodeA=new l;this.m_nodeB=new l;this.m_manifold=new T;this.m_oldManifold=new T};a.prototype.GetManifold=function(){return this.m_manifold};a.prototype.GetWorldManifold=function(e){var t=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),r=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();e.Initialize(this.m_manifold,t.GetTransform(),r.m_radius,i.GetTransform(),n.m_radius)};a.prototype.IsTouching=function(){return(this.m_flags&a.e_touchingFlag)==a.e_touchingFlag};a.prototype.IsContinuous=function(){return(this.m_flags&a.e_continuousFlag)==a.e_continuousFlag};a.prototype.SetSensor=function(e){if(e)this.m_flags|=a.e_sensorFlag;else this.m_flags&=~a.e_sensorFlag};a.prototype.IsSensor=function(){return(this.m_flags&a.e_sensorFlag)==a.e_sensorFlag};a.prototype.SetEnabled=function(e){if(e)this.m_flags|=a.e_enabledFlag;else this.m_flags&=~a.e_enabledFlag};a.prototype.IsEnabled=function(){return(this.m_flags&a.e_enabledFlag)==a.e_enabledFlag};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetFixtureA=function(){return this.m_fixtureA};a.prototype.GetFixtureB=function(){return this.m_fixtureB};a.prototype.FlagForFiltering=function(){this.m_flags|=a.e_filterFlag};a.prototype.b2Contact=function(){};a.prototype.Reset=function(e,t){if(e===undefined)e=null;if(t===undefined)t=null;this.m_flags=a.e_enabledFlag;if(!e||!t)this.m_fixtureB=this.m_fixtureA=null;else{if(e.IsSensor()||t.IsSensor())this.m_flags|=a.e_sensorFlag;var i=e.GetBody(),r=t.GetBody();if(i.GetType()!=g.b2_dynamicBody||i.IsBullet()||r.GetType()!=g.b2_dynamicBody||r.IsBullet())this.m_flags|=a.e_continuousFlag;this.m_fixtureA=e;this.m_fixtureB=t;this.m_manifold.m_pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}};a.prototype.Update=function(e){var t=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=t;this.m_flags|=a.e_enabledFlag;var i=false;t=(this.m_flags&a.e_touchingFlag)==a.e_touchingFlag;var n=this.m_fixtureA.m_body,o=this.m_fixtureB.m_body,s=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&a.e_sensorFlag){if(s){i=this.m_fixtureA.GetShape();s=this.m_fixtureB.GetShape();n=n.GetTransform();o=o.GetTransform();i=r.TestOverlap(i,n,s,o)}this.m_manifold.m_pointCount=0}else{if(n.GetType()!=g.b2_dynamicBody||n.IsBullet()||o.GetType()!=g.b2_dynamicBody||o.IsBullet())this.m_flags|=a.e_continuousFlag;else this.m_flags&=~a.e_continuousFlag;if(s){this.Evaluate();i=this.m_manifold.m_pointCount>0;for(s=0;s<this.m_manifold.m_pointCount;++s){var l=this.m_manifold.m_points[s];l.m_normalImpulse=0;l.m_tangentImpulse=0;for(var c=l.m_id,u=0;u<this.m_oldManifold.m_pointCount;++u){var h=this.m_oldManifold.m_points[u];if(h.m_id.key==c.key){l.m_normalImpulse=h.m_normalImpulse;l.m_tangentImpulse=h.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;if(i!=t){n.SetAwake(true);o.SetAwake(true)}}if(i)this.m_flags|=a.e_touchingFlag;else this.m_flags&=~a.e_touchingFlag;t==false&&i==true&&e.BeginContact(this);t==true&&i==false&&e.EndContact(this);(this.m_flags&a.e_sensorFlag)==0&&e.PreSolve(this,this.m_oldManifold)};a.prototype.Evaluate=function(){};a.prototype.ComputeTOI=function(e,t){a.s_input.proxyA.Set(this.m_fixtureA.GetShape());a.s_input.proxyB.Set(this.m_fixtureB.GetShape());a.s_input.sweepA=e;a.s_input.sweepB=t;a.s_input.tolerance=b.b2_linearSlop;return B.TimeOfImpact(a.s_input)};Box2D.postDefs.push((function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64;Box2D.Dynamics.Contacts.b2Contact.s_input=new L}));o.b2ContactConstraint=function(){this.localPlaneNormal=new S;this.localPoint=new S;this.normal=new S;this.normalMass=new M;this.K=new M};o.prototype.b2ContactConstraint=function(){this.points=new Vector(b.b2_maxManifoldPoints);for(var e=0;e<b.b2_maxManifoldPoints;e++)this.points[e]=new s};s.b2ContactConstraintPoint=function(){this.localPoint=new S;this.rA=new S;this.rB=new S};l.b2ContactEdge=function(){};c.b2ContactFactory=function(){};c.prototype.b2ContactFactory=function(e){this.m_allocator=e;this.InitializeRegisters()};c.prototype.AddType=function(e,t,i,r){if(i===undefined)i=0;if(r===undefined)r=0;this.m_registers[i][r].createFcn=e;this.m_registers[i][r].destroyFcn=t;this.m_registers[i][r].primary=true;if(i!=r){this.m_registers[r][i].createFcn=e;this.m_registers[r][i].destroyFcn=t;this.m_registers[r][i].primary=false}};c.prototype.InitializeRegisters=function(){this.m_registers=new Vector(r.e_shapeTypeCount);for(var e=0;e<r.e_shapeTypeCount;e++){this.m_registers[e]=new Vector(r.e_shapeTypeCount);for(var t=0;t<r.e_shapeTypeCount;t++)this.m_registers[e][t]=new u}this.AddType(n.Create,n.Destroy,r.e_circleShape,r.e_circleShape);this.AddType(d.Create,d.Destroy,r.e_polygonShape,r.e_circleShape);this.AddType(y.Create,y.Destroy,r.e_polygonShape,r.e_polygonShape);this.AddType(m.Create,m.Destroy,r.e_edgeShape,r.e_circleShape);this.AddType(_.Create,_.Destroy,r.e_polygonShape,r.e_edgeShape)};c.prototype.Create=function(e,t){var i=parseInt(e.GetType()),r=parseInt(t.GetType());i=this.m_registers[i][r];if(i.pool){r=i.pool;i.pool=r.m_next;i.poolCount--;r.Reset(e,t);return r}r=i.createFcn;if(r!=null){if(i.primary){r=r(this.m_allocator);r.Reset(e,t)}else{r=r(this.m_allocator);r.Reset(t,e)}return r}else return null};c.prototype.Destroy=function(e){if(e.m_manifold.m_pointCount>0){e.m_fixtureA.m_body.SetAwake(true);e.m_fixtureB.m_body.SetAwake(true)}var t=parseInt(e.m_fixtureA.GetType()),i=parseInt(e.m_fixtureB.GetType());t=this.m_registers[t][i];t.poolCount++;e.m_next=t.pool;t.pool=e;t=t.destroyFcn;t(e,this.m_allocator)};u.b2ContactRegister=function(){};h.b2ContactResult=function(){this.position=new S;this.normal=new S;this.id=new C};p.b2ContactSolver=function(){this.m_step=new x;this.m_constraints=new Vector};p.prototype.b2ContactSolver=function(){};p.prototype.Initialize=function(e,t,i,r){if(i===undefined)i=0;var n;this.m_step.Set(e);this.m_allocator=r;e=0;for(this.m_constraintCount=i;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new o;for(e=0;e<i;++e){n=t[e];r=n.m_fixtureA;var a=n.m_fixtureB,s=r.m_shape.m_radius,l=a.m_shape.m_radius,c=r.m_body,u=a.m_body,h=n.GetManifold(),m=b.b2MixFriction(r.GetFriction(),a.GetFriction()),f=b.b2MixRestitution(r.GetRestitution(),a.GetRestitution()),d=c.m_linearVelocity.x,_=c.m_linearVelocity.y,y=u.m_linearVelocity.x,v=u.m_linearVelocity.y,g=c.m_angularVelocity,x=u.m_angularVelocity;b.b2Assert(h.m_pointCount>0);p.s_worldManifold.Initialize(h,c.m_xf,s,u.m_xf,l);a=p.s_worldManifold.m_normal.x;n=p.s_worldManifold.m_normal.y;r=this.m_constraints[e];r.bodyA=c;r.bodyB=u;r.manifold=h;r.normal.x=a;r.normal.y=n;r.pointCount=h.m_pointCount;r.friction=m;r.restitution=f;r.localPlaneNormal.x=h.m_localPlaneNormal.x;r.localPlaneNormal.y=h.m_localPlaneNormal.y;r.localPoint.x=h.m_localPoint.x;r.localPoint.y=h.m_localPoint.y;r.radius=s+l;r.type=h.m_type;for(s=0;s<r.pointCount;++s){m=h.m_points[s];l=r.points[s];l.normalImpulse=m.m_normalImpulse;l.tangentImpulse=m.m_tangentImpulse;l.localPoint.SetV(m.m_localPoint);m=l.rA.x=p.s_worldManifold.m_points[s].x-c.m_sweep.c.x;f=l.rA.y=p.s_worldManifold.m_points[s].y-c.m_sweep.c.y;var M=l.rB.x=p.s_worldManifold.m_points[s].x-u.m_sweep.c.x,w=l.rB.y=p.s_worldManifold.m_points[s].y-u.m_sweep.c.y,S=m*n-f*a,A=M*n-w*a;S*=S;A*=A;l.normalMass=1/(c.m_invMass+u.m_invMass+c.m_invI*S+u.m_invI*A);var C=c.m_mass*c.m_invMass+u.m_mass*u.m_invMass;C+=c.m_mass*c.m_invI*S+u.m_mass*u.m_invI*A;l.equalizedMass=1/C;A=n;C=-a;S=m*C-f*A;A=M*C-w*A;S*=S;A*=A;l.tangentMass=1/(c.m_invMass+u.m_invMass+c.m_invI*S+u.m_invI*A);l.velocityBias=0;m=r.normal.x*(y+-x*w-d- -g*f)+r.normal.y*(v+x*M-_-g*m);if(m<-b.b2_velocityThreshold)l.velocityBias+=-r.restitution*m}if(r.pointCount==2){v=r.points[0];y=r.points[1];h=c.m_invMass;c=c.m_invI;d=u.m_invMass;u=u.m_invI;_=v.rA.x*n-v.rA.y*a;v=v.rB.x*n-v.rB.y*a;g=y.rA.x*n-y.rA.y*a;y=y.rB.x*n-y.rB.y*a;a=h+d+c*_*_+u*v*v;n=h+d+c*g*g+u*y*y;u=h+d+c*_*g+u*v*y;if(a*a<100*(a*n-u*u)){r.K.col1.Set(a,u);r.K.col2.Set(u,n);r.K.GetInverse(r.normalMass)}else r.pointCount=1}}};p.prototype.InitVelocityConstraints=function(e){for(var t=0;t<this.m_constraintCount;++t){var i=this.m_constraints[t],r=i.bodyA,n=i.bodyB,a=r.m_invMass,o=r.m_invI,s=n.m_invMass,l=n.m_invI,c=i.normal.x,u=i.normal.y,h=u,p=-c,m=0,f=0;if(e.warmStarting){f=i.pointCount;for(m=0;m<f;++m){var d=i.points[m];d.normalImpulse*=e.dtRatio;d.tangentImpulse*=e.dtRatio;var _=d.normalImpulse*c+d.tangentImpulse*h,y=d.normalImpulse*u+d.tangentImpulse*p;r.m_angularVelocity-=o*(d.rA.x*y-d.rA.y*_);r.m_linearVelocity.x-=a*_;r.m_linearVelocity.y-=a*y;n.m_angularVelocity+=l*(d.rB.x*y-d.rB.y*_);n.m_linearVelocity.x+=s*_;n.m_linearVelocity.y+=s*y}}else{f=i.pointCount;for(m=0;m<f;++m){r=i.points[m];r.normalImpulse=0;r.tangentImpulse=0}}}};p.prototype.SolveVelocityConstraints=function(){for(var e=0,t,i=0,r=0,n=0,a=r=r=i=i=0,o=i=i=0,s=i=n=0,l=0,c,u=0;u<this.m_constraintCount;++u){n=this.m_constraints[u];var h=n.bodyA,p=n.bodyB,m=h.m_angularVelocity,f=p.m_angularVelocity,d=h.m_linearVelocity,_=p.m_linearVelocity,y=h.m_invMass,v=h.m_invI,g=p.m_invMass,x=p.m_invI;s=n.normal.x;var b=l=n.normal.y;c=-s;o=n.friction;for(e=0;e<n.pointCount;e++){t=n.points[e];i=_.x-f*t.rB.y-d.x+m*t.rA.y;r=_.y+f*t.rB.x-d.y-m*t.rA.x;i=i*b+r*c;i=t.tangentMass*-i;r=o*t.normalImpulse;r=w.Clamp(t.tangentImpulse+i,-r,r);i=r-t.tangentImpulse;a=i*b;i=i*c;d.x-=y*a;d.y-=y*i;m-=v*(t.rA.x*i-t.rA.y*a);_.x+=g*a;_.y+=g*i;f+=x*(t.rB.x*i-t.rB.y*a);t.tangentImpulse=r}parseInt(n.pointCount);if(n.pointCount==1){t=n.points[0];i=_.x+-f*t.rB.y-d.x- -m*t.rA.y;r=_.y+f*t.rB.x-d.y-m*t.rA.x;n=i*s+r*l;i=-t.normalMass*(n-t.velocityBias);r=t.normalImpulse+i;r=r>0?r:0;i=r-t.normalImpulse;a=i*s;i=i*l;d.x-=y*a;d.y-=y*i;m-=v*(t.rA.x*i-t.rA.y*a);_.x+=g*a;_.y+=g*i;f+=x*(t.rB.x*i-t.rB.y*a);t.normalImpulse=r}else{t=n.points[0];e=n.points[1];i=t.normalImpulse;o=e.normalImpulse;var M=(_.x-f*t.rB.y-d.x+m*t.rA.y)*s+(_.y+f*t.rB.x-d.y-m*t.rA.x)*l,S=(_.x-f*e.rB.y-d.x+m*e.rA.y)*s+(_.y+f*e.rB.x-d.y-m*e.rA.x)*l;r=M-t.velocityBias;a=S-e.velocityBias;c=n.K;r-=c.col1.x*i+c.col2.x*o;for(a-=c.col1.y*i+c.col2.y*o;;){c=n.normalMass;b=-(c.col1.x*r+c.col2.x*a);c=-(c.col1.y*r+c.col2.y*a);if(b>=0&&c>=0){i=b-i;o=c-o;n=i*s;i=i*l;s=o*s;l=o*l;d.x-=y*(n+s);d.y-=y*(i+l);m-=v*(t.rA.x*i-t.rA.y*n+e.rA.x*l-e.rA.y*s);_.x+=g*(n+s);_.y+=g*(i+l);f+=x*(t.rB.x*i-t.rB.y*n+e.rB.x*l-e.rB.y*s);t.normalImpulse=b;e.normalImpulse=c;break}b=-t.normalMass*r;c=0;S=n.K.col1.y*b+a;if(b>=0&&S>=0){i=b-i;o=c-o;n=i*s;i=i*l;s=o*s;l=o*l;d.x-=y*(n+s);d.y-=y*(i+l);m-=v*(t.rA.x*i-t.rA.y*n+e.rA.x*l-e.rA.y*s);_.x+=g*(n+s);_.y+=g*(i+l);f+=x*(t.rB.x*i-t.rB.y*n+e.rB.x*l-e.rB.y*s);t.normalImpulse=b;e.normalImpulse=c;break}b=0;c=-e.normalMass*a;M=n.K.col2.x*c+r;if(c>=0&&M>=0){i=b-i;o=c-o;n=i*s;i=i*l;s=o*s;l=o*l;d.x-=y*(n+s);d.y-=y*(i+l);m-=v*(t.rA.x*i-t.rA.y*n+e.rA.x*l-e.rA.y*s);_.x+=g*(n+s);_.y+=g*(i+l);f+=x*(t.rB.x*i-t.rB.y*n+e.rB.x*l-e.rB.y*s);t.normalImpulse=b;e.normalImpulse=c;break}c=b=0;M=r;S=a;if(M>=0&&S>=0){i=b-i;o=c-o;n=i*s;i=i*l;s=o*s;l=o*l;d.x-=y*(n+s);d.y-=y*(i+l);m-=v*(t.rA.x*i-t.rA.y*n+e.rA.x*l-e.rA.y*s);_.x+=g*(n+s);_.y+=g*(i+l);f+=x*(t.rB.x*i-t.rB.y*n+e.rB.x*l-e.rB.y*s);t.normalImpulse=b;e.normalImpulse=c;break}break}}h.m_angularVelocity=m;p.m_angularVelocity=f}};p.prototype.FinalizeVelocityConstraints=function(){for(var e=0;e<this.m_constraintCount;++e)for(var t=this.m_constraints[e],i=t.manifold,r=0;r<t.pointCount;++r){var n=i.m_points[r],a=t.points[r];n.m_normalImpulse=a.normalImpulse;n.m_tangentImpulse=a.tangentImpulse}};p.prototype.SolvePositionConstraints=function(e){if(e===undefined)e=0;for(var t=0,i=0;i<this.m_constraintCount;i++){var r=this.m_constraints[i],n=r.bodyA,a=r.bodyB,o=n.m_mass*n.m_invMass,s=n.m_mass*n.m_invI,l=a.m_mass*a.m_invMass,c=a.m_mass*a.m_invI;p.s_psm.Initialize(r);for(var u=p.s_psm.m_normal,h=0;h<r.pointCount;h++){var m=r.points[h],f=p.s_psm.m_points[h],d=p.s_psm.m_separations[h],_=f.x-n.m_sweep.c.x,y=f.y-n.m_sweep.c.y,v=f.x-a.m_sweep.c.x;f=f.y-a.m_sweep.c.y;t=t<d?t:d;d=w.Clamp(e*(d+b.b2_linearSlop),-b.b2_maxLinearCorrection,0);d=-m.equalizedMass*d;m=d*u.x;d=d*u.y;n.m_sweep.c.x-=o*m;n.m_sweep.c.y-=o*d;n.m_sweep.a-=s*(_*d-y*m);n.SynchronizeTransform();a.m_sweep.c.x+=l*m;a.m_sweep.c.y+=l*d;a.m_sweep.a+=c*(v*d-f*m);a.SynchronizeTransform()}}return t>-1.5*b.b2_linearSlop};Box2D.postDefs.push((function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new D;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new v}));Box2D.inherit(m,Box2D.Dynamics.Contacts.b2Contact);m.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;m.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};m.Create=function(){return new m};m.Destroy=function(){};m.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)};m.prototype.Evaluate=function(){var i=this.m_fixtureA.GetBody(),r=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,i.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,r.m_xf)};m.prototype.b2CollideEdgeAndCircle=function(){};Box2D.inherit(f,Box2D.Dynamics.Contacts.b2Contact);f.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;f.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};f.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};f.prototype.Evaluate=function(){};Box2D.inherit(d,Box2D.Dynamics.Contacts.b2Contact);d.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;d.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};d.Create=function(){return new d};d.Destroy=function(){};d.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t);b.b2Assert(e.GetType()==r.e_polygonShape);b.b2Assert(t.GetType()==r.e_circleShape)};d.prototype.Evaluate=function(){var t=this.m_fixtureA.m_body,r=this.m_fixtureB.m_body;A.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,r.m_xf)};Box2D.inherit(_,Box2D.Dynamics.Contacts.b2Contact);_.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;_.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};_.Create=function(){return new _};_.Destroy=function(){};_.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t);b.b2Assert(e.GetType()==r.e_polygonShape);b.b2Assert(t.GetType()==r.e_edgeShape)};_.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),r=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,r.m_xf)};_.prototype.b2CollidePolyAndEdge=function(){};Box2D.inherit(y,Box2D.Dynamics.Contacts.b2Contact);y.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;y.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};y.Create=function(){return new y};y.Destroy=function(){};y.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)};y.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();A.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,t.m_xf)};v.b2PositionSolverManifold=function(){};v.prototype.b2PositionSolverManifold=function(){this.m_normal=new S;this.m_separations=new Vector_a2j_Number(b.b2_maxManifoldPoints);this.m_points=new Vector(b.b2_maxManifoldPoints);for(var e=0;e<b.b2_maxManifoldPoints;e++)this.m_points[e]=new S};v.prototype.Initialize=function(e){b.b2Assert(e.pointCount>0);var t=0,i=0,r=0,n,a=0,o=0;switch(e.type){case T.e_circles:n=e.bodyA.m_xf.R;r=e.localPoint;t=e.bodyA.m_xf.position.x+(n.col1.x*r.x+n.col2.x*r.y);i=e.bodyA.m_xf.position.y+(n.col1.y*r.x+n.col2.y*r.y);n=e.bodyB.m_xf.R;r=e.points[0].localPoint;a=e.bodyB.m_xf.position.x+(n.col1.x*r.x+n.col2.x*r.y);n=e.bodyB.m_xf.position.y+(n.col1.y*r.x+n.col2.y*r.y);r=a-t;o=n-i;var s=r*r+o*o;if(s>Number.MIN_VALUE*Number.MIN_VALUE){s=Math.sqrt(s);this.m_normal.x=r/s;this.m_normal.y=o/s}else{this.m_normal.x=1;this.m_normal.y=0}this.m_points[0].x=.5*(t+a);this.m_points[0].y=.5*(i+n);this.m_separations[0]=r*this.m_normal.x+o*this.m_normal.y-e.radius;break;case T.e_faceA:n=e.bodyA.m_xf.R;r=e.localPlaneNormal;this.m_normal.x=n.col1.x*r.x+n.col2.x*r.y;this.m_normal.y=n.col1.y*r.x+n.col2.y*r.y;n=e.bodyA.m_xf.R;r=e.localPoint;a=e.bodyA.m_xf.position.x+(n.col1.x*r.x+n.col2.x*r.y);o=e.bodyA.m_xf.position.y+(n.col1.y*r.x+n.col2.y*r.y);n=e.bodyB.m_xf.R;for(t=0;t<e.pointCount;++t){r=e.points[t].localPoint;i=e.bodyB.m_xf.position.x+(n.col1.x*r.x+n.col2.x*r.y);r=e.bodyB.m_xf.position.y+(n.col1.y*r.x+n.col2.y*r.y);this.m_separations[t]=(i-a)*this.m_normal.x+(r-o)*this.m_normal.y-e.radius;this.m_points[t].x=i;this.m_points[t].y=r}break;case T.e_faceB:n=e.bodyB.m_xf.R;r=e.localPlaneNormal;this.m_normal.x=n.col1.x*r.x+n.col2.x*r.y;this.m_normal.y=n.col1.y*r.x+n.col2.y*r.y;n=e.bodyB.m_xf.R;r=e.localPoint;a=e.bodyB.m_xf.position.x+(n.col1.x*r.x+n.col2.x*r.y);o=e.bodyB.m_xf.position.y+(n.col1.y*r.x+n.col2.y*r.y);n=e.bodyA.m_xf.R;for(t=0;t<e.pointCount;++t){r=e.points[t].localPoint;i=e.bodyA.m_xf.position.x+(n.col1.x*r.x+n.col2.x*r.y);r=e.bodyA.m_xf.position.y+(n.col1.y*r.x+n.col2.y*r.y);this.m_separations[t]=(i-a)*this.m_normal.x+(r-o)*this.m_normal.y-e.radius;this.m_points[t].Set(i,r)}this.m_normal.x*=-1;this.m_normal.y*=-1}};Box2D.postDefs.push((function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new S;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new S}))})();(function(){var e=Box2D.Common.Math.b2Mat22,t=Box2D.Common.Math.b2Math,i=Box2D.Common.Math.b2Vec2,r=Box2D.Common.b2Color,n=Box2D.Dynamics.Controllers.b2BuoyancyController,a=Box2D.Dynamics.Controllers.b2ConstantAccelController,o=Box2D.Dynamics.Controllers.b2ConstantForceController,s=Box2D.Dynamics.Controllers.b2Controller,l=Box2D.Dynamics.Controllers.b2ControllerEdge,c=Box2D.Dynamics.Controllers.b2GravityController,u=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(n,Box2D.Dynamics.Controllers.b2Controller);n.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;n.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new i(0,-1);this.density=this.offset=0;this.velocity=new i(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=false;this.useWorldGravity=true;this.gravity=null};n.prototype.Step=function(){if(this.m_bodyList){if(this.useWorldGravity)this.gravity=this.GetWorld().GetGravity().Copy();for(var e=this.m_bodyList;e;e=e.nextBody){var t=e.body;if(t.IsAwake()!=false){for(var r=new i,n=new i,a=0,o=0,s=t.GetFixtureList();s;s=s.GetNext()){var l=new i,c=s.GetShape().ComputeSubmergedArea(this.normal,this.offset,t.GetTransform(),l);a+=c;r.x+=c*l.x;r.y+=c*l.y;var u=0;u=1;o+=c*u;n.x+=c*l.x*u;n.y+=c*l.y*u}r.x/=a;r.y/=a;n.x/=o;n.y/=o;if(!(a<Number.MIN_VALUE)){o=this.gravity.GetNegative();o.Multiply(this.density*a);t.ApplyForce(o,n);n=t.GetLinearVelocityFromWorldPoint(r);n.Subtract(this.velocity);n.Multiply(-this.linearDrag*a);t.ApplyForce(n,r);t.ApplyTorque(-t.GetInertia()/t.GetMass()*a*t.GetAngularVelocity()*this.angularDrag)}}}}};n.prototype.Draw=function(e){var t=new i,n=new i;t.x=this.normal.x*this.offset+this.normal.y*1e3;t.y=this.normal.y*this.offset-this.normal.x*1e3;n.x=this.normal.x*this.offset-this.normal.y*1e3;n.y=this.normal.y*this.offset+this.normal.x*1e3;var a=new r(0,0,1);e.DrawSegment(t,n,a)};Box2D.inherit(a,Box2D.Dynamics.Controllers.b2Controller);a.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;a.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new i(0,0)};a.prototype.Step=function(e){e=new i(this.A.x*e.dt,this.A.y*e.dt);for(var t=this.m_bodyList;t;t=t.nextBody){var r=t.body;r.IsAwake()&&r.SetLinearVelocity(new i(r.GetLinearVelocity().x+e.x,r.GetLinearVelocity().y+e.y))}};Box2D.inherit(o,Box2D.Dynamics.Controllers.b2Controller);o.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;o.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new i(0,0)};o.prototype.Step=function(){for(var e=this.m_bodyList;e;e=e.nextBody){var t=e.body;t.IsAwake()&&t.ApplyForce(this.F,t.GetWorldCenter())}};s.b2Controller=function(){};s.prototype.Step=function(){};s.prototype.Draw=function(){};s.prototype.AddBody=function(e){var t=new l;t.controller=this;t.body=e;t.nextBody=this.m_bodyList;t.prevBody=null;this.m_bodyList=t;if(t.nextBody)t.nextBody.prevBody=t;this.m_bodyCount++;t.nextController=e.m_controllerList;t.prevController=null;e.m_controllerList=t;if(t.nextController)t.nextController.prevController=t;e.m_controllerCount++};s.prototype.RemoveBody=function(e){for(var t=e.m_controllerList;t&&t.controller!=this;)t=t.nextController;if(t.prevBody)t.prevBody.nextBody=t.nextBody;if(t.nextBody)t.nextBody.prevBody=t.prevBody;if(t.nextController)t.nextController.prevController=t.prevController;if(t.prevController)t.prevController.nextController=t.nextController;if(this.m_bodyList==t)this.m_bodyList=t.nextBody;if(e.m_controllerList==t)e.m_controllerList=t.nextController;e.m_controllerCount--;this.m_bodyCount--};s.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};s.prototype.GetNext=function(){return this.m_next};s.prototype.GetWorld=function(){return this.m_world};s.prototype.GetBodyList=function(){return this.m_bodyList};l.b2ControllerEdge=function(){};Box2D.inherit(c,Box2D.Dynamics.Controllers.b2Controller);c.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;c.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=true};c.prototype.Step=function(){var e=null,t=null,r=null,n=0,a=null,o=null,s=null,l=0,c=0,u=0;l=null;if(this.invSqr)for(e=this.m_bodyList;e;e=e.nextBody){t=e.body;r=t.GetWorldCenter();n=t.GetMass();for(a=this.m_bodyList;a!=e;a=a.nextBody){o=a.body;s=o.GetWorldCenter();l=s.x-r.x;c=s.y-r.y;u=l*l+c*c;if(!(u<Number.MIN_VALUE)){l=new i(l,c);l.Multiply(this.G/u/Math.sqrt(u)*n*o.GetMass());t.IsAwake()&&t.ApplyForce(l,r);l.Multiply(-1);o.IsAwake()&&o.ApplyForce(l,s)}}}else for(e=this.m_bodyList;e;e=e.nextBody){t=e.body;r=t.GetWorldCenter();n=t.GetMass();for(a=this.m_bodyList;a!=e;a=a.nextBody){o=a.body;s=o.GetWorldCenter();l=s.x-r.x;c=s.y-r.y;u=l*l+c*c;if(!(u<Number.MIN_VALUE)){l=new i(l,c);l.Multiply(this.G/u*n*o.GetMass());t.IsAwake()&&t.ApplyForce(l,r);l.Multiply(-1);o.IsAwake()&&o.ApplyForce(l,s)}}}};Box2D.inherit(u,Box2D.Dynamics.Controllers.b2Controller);u.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;u.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new e;this.maxTimestep=0};u.prototype.SetAxisAligned=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;this.T.col1.x=-e;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-t;this.maxTimestep=e>0||t>0?1/Math.max(e,t):0};u.prototype.Step=function(e){e=e.dt;if(!(e<=Number.MIN_VALUE)){if(e>this.maxTimestep&&this.maxTimestep>0)e=this.maxTimestep;for(var r=this.m_bodyList;r;r=r.nextBody){var n=r.body;if(n.IsAwake()){var a=n.GetWorldVector(t.MulMV(this.T,n.GetLocalVector(n.GetLinearVelocity())));n.SetLinearVelocity(new i(n.GetLinearVelocity().x+a.x*e,n.GetLinearVelocity().y+a.y*e))}}}}})();(function(){var e=Box2D.Common.b2Settings,t=Box2D.Common.Math.b2Mat22,i=Box2D.Common.Math.b2Mat33,r=Box2D.Common.Math.b2Math,n=Box2D.Common.Math.b2Vec2,a=Box2D.Common.Math.b2Vec3,o=Box2D.Dynamics.Joints.b2DistanceJoint,s=Box2D.Dynamics.Joints.b2DistanceJointDef,l=Box2D.Dynamics.Joints.b2FrictionJoint,c=Box2D.Dynamics.Joints.b2FrictionJointDef,u=Box2D.Dynamics.Joints.b2GearJoint,h=Box2D.Dynamics.Joints.b2GearJointDef,p=Box2D.Dynamics.Joints.b2Jacobian,m=Box2D.Dynamics.Joints.b2Joint,f=Box2D.Dynamics.Joints.b2JointDef,d=Box2D.Dynamics.Joints.b2JointEdge,_=Box2D.Dynamics.Joints.b2LineJoint,y=Box2D.Dynamics.Joints.b2LineJointDef,v=Box2D.Dynamics.Joints.b2MouseJoint,g=Box2D.Dynamics.Joints.b2MouseJointDef,x=Box2D.Dynamics.Joints.b2PrismaticJoint,b=Box2D.Dynamics.Joints.b2PrismaticJointDef,M=Box2D.Dynamics.Joints.b2PulleyJoint,w=Box2D.Dynamics.Joints.b2PulleyJointDef,S=Box2D.Dynamics.Joints.b2RevoluteJoint,A=Box2D.Dynamics.Joints.b2RevoluteJointDef,C=Box2D.Dynamics.Joints.b2WeldJoint,T=Box2D.Dynamics.Joints.b2WeldJointDef;Box2D.inherit(o,Box2D.Dynamics.Joints.b2Joint);o.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;o.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_u=new n};o.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};o.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};o.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new n(e*this.m_impulse*this.m_u.x,e*this.m_impulse*this.m_u.y)};o.prototype.GetReactionTorque=function(){return 0};o.prototype.GetLength=function(){return this.m_length};o.prototype.SetLength=function(e){if(e===undefined)e=0;this.m_length=e};o.prototype.GetFrequency=function(){return this.m_frequencyHz};o.prototype.SetFrequency=function(e){if(e===undefined)e=0;this.m_frequencyHz=e};o.prototype.GetDampingRatio=function(){return this.m_dampingRatio};o.prototype.SetDampingRatio=function(e){if(e===undefined)e=0;this.m_dampingRatio=e};o.prototype.b2DistanceJoint=function(e){this.__super.b2Joint.call(this,e);this.m_localAnchor1.SetV(e.localAnchorA);this.m_localAnchor2.SetV(e.localAnchorB);this.m_length=e.length;this.m_frequencyHz=e.frequencyHz;this.m_dampingRatio=e.dampingRatio;this.m_bias=this.m_gamma=this.m_impulse=0};o.prototype.InitVelocityConstraints=function(t){var i,r=0,n=this.m_bodyA,a=this.m_bodyB;i=n.m_xf.R;var o=this.m_localAnchor1.x-n.m_sweep.localCenter.x,s=this.m_localAnchor1.y-n.m_sweep.localCenter.y;r=i.col1.x*o+i.col2.x*s;s=i.col1.y*o+i.col2.y*s;o=r;i=a.m_xf.R;var l=this.m_localAnchor2.x-a.m_sweep.localCenter.x,c=this.m_localAnchor2.y-a.m_sweep.localCenter.y;r=i.col1.x*l+i.col2.x*c;c=i.col1.y*l+i.col2.y*c;l=r;this.m_u.x=a.m_sweep.c.x+l-n.m_sweep.c.x-o;this.m_u.y=a.m_sweep.c.y+c-n.m_sweep.c.y-s;r=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);r>e.b2_linearSlop?this.m_u.Multiply(1/r):this.m_u.SetZero();i=o*this.m_u.y-s*this.m_u.x;var u=l*this.m_u.y-c*this.m_u.x;i=n.m_invMass+n.m_invI*i*i+a.m_invMass+a.m_invI*u*u;this.m_mass=i!=0?1/i:0;if(this.m_frequencyHz>0){r=r-this.m_length;u=2*Math.PI*this.m_frequencyHz;var h=this.m_mass*u*u;this.m_gamma=t.dt*(2*this.m_mass*this.m_dampingRatio*u+t.dt*h);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_bias=r*t.dt*h*this.m_gamma;this.m_mass=i+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(t.warmStarting){this.m_impulse*=t.dtRatio;t=this.m_impulse*this.m_u.x;i=this.m_impulse*this.m_u.y;n.m_linearVelocity.x-=n.m_invMass*t;n.m_linearVelocity.y-=n.m_invMass*i;n.m_angularVelocity-=n.m_invI*(o*i-s*t);a.m_linearVelocity.x+=a.m_invMass*t;a.m_linearVelocity.y+=a.m_invMass*i;a.m_angularVelocity+=a.m_invI*(l*i-c*t)}else this.m_impulse=0};o.prototype.SolveVelocityConstraints=function(){var e,t=this.m_bodyA,i=this.m_bodyB;e=t.m_xf.R;var r=this.m_localAnchor1.x-t.m_sweep.localCenter.x,n=this.m_localAnchor1.y-t.m_sweep.localCenter.y,a=e.col1.x*r+e.col2.x*n;n=e.col1.y*r+e.col2.y*n;r=a;e=i.m_xf.R;var o=this.m_localAnchor2.x-i.m_sweep.localCenter.x,s=this.m_localAnchor2.y-i.m_sweep.localCenter.y;a=e.col1.x*o+e.col2.x*s;s=e.col1.y*o+e.col2.y*s;o=a;a=-this.m_mass*(this.m_u.x*(i.m_linearVelocity.x+-i.m_angularVelocity*s-(t.m_linearVelocity.x+-t.m_angularVelocity*n))+this.m_u.y*(i.m_linearVelocity.y+i.m_angularVelocity*o-(t.m_linearVelocity.y+t.m_angularVelocity*r))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=a;e=a*this.m_u.x;a=a*this.m_u.y;t.m_linearVelocity.x-=t.m_invMass*e;t.m_linearVelocity.y-=t.m_invMass*a;t.m_angularVelocity-=t.m_invI*(r*a-n*e);i.m_linearVelocity.x+=i.m_invMass*e;i.m_linearVelocity.y+=i.m_invMass*a;i.m_angularVelocity+=i.m_invI*(o*a-s*e)};o.prototype.SolvePositionConstraints=function(){var t;if(this.m_frequencyHz>0)return true;var i=this.m_bodyA,n=this.m_bodyB;t=i.m_xf.R;var a=this.m_localAnchor1.x-i.m_sweep.localCenter.x,o=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=t.col1.x*a+t.col2.x*o;o=t.col1.y*a+t.col2.y*o;a=s;t=n.m_xf.R;var l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,c=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=t.col1.x*l+t.col2.x*c;c=t.col1.y*l+t.col2.y*c;l=s;s=n.m_sweep.c.x+l-i.m_sweep.c.x-a;var u=n.m_sweep.c.y+c-i.m_sweep.c.y-o;t=Math.sqrt(s*s+u*u);s/=t;u/=t;t=t-this.m_length;t=r.Clamp(t,-e.b2_maxLinearCorrection,e.b2_maxLinearCorrection);var h=-this.m_mass*t;this.m_u.Set(s,u);s=h*this.m_u.x;u=h*this.m_u.y;i.m_sweep.c.x-=i.m_invMass*s;i.m_sweep.c.y-=i.m_invMass*u;i.m_sweep.a-=i.m_invI*(a*u-o*s);n.m_sweep.c.x+=n.m_invMass*s;n.m_sweep.c.y+=n.m_invMass*u;n.m_sweep.a+=n.m_invI*(l*u-c*s);i.SynchronizeTransform();n.SynchronizeTransform();return r.Abs(t)<e.b2_linearSlop};Box2D.inherit(s,Box2D.Dynamics.Joints.b2JointDef);s.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;s.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n};s.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=m.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};s.prototype.Initialize=function(e,t,i,r){this.bodyA=e;this.bodyB=t;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(r));e=r.x-i.x;i=r.y-i.y;this.length=Math.sqrt(e*e+i*i);this.dampingRatio=this.frequencyHz=0};Box2D.inherit(l,Box2D.Dynamics.Joints.b2Joint);l.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;l.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_linearMass=new t;this.m_linearImpulse=new n};l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};l.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new n(e*this.m_linearImpulse.x,e*this.m_linearImpulse.y)};l.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;return e*this.m_angularImpulse};l.prototype.SetMaxForce=function(e){if(e===undefined)e=0;this.m_maxForce=e};l.prototype.GetMaxForce=function(){return this.m_maxForce};l.prototype.SetMaxTorque=function(e){if(e===undefined)e=0;this.m_maxTorque=e};l.prototype.GetMaxTorque=function(){return this.m_maxTorque};l.prototype.b2FrictionJoint=function(e){this.__super.b2Joint.call(this,e);this.m_localAnchorA.SetV(e.localAnchorA);this.m_localAnchorB.SetV(e.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=e.maxForce;this.m_maxTorque=e.maxTorque};l.prototype.InitVelocityConstraints=function(e){var i,r=0,n=this.m_bodyA,a=this.m_bodyB;i=n.m_xf.R;var o=this.m_localAnchorA.x-n.m_sweep.localCenter.x,s=this.m_localAnchorA.y-n.m_sweep.localCenter.y;r=i.col1.x*o+i.col2.x*s;s=i.col1.y*o+i.col2.y*s;o=r;i=a.m_xf.R;var l=this.m_localAnchorB.x-a.m_sweep.localCenter.x,c=this.m_localAnchorB.y-a.m_sweep.localCenter.y;r=i.col1.x*l+i.col2.x*c;c=i.col1.y*l+i.col2.y*c;l=r;i=n.m_invMass;r=a.m_invMass;var u=n.m_invI,h=a.m_invI,p=new t;p.col1.x=i+r;p.col2.x=0;p.col1.y=0;p.col2.y=i+r;p.col1.x+=u*s*s;p.col2.x+=-u*o*s;p.col1.y+=-u*o*s;p.col2.y+=u*o*o;p.col1.x+=h*c*c;p.col2.x+=-h*l*c;p.col1.y+=-h*l*c;p.col2.y+=h*l*l;p.GetInverse(this.m_linearMass);this.m_angularMass=u+h;if(this.m_angularMass>0)this.m_angularMass=1/this.m_angularMass;if(e.warmStarting){this.m_linearImpulse.x*=e.dtRatio;this.m_linearImpulse.y*=e.dtRatio;this.m_angularImpulse*=e.dtRatio;e=this.m_linearImpulse;n.m_linearVelocity.x-=i*e.x;n.m_linearVelocity.y-=i*e.y;n.m_angularVelocity-=u*(o*e.y-s*e.x+this.m_angularImpulse);a.m_linearVelocity.x+=r*e.x;a.m_linearVelocity.y+=r*e.y;a.m_angularVelocity+=h*(l*e.y-c*e.x+this.m_angularImpulse)}else{this.m_linearImpulse.SetZero();this.m_angularImpulse=0}};l.prototype.SolveVelocityConstraints=function(e){var t,i=0,a=this.m_bodyA,o=this.m_bodyB,s=a.m_linearVelocity,l=a.m_angularVelocity,c=o.m_linearVelocity,u=o.m_angularVelocity,h=a.m_invMass,p=o.m_invMass,m=a.m_invI,f=o.m_invI;t=a.m_xf.R;var d=this.m_localAnchorA.x-a.m_sweep.localCenter.x,_=this.m_localAnchorA.y-a.m_sweep.localCenter.y;i=t.col1.x*d+t.col2.x*_;_=t.col1.y*d+t.col2.y*_;d=i;t=o.m_xf.R;var y=this.m_localAnchorB.x-o.m_sweep.localCenter.x,v=this.m_localAnchorB.y-o.m_sweep.localCenter.y;i=t.col1.x*y+t.col2.x*v;v=t.col1.y*y+t.col2.y*v;y=i;t=0;i=-this.m_angularMass*(u-l);var g=this.m_angularImpulse;t=e.dt*this.m_maxTorque;this.m_angularImpulse=r.Clamp(this.m_angularImpulse+i,-t,t);i=this.m_angularImpulse-g;l-=m*i;u+=f*i;t=r.MulMV(this.m_linearMass,new n(-(c.x-u*v-s.x+l*_),-(c.y+u*y-s.y-l*d)));i=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(t);t=e.dt*this.m_maxForce;if(this.m_linearImpulse.LengthSquared()>t*t){this.m_linearImpulse.Normalize();this.m_linearImpulse.Multiply(t)}t=r.SubtractVV(this.m_linearImpulse,i);s.x-=h*t.x;s.y-=h*t.y;l-=m*(d*t.y-_*t.x);c.x+=p*t.x;c.y+=p*t.y;u+=f*(y*t.y-v*t.x);a.m_angularVelocity=l;o.m_angularVelocity=u};l.prototype.SolvePositionConstraints=function(){return true};Box2D.inherit(c,Box2D.Dynamics.Joints.b2JointDef);c.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;c.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n};c.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=m.e_frictionJoint;this.maxTorque=this.maxForce=0};c.prototype.Initialize=function(e,t,i){this.bodyA=e;this.bodyB=t;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i))};Box2D.inherit(u,Box2D.Dynamics.Joints.b2Joint);u.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;u.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new n;this.m_groundAnchor2=new n;this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_J=new p};u.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};u.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};u.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new n(e*this.m_impulse*this.m_J.linearB.x,e*this.m_impulse*this.m_J.linearB.y)};u.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;var t=this.m_bodyB.m_xf.R,i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,r=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,n=t.col1.x*i+t.col2.x*r;r=t.col1.y*i+t.col2.y*r;i=n;return e*(this.m_impulse*this.m_J.angularB-i*this.m_impulse*this.m_J.linearB.y+r*this.m_impulse*this.m_J.linearB.x)};u.prototype.GetRatio=function(){return this.m_ratio};u.prototype.SetRatio=function(e){if(e===undefined)e=0;this.m_ratio=e};u.prototype.b2GearJoint=function(e){this.__super.b2Joint.call(this,e);var t=parseInt(e.joint1.m_type),i=parseInt(e.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var r=0,n=0;this.m_ground1=e.joint1.GetBodyA();this.m_bodyA=e.joint1.GetBodyB();if(t==m.e_revoluteJoint){this.m_revolute1=e.joint1 instanceof S?e.joint1:null;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);r=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=e.joint1 instanceof x?e.joint1:null;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);r=this.m_prismatic1.GetJointTranslation()}this.m_ground2=e.joint2.GetBodyA();this.m_bodyB=e.joint2.GetBodyB();if(i==m.e_revoluteJoint){this.m_revolute2=e.joint2 instanceof S?e.joint2:null;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);n=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=e.joint2 instanceof x?e.joint2:null;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);n=this.m_prismatic2.GetJointTranslation()}this.m_ratio=e.ratio;this.m_constant=r+this.m_ratio*n;this.m_impulse=0};u.prototype.InitVelocityConstraints=function(e){var t=this.m_ground1,i=this.m_ground2,r=this.m_bodyA,n=this.m_bodyB,a=0,o=0,s=0,l=0,c=s=0,u=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angularA=-1;u+=r.m_invI}else{t=t.m_xf.R;o=this.m_prismatic1.m_localXAxis1;a=t.col1.x*o.x+t.col2.x*o.y;o=t.col1.y*o.x+t.col2.y*o.y;t=r.m_xf.R;s=this.m_localAnchor1.x-r.m_sweep.localCenter.x;l=this.m_localAnchor1.y-r.m_sweep.localCenter.y;c=t.col1.x*s+t.col2.x*l;l=t.col1.y*s+t.col2.y*l;s=c;s=s*o-l*a;this.m_J.linearA.Set(-a,-o);this.m_J.angularA=-s;u+=r.m_invMass+r.m_invI*s*s}if(this.m_revolute2){this.m_J.angularB=-this.m_ratio;u+=this.m_ratio*this.m_ratio*n.m_invI}else{t=i.m_xf.R;o=this.m_prismatic2.m_localXAxis1;a=t.col1.x*o.x+t.col2.x*o.y;o=t.col1.y*o.x+t.col2.y*o.y;t=n.m_xf.R;s=this.m_localAnchor2.x-n.m_sweep.localCenter.x;l=this.m_localAnchor2.y-n.m_sweep.localCenter.y;c=t.col1.x*s+t.col2.x*l;l=t.col1.y*s+t.col2.y*l;s=c;s=s*o-l*a;this.m_J.linearB.Set(-this.m_ratio*a,-this.m_ratio*o);this.m_J.angularB=-this.m_ratio*s;u+=this.m_ratio*this.m_ratio*(n.m_invMass+n.m_invI*s*s)}this.m_mass=u>0?1/u:0;if(e.warmStarting){r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearA.x;r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearA.y;r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularA;n.m_linearVelocity.x+=n.m_invMass*this.m_impulse*this.m_J.linearB.x;n.m_linearVelocity.y+=n.m_invMass*this.m_impulse*this.m_J.linearB.y;n.m_angularVelocity+=n.m_invI*this.m_impulse*this.m_J.angularB}else this.m_impulse=0};u.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,i=-this.m_mass*this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,t.m_linearVelocity,t.m_angularVelocity);this.m_impulse+=i;e.m_linearVelocity.x+=e.m_invMass*i*this.m_J.linearA.x;e.m_linearVelocity.y+=e.m_invMass*i*this.m_J.linearA.y;e.m_angularVelocity+=e.m_invI*i*this.m_J.angularA;t.m_linearVelocity.x+=t.m_invMass*i*this.m_J.linearB.x;t.m_linearVelocity.y+=t.m_invMass*i*this.m_J.linearB.y;t.m_angularVelocity+=t.m_invI*i*this.m_J.angularB};u.prototype.SolvePositionConstraints=function(){var t=this.m_bodyA,i=this.m_bodyB,r=0,n=0;r=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation();n=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();r=-this.m_mass*(this.m_constant-(r+this.m_ratio*n));t.m_sweep.c.x+=t.m_invMass*r*this.m_J.linearA.x;t.m_sweep.c.y+=t.m_invMass*r*this.m_J.linearA.y;t.m_sweep.a+=t.m_invI*r*this.m_J.angularA;i.m_sweep.c.x+=i.m_invMass*r*this.m_J.linearB.x;i.m_sweep.c.y+=i.m_invMass*r*this.m_J.linearB.y;i.m_sweep.a+=i.m_invI*r*this.m_J.angularB;t.SynchronizeTransform();i.SynchronizeTransform();return 0<e.b2_linearSlop};Box2D.inherit(h,Box2D.Dynamics.Joints.b2JointDef);h.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;h.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};h.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=m.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};p.b2Jacobian=function(){this.linearA=new n;this.linearB=new n};p.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};p.prototype.Set=function(e,t,i,r){if(t===undefined)t=0;if(r===undefined)r=0;this.linearA.SetV(e);this.angularA=t;this.linearB.SetV(i);this.angularB=r};p.prototype.Compute=function(e,t,i,r){if(t===undefined)t=0;if(r===undefined)r=0;return this.linearA.x*e.x+this.linearA.y*e.y+this.angularA*t+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*r};m.b2Joint=function(){this.m_edgeA=new d;this.m_edgeB=new d;this.m_localCenterA=new n;this.m_localCenterB=new n};m.prototype.GetType=function(){return this.m_type};m.prototype.GetAnchorA=function(){return null};m.prototype.GetAnchorB=function(){return null};m.prototype.GetReactionForce=function(){return null};m.prototype.GetReactionTorque=function(){return 0};m.prototype.GetBodyA=function(){return this.m_bodyA};m.prototype.GetBodyB=function(){return this.m_bodyB};m.prototype.GetNext=function(){return this.m_next};m.prototype.GetUserData=function(){return this.m_userData};m.prototype.SetUserData=function(e){this.m_userData=e};m.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};m.Create=function(e){var t=null;switch(e.type){case m.e_distanceJoint:t=new o(e instanceof s?e:null);break;case m.e_mouseJoint:t=new v(e instanceof g?e:null);break;case m.e_prismaticJoint:t=new x(e instanceof b?e:null);break;case m.e_revoluteJoint:t=new S(e instanceof A?e:null);break;case m.e_pulleyJoint:t=new M(e instanceof w?e:null);break;case m.e_gearJoint:t=new u(e instanceof h?e:null);break;case m.e_lineJoint:t=new _(e instanceof y?e:null);break;case m.e_weldJoint:t=new C(e instanceof T?e:null);break;case m.e_frictionJoint:t=new l(e instanceof c?e:null)}return t};m.Destroy=function(){};m.prototype.b2Joint=function(t){e.b2Assert(t.bodyA!=t.bodyB);this.m_type=t.type;this.m_next=this.m_prev=null;this.m_bodyA=t.bodyA;this.m_bodyB=t.bodyB;this.m_collideConnected=t.collideConnected;this.m_islandFlag=false;this.m_userData=t.userData};m.prototype.InitVelocityConstraints=function(){};m.prototype.SolveVelocityConstraints=function(){};m.prototype.FinalizeVelocityConstraints=function(){};m.prototype.SolvePositionConstraints=function(){return false};Box2D.postDefs.push((function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3}));f.b2JointDef=function(){};f.prototype.b2JointDef=function(){this.type=m.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=false};d.b2JointEdge=function(){};Box2D.inherit(_,Box2D.Dynamics.Joints.b2Joint);_.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;_.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_localXAxis1=new n;this.m_localYAxis1=new n;this.m_axis=new n;this.m_perp=new n;this.m_K=new t;this.m_impulse=new n};_.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};_.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};_.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new n(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};_.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;return e*this.m_impulse.y};_.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,i=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2);t=r.x-i.x;i=r.y-i.y;e=e.GetWorldVector(this.m_localXAxis1);return e.x*t+e.y*i};_.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,i;i=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,n=this.m_localAnchor1.y-e.m_sweep.localCenter.y,a=i.col1.x*r+i.col2.x*n;n=i.col1.y*r+i.col2.y*n;r=a;i=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,s=this.m_localAnchor2.y-t.m_sweep.localCenter.y;a=i.col1.x*o+i.col2.x*s;s=i.col1.y*o+i.col2.y*s;o=a;i=t.m_sweep.c.x+o-(e.m_sweep.c.x+r);a=t.m_sweep.c.y+s-(e.m_sweep.c.y+n);var l=e.GetWorldVector(this.m_localXAxis1),c=e.m_linearVelocity,u=t.m_linearVelocity;e=e.m_angularVelocity;t=t.m_angularVelocity;return i*-e*l.y+a*e*l.x+(l.x*(u.x+-t*s-c.x- -e*n)+l.y*(u.y+t*o-c.y-e*r))};_.prototype.IsLimitEnabled=function(){return this.m_enableLimit};_.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=e};_.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};_.prototype.GetUpperLimit=function(){return this.m_upperTranslation};_.prototype.SetLimits=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=e;this.m_upperTranslation=t};_.prototype.IsMotorEnabled=function(){return this.m_enableMotor};_.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=e};_.prototype.SetMotorSpeed=function(e){if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=e};_.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};_.prototype.SetMaxMotorForce=function(e){if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=e};_.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};_.prototype.GetMotorForce=function(){return this.m_motorImpulse};_.prototype.b2LineJoint=function(e){this.__super.b2Joint.call(this,e);this.m_localAnchor1.SetV(e.localAnchorA);this.m_localAnchor2.SetV(e.localAnchorB);this.m_localXAxis1.SetV(e.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=e.lowerTranslation;this.m_upperTranslation=e.upperTranslation;this.m_maxMotorForce=e.maxMotorForce;this.m_motorSpeed=e.motorSpeed;this.m_enableLimit=e.enableLimit;this.m_enableMotor=e.enableMotor;this.m_limitState=m.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};_.prototype.InitVelocityConstraints=function(t){var i=this.m_bodyA,n=this.m_bodyB,a,o=0;this.m_localCenterA.SetV(i.GetLocalCenter());this.m_localCenterB.SetV(n.GetLocalCenter());var s=i.GetTransform();n.GetTransform();a=i.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,c=this.m_localAnchor1.y-this.m_localCenterA.y;o=a.col1.x*l+a.col2.x*c;c=a.col1.y*l+a.col2.y*c;l=o;a=n.m_xf.R;var u=this.m_localAnchor2.x-this.m_localCenterB.x,h=this.m_localAnchor2.y-this.m_localCenterB.y;o=a.col1.x*u+a.col2.x*h;h=a.col1.y*u+a.col2.y*h;u=o;a=n.m_sweep.c.x+u-i.m_sweep.c.x-l;o=n.m_sweep.c.y+h-i.m_sweep.c.y-c;this.m_invMassA=i.m_invMass;this.m_invMassB=n.m_invMass;this.m_invIA=i.m_invI;this.m_invIB=n.m_invI;this.m_axis.SetV(r.MulMV(s.R,this.m_localXAxis1));this.m_a1=(a+l)*this.m_axis.y-(o+c)*this.m_axis.x;this.m_a2=u*this.m_axis.y-h*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(r.MulMV(s.R,this.m_localYAxis1));this.m_s1=(a+l)*this.m_perp.y-(o+c)*this.m_perp.x;this.m_s2=u*this.m_perp.y-h*this.m_perp.x;s=this.m_invMassA;l=this.m_invMassB;c=this.m_invIA;u=this.m_invIB;this.m_K.col1.x=s+l+c*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2;this.m_K.col1.y=c*this.m_s1*this.m_a1+u*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=s+l+c*this.m_a1*this.m_a1+u*this.m_a2*this.m_a2;if(this.m_enableLimit){a=this.m_axis.x*a+this.m_axis.y*o;if(r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop)this.m_limitState=m.e_equalLimits;else if(a<=this.m_lowerTranslation){if(this.m_limitState!=m.e_atLowerLimit){this.m_limitState=m.e_atLowerLimit;this.m_impulse.y=0}}else if(a>=this.m_upperTranslation){if(this.m_limitState!=m.e_atUpperLimit){this.m_limitState=m.e_atUpperLimit;this.m_impulse.y=0}}else{this.m_limitState=m.e_inactiveLimit;this.m_impulse.y=0}}else this.m_limitState=m.e_inactiveLimit;if(this.m_enableMotor==false)this.m_motorImpulse=0;if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;t=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x;a=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y;o=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1;s=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;i.m_linearVelocity.x-=this.m_invMassA*t;i.m_linearVelocity.y-=this.m_invMassA*a;i.m_angularVelocity-=this.m_invIA*o;n.m_linearVelocity.x+=this.m_invMassB*t;n.m_linearVelocity.y+=this.m_invMassB*a;n.m_angularVelocity+=this.m_invIB*s}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};_.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB,a=t.m_linearVelocity,o=t.m_angularVelocity,s=i.m_linearVelocity,l=i.m_angularVelocity,c=0,u=0,h=0,p=0;if(this.m_enableMotor&&this.m_limitState!=m.e_equalLimits){p=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(s.x-a.x)+this.m_axis.y*(s.y-a.y)+this.m_a2*l-this.m_a1*o));c=this.m_motorImpulse;u=e.dt*this.m_maxMotorForce;this.m_motorImpulse=r.Clamp(this.m_motorImpulse+p,-u,u);p=this.m_motorImpulse-c;c=p*this.m_axis.x;u=p*this.m_axis.y;h=p*this.m_a1;p=p*this.m_a2;a.x-=this.m_invMassA*c;a.y-=this.m_invMassA*u;o-=this.m_invIA*h;s.x+=this.m_invMassB*c;s.y+=this.m_invMassB*u;l+=this.m_invIB*p}u=this.m_perp.x*(s.x-a.x)+this.m_perp.y*(s.y-a.y)+this.m_s2*l-this.m_s1*o;if(this.m_enableLimit&&this.m_limitState!=m.e_inactiveLimit){h=this.m_axis.x*(s.x-a.x)+this.m_axis.y*(s.y-a.y)+this.m_a2*l-this.m_a1*o;c=this.m_impulse.Copy();e=this.m_K.Solve(new n,-u,-h);this.m_impulse.Add(e);if(this.m_limitState==m.e_atLowerLimit)this.m_impulse.y=r.Max(this.m_impulse.y,0);else if(this.m_limitState==m.e_atUpperLimit)this.m_impulse.y=r.Min(this.m_impulse.y,0);u=-u-(this.m_impulse.y-c.y)*this.m_K.col2.x;h=0;h=this.m_K.col1.x!=0?u/this.m_K.col1.x+c.x:c.x;this.m_impulse.x=h;e.x=this.m_impulse.x-c.x;e.y=this.m_impulse.y-c.y;c=e.x*this.m_perp.x+e.y*this.m_axis.x;u=e.x*this.m_perp.y+e.y*this.m_axis.y;h=e.x*this.m_s1+e.y*this.m_a1;p=e.x*this.m_s2+e.y*this.m_a2}else{e=0;e=this.m_K.col1.x!=0?-u/this.m_K.col1.x:0;this.m_impulse.x+=e;c=e*this.m_perp.x;u=e*this.m_perp.y;h=e*this.m_s1;p=e*this.m_s2}a.x-=this.m_invMassA*c;a.y-=this.m_invMassA*u;o-=this.m_invIA*h;s.x+=this.m_invMassB*c;s.y+=this.m_invMassB*u;l+=this.m_invIB*p;t.m_linearVelocity.SetV(a);t.m_angularVelocity=o;i.m_linearVelocity.SetV(s);i.m_angularVelocity=l};_.prototype.SolvePositionConstraints=function(){var i=this.m_bodyA,a=this.m_bodyB,o=i.m_sweep.c,s=i.m_sweep.a,l=a.m_sweep.c,c=a.m_sweep.a,u,h=0,p=0,m=0,f=0,d=u=0,_=0;p=false;var y=0,v=t.FromAngle(s);m=t.FromAngle(c);u=v;_=this.m_localAnchor1.x-this.m_localCenterA.x;var g=this.m_localAnchor1.y-this.m_localCenterA.y;h=u.col1.x*_+u.col2.x*g;g=u.col1.y*_+u.col2.y*g;_=h;u=m;m=this.m_localAnchor2.x-this.m_localCenterB.x;f=this.m_localAnchor2.y-this.m_localCenterB.y;h=u.col1.x*m+u.col2.x*f;f=u.col1.y*m+u.col2.y*f;m=h;u=l.x+m-o.x-_;h=l.y+f-o.y-g;if(this.m_enableLimit){this.m_axis=r.MulMV(v,this.m_localXAxis1);this.m_a1=(u+_)*this.m_axis.y-(h+g)*this.m_axis.x;this.m_a2=m*this.m_axis.y-f*this.m_axis.x;var x=this.m_axis.x*u+this.m_axis.y*h;if(r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop){y=r.Clamp(x,-e.b2_maxLinearCorrection,e.b2_maxLinearCorrection);d=r.Abs(x);p=true}else if(x<=this.m_lowerTranslation){y=r.Clamp(x-this.m_lowerTranslation+e.b2_linearSlop,-e.b2_maxLinearCorrection,0);d=this.m_lowerTranslation-x;p=true}else if(x>=this.m_upperTranslation){y=r.Clamp(x-this.m_upperTranslation+e.b2_linearSlop,0,e.b2_maxLinearCorrection);d=x-this.m_upperTranslation;p=true}}this.m_perp=r.MulMV(v,this.m_localYAxis1);this.m_s1=(u+_)*this.m_perp.y-(h+g)*this.m_perp.x;this.m_s2=m*this.m_perp.y-f*this.m_perp.x;v=new n;g=this.m_perp.x*u+this.m_perp.y*h;d=r.Max(d,r.Abs(g));_=0;if(p){p=this.m_invMassA;m=this.m_invMassB;f=this.m_invIA;u=this.m_invIB;this.m_K.col1.x=p+m+f*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2;this.m_K.col1.y=f*this.m_s1*this.m_a1+u*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=p+m+f*this.m_a1*this.m_a1+u*this.m_a2*this.m_a2;this.m_K.Solve(v,-g,-y)}else{p=this.m_invMassA;m=this.m_invMassB;f=this.m_invIA;u=this.m_invIB;y=p+m+f*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2;p=0;p=y!=0?-g/y:0;v.x=p;v.y=0}y=v.x*this.m_perp.x+v.y*this.m_axis.x;p=v.x*this.m_perp.y+v.y*this.m_axis.y;g=v.x*this.m_s1+v.y*this.m_a1;v=v.x*this.m_s2+v.y*this.m_a2;o.x-=this.m_invMassA*y;o.y-=this.m_invMassA*p;s-=this.m_invIA*g;l.x+=this.m_invMassB*y;l.y+=this.m_invMassB*p;c+=this.m_invIB*v;i.m_sweep.a=s;a.m_sweep.a=c;i.SynchronizeTransform();a.SynchronizeTransform();return d<=e.b2_linearSlop&&_<=e.b2_angularSlop};Box2D.inherit(y,Box2D.Dynamics.Joints.b2JointDef);y.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;y.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n;this.localAxisA=new n};y.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=m.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=false;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=false;this.motorSpeed=this.maxMotorForce=0};y.prototype.Initialize=function(e,t,i,r){this.bodyA=e;this.bodyB=t;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.localAxisA=this.bodyA.GetLocalVector(r)};Box2D.inherit(v,Box2D.Dynamics.Joints.b2Joint);v.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;v.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new t;this.K1=new t;this.K2=new t;this.m_localAnchor=new n;this.m_target=new n;this.m_impulse=new n;this.m_mass=new t;this.m_C=new n};v.prototype.GetAnchorA=function(){return this.m_target};v.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};v.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new n(e*this.m_impulse.x,e*this.m_impulse.y)};v.prototype.GetReactionTorque=function(){return 0};v.prototype.GetTarget=function(){return this.m_target};v.prototype.SetTarget=function(e){this.m_bodyB.IsAwake()==false&&this.m_bodyB.SetAwake(true);this.m_target=e};v.prototype.GetMaxForce=function(){return this.m_maxForce};v.prototype.SetMaxForce=function(e){if(e===undefined)e=0;this.m_maxForce=e};v.prototype.GetFrequency=function(){return this.m_frequencyHz};v.prototype.SetFrequency=function(e){if(e===undefined)e=0;this.m_frequencyHz=e};v.prototype.GetDampingRatio=function(){return this.m_dampingRatio};v.prototype.SetDampingRatio=function(e){if(e===undefined)e=0;this.m_dampingRatio=e};v.prototype.b2MouseJoint=function(e){this.__super.b2Joint.call(this,e);this.m_target.SetV(e.target);var t=this.m_target.x-this.m_bodyB.m_xf.position.x,i=this.m_target.y-this.m_bodyB.m_xf.position.y,r=this.m_bodyB.m_xf.R;this.m_localAnchor.x=t*r.col1.x+i*r.col1.y;this.m_localAnchor.y=t*r.col2.x+i*r.col2.y;this.m_maxForce=e.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=e.frequencyHz;this.m_dampingRatio=e.dampingRatio;this.m_gamma=this.m_beta=0};v.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyB,i=t.GetMass(),r=2*Math.PI*this.m_frequencyHz,n=i*r*r;this.m_gamma=e.dt*(2*i*this.m_dampingRatio*r+e.dt*n);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=e.dt*n*this.m_gamma;n=t.m_xf.R;i=this.m_localAnchor.x-t.m_sweep.localCenter.x;r=this.m_localAnchor.y-t.m_sweep.localCenter.y;var a=n.col1.x*i+n.col2.x*r;r=n.col1.y*i+n.col2.y*r;i=a;n=t.m_invMass;a=t.m_invI;this.K1.col1.x=n;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=n;this.K2.col1.x=a*r*r;this.K2.col2.x=-a*i*r;this.K2.col1.y=-a*i*r;this.K2.col2.y=a*i*i;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=t.m_sweep.c.x+i-this.m_target.x;this.m_C.y=t.m_sweep.c.y+r-this.m_target.y;t.m_angularVelocity*=.98;this.m_impulse.x*=e.dtRatio;this.m_impulse.y*=e.dtRatio;t.m_linearVelocity.x+=n*this.m_impulse.x;t.m_linearVelocity.y+=n*this.m_impulse.y;t.m_angularVelocity+=a*(i*this.m_impulse.y-r*this.m_impulse.x)};v.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyB,i,r=0,n=0;i=t.m_xf.R;var a=this.m_localAnchor.x-t.m_sweep.localCenter.x,o=this.m_localAnchor.y-t.m_sweep.localCenter.y;r=i.col1.x*a+i.col2.x*o;o=i.col1.y*a+i.col2.y*o;a=r;r=t.m_linearVelocity.x+-t.m_angularVelocity*o;var s=t.m_linearVelocity.y+t.m_angularVelocity*a;i=this.m_mass;r=r+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;n=s+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;s=-(i.col1.x*r+i.col2.x*n);n=-(i.col1.y*r+i.col2.y*n);i=this.m_impulse.x;r=this.m_impulse.y;this.m_impulse.x+=s;this.m_impulse.y+=n;e=e.dt*this.m_maxForce;this.m_impulse.LengthSquared()>e*e&&this.m_impulse.Multiply(e/this.m_impulse.Length());s=this.m_impulse.x-i;n=this.m_impulse.y-r;t.m_linearVelocity.x+=t.m_invMass*s;t.m_linearVelocity.y+=t.m_invMass*n;t.m_angularVelocity+=t.m_invI*(a*n-o*s)};v.prototype.SolvePositionConstraints=function(){return true};Box2D.inherit(g,Box2D.Dynamics.Joints.b2JointDef);g.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;g.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new n};g.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=m.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7};Box2D.inherit(x,Box2D.Dynamics.Joints.b2Joint);x.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;x.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_localXAxis1=new n;this.m_localYAxis1=new n;this.m_axis=new n;this.m_perp=new n;this.m_K=new i;this.m_impulse=new a};x.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};x.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};x.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new n(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};x.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;return e*this.m_impulse.y};x.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,i=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2);t=r.x-i.x;i=r.y-i.y;e=e.GetWorldVector(this.m_localXAxis1);return e.x*t+e.y*i};x.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,i;i=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,n=this.m_localAnchor1.y-e.m_sweep.localCenter.y,a=i.col1.x*r+i.col2.x*n;n=i.col1.y*r+i.col2.y*n;r=a;i=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,s=this.m_localAnchor2.y-t.m_sweep.localCenter.y;a=i.col1.x*o+i.col2.x*s;s=i.col1.y*o+i.col2.y*s;o=a;i=t.m_sweep.c.x+o-(e.m_sweep.c.x+r);a=t.m_sweep.c.y+s-(e.m_sweep.c.y+n);var l=e.GetWorldVector(this.m_localXAxis1),c=e.m_linearVelocity,u=t.m_linearVelocity;e=e.m_angularVelocity;t=t.m_angularVelocity;return i*-e*l.y+a*e*l.x+(l.x*(u.x+-t*s-c.x- -e*n)+l.y*(u.y+t*o-c.y-e*r))};x.prototype.IsLimitEnabled=function(){return this.m_enableLimit};x.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=e};x.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};x.prototype.GetUpperLimit=function(){return this.m_upperTranslation};x.prototype.SetLimits=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=e;this.m_upperTranslation=t};x.prototype.IsMotorEnabled=function(){return this.m_enableMotor};x.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=e};x.prototype.SetMotorSpeed=function(e){if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=e};x.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};x.prototype.SetMaxMotorForce=function(e){if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=e};x.prototype.GetMotorForce=function(){return this.m_motorImpulse};x.prototype.b2PrismaticJoint=function(e){this.__super.b2Joint.call(this,e);this.m_localAnchor1.SetV(e.localAnchorA);this.m_localAnchor2.SetV(e.localAnchorB);this.m_localXAxis1.SetV(e.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=e.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=e.lowerTranslation;this.m_upperTranslation=e.upperTranslation;this.m_maxMotorForce=e.maxMotorForce;this.m_motorSpeed=e.motorSpeed;this.m_enableLimit=e.enableLimit;this.m_enableMotor=e.enableMotor;this.m_limitState=m.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};x.prototype.InitVelocityConstraints=function(t){var i=this.m_bodyA,n=this.m_bodyB,a,o=0;this.m_localCenterA.SetV(i.GetLocalCenter());this.m_localCenterB.SetV(n.GetLocalCenter());var s=i.GetTransform();n.GetTransform();a=i.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,c=this.m_localAnchor1.y-this.m_localCenterA.y;o=a.col1.x*l+a.col2.x*c;c=a.col1.y*l+a.col2.y*c;l=o;a=n.m_xf.R;var u=this.m_localAnchor2.x-this.m_localCenterB.x,h=this.m_localAnchor2.y-this.m_localCenterB.y;o=a.col1.x*u+a.col2.x*h;h=a.col1.y*u+a.col2.y*h;u=o;a=n.m_sweep.c.x+u-i.m_sweep.c.x-l;o=n.m_sweep.c.y+h-i.m_sweep.c.y-c;this.m_invMassA=i.m_invMass;this.m_invMassB=n.m_invMass;this.m_invIA=i.m_invI;this.m_invIB=n.m_invI;this.m_axis.SetV(r.MulMV(s.R,this.m_localXAxis1));this.m_a1=(a+l)*this.m_axis.y-(o+c)*this.m_axis.x;this.m_a2=u*this.m_axis.y-h*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Number.MIN_VALUE)this.m_motorMass=1/this.m_motorMass;this.m_perp.SetV(r.MulMV(s.R,this.m_localYAxis1));this.m_s1=(a+l)*this.m_perp.y-(o+c)*this.m_perp.x;this.m_s2=u*this.m_perp.y-h*this.m_perp.x;s=this.m_invMassA;l=this.m_invMassB;c=this.m_invIA;u=this.m_invIB;this.m_K.col1.x=s+l+c*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2;this.m_K.col1.y=c*this.m_s1+u*this.m_s2;this.m_K.col1.z=c*this.m_s1*this.m_a1+u*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=c+u;this.m_K.col2.z=c*this.m_a1+u*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=s+l+c*this.m_a1*this.m_a1+u*this.m_a2*this.m_a2;if(this.m_enableLimit){a=this.m_axis.x*a+this.m_axis.y*o;if(r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop)this.m_limitState=m.e_equalLimits;else if(a<=this.m_lowerTranslation){if(this.m_limitState!=m.e_atLowerLimit){this.m_limitState=m.e_atLowerLimit;this.m_impulse.z=0}}else if(a>=this.m_upperTranslation){if(this.m_limitState!=m.e_atUpperLimit){this.m_limitState=m.e_atUpperLimit;this.m_impulse.z=0}}else{this.m_limitState=m.e_inactiveLimit;this.m_impulse.z=0}}else this.m_limitState=m.e_inactiveLimit;if(this.m_enableMotor==false)this.m_motorImpulse=0;if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;t=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x;a=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y;o=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1;s=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;i.m_linearVelocity.x-=this.m_invMassA*t;i.m_linearVelocity.y-=this.m_invMassA*a;i.m_angularVelocity-=this.m_invIA*o;n.m_linearVelocity.x+=this.m_invMassB*t;n.m_linearVelocity.y+=this.m_invMassB*a;n.m_angularVelocity+=this.m_invIB*s}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};x.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB,o=t.m_linearVelocity,s=t.m_angularVelocity,l=i.m_linearVelocity,c=i.m_angularVelocity,u=0,h=0,p=0,f=0;if(this.m_enableMotor&&this.m_limitState!=m.e_equalLimits){f=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(l.x-o.x)+this.m_axis.y*(l.y-o.y)+this.m_a2*c-this.m_a1*s));u=this.m_motorImpulse;e=e.dt*this.m_maxMotorForce;this.m_motorImpulse=r.Clamp(this.m_motorImpulse+f,-e,e);f=this.m_motorImpulse-u;u=f*this.m_axis.x;h=f*this.m_axis.y;p=f*this.m_a1;f=f*this.m_a2;o.x-=this.m_invMassA*u;o.y-=this.m_invMassA*h;s-=this.m_invIA*p;l.x+=this.m_invMassB*u;l.y+=this.m_invMassB*h;c+=this.m_invIB*f}p=this.m_perp.x*(l.x-o.x)+this.m_perp.y*(l.y-o.y)+this.m_s2*c-this.m_s1*s;h=c-s;if(this.m_enableLimit&&this.m_limitState!=m.e_inactiveLimit){e=this.m_axis.x*(l.x-o.x)+this.m_axis.y*(l.y-o.y)+this.m_a2*c-this.m_a1*s;u=this.m_impulse.Copy();e=this.m_K.Solve33(new a,-p,-h,-e);this.m_impulse.Add(e);if(this.m_limitState==m.e_atLowerLimit)this.m_impulse.z=r.Max(this.m_impulse.z,0);else if(this.m_limitState==m.e_atUpperLimit)this.m_impulse.z=r.Min(this.m_impulse.z,0);p=-p-(this.m_impulse.z-u.z)*this.m_K.col3.x;h=-h-(this.m_impulse.z-u.z)*this.m_K.col3.y;h=this.m_K.Solve22(new n,p,h);h.x+=u.x;h.y+=u.y;this.m_impulse.x=h.x;this.m_impulse.y=h.y;e.x=this.m_impulse.x-u.x;e.y=this.m_impulse.y-u.y;e.z=this.m_impulse.z-u.z;u=e.x*this.m_perp.x+e.z*this.m_axis.x;h=e.x*this.m_perp.y+e.z*this.m_axis.y;p=e.x*this.m_s1+e.y+e.z*this.m_a1;f=e.x*this.m_s2+e.y+e.z*this.m_a2}else{e=this.m_K.Solve22(new n,-p,-h);this.m_impulse.x+=e.x;this.m_impulse.y+=e.y;u=e.x*this.m_perp.x;h=e.x*this.m_perp.y;p=e.x*this.m_s1+e.y;f=e.x*this.m_s2+e.y}o.x-=this.m_invMassA*u;o.y-=this.m_invMassA*h;s-=this.m_invIA*p;l.x+=this.m_invMassB*u;l.y+=this.m_invMassB*h;c+=this.m_invIB*f;t.m_linearVelocity.SetV(o);t.m_angularVelocity=s;i.m_linearVelocity.SetV(l);i.m_angularVelocity=c};x.prototype.SolvePositionConstraints=function(){var i=this.m_bodyA,o=this.m_bodyB,s=i.m_sweep.c,l=i.m_sweep.a,c=o.m_sweep.c,u=o.m_sweep.a,h,p=0,m=0,f=0,d=p=h=0,_=0;m=false;var y=0,v=t.FromAngle(l),g=t.FromAngle(u);h=v;_=this.m_localAnchor1.x-this.m_localCenterA.x;var x=this.m_localAnchor1.y-this.m_localCenterA.y;p=h.col1.x*_+h.col2.x*x;x=h.col1.y*_+h.col2.y*x;_=p;h=g;g=this.m_localAnchor2.x-this.m_localCenterB.x;f=this.m_localAnchor2.y-this.m_localCenterB.y;p=h.col1.x*g+h.col2.x*f;f=h.col1.y*g+h.col2.y*f;g=p;h=c.x+g-s.x-_;p=c.y+f-s.y-x;if(this.m_enableLimit){this.m_axis=r.MulMV(v,this.m_localXAxis1);this.m_a1=(h+_)*this.m_axis.y-(p+x)*this.m_axis.x;this.m_a2=g*this.m_axis.y-f*this.m_axis.x;var b=this.m_axis.x*h+this.m_axis.y*p;if(r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop){y=r.Clamp(b,-e.b2_maxLinearCorrection,e.b2_maxLinearCorrection);d=r.Abs(b);m=true}else if(b<=this.m_lowerTranslation){y=r.Clamp(b-this.m_lowerTranslation+e.b2_linearSlop,-e.b2_maxLinearCorrection,0);d=this.m_lowerTranslation-b;m=true}else if(b>=this.m_upperTranslation){y=r.Clamp(b-this.m_upperTranslation+e.b2_linearSlop,0,e.b2_maxLinearCorrection);d=b-this.m_upperTranslation;m=true}}this.m_perp=r.MulMV(v,this.m_localYAxis1);this.m_s1=(h+_)*this.m_perp.y-(p+x)*this.m_perp.x;this.m_s2=g*this.m_perp.y-f*this.m_perp.x;v=new a;x=this.m_perp.x*h+this.m_perp.y*p;g=u-l-this.m_refAngle;d=r.Max(d,r.Abs(x));_=r.Abs(g);if(m){m=this.m_invMassA;f=this.m_invMassB;h=this.m_invIA;p=this.m_invIB;this.m_K.col1.x=m+f+h*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2;this.m_K.col1.y=h*this.m_s1+p*this.m_s2;this.m_K.col1.z=h*this.m_s1*this.m_a1+p*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=h+p;this.m_K.col2.z=h*this.m_a1+p*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=m+f+h*this.m_a1*this.m_a1+p*this.m_a2*this.m_a2;this.m_K.Solve33(v,-x,-g,-y)}else{m=this.m_invMassA;f=this.m_invMassB;h=this.m_invIA;p=this.m_invIB;y=h*this.m_s1+p*this.m_s2;b=h+p;this.m_K.col1.Set(m+f+h*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,y,0);this.m_K.col2.Set(y,b,0);y=this.m_K.Solve22(new n,-x,-g);v.x=y.x;v.y=y.y;v.z=0}y=v.x*this.m_perp.x+v.z*this.m_axis.x;m=v.x*this.m_perp.y+v.z*this.m_axis.y;x=v.x*this.m_s1+v.y+v.z*this.m_a1;v=v.x*this.m_s2+v.y+v.z*this.m_a2;s.x-=this.m_invMassA*y;s.y-=this.m_invMassA*m;l-=this.m_invIA*x;c.x+=this.m_invMassB*y;c.y+=this.m_invMassB*m;u+=this.m_invIB*v;i.m_sweep.a=l;o.m_sweep.a=u;i.SynchronizeTransform();o.SynchronizeTransform();return d<=e.b2_linearSlop&&_<=e.b2_angularSlop};Box2D.inherit(b,Box2D.Dynamics.Joints.b2JointDef);b.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;b.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n;this.localAxisA=new n};b.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=m.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=false;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=false;this.motorSpeed=this.maxMotorForce=0};b.prototype.Initialize=function(e,t,i,r){this.bodyA=e;this.bodyB=t;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.localAxisA=this.bodyA.GetLocalVector(r);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(M,Box2D.Dynamics.Joints.b2Joint);M.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;M.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new n;this.m_groundAnchor2=new n;this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_u1=new n;this.m_u2=new n};M.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};M.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};M.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new n(e*this.m_impulse*this.m_u2.x,e*this.m_impulse*this.m_u2.y)};M.prototype.GetReactionTorque=function(){return 0};M.prototype.GetGroundAnchorA=function(){var e=this.m_ground.m_xf.position.Copy();e.Add(this.m_groundAnchor1);return e};M.prototype.GetGroundAnchorB=function(){var e=this.m_ground.m_xf.position.Copy();e.Add(this.m_groundAnchor2);return e};M.prototype.GetLength1=function(){var e=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(t*t+e*e)};M.prototype.GetLength2=function(){var e=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(t*t+e*e)};M.prototype.GetRatio=function(){return this.m_ratio};M.prototype.b2PulleyJoint=function(e){this.__super.b2Joint.call(this,e);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=e.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=e.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=e.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=e.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(e.localAnchorA);this.m_localAnchor2.SetV(e.localAnchorB);this.m_ratio=e.ratio;this.m_constant=e.lengthA+this.m_ratio*e.lengthB;this.m_maxLength1=r.Min(e.maxLengthA,this.m_constant-this.m_ratio*M.b2_minPulleyLength);this.m_maxLength2=r.Min(e.maxLengthB,(this.m_constant-M.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};M.prototype.InitVelocityConstraints=function(t){var i=this.m_bodyA,r=this.m_bodyB,n;n=i.m_xf.R;var a=this.m_localAnchor1.x-i.m_sweep.localCenter.x,o=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=n.col1.x*a+n.col2.x*o;o=n.col1.y*a+n.col2.y*o;a=s;n=r.m_xf.R;var l=this.m_localAnchor2.x-r.m_sweep.localCenter.x,c=this.m_localAnchor2.y-r.m_sweep.localCenter.y;s=n.col1.x*l+n.col2.x*c;c=n.col1.y*l+n.col2.y*c;l=s;n=r.m_sweep.c.x+l;s=r.m_sweep.c.y+c;var u=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,h=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(i.m_sweep.c.x+a-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),i.m_sweep.c.y+o-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(n-u,s-h);n=this.m_u1.Length();s=this.m_u2.Length();n>e.b2_linearSlop?this.m_u1.Multiply(1/n):this.m_u1.SetZero();s>e.b2_linearSlop?this.m_u2.Multiply(1/s):this.m_u2.SetZero();if(this.m_constant-n-this.m_ratio*s>0){this.m_state=m.e_inactiveLimit;this.m_impulse=0}else this.m_state=m.e_atUpperLimit;if(n<this.m_maxLength1){this.m_limitState1=m.e_inactiveLimit;this.m_limitImpulse1=0}else this.m_limitState1=m.e_atUpperLimit;if(s<this.m_maxLength2){this.m_limitState2=m.e_inactiveLimit;this.m_limitImpulse2=0}else this.m_limitState2=m.e_atUpperLimit;n=a*this.m_u1.y-o*this.m_u1.x;s=l*this.m_u2.y-c*this.m_u2.x;this.m_limitMass1=i.m_invMass+i.m_invI*n*n;this.m_limitMass2=r.m_invMass+r.m_invI*s*s;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;if(t.warmStarting){this.m_impulse*=t.dtRatio;this.m_limitImpulse1*=t.dtRatio;this.m_limitImpulse2*=t.dtRatio;t=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x;n=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y;s=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x;u=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;i.m_linearVelocity.x+=i.m_invMass*t;i.m_linearVelocity.y+=i.m_invMass*n;i.m_angularVelocity+=i.m_invI*(a*n-o*t);r.m_linearVelocity.x+=r.m_invMass*s;r.m_linearVelocity.y+=r.m_invMass*u;r.m_angularVelocity+=r.m_invI*(l*u-c*s)}else this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};M.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,i;i=e.m_xf.R;var n=this.m_localAnchor1.x-e.m_sweep.localCenter.x,a=this.m_localAnchor1.y-e.m_sweep.localCenter.y,o=i.col1.x*n+i.col2.x*a;a=i.col1.y*n+i.col2.y*a;n=o;i=t.m_xf.R;var s=this.m_localAnchor2.x-t.m_sweep.localCenter.x,l=this.m_localAnchor2.y-t.m_sweep.localCenter.y;o=i.col1.x*s+i.col2.x*l;l=i.col1.y*s+i.col2.y*l;s=o;var c=o=i=0,u=0;i=u=i=u=c=o=i=0;if(this.m_state==m.e_atUpperLimit){i=e.m_linearVelocity.x+-e.m_angularVelocity*a;o=e.m_linearVelocity.y+e.m_angularVelocity*n;c=t.m_linearVelocity.x+-t.m_angularVelocity*l;u=t.m_linearVelocity.y+t.m_angularVelocity*s;i=-(this.m_u1.x*i+this.m_u1.y*o)-this.m_ratio*(this.m_u2.x*c+this.m_u2.y*u);u=this.m_pulleyMass*-i;i=this.m_impulse;this.m_impulse=r.Max(0,this.m_impulse+u);u=this.m_impulse-i;i=-u*this.m_u1.x;o=-u*this.m_u1.y;c=-this.m_ratio*u*this.m_u2.x;u=-this.m_ratio*u*this.m_u2.y;e.m_linearVelocity.x+=e.m_invMass*i;e.m_linearVelocity.y+=e.m_invMass*o;e.m_angularVelocity+=e.m_invI*(n*o-a*i);t.m_linearVelocity.x+=t.m_invMass*c;t.m_linearVelocity.y+=t.m_invMass*u;t.m_angularVelocity+=t.m_invI*(s*u-l*c)}if(this.m_limitState1==m.e_atUpperLimit){i=e.m_linearVelocity.x+-e.m_angularVelocity*a;o=e.m_linearVelocity.y+e.m_angularVelocity*n;i=-(this.m_u1.x*i+this.m_u1.y*o);u=-this.m_limitMass1*i;i=this.m_limitImpulse1;this.m_limitImpulse1=r.Max(0,this.m_limitImpulse1+u);u=this.m_limitImpulse1-i;i=-u*this.m_u1.x;o=-u*this.m_u1.y;e.m_linearVelocity.x+=e.m_invMass*i;e.m_linearVelocity.y+=e.m_invMass*o;e.m_angularVelocity+=e.m_invI*(n*o-a*i)}if(this.m_limitState2==m.e_atUpperLimit){c=t.m_linearVelocity.x+-t.m_angularVelocity*l;u=t.m_linearVelocity.y+t.m_angularVelocity*s;i=-(this.m_u2.x*c+this.m_u2.y*u);u=-this.m_limitMass2*i;i=this.m_limitImpulse2;this.m_limitImpulse2=r.Max(0,this.m_limitImpulse2+u);u=this.m_limitImpulse2-i;c=-u*this.m_u2.x;u=-u*this.m_u2.y;t.m_linearVelocity.x+=t.m_invMass*c;t.m_linearVelocity.y+=t.m_invMass*u;t.m_angularVelocity+=t.m_invI*(s*u-l*c)}};M.prototype.SolvePositionConstraints=function(){var t=this.m_bodyA,i=this.m_bodyB,n,a=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,s=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,l=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,c=0,u=0,h=0,p=0,f=n=0,d=0,_=0,y=f=_=n=f=n=0;if(this.m_state==m.e_atUpperLimit){n=t.m_xf.R;c=this.m_localAnchor1.x-t.m_sweep.localCenter.x;u=this.m_localAnchor1.y-t.m_sweep.localCenter.y;f=n.col1.x*c+n.col2.x*u;u=n.col1.y*c+n.col2.y*u;c=f;n=i.m_xf.R;h=this.m_localAnchor2.x-i.m_sweep.localCenter.x;p=this.m_localAnchor2.y-i.m_sweep.localCenter.y;f=n.col1.x*h+n.col2.x*p;p=n.col1.y*h+n.col2.y*p;h=f;n=t.m_sweep.c.x+c;f=t.m_sweep.c.y+u;d=i.m_sweep.c.x+h;_=i.m_sweep.c.y+p;this.m_u1.Set(n-a,f-o);this.m_u2.Set(d-s,_-l);n=this.m_u1.Length();f=this.m_u2.Length();n>e.b2_linearSlop?this.m_u1.Multiply(1/n):this.m_u1.SetZero();f>e.b2_linearSlop?this.m_u2.Multiply(1/f):this.m_u2.SetZero();n=this.m_constant-n-this.m_ratio*f;y=r.Max(y,-n);n=r.Clamp(n+e.b2_linearSlop,-e.b2_maxLinearCorrection,0);_=-this.m_pulleyMass*n;n=-_*this.m_u1.x;f=-_*this.m_u1.y;d=-this.m_ratio*_*this.m_u2.x;_=-this.m_ratio*_*this.m_u2.y;t.m_sweep.c.x+=t.m_invMass*n;t.m_sweep.c.y+=t.m_invMass*f;t.m_sweep.a+=t.m_invI*(c*f-u*n);i.m_sweep.c.x+=i.m_invMass*d;i.m_sweep.c.y+=i.m_invMass*_;i.m_sweep.a+=i.m_invI*(h*_-p*d);t.SynchronizeTransform();i.SynchronizeTransform()}if(this.m_limitState1==m.e_atUpperLimit){n=t.m_xf.R;c=this.m_localAnchor1.x-t.m_sweep.localCenter.x;u=this.m_localAnchor1.y-t.m_sweep.localCenter.y;f=n.col1.x*c+n.col2.x*u;u=n.col1.y*c+n.col2.y*u;c=f;n=t.m_sweep.c.x+c;f=t.m_sweep.c.y+u;this.m_u1.Set(n-a,f-o);n=this.m_u1.Length();if(n>e.b2_linearSlop){this.m_u1.x*=1/n;this.m_u1.y*=1/n}else this.m_u1.SetZero();n=this.m_maxLength1-n;y=r.Max(y,-n);n=r.Clamp(n+e.b2_linearSlop,-e.b2_maxLinearCorrection,0);_=-this.m_limitMass1*n;n=-_*this.m_u1.x;f=-_*this.m_u1.y;t.m_sweep.c.x+=t.m_invMass*n;t.m_sweep.c.y+=t.m_invMass*f;t.m_sweep.a+=t.m_invI*(c*f-u*n);t.SynchronizeTransform()}if(this.m_limitState2==m.e_atUpperLimit){n=i.m_xf.R;h=this.m_localAnchor2.x-i.m_sweep.localCenter.x;p=this.m_localAnchor2.y-i.m_sweep.localCenter.y;f=n.col1.x*h+n.col2.x*p;p=n.col1.y*h+n.col2.y*p;h=f;d=i.m_sweep.c.x+h;_=i.m_sweep.c.y+p;this.m_u2.Set(d-s,_-l);f=this.m_u2.Length();if(f>e.b2_linearSlop){this.m_u2.x*=1/f;this.m_u2.y*=1/f}else this.m_u2.SetZero();n=this.m_maxLength2-f;y=r.Max(y,-n);n=r.Clamp(n+e.b2_linearSlop,-e.b2_maxLinearCorrection,0);_=-this.m_limitMass2*n;d=-_*this.m_u2.x;_=-_*this.m_u2.y;i.m_sweep.c.x+=i.m_invMass*d;i.m_sweep.c.y+=i.m_invMass*_;i.m_sweep.a+=i.m_invI*(h*_-p*d);i.SynchronizeTransform()}return y<e.b2_linearSlop};Box2D.postDefs.push((function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}));Box2D.inherit(w,Box2D.Dynamics.Joints.b2JointDef);w.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;w.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new n;this.groundAnchorB=new n;this.localAnchorA=new n;this.localAnchorB=new n};w.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=m.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=true};w.prototype.Initialize=function(e,t,i,r,n,a,o){if(o===undefined)o=0;this.bodyA=e;this.bodyB=t;this.groundAnchorA.SetV(i);this.groundAnchorB.SetV(r);this.localAnchorA=this.bodyA.GetLocalPoint(n);this.localAnchorB=this.bodyB.GetLocalPoint(a);e=n.x-i.x;i=n.y-i.y;this.lengthA=Math.sqrt(e*e+i*i);i=a.x-r.x;r=a.y-r.y;this.lengthB=Math.sqrt(i*i+r*r);this.ratio=o;o=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=o-this.ratio*M.b2_minPulleyLength;this.maxLengthB=(o-M.b2_minPulleyLength)/this.ratio};Box2D.inherit(S,Box2D.Dynamics.Joints.b2Joint);S.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;S.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new t;this.K1=new t;this.K2=new t;this.K3=new t;this.impulse3=new a;this.impulse2=new n;this.reduced=new n;this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_impulse=new a;this.m_mass=new i};S.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};S.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};S.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new n(e*this.m_impulse.x,e*this.m_impulse.y)};S.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;return e*this.m_impulse.z};S.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};S.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};S.prototype.IsLimitEnabled=function(){return this.m_enableLimit};S.prototype.EnableLimit=function(e){this.m_enableLimit=e};S.prototype.GetLowerLimit=function(){return this.m_lowerAngle};S.prototype.GetUpperLimit=function(){return this.m_upperAngle};S.prototype.SetLimits=function(e,t){if(e===undefined)e=0;if(t===undefined)t=0;this.m_lowerAngle=e;this.m_upperAngle=t};S.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);return this.m_enableMotor};S.prototype.EnableMotor=function(e){this.m_enableMotor=e};S.prototype.SetMotorSpeed=function(e){if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=e};S.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};S.prototype.SetMaxMotorTorque=function(e){if(e===undefined)e=0;this.m_maxMotorTorque=e};S.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};S.prototype.b2RevoluteJoint=function(e){this.__super.b2Joint.call(this,e);this.m_localAnchor1.SetV(e.localAnchorA);this.m_localAnchor2.SetV(e.localAnchorB);this.m_referenceAngle=e.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=e.lowerAngle;this.m_upperAngle=e.upperAngle;this.m_maxMotorTorque=e.maxMotorTorque;this.m_motorSpeed=e.motorSpeed;this.m_enableLimit=e.enableLimit;this.m_enableMotor=e.enableMotor;this.m_limitState=m.e_inactiveLimit};S.prototype.InitVelocityConstraints=function(t){var i=this.m_bodyA,n=this.m_bodyB,a,o=0;a=i.m_xf.R;var s=this.m_localAnchor1.x-i.m_sweep.localCenter.x,l=this.m_localAnchor1.y-i.m_sweep.localCenter.y;o=a.col1.x*s+a.col2.x*l;l=a.col1.y*s+a.col2.y*l;s=o;a=n.m_xf.R;var c=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y;o=a.col1.x*c+a.col2.x*u;u=a.col1.y*c+a.col2.y*u;c=o;a=i.m_invMass;o=n.m_invMass;var h=i.m_invI,p=n.m_invI;this.m_mass.col1.x=a+o+l*l*h+u*u*p;this.m_mass.col2.x=-l*s*h-u*c*p;this.m_mass.col3.x=-l*h-u*p;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=a+o+s*s*h+c*c*p;this.m_mass.col3.y=s*h+c*p;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=h+p;this.m_motorMass=1/(h+p);if(this.m_enableMotor==false)this.m_motorImpulse=0;if(this.m_enableLimit){var f=n.m_sweep.a-i.m_sweep.a-this.m_referenceAngle;if(r.Abs(this.m_upperAngle-this.m_lowerAngle)<2*e.b2_angularSlop)this.m_limitState=m.e_equalLimits;else if(f<=this.m_lowerAngle){if(this.m_limitState!=m.e_atLowerLimit)this.m_impulse.z=0;this.m_limitState=m.e_atLowerLimit}else if(f>=this.m_upperAngle){if(this.m_limitState!=m.e_atUpperLimit)this.m_impulse.z=0;this.m_limitState=m.e_atUpperLimit}else{this.m_limitState=m.e_inactiveLimit;this.m_impulse.z=0}}else this.m_limitState=m.e_inactiveLimit;if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;t=this.m_impulse.x;f=this.m_impulse.y;i.m_linearVelocity.x-=a*t;i.m_linearVelocity.y-=a*f;i.m_angularVelocity-=h*(s*f-l*t+this.m_motorImpulse+this.m_impulse.z);n.m_linearVelocity.x+=o*t;n.m_linearVelocity.y+=o*f;n.m_angularVelocity+=p*(c*f-u*t+this.m_motorImpulse+this.m_impulse.z)}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};S.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,i=this.m_bodyB,n=0,a=n=0,o=0,s=0,l=0,c=t.m_linearVelocity,u=t.m_angularVelocity,h=i.m_linearVelocity,p=i.m_angularVelocity,f=t.m_invMass,d=i.m_invMass,_=t.m_invI,y=i.m_invI;if(this.m_enableMotor&&this.m_limitState!=m.e_equalLimits){a=this.m_motorMass*-(p-u-this.m_motorSpeed);o=this.m_motorImpulse;s=e.dt*this.m_maxMotorTorque;this.m_motorImpulse=r.Clamp(this.m_motorImpulse+a,-s,s);a=this.m_motorImpulse-o;u-=_*a;p+=y*a}if(this.m_enableLimit&&this.m_limitState!=m.e_inactiveLimit){e=t.m_xf.R;a=this.m_localAnchor1.x-t.m_sweep.localCenter.x;o=this.m_localAnchor1.y-t.m_sweep.localCenter.y;n=e.col1.x*a+e.col2.x*o;o=e.col1.y*a+e.col2.y*o;a=n;e=i.m_xf.R;s=this.m_localAnchor2.x-i.m_sweep.localCenter.x;l=this.m_localAnchor2.y-i.m_sweep.localCenter.y;n=e.col1.x*s+e.col2.x*l;l=e.col1.y*s+e.col2.y*l;s=n;e=h.x+-p*l-c.x- -u*o;var v=h.y+p*s-c.y-u*a;this.m_mass.Solve33(this.impulse3,-e,-v,-(p-u));if(this.m_limitState==m.e_equalLimits)this.m_impulse.Add(this.impulse3);else if(this.m_limitState==m.e_atLowerLimit){n=this.m_impulse.z+this.impulse3.z;if(n<0){this.m_mass.Solve22(this.reduced,-e,-v);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}else if(this.m_limitState==m.e_atUpperLimit){n=this.m_impulse.z+this.impulse3.z;if(n>0){this.m_mass.Solve22(this.reduced,-e,-v);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}c.x-=f*this.impulse3.x;c.y-=f*this.impulse3.y;u-=_*(a*this.impulse3.y-o*this.impulse3.x+this.impulse3.z);h.x+=d*this.impulse3.x;h.y+=d*this.impulse3.y;p+=y*(s*this.impulse3.y-l*this.impulse3.x+this.impulse3.z)}else{e=t.m_xf.R;a=this.m_localAnchor1.x-t.m_sweep.localCenter.x;o=this.m_localAnchor1.y-t.m_sweep.localCenter.y;n=e.col1.x*a+e.col2.x*o;o=e.col1.y*a+e.col2.y*o;a=n;e=i.m_xf.R;s=this.m_localAnchor2.x-i.m_sweep.localCenter.x;l=this.m_localAnchor2.y-i.m_sweep.localCenter.y;n=e.col1.x*s+e.col2.x*l;l=e.col1.y*s+e.col2.y*l;s=n;this.m_mass.Solve22(this.impulse2,-(h.x+-p*l-c.x- -u*o),-(h.y+p*s-c.y-u*a));this.m_impulse.x+=this.impulse2.x;this.m_impulse.y+=this.impulse2.y;c.x-=f*this.impulse2.x;c.y-=f*this.impulse2.y;u-=_*(a*this.impulse2.y-o*this.impulse2.x);h.x+=d*this.impulse2.x;h.y+=d*this.impulse2.y;p+=y*(s*this.impulse2.y-l*this.impulse2.x)}t.m_linearVelocity.SetV(c);t.m_angularVelocity=u;i.m_linearVelocity.SetV(h);i.m_angularVelocity=p};S.prototype.SolvePositionConstraints=function(){var t=0,i,n=this.m_bodyA,a=this.m_bodyB,o=0,s=i=0,l=0,c=0;if(this.m_enableLimit&&this.m_limitState!=m.e_inactiveLimit){t=a.m_sweep.a-n.m_sweep.a-this.m_referenceAngle;var u=0;if(this.m_limitState==m.e_equalLimits){t=r.Clamp(t-this.m_lowerAngle,-e.b2_maxAngularCorrection,e.b2_maxAngularCorrection);u=-this.m_motorMass*t;o=r.Abs(t)}else if(this.m_limitState==m.e_atLowerLimit){t=t-this.m_lowerAngle;o=-t;t=r.Clamp(t+e.b2_angularSlop,-e.b2_maxAngularCorrection,0);u=-this.m_motorMass*t}else if(this.m_limitState==m.e_atUpperLimit){o=t=t-this.m_upperAngle;t=r.Clamp(t-e.b2_angularSlop,0,e.b2_maxAngularCorrection);u=-this.m_motorMass*t}n.m_sweep.a-=n.m_invI*u;a.m_sweep.a+=a.m_invI*u;n.SynchronizeTransform();a.SynchronizeTransform()}i=n.m_xf.R;u=this.m_localAnchor1.x-n.m_sweep.localCenter.x;t=this.m_localAnchor1.y-n.m_sweep.localCenter.y;s=i.col1.x*u+i.col2.x*t;t=i.col1.y*u+i.col2.y*t;u=s;i=a.m_xf.R;var h=this.m_localAnchor2.x-a.m_sweep.localCenter.x,p=this.m_localAnchor2.y-a.m_sweep.localCenter.y;s=i.col1.x*h+i.col2.x*p;p=i.col1.y*h+i.col2.y*p;h=s;l=a.m_sweep.c.x+h-n.m_sweep.c.x-u;c=a.m_sweep.c.y+p-n.m_sweep.c.y-t;var f=l*l+c*c;i=Math.sqrt(f);s=n.m_invMass;var d=a.m_invMass,_=n.m_invI,y=a.m_invI,v=10*e.b2_linearSlop;if(f>v*v){f=1/(s+d);l=f*-l;c=f*-c;n.m_sweep.c.x-=.5*s*l;n.m_sweep.c.y-=.5*s*c;a.m_sweep.c.x+=.5*d*l;a.m_sweep.c.y+=.5*d*c;l=a.m_sweep.c.x+h-n.m_sweep.c.x-u;c=a.m_sweep.c.y+p-n.m_sweep.c.y-t}this.K1.col1.x=s+d;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=s+d;this.K2.col1.x=_*t*t;this.K2.col2.x=-_*u*t;this.K2.col1.y=-_*u*t;this.K2.col2.y=_*u*u;this.K3.col1.x=y*p*p;this.K3.col2.x=-y*h*p;this.K3.col1.y=-y*h*p;this.K3.col2.y=y*h*h;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(S.tImpulse,-l,-c);l=S.tImpulse.x;c=S.tImpulse.y;n.m_sweep.c.x-=n.m_invMass*l;n.m_sweep.c.y-=n.m_invMass*c;n.m_sweep.a-=n.m_invI*(u*c-t*l);a.m_sweep.c.x+=a.m_invMass*l;a.m_sweep.c.y+=a.m_invMass*c;a.m_sweep.a+=a.m_invI*(h*c-p*l);n.SynchronizeTransform();a.SynchronizeTransform();return i<=e.b2_linearSlop&&o<=e.b2_angularSlop};Box2D.postDefs.push((function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new n}));Box2D.inherit(A,Box2D.Dynamics.Joints.b2JointDef);A.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;A.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n};A.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=m.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=false};A.prototype.Initialize=function(e,t,i){this.bodyA=e;this.bodyB=t;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(C,Box2D.Dynamics.Joints.b2Joint);C.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;C.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_impulse=new a;this.m_mass=new i};C.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};C.prototype.GetReactionForce=function(e){if(e===undefined)e=0;return new n(e*this.m_impulse.x,e*this.m_impulse.y)};C.prototype.GetReactionTorque=function(e){if(e===undefined)e=0;return e*this.m_impulse.z};C.prototype.b2WeldJoint=function(e){this.__super.b2Joint.call(this,e);this.m_localAnchorA.SetV(e.localAnchorA);this.m_localAnchorB.SetV(e.localAnchorB);this.m_referenceAngle=e.referenceAngle;this.m_impulse.SetZero();this.m_mass=new i};C.prototype.InitVelocityConstraints=function(e){var t,i=0,r=this.m_bodyA,n=this.m_bodyB;t=r.m_xf.R;var a=this.m_localAnchorA.x-r.m_sweep.localCenter.x,o=this.m_localAnchorA.y-r.m_sweep.localCenter.y;i=t.col1.x*a+t.col2.x*o;o=t.col1.y*a+t.col2.y*o;a=i;t=n.m_xf.R;var s=this.m_localAnchorB.x-n.m_sweep.localCenter.x,l=this.m_localAnchorB.y-n.m_sweep.localCenter.y;i=t.col1.x*s+t.col2.x*l;l=t.col1.y*s+t.col2.y*l;s=i;t=r.m_invMass;i=n.m_invMass;var c=r.m_invI,u=n.m_invI;this.m_mass.col1.x=t+i+o*o*c+l*l*u;this.m_mass.col2.x=-o*a*c-l*s*u;this.m_mass.col3.x=-o*c-l*u;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=t+i+a*a*c+s*s*u;this.m_mass.col3.y=a*c+s*u;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=c+u;if(e.warmStarting){this.m_impulse.x*=e.dtRatio;this.m_impulse.y*=e.dtRatio;this.m_impulse.z*=e.dtRatio;r.m_linearVelocity.x-=t*this.m_impulse.x;r.m_linearVelocity.y-=t*this.m_impulse.y;r.m_angularVelocity-=c*(a*this.m_impulse.y-o*this.m_impulse.x+this.m_impulse.z);n.m_linearVelocity.x+=i*this.m_impulse.x;n.m_linearVelocity.y+=i*this.m_impulse.y;n.m_angularVelocity+=u*(s*this.m_impulse.y-l*this.m_impulse.x+this.m_impulse.z)}else this.m_impulse.SetZero()};C.prototype.SolveVelocityConstraints=function(){var e,t=0,i=this.m_bodyA,r=this.m_bodyB,n=i.m_linearVelocity,o=i.m_angularVelocity,s=r.m_linearVelocity,l=r.m_angularVelocity,c=i.m_invMass,u=r.m_invMass,h=i.m_invI,p=r.m_invI;e=i.m_xf.R;var m=this.m_localAnchorA.x-i.m_sweep.localCenter.x,f=this.m_localAnchorA.y-i.m_sweep.localCenter.y;t=e.col1.x*m+e.col2.x*f;f=e.col1.y*m+e.col2.y*f;m=t;e=r.m_xf.R;var d=this.m_localAnchorB.x-r.m_sweep.localCenter.x,_=this.m_localAnchorB.y-r.m_sweep.localCenter.y;t=e.col1.x*d+e.col2.x*_;_=e.col1.y*d+e.col2.y*_;d=t;e=s.x-l*_-n.x+o*f;t=s.y+l*d-n.y-o*m;var y=l-o,v=new a;this.m_mass.Solve33(v,-e,-t,-y);this.m_impulse.Add(v);n.x-=c*v.x;n.y-=c*v.y;o-=h*(m*v.y-f*v.x+v.z);s.x+=u*v.x;s.y+=u*v.y;l+=p*(d*v.y-_*v.x+v.z);i.m_angularVelocity=o;r.m_angularVelocity=l};C.prototype.SolvePositionConstraints=function(){var t,i=0,n=this.m_bodyA,o=this.m_bodyB;t=n.m_xf.R;var s=this.m_localAnchorA.x-n.m_sweep.localCenter.x,l=this.m_localAnchorA.y-n.m_sweep.localCenter.y;i=t.col1.x*s+t.col2.x*l;l=t.col1.y*s+t.col2.y*l;s=i;t=o.m_xf.R;var c=this.m_localAnchorB.x-o.m_sweep.localCenter.x,u=this.m_localAnchorB.y-o.m_sweep.localCenter.y;i=t.col1.x*c+t.col2.x*u;u=t.col1.y*c+t.col2.y*u;c=i;t=n.m_invMass;i=o.m_invMass;var h=n.m_invI,p=o.m_invI,m=o.m_sweep.c.x+c-n.m_sweep.c.x-s,f=o.m_sweep.c.y+u-n.m_sweep.c.y-l,d=o.m_sweep.a-n.m_sweep.a-this.m_referenceAngle,_=10*e.b2_linearSlop,y=Math.sqrt(m*m+f*f),v=r.Abs(d);if(y>_){h*=1;p*=1}this.m_mass.col1.x=t+i+l*l*h+u*u*p;this.m_mass.col2.x=-l*s*h-u*c*p;this.m_mass.col3.x=-l*h-u*p;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=t+i+s*s*h+c*c*p;this.m_mass.col3.y=s*h+c*p;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=h+p;_=new a;this.m_mass.Solve33(_,-m,-f,-d);n.m_sweep.c.x-=t*_.x;n.m_sweep.c.y-=t*_.y;n.m_sweep.a-=h*(s*_.y-l*_.x+_.z);o.m_sweep.c.x+=i*_.x;o.m_sweep.c.y+=i*_.y;o.m_sweep.a+=p*(c*_.y-u*_.x+_.z);n.SynchronizeTransform();o.SynchronizeTransform();return y<=e.b2_linearSlop&&v<=e.b2_angularSlop};Box2D.inherit(T,Box2D.Dynamics.Joints.b2JointDef);T.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;T.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n};T.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=m.e_weldJoint;this.referenceAngle=0};T.prototype.Initialize=function(e,t,i){this.bodyA=e;this.bodyB=t;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();(function(){var e=Box2D.Dynamics.b2DebugDraw;e.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var e=this;this.m_sprite={graphics:{clear:function(){e.m_ctx.clearRect(0,0,e.m_ctx.canvas.width,e.m_ctx.canvas.height)}}}};e.prototype._color=function(e,t){return"rgba("+((e&16711680)>>16)+","+((e&65280)>>8)+","+(e&255)+","+t+")"};e.prototype.b2DebugDraw=function(){this.m_drawFlags=0};e.prototype.SetFlags=function(e){if(e===undefined)e=0;this.m_drawFlags=e};e.prototype.GetFlags=function(){return this.m_drawFlags};e.prototype.AppendFlags=function(e){if(e===undefined)e=0;this.m_drawFlags|=e};e.prototype.ClearFlags=function(e){if(e===undefined)e=0;this.m_drawFlags&=~e};e.prototype.SetSprite=function(e){this.m_ctx=e};e.prototype.GetSprite=function(){return this.m_ctx};e.prototype.SetDrawScale=function(e){if(e===undefined)e=0;this.m_drawScale=e};e.prototype.GetDrawScale=function(){return this.m_drawScale};e.prototype.SetLineThickness=function(e){if(e===undefined)e=0;this.m_lineThickness=e;this.m_ctx.strokeWidth=e};e.prototype.GetLineThickness=function(){return this.m_lineThickness};e.prototype.SetAlpha=function(e){if(e===undefined)e=0;this.m_alpha=e};e.prototype.GetAlpha=function(){return this.m_alpha};e.prototype.SetFillAlpha=function(e){if(e===undefined)e=0;this.m_fillAlpha=e};e.prototype.GetFillAlpha=function(){return this.m_fillAlpha};e.prototype.SetXFormScale=function(e){if(e===undefined)e=0;this.m_xformScale=e};e.prototype.GetXFormScale=function(){return this.m_xformScale};e.prototype.DrawPolygon=function(e,t,i){if(t){var r=this.m_ctx,n=this.m_drawScale;r.beginPath();r.strokeStyle=this._color(i.color,this.m_alpha);r.moveTo(e[0].x*n,e[0].y*n);for(i=1;i<t;i++)r.lineTo(e[i].x*n,e[i].y*n);r.lineTo(e[0].x*n,e[0].y*n);r.closePath();r.stroke()}};e.prototype.DrawSolidPolygon=function(e,t,i){if(t){var r=this.m_ctx,n=this.m_drawScale;r.beginPath();r.strokeStyle=this._color(i.color,this.m_alpha);r.fillStyle=this._color(i.color,this.m_fillAlpha);r.moveTo(e[0].x*n,e[0].y*n);for(i=1;i<t;i++)r.lineTo(e[i].x*n,e[i].y*n);r.lineTo(e[0].x*n,e[0].y*n);r.closePath();r.fill();r.stroke()}};e.prototype.DrawCircle=function(e,t,i){if(t){var r=this.m_ctx,n=this.m_drawScale;r.beginPath();r.strokeStyle=this._color(i.color,this.m_alpha);r.arc(e.x*n,e.y*n,t*n,0,Math.PI*2,true);r.closePath();r.stroke()}};e.prototype.DrawSolidCircle=function(e,t,i,r){if(t){var n=this.m_ctx,a=this.m_drawScale,o=e.x*a,s=e.y*a;n.moveTo(0,0);n.beginPath();n.strokeStyle=this._color(r.color,this.m_alpha);n.fillStyle=this._color(r.color,this.m_fillAlpha);n.arc(o,s,t*a,0,Math.PI*2,true);n.moveTo(o,s);n.lineTo((e.x+i.x*t)*a,(e.y+i.y*t)*a);n.closePath();n.fill();n.stroke()}};e.prototype.DrawSegment=function(e,t,i){var r=this.m_ctx,n=this.m_drawScale;r.strokeStyle=this._color(i.color,this.m_alpha);r.beginPath();r.moveTo(e.x*n,e.y*n);r.lineTo(t.x*n,t.y*n);r.closePath();r.stroke()};e.prototype.DrawTransform=function(e){var t=this.m_ctx,i=this.m_drawScale;t.beginPath();t.strokeStyle=this._color(16711680,this.m_alpha);t.moveTo(e.position.x*i,e.position.y*i);t.lineTo((e.position.x+this.m_xformScale*e.R.col1.x)*i,(e.position.y+this.m_xformScale*e.R.col1.y)*i);t.strokeStyle=this._color(65280,this.m_alpha);t.moveTo(e.position.x*i,e.position.y*i);t.lineTo((e.position.x+this.m_xformScale*e.R.col2.x)*i,(e.position.y+this.m_xformScale*e.R.col2.y)*i);t.closePath();t.stroke()}})();var i$1;for(i$1=0;i$1<Box2D.postDefs.length;++i$1)Box2D.postDefs[i$1]();delete Box2D.postDefs;module.exports={Maze:Maze,Box2D:Box2D,THREE:THREE};