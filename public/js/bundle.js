const Maze={generate(t){var e=new Array(t);e.dimension=t;for(var i=0;i<t;i++){e[i]=new Array(t);for(var o=0;o<t;o++){e[i][o]=true}}e=this.iterate(e,1,1);return e},iterate(t,e,i){t[e][i]=false;while(true){let o=[];if(e>1&&t[e-2][i]==true){o.push([-1,0])}if(e<t.dimension-2&&t[e+2][i]==true){o.push([1,0])}if(i>1&&t[e][i-2]==true){o.push([0,-1])}if(i<t.dimension-2&&t[e][i+2]==true){o.push([0,1])}if(o.length==0){return t}let r=o[Math.floor(Math.random()*o.length)];t[e+r[0]][i+r[1]]=false;t=this.iterate(t,e+r[0]*2,i+r[1]*2)}}};var Box2D={};(function(t,e){if(!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function){Object.defineProperty=function(t,e,i){if(i.get instanceof Function)t.__defineGetter__(e,i.get);if(i.set instanceof Function)t.__defineSetter__(e,i.set)}}function i(){}t.inherit=function(t,e){var o=t;i.prototype=e.prototype;t.prototype=new i;t.prototype.constructor=o};t.generateCallback=function t(e,i){return function(){i.apply(e,arguments)}};t.NVector=function t(i){if(i===e)i=0;var o=new Array(i||0);for(var r=0;r<i;++r)o[r]=0;return o};t.is=function t(i,o){if(i===null)return false;if(o instanceof Function&&i instanceof o)return true;if(i.constructor.__implements!=e&&i.constructor.__implements[o])return true;return false};t.parseUInt=function(t){return Math.abs(parseInt(t))}})(Box2D);var Vector=Array;var Vector_a2j_Number=Box2D.NVector;if(typeof Box2D==="undefined")Box2D={};if(typeof Box2D.Collision==="undefined")Box2D.Collision={};if(typeof Box2D.Collision.Shapes==="undefined")Box2D.Collision.Shapes={};if(typeof Box2D.Common==="undefined")Box2D.Common={};if(typeof Box2D.Common.Math==="undefined")Box2D.Common.Math={};if(typeof Box2D.Dynamics==="undefined")Box2D.Dynamics={};if(typeof Box2D.Dynamics.Contacts==="undefined")Box2D.Dynamics.Contacts={};if(typeof Box2D.Dynamics.Controllers==="undefined")Box2D.Dynamics.Controllers={};if(typeof Box2D.Dynamics.Joints==="undefined")Box2D.Dynamics.Joints={};(function(){Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";function t(){t.b2AABB.apply(this,arguments)}Box2D.Collision.b2AABB=t;function e(){e.b2Bound.apply(this,arguments)}Box2D.Collision.b2Bound=e;function i(){i.b2BoundValues.apply(this,arguments);if(this.constructor===i)this.b2BoundValues.apply(this,arguments)}Box2D.Collision.b2BoundValues=i;function o(){o.b2Collision.apply(this,arguments)}Box2D.Collision.b2Collision=o;function r(){r.b2ContactID.apply(this,arguments);if(this.constructor===r)this.b2ContactID.apply(this,arguments)}Box2D.Collision.b2ContactID=r;function n(){n.b2ContactPoint.apply(this,arguments)}Box2D.Collision.b2ContactPoint=n;function a(){a.b2Distance.apply(this,arguments)}Box2D.Collision.b2Distance=a;function s(){s.b2DistanceInput.apply(this,arguments)}Box2D.Collision.b2DistanceInput=s;function l(){l.b2DistanceOutput.apply(this,arguments)}Box2D.Collision.b2DistanceOutput=l;function c(){c.b2DistanceProxy.apply(this,arguments)}Box2D.Collision.b2DistanceProxy=c;function h(){h.b2DynamicTree.apply(this,arguments);if(this.constructor===h)this.b2DynamicTree.apply(this,arguments)}Box2D.Collision.b2DynamicTree=h;function m(){m.b2DynamicTreeBroadPhase.apply(this,arguments)}Box2D.Collision.b2DynamicTreeBroadPhase=m;function p(){p.b2DynamicTreeNode.apply(this,arguments)}Box2D.Collision.b2DynamicTreeNode=p;function u(){u.b2DynamicTreePair.apply(this,arguments)}Box2D.Collision.b2DynamicTreePair=u;function f(){f.b2Manifold.apply(this,arguments);if(this.constructor===f)this.b2Manifold.apply(this,arguments)}Box2D.Collision.b2Manifold=f;function y(){y.b2ManifoldPoint.apply(this,arguments);if(this.constructor===y)this.b2ManifoldPoint.apply(this,arguments)}Box2D.Collision.b2ManifoldPoint=y;function d(){d.b2Point.apply(this,arguments)}Box2D.Collision.b2Point=d;function _(){_.b2RayCastInput.apply(this,arguments);if(this.constructor===_)this.b2RayCastInput.apply(this,arguments)}Box2D.Collision.b2RayCastInput=_;function v(){v.b2RayCastOutput.apply(this,arguments)}Box2D.Collision.b2RayCastOutput=v;function x(){x.b2Segment.apply(this,arguments)}Box2D.Collision.b2Segment=x;function E(){E.b2SeparationFunction.apply(this,arguments)}Box2D.Collision.b2SeparationFunction=E;function g(){g.b2Simplex.apply(this,arguments);if(this.constructor===g)this.b2Simplex.apply(this,arguments)}Box2D.Collision.b2Simplex=g;function b(){b.b2SimplexCache.apply(this,arguments)}Box2D.Collision.b2SimplexCache=b;function T(){T.b2SimplexVertex.apply(this,arguments)}Box2D.Collision.b2SimplexVertex=T;function R(){R.b2TimeOfImpact.apply(this,arguments)}Box2D.Collision.b2TimeOfImpact=R;function w(){w.b2TOIInput.apply(this,arguments)}Box2D.Collision.b2TOIInput=w;function S(){S.b2WorldManifold.apply(this,arguments);if(this.constructor===S)this.b2WorldManifold.apply(this,arguments)}Box2D.Collision.b2WorldManifold=S;function C(){C.ClipVertex.apply(this,arguments)}Box2D.Collision.ClipVertex=C;function A(){A.Features.apply(this,arguments)}Box2D.Collision.Features=A;function M(){M.b2CircleShape.apply(this,arguments);if(this.constructor===M)this.b2CircleShape.apply(this,arguments)}Box2D.Collision.Shapes.b2CircleShape=M;function D(){D.b2EdgeChainDef.apply(this,arguments);if(this.constructor===D)this.b2EdgeChainDef.apply(this,arguments)}Box2D.Collision.Shapes.b2EdgeChainDef=D;function B(){B.b2EdgeShape.apply(this,arguments);if(this.constructor===B)this.b2EdgeShape.apply(this,arguments)}Box2D.Collision.Shapes.b2EdgeShape=B;function H(){H.b2MassData.apply(this,arguments)}Box2D.Collision.Shapes.b2MassData=H;function V(){V.b2PolygonShape.apply(this,arguments);if(this.constructor===V)this.b2PolygonShape.apply(this,arguments)}Box2D.Collision.Shapes.b2PolygonShape=V;function L(){L.b2Shape.apply(this,arguments);if(this.constructor===L)this.b2Shape.apply(this,arguments)}Box2D.Collision.Shapes.b2Shape=L;Box2D.Common.b2internal="Box2D.Common.b2internal";function P(){P.b2Color.apply(this,arguments);if(this.constructor===P)this.b2Color.apply(this,arguments)}Box2D.Common.b2Color=P;function F(){F.b2Settings.apply(this,arguments)}Box2D.Common.b2Settings=F;function I(){I.b2Mat22.apply(this,arguments);if(this.constructor===I)this.b2Mat22.apply(this,arguments)}Box2D.Common.Math.b2Mat22=I;function U(){U.b2Mat33.apply(this,arguments);if(this.constructor===U)this.b2Mat33.apply(this,arguments)}Box2D.Common.Math.b2Mat33=U;function G(){G.b2Math.apply(this,arguments)}Box2D.Common.Math.b2Math=G;function z(){z.b2Sweep.apply(this,arguments)}Box2D.Common.Math.b2Sweep=z;function N(){N.b2Transform.apply(this,arguments);if(this.constructor===N)this.b2Transform.apply(this,arguments)}Box2D.Common.Math.b2Transform=N;function k(){k.b2Vec2.apply(this,arguments);if(this.constructor===k)this.b2Vec2.apply(this,arguments)}Box2D.Common.Math.b2Vec2=k;function O(){O.b2Vec3.apply(this,arguments);if(this.constructor===O)this.b2Vec3.apply(this,arguments)}Box2D.Common.Math.b2Vec3=O;function W(){W.b2Body.apply(this,arguments);if(this.constructor===W)this.b2Body.apply(this,arguments)}Box2D.Dynamics.b2Body=W;function j(){j.b2BodyDef.apply(this,arguments);if(this.constructor===j)this.b2BodyDef.apply(this,arguments)}Box2D.Dynamics.b2BodyDef=j;function J(){J.b2ContactFilter.apply(this,arguments)}Box2D.Dynamics.b2ContactFilter=J;function X(){X.b2ContactImpulse.apply(this,arguments)}Box2D.Dynamics.b2ContactImpulse=X;function q(){q.b2ContactListener.apply(this,arguments)}Box2D.Dynamics.b2ContactListener=q;function Y(){Y.b2ContactManager.apply(this,arguments);if(this.constructor===Y)this.b2ContactManager.apply(this,arguments)}Box2D.Dynamics.b2ContactManager=Y;function K(){K.b2DebugDraw.apply(this,arguments);if(this.constructor===K)this.b2DebugDraw.apply(this,arguments)}Box2D.Dynamics.b2DebugDraw=K;function Z(){Z.b2DestructionListener.apply(this,arguments)}Box2D.Dynamics.b2DestructionListener=Z;function Q(){Q.b2FilterData.apply(this,arguments)}Box2D.Dynamics.b2FilterData=Q;function $(){$.b2Fixture.apply(this,arguments);if(this.constructor===$)this.b2Fixture.apply(this,arguments)}Box2D.Dynamics.b2Fixture=$;function tt(){tt.b2FixtureDef.apply(this,arguments);if(this.constructor===tt)this.b2FixtureDef.apply(this,arguments)}Box2D.Dynamics.b2FixtureDef=tt;function et(){et.b2Island.apply(this,arguments);if(this.constructor===et)this.b2Island.apply(this,arguments)}Box2D.Dynamics.b2Island=et;function it(){it.b2TimeStep.apply(this,arguments)}Box2D.Dynamics.b2TimeStep=it;function ot(){ot.b2World.apply(this,arguments);if(this.constructor===ot)this.b2World.apply(this,arguments)}Box2D.Dynamics.b2World=ot;function rt(){rt.b2CircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2CircleContact=rt;function nt(){nt.b2Contact.apply(this,arguments);if(this.constructor===nt)this.b2Contact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2Contact=nt;function at(){at.b2ContactConstraint.apply(this,arguments);if(this.constructor===at)this.b2ContactConstraint.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactConstraint=at;function st(){st.b2ContactConstraintPoint.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactConstraintPoint=st;function lt(){lt.b2ContactEdge.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactEdge=lt;function ct(){ct.b2ContactFactory.apply(this,arguments);if(this.constructor===ct)this.b2ContactFactory.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactFactory=ct;function ht(){ht.b2ContactRegister.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactRegister=ht;function mt(){mt.b2ContactResult.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactResult=mt;function pt(){pt.b2ContactSolver.apply(this,arguments);if(this.constructor===pt)this.b2ContactSolver.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactSolver=pt;function ut(){ut.b2EdgeAndCircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=ut;function ft(){ft.b2NullContact.apply(this,arguments);if(this.constructor===ft)this.b2NullContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2NullContact=ft;function yt(){yt.b2PolyAndCircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolyAndCircleContact=yt;function dt(){dt.b2PolyAndEdgeContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=dt;function _t(){_t.b2PolygonContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolygonContact=_t;function vt(){vt.b2PositionSolverManifold.apply(this,arguments);if(this.constructor===vt)this.b2PositionSolverManifold.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PositionSolverManifold=vt;function xt(){xt.b2BuoyancyController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2BuoyancyController=xt;function Et(){Et.b2ConstantAccelController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ConstantAccelController=Et;function gt(){gt.b2ConstantForceController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ConstantForceController=gt;function bt(){bt.b2Controller.apply(this,arguments)}Box2D.Dynamics.Controllers.b2Controller=bt;function Tt(){Tt.b2ControllerEdge.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ControllerEdge=Tt;function Rt(){Rt.b2GravityController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2GravityController=Rt;function wt(){wt.b2TensorDampingController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2TensorDampingController=wt;function St(){St.b2DistanceJoint.apply(this,arguments);if(this.constructor===St)this.b2DistanceJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2DistanceJoint=St;function Ct(){Ct.b2DistanceJointDef.apply(this,arguments);if(this.constructor===Ct)this.b2DistanceJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2DistanceJointDef=Ct;function At(){At.b2FrictionJoint.apply(this,arguments);if(this.constructor===At)this.b2FrictionJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2FrictionJoint=At;function Mt(){Mt.b2FrictionJointDef.apply(this,arguments);if(this.constructor===Mt)this.b2FrictionJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2FrictionJointDef=Mt;function Dt(){Dt.b2GearJoint.apply(this,arguments);if(this.constructor===Dt)this.b2GearJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2GearJoint=Dt;function Bt(){Bt.b2GearJointDef.apply(this,arguments);if(this.constructor===Bt)this.b2GearJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2GearJointDef=Bt;function Ht(){Ht.b2Jacobian.apply(this,arguments)}Box2D.Dynamics.Joints.b2Jacobian=Ht;function Vt(){Vt.b2Joint.apply(this,arguments);if(this.constructor===Vt)this.b2Joint.apply(this,arguments)}Box2D.Dynamics.Joints.b2Joint=Vt;function Lt(){Lt.b2JointDef.apply(this,arguments);if(this.constructor===Lt)this.b2JointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2JointDef=Lt;function Pt(){Pt.b2JointEdge.apply(this,arguments)}Box2D.Dynamics.Joints.b2JointEdge=Pt;function Ft(){Ft.b2LineJoint.apply(this,arguments);if(this.constructor===Ft)this.b2LineJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2LineJoint=Ft;function It(){It.b2LineJointDef.apply(this,arguments);if(this.constructor===It)this.b2LineJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2LineJointDef=It;function Ut(){Ut.b2MouseJoint.apply(this,arguments);if(this.constructor===Ut)this.b2MouseJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2MouseJoint=Ut;function Gt(){Gt.b2MouseJointDef.apply(this,arguments);if(this.constructor===Gt)this.b2MouseJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2MouseJointDef=Gt;function zt(){zt.b2PrismaticJoint.apply(this,arguments);if(this.constructor===zt)this.b2PrismaticJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2PrismaticJoint=zt;function Nt(){Nt.b2PrismaticJointDef.apply(this,arguments);if(this.constructor===Nt)this.b2PrismaticJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2PrismaticJointDef=Nt;function kt(){kt.b2PulleyJoint.apply(this,arguments);if(this.constructor===kt)this.b2PulleyJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2PulleyJoint=kt;function Ot(){Ot.b2PulleyJointDef.apply(this,arguments);if(this.constructor===Ot)this.b2PulleyJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2PulleyJointDef=Ot;function Wt(){Wt.b2RevoluteJoint.apply(this,arguments);if(this.constructor===Wt)this.b2RevoluteJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2RevoluteJoint=Wt;function jt(){jt.b2RevoluteJointDef.apply(this,arguments);if(this.constructor===jt)this.b2RevoluteJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2RevoluteJointDef=jt;function Jt(){Jt.b2WeldJoint.apply(this,arguments);if(this.constructor===Jt)this.b2WeldJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2WeldJoint=Jt;function Xt(){Xt.b2WeldJointDef.apply(this,arguments);if(this.constructor===Xt)this.b2WeldJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2WeldJointDef=Xt})();Box2D.postDefs=[];(function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2EdgeChainDef,i=Box2D.Collision.Shapes.b2EdgeShape,o=Box2D.Collision.Shapes.b2MassData,r=Box2D.Collision.Shapes.b2PolygonShape,n=Box2D.Collision.Shapes.b2Shape,a=Box2D.Common.b2Color,s=Box2D.Common.b2internal,l=Box2D.Common.b2Settings,c=Box2D.Common.Math.b2Mat22,h=Box2D.Common.Math.b2Mat33,m=Box2D.Common.Math.b2Math,p=Box2D.Common.Math.b2Sweep,u=Box2D.Common.Math.b2Transform,f=Box2D.Common.Math.b2Vec2,y=Box2D.Common.Math.b2Vec3,d=Box2D.Collision.b2AABB,_=Box2D.Collision.b2Bound,v=Box2D.Collision.b2BoundValues,x=Box2D.Collision.b2Collision,E=Box2D.Collision.b2ContactID,g=Box2D.Collision.b2ContactPoint,b=Box2D.Collision.b2Distance,T=Box2D.Collision.b2DistanceInput,R=Box2D.Collision.b2DistanceOutput,w=Box2D.Collision.b2DistanceProxy,S=Box2D.Collision.b2DynamicTree,C=Box2D.Collision.b2DynamicTreeBroadPhase,A=Box2D.Collision.b2DynamicTreeNode,M=Box2D.Collision.b2DynamicTreePair,D=Box2D.Collision.b2Manifold,B=Box2D.Collision.b2ManifoldPoint,H=Box2D.Collision.b2Point,V=Box2D.Collision.b2RayCastInput,L=Box2D.Collision.b2RayCastOutput,P=Box2D.Collision.b2Segment,F=Box2D.Collision.b2SeparationFunction,I=Box2D.Collision.b2Simplex,U=Box2D.Collision.b2SimplexCache,G=Box2D.Collision.b2SimplexVertex,z=Box2D.Collision.b2TimeOfImpact,N=Box2D.Collision.b2TOIInput,k=Box2D.Collision.b2WorldManifold,O=Box2D.Collision.ClipVertex,W=Box2D.Collision.Features,j=Box2D.Collision.IBroadPhase;d.b2AABB=function(){this.lowerBound=new f;this.upperBound=new f};d.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x;var e=this.upperBound.y-this.lowerBound.y;var i=t>=0&&e>=0;i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid();return i};d.prototype.GetCenter=function(){return new f((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};d.prototype.GetExtents=function(){return new f((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};d.prototype.Contains=function(t){var e=true;e=e&&this.lowerBound.x<=t.lowerBound.x;e=e&&this.lowerBound.y<=t.lowerBound.y;e=e&&t.upperBound.x<=this.upperBound.x;e=e&&t.upperBound.y<=this.upperBound.y;return e};d.prototype.RayCast=function(t,e){var i=-Number.MAX_VALUE;var o=Number.MAX_VALUE;var r=e.p1.x;var n=e.p1.y;var a=e.p2.x-e.p1.x;var s=e.p2.y-e.p1.y;var l=Math.abs(a);var c=Math.abs(s);var h=t.normal;var m=0;var p=0;var u=0;var f=0;var y=0;{if(l<Number.MIN_VALUE){if(r<this.lowerBound.x||this.upperBound.x<r)return false}else{m=1/a;p=(this.lowerBound.x-r)*m;u=(this.upperBound.x-r)*m;y=-1;if(p>u){f=p;p=u;u=f;y=1}if(p>i){h.x=y;h.y=0;i=p}o=Math.min(o,u);if(i>o)return false}}{if(c<Number.MIN_VALUE){if(n<this.lowerBound.y||this.upperBound.y<n)return false}else{m=1/s;p=(this.lowerBound.y-n)*m;u=(this.upperBound.y-n)*m;y=-1;if(p>u){f=p;p=u;u=f;y=1}if(p>i){h.y=y;h.x=0;i=p}o=Math.min(o,u);if(i>o)return false}}t.fraction=i;return true};d.prototype.TestOverlap=function(t){var e=t.lowerBound.x-this.upperBound.x;var i=t.lowerBound.y-this.upperBound.y;var o=this.lowerBound.x-t.upperBound.x;var r=this.lowerBound.y-t.upperBound.y;if(e>0||i>0)return false;if(o>0||r>0)return false;return true};d.Combine=function(t,e){var i=new d;i.Combine(t,e);return i};d.prototype.Combine=function(t,e){this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x);this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y);this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x);this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y)};_.b2Bound=function(){};_.prototype.IsLower=function(){return(this.value&1)==0};_.prototype.IsUpper=function(){return(this.value&1)==1};_.prototype.Swap=function(t){var e=this.value;var i=this.proxy;var o=this.stabbingCount;this.value=t.value;this.proxy=t.proxy;this.stabbingCount=t.stabbingCount;t.value=e;t.proxy=i;t.stabbingCount=o};v.b2BoundValues=function(){};v.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};x.b2Collision=function(){};x.ClipSegmentToLine=function(t,e,i,o){if(o===undefined)o=0;var r;var n=0;r=e[0];var a=r.v;r=e[1];var s=r.v;var l=i.x*a.x+i.y*a.y-o;var c=i.x*s.x+i.y*s.y-o;if(l<=0)t[n++].Set(e[0]);if(c<=0)t[n++].Set(e[1]);if(l*c<0){var h=l/(l-c);r=t[n];var m=r.v;m.x=a.x+h*(s.x-a.x);m.y=a.y+h*(s.y-a.y);r=t[n];var p;if(l>0){p=e[0];r.id=p.id}else{p=e[1];r.id=p.id}++n}return n};x.EdgeSeparation=function(t,e,i,o,r){if(i===undefined)i=0;var n=parseInt(t.m_vertexCount);var a=t.m_vertices;var s=t.m_normals;var l=parseInt(o.m_vertexCount);var c=o.m_vertices;var h;var m;h=e.R;m=s[i];var p=h.col1.x*m.x+h.col2.x*m.y;var u=h.col1.y*m.x+h.col2.y*m.y;h=r.R;var f=h.col1.x*p+h.col1.y*u;var y=h.col2.x*p+h.col2.y*u;var d=0;var _=Number.MAX_VALUE;for(var v=0;v<l;++v){m=c[v];var x=m.x*f+m.y*y;if(x<_){_=x;d=v}}m=a[i];h=e.R;var E=e.position.x+(h.col1.x*m.x+h.col2.x*m.y);var g=e.position.y+(h.col1.y*m.x+h.col2.y*m.y);m=c[d];h=r.R;var b=r.position.x+(h.col1.x*m.x+h.col2.x*m.y);var T=r.position.y+(h.col1.y*m.x+h.col2.y*m.y);b-=E;T-=g;var R=b*p+T*u;return R};x.FindMaxSeparation=function(t,e,i,o,r){var n=parseInt(e.m_vertexCount);var a=e.m_normals;var s;var l;l=r.R;s=o.m_centroid;var c=r.position.x+(l.col1.x*s.x+l.col2.x*s.y);var h=r.position.y+(l.col1.y*s.x+l.col2.y*s.y);l=i.R;s=e.m_centroid;c-=i.position.x+(l.col1.x*s.x+l.col2.x*s.y);h-=i.position.y+(l.col1.y*s.x+l.col2.y*s.y);var m=c*i.R.col1.x+h*i.R.col1.y;var p=c*i.R.col2.x+h*i.R.col2.y;var u=0;var f=-Number.MAX_VALUE;for(var y=0;y<n;++y){s=a[y];var d=s.x*m+s.y*p;if(d>f){f=d;u=y}}var _=x.EdgeSeparation(e,i,u,o,r);var v=parseInt(u-1>=0?u-1:n-1);var E=x.EdgeSeparation(e,i,v,o,r);var g=parseInt(u+1<n?u+1:0);var b=x.EdgeSeparation(e,i,g,o,r);var T=0;var R=0;var w=0;if(E>_&&E>b){w=-1;T=v;R=E}else if(b>_){w=1;T=g;R=b}else{t[0]=u;return _}while(true){if(w==-1)u=T-1>=0?T-1:n-1;else u=T+1<n?T+1:0;_=x.EdgeSeparation(e,i,u,o,r);if(_>R){T=u;R=_}else{break}}t[0]=T;return R};x.FindIncidentEdge=function(t,e,i,o,r,n){if(o===undefined)o=0;var a=parseInt(e.m_vertexCount);var s=e.m_normals;var l=parseInt(r.m_vertexCount);var c=r.m_vertices;var h=r.m_normals;var m;var p;m=i.R;p=s[o];var u=m.col1.x*p.x+m.col2.x*p.y;var f=m.col1.y*p.x+m.col2.y*p.y;m=n.R;var y=m.col1.x*u+m.col1.y*f;f=m.col2.x*u+m.col2.y*f;u=y;var d=0;var _=Number.MAX_VALUE;for(var v=0;v<l;++v){p=h[v];var x=u*p.x+f*p.y;if(x<_){_=x;d=v}}var E;var g=parseInt(d);var b=parseInt(g+1<l?g+1:0);E=t[0];p=c[g];m=n.R;E.v.x=n.position.x+(m.col1.x*p.x+m.col2.x*p.y);E.v.y=n.position.y+(m.col1.y*p.x+m.col2.y*p.y);E.id.features.referenceEdge=o;E.id.features.incidentEdge=g;E.id.features.incidentVertex=0;E=t[1];p=c[b];m=n.R;E.v.x=n.position.x+(m.col1.x*p.x+m.col2.x*p.y);E.v.y=n.position.y+(m.col1.y*p.x+m.col2.y*p.y);E.id.features.referenceEdge=o;E.id.features.incidentEdge=b;E.id.features.incidentVertex=1};x.MakeClipPointVector=function(){var t=new Vector(2);t[0]=new O;t[1]=new O;return t};x.CollidePolygons=function(t,e,i,o,r){var n;t.m_pointCount=0;var a=e.m_radius+o.m_radius;var s=0;x.s_edgeAO[0]=s;var c=x.FindMaxSeparation(x.s_edgeAO,e,i,o,r);s=x.s_edgeAO[0];if(c>a)return;var h=0;x.s_edgeBO[0]=h;var m=x.FindMaxSeparation(x.s_edgeBO,o,r,e,i);h=x.s_edgeBO[0];if(m>a)return;var p;var u;var f;var y;var d=0;var _=0;var v=.98;var E=.001;var g;if(m>v*c+E){p=o;u=e;f=r;y=i;d=h;t.m_type=D.e_faceB;_=1}else{p=e;u=o;f=i;y=r;d=s;t.m_type=D.e_faceA;_=0}var b=x.s_incidentEdge;x.FindIncidentEdge(b,p,f,d,u,y);var T=parseInt(p.m_vertexCount);var R=p.m_vertices;var w=R[d];var S;if(d+1<T){S=R[parseInt(d+1)]}else{S=R[0]}var C=x.s_localTangent;C.Set(S.x-w.x,S.y-w.y);C.Normalize();var A=x.s_localNormal;A.x=C.y;A.y=-C.x;var M=x.s_planePoint;M.Set(.5*(w.x+S.x),.5*(w.y+S.y));var B=x.s_tangent;g=f.R;B.x=g.col1.x*C.x+g.col2.x*C.y;B.y=g.col1.y*C.x+g.col2.y*C.y;var H=x.s_tangent2;H.x=-B.x;H.y=-B.y;var V=x.s_normal;V.x=B.y;V.y=-B.x;var L=x.s_v11;var P=x.s_v12;L.x=f.position.x+(g.col1.x*w.x+g.col2.x*w.y);L.y=f.position.y+(g.col1.y*w.x+g.col2.y*w.y);P.x=f.position.x+(g.col1.x*S.x+g.col2.x*S.y);P.y=f.position.y+(g.col1.y*S.x+g.col2.y*S.y);var F=V.x*L.x+V.y*L.y;var I=-B.x*L.x-B.y*L.y+a;var U=B.x*P.x+B.y*P.y+a;var G=x.s_clipPoints1;var z=x.s_clipPoints2;var N=0;N=x.ClipSegmentToLine(G,b,H,I);if(N<2)return;N=x.ClipSegmentToLine(z,G,B,U);if(N<2)return;t.m_localPlaneNormal.SetV(A);t.m_localPoint.SetV(M);var k=0;for(var O=0;O<l.b2_maxManifoldPoints;++O){n=z[O];var W=V.x*n.v.x+V.y*n.v.y-F;if(W<=a){var j=t.m_points[k];g=y.R;var J=n.v.x-y.position.x;var X=n.v.y-y.position.y;j.m_localPoint.x=J*g.col1.x+X*g.col1.y;j.m_localPoint.y=J*g.col2.x+X*g.col2.y;j.m_id.Set(n.id);j.m_id.features.flip=_;++k}}t.m_pointCount=k};x.CollideCircles=function(t,e,i,o,r){t.m_pointCount=0;var n;var a;n=i.R;a=e.m_p;var s=i.position.x+(n.col1.x*a.x+n.col2.x*a.y);var l=i.position.y+(n.col1.y*a.x+n.col2.y*a.y);n=r.R;a=o.m_p;var c=r.position.x+(n.col1.x*a.x+n.col2.x*a.y);var h=r.position.y+(n.col1.y*a.x+n.col2.y*a.y);var m=c-s;var p=h-l;var u=m*m+p*p;var f=e.m_radius+o.m_radius;if(u>f*f){return}t.m_type=D.e_circles;t.m_localPoint.SetV(e.m_p);t.m_localPlaneNormal.SetZero();t.m_pointCount=1;t.m_points[0].m_localPoint.SetV(o.m_p);t.m_points[0].m_id.key=0};x.CollidePolygonAndCircle=function(t,e,i,o,r){t.m_pointCount=0;var n;var a=0;var s=0;var l=0;var c=0;var h;var m;m=r.R;h=o.m_p;var p=r.position.x+(m.col1.x*h.x+m.col2.x*h.y);var u=r.position.y+(m.col1.y*h.x+m.col2.y*h.y);a=p-i.position.x;s=u-i.position.y;m=i.R;var f=a*m.col1.x+s*m.col1.y;var y=a*m.col2.x+s*m.col2.y;var d=0;var _=0;var v=-Number.MAX_VALUE;var x=e.m_radius+o.m_radius;var E=parseInt(e.m_vertexCount);var g=e.m_vertices;var b=e.m_normals;for(var T=0;T<E;++T){h=g[T];a=f-h.x;s=y-h.y;h=b[T];var R=h.x*a+h.y*s;if(R>x){return}if(R>v){v=R;_=T}}var w=parseInt(_);var S=parseInt(w+1<E?w+1:0);var C=g[w];var A=g[S];if(v<Number.MIN_VALUE){t.m_pointCount=1;t.m_type=D.e_faceA;t.m_localPlaneNormal.SetV(b[_]);t.m_localPoint.x=.5*(C.x+A.x);t.m_localPoint.y=.5*(C.y+A.y);t.m_points[0].m_localPoint.SetV(o.m_p);t.m_points[0].m_id.key=0;return}var M=(f-C.x)*(A.x-C.x)+(y-C.y)*(A.y-C.y);var B=(f-A.x)*(C.x-A.x)+(y-A.y)*(C.y-A.y);if(M<=0){if((f-C.x)*(f-C.x)+(y-C.y)*(y-C.y)>x*x)return;t.m_pointCount=1;t.m_type=D.e_faceA;t.m_localPlaneNormal.x=f-C.x;t.m_localPlaneNormal.y=y-C.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.SetV(C);t.m_points[0].m_localPoint.SetV(o.m_p);t.m_points[0].m_id.key=0}else if(B<=0){if((f-A.x)*(f-A.x)+(y-A.y)*(y-A.y)>x*x)return;t.m_pointCount=1;t.m_type=D.e_faceA;t.m_localPlaneNormal.x=f-A.x;t.m_localPlaneNormal.y=y-A.y;t.m_localPlaneNormal.Normalize();t.m_localPoint.SetV(A);t.m_points[0].m_localPoint.SetV(o.m_p);t.m_points[0].m_id.key=0}else{var H=.5*(C.x+A.x);var V=.5*(C.y+A.y);v=(f-H)*b[w].x+(y-V)*b[w].y;if(v>x)return;t.m_pointCount=1;t.m_type=D.e_faceA;t.m_localPlaneNormal.x=b[w].x;t.m_localPlaneNormal.y=b[w].y;t.m_localPlaneNormal.Normalize();t.m_localPoint.Set(H,V);t.m_points[0].m_localPoint.SetV(o.m_p);t.m_points[0].m_id.key=0}};x.TestOverlap=function(t,e){var i=e.lowerBound;var o=t.upperBound;var r=i.x-o.x;var n=i.y-o.y;i=t.lowerBound;o=e.upperBound;var a=i.x-o.x;var s=i.y-o.y;if(r>0||n>0)return false;if(a>0||s>0)return false;return true};Box2D.postDefs.push((function(){Box2D.Collision.b2Collision.s_incidentEdge=x.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=x.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=x.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new f;Box2D.Collision.b2Collision.s_localNormal=new f;Box2D.Collision.b2Collision.s_planePoint=new f;Box2D.Collision.b2Collision.s_normal=new f;Box2D.Collision.b2Collision.s_tangent=new f;Box2D.Collision.b2Collision.s_tangent2=new f;Box2D.Collision.b2Collision.s_v11=new f;Box2D.Collision.b2Collision.s_v12=new f;Box2D.Collision.b2Collision.b2CollidePolyTempVec=new f;Box2D.Collision.b2Collision.b2_nullFeature=255}));E.b2ContactID=function(){this.features=new W};E.prototype.b2ContactID=function(){this.features._m_id=this};E.prototype.Set=function(t){this.key=t._key};E.prototype.Copy=function(){var t=new E;t.key=this.key;return t};Object.defineProperty(E.prototype,"key",{enumerable:false,configurable:true,get:function(){return this._key}});Object.defineProperty(E.prototype,"key",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._key=t;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});g.b2ContactPoint=function(){this.position=new f;this.velocity=new f;this.normal=new f;this.id=new E};b.b2Distance=function(){};b.Distance=function(t,e,i){++b.b2_gjkCalls;var o=i.proxyA;var r=i.proxyB;var n=i.transformA;var a=i.transformB;var s=b.s_simplex;s.ReadCache(e,o,n,r,a);var c=s.m_vertices;var h=20;var p=b.s_saveA;var u=b.s_saveB;var y=0;var d=s.GetClosestPoint();var _=d.LengthSquared();var v=_;var x=0;var E;var g=0;while(g<h){y=s.m_count;for(x=0;x<y;x++){p[x]=c[x].indexA;u[x]=c[x].indexB}switch(s.m_count){case 1:break;case 2:s.Solve2();break;case 3:s.Solve3();break;default:l.b2Assert(false)}if(s.m_count==3){break}E=s.GetClosestPoint();v=E.LengthSquared();if(v>_){}_=v;var T=s.GetSearchDirection();if(T.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE){break}var R=c[s.m_count];R.indexA=o.GetSupport(m.MulTMV(n.R,T.GetNegative()));R.wA=m.MulX(n,o.GetVertex(R.indexA));R.indexB=r.GetSupport(m.MulTMV(a.R,T));R.wB=m.MulX(a,r.GetVertex(R.indexB));R.w=m.SubtractVV(R.wB,R.wA);++g;++b.b2_gjkIters;var w=false;for(x=0;x<y;x++){if(R.indexA==p[x]&&R.indexB==u[x]){w=true;break}}if(w){break}++s.m_count}b.b2_gjkMaxIters=m.Max(b.b2_gjkMaxIters,g);s.GetWitnessPoints(t.pointA,t.pointB);t.distance=m.SubtractVV(t.pointA,t.pointB).Length();t.iterations=g;s.WriteCache(e);if(i.useRadii){var S=o.m_radius;var C=r.m_radius;if(t.distance>S+C&&t.distance>Number.MIN_VALUE){t.distance-=S+C;var A=m.SubtractVV(t.pointB,t.pointA);A.Normalize();t.pointA.x+=S*A.x;t.pointA.y+=S*A.y;t.pointB.x-=C*A.x;t.pointB.y-=C*A.y}else{E=new f;E.x=.5*(t.pointA.x+t.pointB.x);E.y=.5*(t.pointA.y+t.pointB.y);t.pointA.x=t.pointB.x=E.x;t.pointA.y=t.pointB.y=E.y;t.distance=0}}};Box2D.postDefs.push((function(){Box2D.Collision.b2Distance.s_simplex=new I;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}));T.b2DistanceInput=function(){};R.b2DistanceOutput=function(){this.pointA=new f;this.pointB=new f};w.b2DistanceProxy=function(){};w.prototype.Set=function(e){switch(e.GetType()){case n.e_circleShape:{var i=e instanceof t?e:null;this.m_vertices=new Vector(1,true);this.m_vertices[0]=i.m_p;this.m_count=1;this.m_radius=i.m_radius}break;case n.e_polygonShape:{var o=e instanceof r?e:null;this.m_vertices=o.m_vertices;this.m_count=o.m_vertexCount;this.m_radius=o.m_radius}break;default:l.b2Assert(false)}};w.prototype.GetSupport=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var o=1;o<this.m_count;++o){var r=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;if(r>i){e=o;i=r}}return e};w.prototype.GetSupportVertex=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var o=1;o<this.m_count;++o){var r=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;if(r>i){e=o;i=r}}return this.m_vertices[e]};w.prototype.GetVertexCount=function(){return this.m_count};w.prototype.GetVertex=function(t){if(t===undefined)t=0;l.b2Assert(0<=t&&t<this.m_count);return this.m_vertices[t]};S.b2DynamicTree=function(){};S.prototype.b2DynamicTree=function(){this.m_root=null;this.m_freeList=null;this.m_path=0;this.m_insertionCount=0};S.prototype.CreateProxy=function(t,e){var i=this.AllocateNode();var o=l.b2_aabbExtension;var r=l.b2_aabbExtension;i.aabb.lowerBound.x=t.lowerBound.x-o;i.aabb.lowerBound.y=t.lowerBound.y-r;i.aabb.upperBound.x=t.upperBound.x+o;i.aabb.upperBound.y=t.upperBound.y+r;i.userData=e;this.InsertLeaf(i);return i};S.prototype.DestroyProxy=function(t){this.RemoveLeaf(t);this.FreeNode(t)};S.prototype.MoveProxy=function(t,e,i){l.b2Assert(t.IsLeaf());if(t.aabb.Contains(e)){return false}this.RemoveLeaf(t);var o=l.b2_aabbExtension+l.b2_aabbMultiplier*(i.x>0?i.x:-i.x);var r=l.b2_aabbExtension+l.b2_aabbMultiplier*(i.y>0?i.y:-i.y);t.aabb.lowerBound.x=e.lowerBound.x-o;t.aabb.lowerBound.y=e.lowerBound.y-r;t.aabb.upperBound.x=e.upperBound.x+o;t.aabb.upperBound.y=e.upperBound.y+r;this.InsertLeaf(t);return true};S.prototype.Rebalance=function(t){if(t===undefined)t=0;if(this.m_root==null)return;for(var e=0;e<t;e++){var i=this.m_root;var o=0;while(i.IsLeaf()==false){i=this.m_path>>o&1?i.child2:i.child1;o=o+1&31}++this.m_path;this.RemoveLeaf(i);this.InsertLeaf(i)}};S.prototype.GetFatAABB=function(t){return t.aabb};S.prototype.GetUserData=function(t){return t.userData};S.prototype.Query=function(t,e){if(this.m_root==null)return;var i=new Vector;var o=0;i[o++]=this.m_root;while(o>0){var r=i[--o];if(r.aabb.TestOverlap(e)){if(r.IsLeaf()){var n=t(r);if(!n)return}else{i[o++]=r.child1;i[o++]=r.child2}}}};S.prototype.RayCast=function(t,e){if(this.m_root==null)return;var i=e.p1;var o=e.p2;var r=m.SubtractVV(i,o);r.Normalize();var n=m.CrossFV(1,r);var a=m.AbsV(n);var s=e.maxFraction;var l=new d;var c=0;var h=0;{c=i.x+s*(o.x-i.x);h=i.y+s*(o.y-i.y);l.lowerBound.x=Math.min(i.x,c);l.lowerBound.y=Math.min(i.y,h);l.upperBound.x=Math.max(i.x,c);l.upperBound.y=Math.max(i.y,h)}var p=new Vector;var u=0;p[u++]=this.m_root;while(u>0){var f=p[--u];if(f.aabb.TestOverlap(l)==false){continue}var y=f.aabb.GetCenter();var _=f.aabb.GetExtents();var v=Math.abs(n.x*(i.x-y.x)+n.y*(i.y-y.y))-a.x*_.x-a.y*_.y;if(v>0)continue;if(f.IsLeaf()){var x=new V;x.p1=e.p1;x.p2=e.p2;x.maxFraction=e.maxFraction;s=t(x,f);if(s==0)return;if(s>0){c=i.x+s*(o.x-i.x);h=i.y+s*(o.y-i.y);l.lowerBound.x=Math.min(i.x,c);l.lowerBound.y=Math.min(i.y,h);l.upperBound.x=Math.max(i.x,c);l.upperBound.y=Math.max(i.y,h)}}else{p[u++]=f.child1;p[u++]=f.child2}}};S.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;this.m_freeList=t.parent;t.parent=null;t.child1=null;t.child2=null;return t}return new A};S.prototype.FreeNode=function(t){t.parent=this.m_freeList;this.m_freeList=t};S.prototype.InsertLeaf=function(t){++this.m_insertionCount;if(this.m_root==null){this.m_root=t;this.m_root.parent=null;return}var e=t.aabb.GetCenter();var i=this.m_root;if(i.IsLeaf()==false){do{var o=i.child1;var r=i.child2;var n=Math.abs((o.aabb.lowerBound.x+o.aabb.upperBound.x)/2-e.x)+Math.abs((o.aabb.lowerBound.y+o.aabb.upperBound.y)/2-e.y);var a=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-e.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-e.y);if(n<a){i=o}else{i=r}}while(i.IsLeaf()==false)}var s=i.parent;var l=this.AllocateNode();l.parent=s;l.userData=null;l.aabb.Combine(t.aabb,i.aabb);if(s){if(i.parent.child1==i){s.child1=l}else{s.child2=l}l.child1=i;l.child2=t;i.parent=l;t.parent=l;do{if(s.aabb.Contains(l.aabb))break;s.aabb.Combine(s.child1.aabb,s.child2.aabb);l=s;s=s.parent}while(s)}else{l.child1=i;l.child2=t;i.parent=l;t.parent=l;this.m_root=l}};S.prototype.RemoveLeaf=function(t){if(t==this.m_root){this.m_root=null;return}var e=t.parent;var i=e.parent;var o;if(e.child1==t){o=e.child2}else{o=e.child1}if(i){if(i.child1==e){i.child1=o}else{i.child2=o}o.parent=i;this.FreeNode(e);while(i){var r=i.aabb;i.aabb=d.Combine(i.child1.aabb,i.child2.aabb);if(r.Contains(i.aabb))break;i=i.parent}}else{this.m_root=o;o.parent=null;this.FreeNode(e)}};C.b2DynamicTreeBroadPhase=function(){this.m_tree=new S;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};C.prototype.CreateProxy=function(t,e){var i=this.m_tree.CreateProxy(t,e);++this.m_proxyCount;this.BufferMove(i);return i};C.prototype.DestroyProxy=function(t){this.UnBufferMove(t);--this.m_proxyCount;this.m_tree.DestroyProxy(t)};C.prototype.MoveProxy=function(t,e,i){var o=this.m_tree.MoveProxy(t,e,i);if(o){this.BufferMove(t)}};C.prototype.TestOverlap=function(t,e){var i=this.m_tree.GetFatAABB(t);var o=this.m_tree.GetFatAABB(e);return i.TestOverlap(o)};C.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)};C.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)};C.prototype.GetProxyCount=function(){return this.m_proxyCount};C.prototype.UpdatePairs=function(t){var e=this;e.m_pairCount=0;var i=0,o;for(i=0;i<e.m_moveBuffer.length;++i){o=e.m_moveBuffer[i];function r(t){if(t==o)return true;if(e.m_pairCount==e.m_pairBuffer.length){e.m_pairBuffer[e.m_pairCount]=new M}var i=e.m_pairBuffer[e.m_pairCount];i.proxyA=t<o?t:o;i.proxyB=t>=o?t:o;++e.m_pairCount;return true}var n=e.m_tree.GetFatAABB(o);e.m_tree.Query(r,n)}e.m_moveBuffer.length=0;for(var i=0;i<e.m_pairCount;){var a=e.m_pairBuffer[i];var s=e.m_tree.GetUserData(a.proxyA);var l=e.m_tree.GetUserData(a.proxyB);t(s,l);++i;while(i<e.m_pairCount){var c=e.m_pairBuffer[i];if(c.proxyA!=a.proxyA||c.proxyB!=a.proxyB){break}++i}}};C.prototype.Query=function(t,e){this.m_tree.Query(t,e)};C.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)};C.prototype.Validate=function(){};C.prototype.Rebalance=function(t){if(t===undefined)t=0;this.m_tree.Rebalance(t)};C.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t};C.prototype.UnBufferMove=function(t){var e=parseInt(this.m_moveBuffer.indexOf(t));this.m_moveBuffer.splice(e,1)};C.prototype.ComparePairs=function(t,e){return 0};C.__implements={};C.__implements[j]=true;A.b2DynamicTreeNode=function(){this.aabb=new d};A.prototype.IsLeaf=function(){return this.child1==null};M.b2DynamicTreePair=function(){};D.b2Manifold=function(){this.m_pointCount=0};D.prototype.b2Manifold=function(){this.m_points=new Vector(l.b2_maxManifoldPoints);for(var t=0;t<l.b2_maxManifoldPoints;t++){this.m_points[t]=new B}this.m_localPlaneNormal=new f;this.m_localPoint=new f};D.prototype.Reset=function(){for(var t=0;t<l.b2_maxManifoldPoints;t++){(this.m_points[t]instanceof B?this.m_points[t]:null).Reset()}this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_type=0;this.m_pointCount=0};D.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var e=0;e<l.b2_maxManifoldPoints;e++){(this.m_points[e]instanceof B?this.m_points[e]:null).Set(t.m_points[e])}this.m_localPlaneNormal.SetV(t.m_localPlaneNormal);this.m_localPoint.SetV(t.m_localPoint);this.m_type=t.m_type};D.prototype.Copy=function(){var t=new D;t.Set(this);return t};Box2D.postDefs.push((function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4}));B.b2ManifoldPoint=function(){this.m_localPoint=new f;this.m_id=new E};B.prototype.b2ManifoldPoint=function(){this.Reset()};B.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_normalImpulse=0;this.m_tangentImpulse=0;this.m_id.key=0};B.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint);this.m_normalImpulse=t.m_normalImpulse;this.m_tangentImpulse=t.m_tangentImpulse;this.m_id.Set(t.m_id)};H.b2Point=function(){this.p=new f};H.prototype.Support=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;return this.p};H.prototype.GetFirstVertex=function(t){return this.p};V.b2RayCastInput=function(){this.p1=new f;this.p2=new f};V.prototype.b2RayCastInput=function(t,e,i){if(t===undefined)t=null;if(e===undefined)e=null;if(i===undefined)i=1;if(t)this.p1.SetV(t);if(e)this.p2.SetV(e);this.maxFraction=i};L.b2RayCastOutput=function(){this.normal=new f};P.b2Segment=function(){this.p1=new f;this.p2=new f};P.prototype.TestSegment=function(t,e,i,o){if(o===undefined)o=0;var r=i.p1;var n=i.p2.x-r.x;var a=i.p2.y-r.y;var s=this.p2.x-this.p1.x;var l=this.p2.y-this.p1.y;var c=l;var h=-s;var m=100*Number.MIN_VALUE;var p=-(n*c+a*h);if(p>m){var u=r.x-this.p1.x;var f=r.y-this.p1.y;var y=u*c+f*h;if(0<=y&&y<=o*p){var d=-n*f+a*u;if(-m*p<=d&&d<=p*(1+m)){y/=p;var _=Math.sqrt(c*c+h*h);c/=_;h/=_;t[0]=y;e.Set(c,h);return true}}}return false};P.prototype.Extend=function(t){this.ExtendForward(t);this.ExtendBackward(t)};P.prototype.ExtendForward=function(t){var e=this.p2.x-this.p1.x;var i=this.p2.y-this.p1.y;var o=Math.min(e>0?(t.upperBound.x-this.p1.x)/e:e<0?(t.lowerBound.x-this.p1.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p1.y)/i:i<0?(t.lowerBound.y-this.p1.y)/i:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+e*o;this.p2.y=this.p1.y+i*o};P.prototype.ExtendBackward=function(t){var e=-this.p2.x+this.p1.x;var i=-this.p2.y+this.p1.y;var o=Math.min(e>0?(t.upperBound.x-this.p2.x)/e:e<0?(t.lowerBound.x-this.p2.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p2.y)/i:i<0?(t.lowerBound.y-this.p2.y)/i:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+e*o;this.p1.y=this.p2.y+i*o};F.b2SeparationFunction=function(){this.m_localPoint=new f;this.m_axis=new f};F.prototype.Initialize=function(t,e,i,o,r){this.m_proxyA=e;this.m_proxyB=o;var n=parseInt(t.count);l.b2Assert(0<n&&n<3);var a;var s;var c;var h;var p;var u;var y=0;var d=0;var _=0;var v=0;var x=0;var E=0;var g;var b;var T=0;var R=0;if(n==1){this.m_type=F.e_points;a=this.m_proxyA.GetVertex(t.indexA[0]);h=this.m_proxyB.GetVertex(t.indexB[0]);b=a;g=i.R;y=i.position.x+(g.col1.x*b.x+g.col2.x*b.y);d=i.position.y+(g.col1.y*b.x+g.col2.y*b.y);b=h;g=r.R;_=r.position.x+(g.col1.x*b.x+g.col2.x*b.y);v=r.position.y+(g.col1.y*b.x+g.col2.y*b.y);this.m_axis.x=_-y;this.m_axis.y=v-d;this.m_axis.Normalize()}else if(t.indexB[0]==t.indexB[1]){this.m_type=F.e_faceA;s=this.m_proxyA.GetVertex(t.indexA[0]);c=this.m_proxyA.GetVertex(t.indexA[1]);h=this.m_proxyB.GetVertex(t.indexB[0]);this.m_localPoint.x=.5*(s.x+c.x);this.m_localPoint.y=.5*(s.y+c.y);this.m_axis=m.CrossVF(m.SubtractVV(c,s),1);this.m_axis.Normalize();b=this.m_axis;g=i.R;x=g.col1.x*b.x+g.col2.x*b.y;E=g.col1.y*b.x+g.col2.y*b.y;b=this.m_localPoint;g=i.R;y=i.position.x+(g.col1.x*b.x+g.col2.x*b.y);d=i.position.y+(g.col1.y*b.x+g.col2.y*b.y);b=h;g=r.R;_=r.position.x+(g.col1.x*b.x+g.col2.x*b.y);v=r.position.y+(g.col1.y*b.x+g.col2.y*b.y);T=(_-y)*x+(v-d)*E;if(T<0){this.m_axis.NegativeSelf()}}else if(t.indexA[0]==t.indexA[0]){this.m_type=F.e_faceB;p=this.m_proxyB.GetVertex(t.indexB[0]);u=this.m_proxyB.GetVertex(t.indexB[1]);a=this.m_proxyA.GetVertex(t.indexA[0]);this.m_localPoint.x=.5*(p.x+u.x);this.m_localPoint.y=.5*(p.y+u.y);this.m_axis=m.CrossVF(m.SubtractVV(u,p),1);this.m_axis.Normalize();b=this.m_axis;g=r.R;x=g.col1.x*b.x+g.col2.x*b.y;E=g.col1.y*b.x+g.col2.y*b.y;b=this.m_localPoint;g=r.R;_=r.position.x+(g.col1.x*b.x+g.col2.x*b.y);v=r.position.y+(g.col1.y*b.x+g.col2.y*b.y);b=a;g=i.R;y=i.position.x+(g.col1.x*b.x+g.col2.x*b.y);d=i.position.y+(g.col1.y*b.x+g.col2.y*b.y);T=(y-_)*x+(d-v)*E;if(T<0){this.m_axis.NegativeSelf()}}else{s=this.m_proxyA.GetVertex(t.indexA[0]);c=this.m_proxyA.GetVertex(t.indexA[1]);p=this.m_proxyB.GetVertex(t.indexB[0]);u=this.m_proxyB.GetVertex(t.indexB[1]);var w=m.MulX(i,a);var S=m.MulMV(i.R,m.SubtractVV(c,s));var C=m.MulX(r,h);var A=m.MulMV(r.R,m.SubtractVV(u,p));var M=S.x*S.x+S.y*S.y;var D=A.x*A.x+A.y*A.y;var B=m.SubtractVV(A,S);var H=S.x*B.x+S.y*B.y;var V=A.x*B.x+A.y*B.y;var L=S.x*A.x+S.y*A.y;var P=M*D-L*L;T=0;if(P!=0){T=m.Clamp((L*V-H*D)/P,0,1)}var I=(L*T+V)/D;if(I<0){I=0;T=m.Clamp((L-H)/M,0,1)}a=new f;a.x=s.x+T*(c.x-s.x);a.y=s.y+T*(c.y-s.y);h=new f;h.x=p.x+T*(u.x-p.x);h.y=p.y+T*(u.y-p.y);if(T==0||T==1){this.m_type=F.e_faceB;this.m_axis=m.CrossVF(m.SubtractVV(u,p),1);this.m_axis.Normalize();this.m_localPoint=h;b=this.m_axis;g=r.R;x=g.col1.x*b.x+g.col2.x*b.y;E=g.col1.y*b.x+g.col2.y*b.y;b=this.m_localPoint;g=r.R;_=r.position.x+(g.col1.x*b.x+g.col2.x*b.y);v=r.position.y+(g.col1.y*b.x+g.col2.y*b.y);b=a;g=i.R;y=i.position.x+(g.col1.x*b.x+g.col2.x*b.y);d=i.position.y+(g.col1.y*b.x+g.col2.y*b.y);R=(y-_)*x+(d-v)*E;if(T<0){this.m_axis.NegativeSelf()}}else{this.m_type=F.e_faceA;this.m_axis=m.CrossVF(m.SubtractVV(c,s),1);this.m_localPoint=a;b=this.m_axis;g=i.R;x=g.col1.x*b.x+g.col2.x*b.y;E=g.col1.y*b.x+g.col2.y*b.y;b=this.m_localPoint;g=i.R;y=i.position.x+(g.col1.x*b.x+g.col2.x*b.y);d=i.position.y+(g.col1.y*b.x+g.col2.y*b.y);b=h;g=r.R;_=r.position.x+(g.col1.x*b.x+g.col2.x*b.y);v=r.position.y+(g.col1.y*b.x+g.col2.y*b.y);R=(_-y)*x+(v-d)*E;if(T<0){this.m_axis.NegativeSelf()}}}};F.prototype.Evaluate=function(t,e){var i;var o;var r;var n;var a;var s;var c=0;var h;switch(this.m_type){case F.e_points:{i=m.MulTMV(t.R,this.m_axis);o=m.MulTMV(e.R,this.m_axis.GetNegative());r=this.m_proxyA.GetSupportVertex(i);n=this.m_proxyB.GetSupportVertex(o);a=m.MulX(t,r);s=m.MulX(e,n);c=(s.x-a.x)*this.m_axis.x+(s.y-a.y)*this.m_axis.y;return c}case F.e_faceA:{h=m.MulMV(t.R,this.m_axis);a=m.MulX(t,this.m_localPoint);o=m.MulTMV(e.R,h.GetNegative());n=this.m_proxyB.GetSupportVertex(o);s=m.MulX(e,n);c=(s.x-a.x)*h.x+(s.y-a.y)*h.y;return c}case F.e_faceB:{h=m.MulMV(e.R,this.m_axis);s=m.MulX(e,this.m_localPoint);i=m.MulTMV(t.R,h.GetNegative());r=this.m_proxyA.GetSupportVertex(i);a=m.MulX(t,r);c=(a.x-s.x)*h.x+(a.y-s.y)*h.y;return c}default:l.b2Assert(false);return 0}};Box2D.postDefs.push((function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4}));I.b2Simplex=function(){this.m_v1=new G;this.m_v2=new G;this.m_v3=new G;this.m_vertices=new Vector(3)};I.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};I.prototype.ReadCache=function(t,e,i,o,r){l.b2Assert(0<=t.count&&t.count<=3);var n;var a;this.m_count=t.count;var s=this.m_vertices;for(var c=0;c<this.m_count;c++){var h=s[c];h.indexA=t.indexA[c];h.indexB=t.indexB[c];n=e.GetVertex(h.indexA);a=o.GetVertex(h.indexB);h.wA=m.MulX(i,n);h.wB=m.MulX(r,a);h.w=m.SubtractVV(h.wB,h.wA);h.a=0}if(this.m_count>1){var p=t.metric;var u=this.GetMetric();if(u<.5*p||2*p<u||u<Number.MIN_VALUE){this.m_count=0}}if(this.m_count==0){h=s[0];h.indexA=0;h.indexB=0;n=e.GetVertex(0);a=o.GetVertex(0);h.wA=m.MulX(i,n);h.wB=m.MulX(r,a);h.w=m.SubtractVV(h.wB,h.wA);this.m_count=1}};I.prototype.WriteCache=function(t){t.metric=this.GetMetric();t.count=Box2D.parseUInt(this.m_count);var e=this.m_vertices;for(var i=0;i<this.m_count;i++){t.indexA[i]=Box2D.parseUInt(e[i].indexA);t.indexB[i]=Box2D.parseUInt(e[i].indexB)}};I.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:{var t=m.SubtractVV(this.m_v2.w,this.m_v1.w);var e=m.CrossVV(t,this.m_v1.w.GetNegative());if(e>0){return m.CrossFV(1,t)}else{return m.CrossVF(t,1)}}default:l.b2Assert(false);return new f}};I.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:l.b2Assert(false);return new f;case 1:return this.m_v1.w;case 2:return new f(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:l.b2Assert(false);return new f}};I.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:l.b2Assert(false);break;case 1:t.SetV(this.m_v1.wA);e.SetV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:l.b2Assert(false);break}};I.prototype.GetMetric=function(){switch(this.m_count){case 0:l.b2Assert(false);return 0;case 1:return 0;case 2:return m.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return m.CrossVV(m.SubtractVV(this.m_v2.w,this.m_v1.w),m.SubtractVV(this.m_v3.w,this.m_v1.w));default:l.b2Assert(false);return 0}};I.prototype.Solve2=function(){var t=this.m_v1.w;var e=this.m_v2.w;var i=m.SubtractVV(e,t);var o=-(t.x*i.x+t.y*i.y);if(o<=0){this.m_v1.a=1;this.m_count=1;return}var r=e.x*i.x+e.y*i.y;if(r<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}var n=1/(r+o);this.m_v1.a=r*n;this.m_v2.a=o*n;this.m_count=2};I.prototype.Solve3=function(){var t=this.m_v1.w;var e=this.m_v2.w;var i=this.m_v3.w;var o=m.SubtractVV(e,t);var r=m.Dot(t,o);var n=m.Dot(e,o);var a=n;var s=-r;var l=m.SubtractVV(i,t);var c=m.Dot(t,l);var h=m.Dot(i,l);var p=h;var u=-c;var f=m.SubtractVV(i,e);var y=m.Dot(e,f);var d=m.Dot(i,f);var _=d;var v=-y;var x=m.CrossVV(o,l);var E=x*m.CrossVV(e,i);var g=x*m.CrossVV(i,t);var b=x*m.CrossVV(t,e);if(s<=0&&u<=0){this.m_v1.a=1;this.m_count=1;return}if(a>0&&s>0&&b<=0){var T=1/(a+s);this.m_v1.a=a*T;this.m_v2.a=s*T;this.m_count=2;return}if(p>0&&u>0&&g<=0){var R=1/(p+u);this.m_v1.a=p*R;this.m_v3.a=u*R;this.m_count=2;this.m_v2.Set(this.m_v3);return}if(a<=0&&v<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}if(p<=0&&_<=0){this.m_v3.a=1;this.m_count=1;this.m_v1.Set(this.m_v3);return}if(_>0&&v>0&&E<=0){var w=1/(_+v);this.m_v2.a=_*w;this.m_v3.a=v*w;this.m_count=2;this.m_v1.Set(this.m_v3);return}var S=1/(E+g+b);this.m_v1.a=E*S;this.m_v2.a=g*S;this.m_v3.a=b*S;this.m_count=3};U.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};G.b2SimplexVertex=function(){};G.prototype.Set=function(t){this.wA.SetV(t.wA);this.wB.SetV(t.wB);this.w.SetV(t.w);this.a=t.a;this.indexA=t.indexA;this.indexB=t.indexB};z.b2TimeOfImpact=function(){};z.TimeOfImpact=function(t){++z.b2_toiCalls;var e=t.proxyA;var i=t.proxyB;var o=t.sweepA;var r=t.sweepB;l.b2Assert(o.t0==r.t0);l.b2Assert(1-o.t0>Number.MIN_VALUE);var n=e.m_radius+i.m_radius;var a=t.tolerance;var s=0;var c=1e3;var h=0;var p=0;z.s_cache.count=0;z.s_distanceInput.useRadii=false;for(;;){o.GetTransform(z.s_xfA,s);r.GetTransform(z.s_xfB,s);z.s_distanceInput.proxyA=e;z.s_distanceInput.proxyB=i;z.s_distanceInput.transformA=z.s_xfA;z.s_distanceInput.transformB=z.s_xfB;b.Distance(z.s_distanceOutput,z.s_cache,z.s_distanceInput);if(z.s_distanceOutput.distance<=0){s=1;break}z.s_fcn.Initialize(z.s_cache,e,z.s_xfA,i,z.s_xfB);var u=z.s_fcn.Evaluate(z.s_xfA,z.s_xfB);if(u<=0){s=1;break}if(h==0){if(u>n){p=m.Max(n-a,.75*n)}else{p=m.Max(u-a,.02*n)}}if(u-p<.5*a){if(h==0){s=1;break}break}var f=s;{var y=s;var d=1;var _=u;o.GetTransform(z.s_xfA,d);r.GetTransform(z.s_xfB,d);var v=z.s_fcn.Evaluate(z.s_xfA,z.s_xfB);if(v>=p){s=1;break}var x=0;for(;;){var E=0;if(x&1){E=y+(p-_)*(d-y)/(v-_)}else{E=.5*(y+d)}o.GetTransform(z.s_xfA,E);r.GetTransform(z.s_xfB,E);var g=z.s_fcn.Evaluate(z.s_xfA,z.s_xfB);if(m.Abs(g-p)<.025*a){f=E;break}if(g>p){y=E;_=g}else{d=E;v=g}++x;++z.b2_toiRootIters;if(x==50){break}}z.b2_toiMaxRootIters=m.Max(z.b2_toiMaxRootIters,x)}if(f<(1+100*Number.MIN_VALUE)*s){break}s=f;h++;++z.b2_toiIters;if(h==c){break}}z.b2_toiMaxIters=m.Max(z.b2_toiMaxIters,h);return s};Box2D.postDefs.push((function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new U;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new T;Box2D.Collision.b2TimeOfImpact.s_xfA=new u;Box2D.Collision.b2TimeOfImpact.s_xfB=new u;Box2D.Collision.b2TimeOfImpact.s_fcn=new F;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new R}));N.b2TOIInput=function(){this.proxyA=new w;this.proxyB=new w;this.sweepA=new p;this.sweepB=new p};k.b2WorldManifold=function(){this.m_normal=new f};k.prototype.b2WorldManifold=function(){this.m_points=new Vector(l.b2_maxManifoldPoints);for(var t=0;t<l.b2_maxManifoldPoints;t++){this.m_points[t]=new f}};k.prototype.Initialize=function(t,e,i,o,r){if(i===undefined)i=0;if(r===undefined)r=0;if(t.m_pointCount==0){return}var n=0;var a;var s;var l=0;var c=0;var h=0;var m=0;var p=0;var u=0;switch(t.m_type){case D.e_circles:{s=e.R;a=t.m_localPoint;var f=e.position.x+s.col1.x*a.x+s.col2.x*a.y;var y=e.position.y+s.col1.y*a.x+s.col2.y*a.y;s=o.R;a=t.m_points[0].m_localPoint;var d=o.position.x+s.col1.x*a.x+s.col2.x*a.y;var _=o.position.y+s.col1.y*a.x+s.col2.y*a.y;var v=d-f;var x=_-y;var E=v*v+x*x;if(E>Number.MIN_VALUE*Number.MIN_VALUE){var g=Math.sqrt(E);this.m_normal.x=v/g;this.m_normal.y=x/g}else{this.m_normal.x=1;this.m_normal.y=0}var b=f+i*this.m_normal.x;var T=y+i*this.m_normal.y;var R=d-r*this.m_normal.x;var w=_-r*this.m_normal.y;this.m_points[0].x=.5*(b+R);this.m_points[0].y=.5*(T+w)}break;case D.e_faceA:{s=e.R;a=t.m_localPlaneNormal;l=s.col1.x*a.x+s.col2.x*a.y;c=s.col1.y*a.x+s.col2.y*a.y;s=e.R;a=t.m_localPoint;h=e.position.x+s.col1.x*a.x+s.col2.x*a.y;m=e.position.y+s.col1.y*a.x+s.col2.y*a.y;this.m_normal.x=l;this.m_normal.y=c;for(n=0;n<t.m_pointCount;n++){s=o.R;a=t.m_points[n].m_localPoint;p=o.position.x+s.col1.x*a.x+s.col2.x*a.y;u=o.position.y+s.col1.y*a.x+s.col2.y*a.y;this.m_points[n].x=p+.5*(i-(p-h)*l-(u-m)*c-r)*l;this.m_points[n].y=u+.5*(i-(p-h)*l-(u-m)*c-r)*c}}break;case D.e_faceB:{s=o.R;a=t.m_localPlaneNormal;l=s.col1.x*a.x+s.col2.x*a.y;c=s.col1.y*a.x+s.col2.y*a.y;s=o.R;a=t.m_localPoint;h=o.position.x+s.col1.x*a.x+s.col2.x*a.y;m=o.position.y+s.col1.y*a.x+s.col2.y*a.y;this.m_normal.x=-l;this.m_normal.y=-c;for(n=0;n<t.m_pointCount;n++){s=e.R;a=t.m_points[n].m_localPoint;p=e.position.x+s.col1.x*a.x+s.col2.x*a.y;u=e.position.y+s.col1.y*a.x+s.col2.y*a.y;this.m_points[n].x=p+.5*(r-(p-h)*l-(u-m)*c-i)*l;this.m_points[n].y=u+.5*(r-(p-h)*l-(u-m)*c-i)*c}}break}};O.ClipVertex=function(){this.v=new f;this.id=new E};O.prototype.Set=function(t){this.v.SetV(t.v);this.id.Set(t.id)};W.Features=function(){};Object.defineProperty(W.prototype,"referenceEdge",{enumerable:false,configurable:true,get:function(){return this._referenceEdge}});Object.defineProperty(W.prototype,"referenceEdge",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._referenceEdge=t;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(W.prototype,"incidentEdge",{enumerable:false,configurable:true,get:function(){return this._incidentEdge}});Object.defineProperty(W.prototype,"incidentEdge",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._incidentEdge=t;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(W.prototype,"incidentVertex",{enumerable:false,configurable:true,get:function(){return this._incidentVertex}});Object.defineProperty(W.prototype,"incidentVertex",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._incidentVertex=t;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(W.prototype,"flip",{enumerable:false,configurable:true,get:function(){return this._flip}});Object.defineProperty(W.prototype,"flip",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._flip=t;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,o=Box2D.Collision.Shapes.b2CircleShape,r=Box2D.Collision.Shapes.b2EdgeChainDef,n=Box2D.Collision.Shapes.b2EdgeShape,a=Box2D.Collision.Shapes.b2MassData,s=Box2D.Collision.Shapes.b2PolygonShape,l=Box2D.Collision.Shapes.b2Shape,c=Box2D.Common.Math.b2Mat22,h=Box2D.Common.Math.b2Mat33,m=Box2D.Common.Math.b2Math,p=Box2D.Common.Math.b2Sweep,u=Box2D.Common.Math.b2Transform,f=Box2D.Common.Math.b2Vec2,y=Box2D.Common.Math.b2Vec3,d=Box2D.Dynamics.b2Body,_=Box2D.Dynamics.b2BodyDef,v=Box2D.Dynamics.b2ContactFilter,x=Box2D.Dynamics.b2ContactImpulse,E=Box2D.Dynamics.b2ContactListener,g=Box2D.Dynamics.b2ContactManager,b=Box2D.Dynamics.b2DebugDraw,T=Box2D.Dynamics.b2DestructionListener,R=Box2D.Dynamics.b2FilterData,w=Box2D.Dynamics.b2Fixture,S=Box2D.Dynamics.b2FixtureDef,C=Box2D.Dynamics.b2Island,A=Box2D.Dynamics.b2TimeStep,M=Box2D.Dynamics.b2World,D=Box2D.Collision.b2AABB,B=Box2D.Collision.b2Bound,H=Box2D.Collision.b2BoundValues,V=Box2D.Collision.b2Collision,L=Box2D.Collision.b2ContactID,P=Box2D.Collision.b2ContactPoint,F=Box2D.Collision.b2Distance,I=Box2D.Collision.b2DistanceInput,U=Box2D.Collision.b2DistanceOutput,G=Box2D.Collision.b2DistanceProxy,z=Box2D.Collision.b2DynamicTree,N=Box2D.Collision.b2DynamicTreeBroadPhase,k=Box2D.Collision.b2DynamicTreeNode,O=Box2D.Collision.b2DynamicTreePair,W=Box2D.Collision.b2Manifold,j=Box2D.Collision.b2ManifoldPoint,J=Box2D.Collision.b2Point,X=Box2D.Collision.b2RayCastInput,q=Box2D.Collision.b2RayCastOutput,Y=Box2D.Collision.b2Segment,K=Box2D.Collision.b2SeparationFunction,Z=Box2D.Collision.b2Simplex,Q=Box2D.Collision.b2SimplexCache,$=Box2D.Collision.b2SimplexVertex,tt=Box2D.Collision.b2TimeOfImpact,et=Box2D.Collision.b2TOIInput,it=Box2D.Collision.b2WorldManifold,ot=Box2D.Collision.ClipVertex,rt=Box2D.Collision.Features,nt=Box2D.Collision.IBroadPhase;Box2D.inherit(o,Box2D.Collision.Shapes.b2Shape);o.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;o.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new f};o.prototype.Copy=function(){var t=new o;t.Set(this);return t};o.prototype.Set=function(t){this.__super.Set.call(this,t);if(Box2D.is(t,o)){var e=t instanceof o?t:null;this.m_p.SetV(e.m_p)}};o.prototype.TestPoint=function(t,e){var i=t.R;var o=t.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y);var r=t.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);o=e.x-o;r=e.y-r;return o*o+r*r<=this.m_radius*this.m_radius};o.prototype.RayCast=function(t,e,i){var o=i.R;var r=i.position.x+(o.col1.x*this.m_p.x+o.col2.x*this.m_p.y);var n=i.position.y+(o.col1.y*this.m_p.x+o.col2.y*this.m_p.y);var a=e.p1.x-r;var s=e.p1.y-n;var l=a*a+s*s-this.m_radius*this.m_radius;var c=e.p2.x-e.p1.x;var h=e.p2.y-e.p1.y;var m=a*c+s*h;var p=c*c+h*h;var u=m*m-p*l;if(u<0||p<Number.MIN_VALUE){return false}var f=-(m+Math.sqrt(u));if(0<=f&&f<=e.maxFraction*p){f/=p;t.fraction=f;t.normal.x=a+f*c;t.normal.y=s+f*h;t.normal.Normalize();return true}return false};o.prototype.ComputeAABB=function(t,e){var i=e.R;var o=e.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y);var r=e.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);t.lowerBound.Set(o-this.m_radius,r-this.m_radius);t.upperBound.Set(o+this.m_radius,r+this.m_radius)};o.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;t.mass=e*i.b2_pi*this.m_radius*this.m_radius;t.center.SetV(this.m_p);t.I=t.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};o.prototype.ComputeSubmergedArea=function(t,e,i,o){if(e===undefined)e=0;var r=m.MulX(i,this.m_p);var n=-(m.Dot(t,r)-e);if(n<-this.m_radius+Number.MIN_VALUE){return 0}if(n>this.m_radius){o.SetV(r);return Math.PI*this.m_radius*this.m_radius}var a=this.m_radius*this.m_radius;var s=n*n;var l=a*(Math.asin(n/this.m_radius)+Math.PI/2)+n*Math.sqrt(a-s);var c=-2/3*Math.pow(a-s,1.5)/l;o.x=r.x+t.x*c;o.y=r.y+t.y*c;return l};o.prototype.GetLocalPosition=function(){return this.m_p};o.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)};o.prototype.GetRadius=function(){return this.m_radius};o.prototype.SetRadius=function(t){if(t===undefined)t=0;this.m_radius=t};o.prototype.b2CircleShape=function(t){if(t===undefined)t=0;this.__super.b2Shape.call(this);this.m_type=l.e_circleShape;this.m_radius=t};r.b2EdgeChainDef=function(){};r.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=true;this.vertices=[]};Box2D.inherit(n,Box2D.Collision.Shapes.b2Shape);n.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;n.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new f;this.m_v1=new f;this.m_v2=new f;this.m_coreV1=new f;this.m_coreV2=new f;this.m_normal=new f;this.m_direction=new f;this.m_cornerDir1=new f;this.m_cornerDir2=new f};n.prototype.TestPoint=function(t,e){return false};n.prototype.RayCast=function(t,e,i){var o;var r=e.p2.x-e.p1.x;var n=e.p2.y-e.p1.y;o=i.R;var a=i.position.x+(o.col1.x*this.m_v1.x+o.col2.x*this.m_v1.y);var s=i.position.y+(o.col1.y*this.m_v1.x+o.col2.y*this.m_v1.y);var l=i.position.y+(o.col1.y*this.m_v2.x+o.col2.y*this.m_v2.y)-s;var c=-(i.position.x+(o.col1.x*this.m_v2.x+o.col2.x*this.m_v2.y)-a);var h=100*Number.MIN_VALUE;var m=-(r*l+n*c);if(m>h){var p=e.p1.x-a;var u=e.p1.y-s;var f=p*l+u*c;if(0<=f&&f<=e.maxFraction*m){var y=-r*u+n*p;if(-h*m<=y&&y<=m*(1+h)){f/=m;t.fraction=f;var d=Math.sqrt(l*l+c*c);t.normal.x=l/d;t.normal.y=c/d;return true}}}return false};n.prototype.ComputeAABB=function(t,e){var i=e.R;var o=e.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y);var r=e.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y);var n=e.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y);var a=e.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);if(o<n){t.lowerBound.x=o;t.upperBound.x=n}else{t.lowerBound.x=n;t.upperBound.x=o}if(r<a){t.lowerBound.y=r;t.upperBound.y=a}else{t.lowerBound.y=a;t.upperBound.y=r}};n.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;t.mass=0;t.center.SetV(this.m_v1);t.I=0};n.prototype.ComputeSubmergedArea=function(t,e,i,o){if(e===undefined)e=0;var r=new f(t.x*e,t.y*e);var n=m.MulX(i,this.m_v1);var a=m.MulX(i,this.m_v2);var s=m.Dot(t,n)-e;var l=m.Dot(t,a)-e;if(s>0){if(l>0){return 0}else{n.x=-l/(s-l)*n.x+s/(s-l)*a.x;n.y=-l/(s-l)*n.y+s/(s-l)*a.y}}else{if(l>0){a.x=-l/(s-l)*n.x+s/(s-l)*a.x;a.y=-l/(s-l)*n.y+s/(s-l)*a.y}else{}}o.x=(r.x+n.x+a.x)/3;o.y=(r.y+n.y+a.y)/3;return.5*((n.x-r.x)*(a.y-r.y)-(n.y-r.y)*(a.x-r.x))};n.prototype.GetLength=function(){return this.m_length};n.prototype.GetVertex1=function(){return this.m_v1};n.prototype.GetVertex2=function(){return this.m_v2};n.prototype.GetCoreVertex1=function(){return this.m_coreV1};n.prototype.GetCoreVertex2=function(){return this.m_coreV2};n.prototype.GetNormalVector=function(){return this.m_normal};n.prototype.GetDirectionVector=function(){return this.m_direction};n.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};n.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};n.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};n.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};n.prototype.GetFirstVertex=function(t){var e=t.R;return new f(t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y))};n.prototype.GetNextEdge=function(){return this.m_nextEdge};n.prototype.GetPrevEdge=function(){return this.m_prevEdge};n.prototype.Support=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var o=t.R;var r=t.position.x+(o.col1.x*this.m_coreV1.x+o.col2.x*this.m_coreV1.y);var n=t.position.y+(o.col1.y*this.m_coreV1.x+o.col2.y*this.m_coreV1.y);var a=t.position.x+(o.col1.x*this.m_coreV2.x+o.col2.x*this.m_coreV2.y);var s=t.position.y+(o.col1.y*this.m_coreV2.x+o.col2.y*this.m_coreV2.y);if(r*e+n*i>a*e+s*i){this.s_supportVec.x=r;this.s_supportVec.y=n}else{this.s_supportVec.x=a;this.s_supportVec.y=s}return this.s_supportVec};n.prototype.b2EdgeShape=function(t,e){this.__super.b2Shape.call(this);this.m_type=l.e_edgeShape;this.m_prevEdge=null;this.m_nextEdge=null;this.m_v1=t;this.m_v2=e;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-i.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-i.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-i.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-i.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};n.prototype.SetPrevEdge=function(t,e,i,o){this.m_prevEdge=t;this.m_coreV1=e;this.m_cornerDir1=i;this.m_cornerConvex1=o};n.prototype.SetNextEdge=function(t,e,i,o){this.m_nextEdge=t;this.m_coreV2=e;this.m_cornerDir2=i;this.m_cornerConvex2=o};a.b2MassData=function(){this.mass=0;this.center=new f(0,0);this.I=0};Box2D.inherit(s,Box2D.Collision.Shapes.b2Shape);s.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;s.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};s.prototype.Copy=function(){var t=new s;t.Set(this);return t};s.prototype.Set=function(t){this.__super.Set.call(this,t);if(Box2D.is(t,s)){var e=t instanceof s?t:null;this.m_centroid.SetV(e.m_centroid);this.m_vertexCount=e.m_vertexCount;this.Reserve(this.m_vertexCount);for(var i=0;i<this.m_vertexCount;i++){this.m_vertices[i].SetV(e.m_vertices[i]);this.m_normals[i].SetV(e.m_normals[i])}}};s.prototype.SetAsArray=function(t,e){if(e===undefined)e=0;var i=new Vector;var o=0,r;for(o=0;o<t.length;++o){r=t[o];i.push(r)}this.SetAsVector(i,e)};s.AsArray=function(t,e){if(e===undefined)e=0;var i=new s;i.SetAsArray(t,e);return i};s.prototype.SetAsVector=function(t,e){if(e===undefined)e=0;if(e==0)e=t.length;i.b2Assert(2<=e);this.m_vertexCount=e;this.Reserve(e);var o=0;for(o=0;o<this.m_vertexCount;o++){this.m_vertices[o].SetV(t[o])}for(o=0;o<this.m_vertexCount;++o){var r=parseInt(o);var n=parseInt(o+1<this.m_vertexCount?o+1:0);var a=m.SubtractVV(this.m_vertices[n],this.m_vertices[r]);i.b2Assert(a.LengthSquared()>Number.MIN_VALUE);this.m_normals[o].SetV(m.CrossVF(a,1));this.m_normals[o].Normalize()}this.m_centroid=s.ComputeCentroid(this.m_vertices,this.m_vertexCount)};s.AsVector=function(t,e){if(e===undefined)e=0;var i=new s;i.SetAsVector(t,e);return i};s.prototype.SetAsBox=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-t,-e);this.m_vertices[1].Set(t,-e);this.m_vertices[2].Set(t,e);this.m_vertices[3].Set(-t,e);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};s.AsBox=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;var i=new s;i.SetAsBox(t,e);return i};s.prototype.SetAsOrientedBox=function(t,e,i,o){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=null;if(o===undefined)o=0;this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-t,-e);this.m_vertices[1].Set(t,-e);this.m_vertices[2].Set(t,e);this.m_vertices[3].Set(-t,e);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=i;var r=new u;r.position=i;r.R.Set(o);for(var n=0;n<this.m_vertexCount;++n){this.m_vertices[n]=m.MulX(r,this.m_vertices[n]);this.m_normals[n]=m.MulMV(r.R,this.m_normals[n])}};s.AsOrientedBox=function(t,e,i,o){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=null;if(o===undefined)o=0;var r=new s;r.SetAsOrientedBox(t,e,i,o);return r};s.prototype.SetAsEdge=function(t,e){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(t);this.m_vertices[1].SetV(e);this.m_centroid.x=.5*(t.x+e.x);this.m_centroid.y=.5*(t.y+e.y);this.m_normals[0]=m.CrossVF(m.SubtractVV(e,t),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};s.AsEdge=function(t,e){var i=new s;i.SetAsEdge(t,e);return i};s.prototype.TestPoint=function(t,e){var i;var o=t.R;var r=e.x-t.position.x;var n=e.y-t.position.y;var a=r*o.col1.x+n*o.col1.y;var s=r*o.col2.x+n*o.col2.y;for(var l=0;l<this.m_vertexCount;++l){i=this.m_vertices[l];r=a-i.x;n=s-i.y;i=this.m_normals[l];var c=i.x*r+i.y*n;if(c>0){return false}}return true};s.prototype.RayCast=function(t,e,i){var o=0;var r=e.maxFraction;var n=0;var a=0;var s;var l;n=e.p1.x-i.position.x;a=e.p1.y-i.position.y;s=i.R;var c=n*s.col1.x+a*s.col1.y;var h=n*s.col2.x+a*s.col2.y;n=e.p2.x-i.position.x;a=e.p2.y-i.position.y;s=i.R;var m=n*s.col1.x+a*s.col1.y;var p=n*s.col2.x+a*s.col2.y;var u=m-c;var f=p-h;var y=parseInt(-1);for(var d=0;d<this.m_vertexCount;++d){l=this.m_vertices[d];n=l.x-c;a=l.y-h;l=this.m_normals[d];var _=l.x*n+l.y*a;var v=l.x*u+l.y*f;if(v==0){if(_<0){return false}}else{if(v<0&&_<o*v){o=_/v;y=d}else if(v>0&&_<r*v){r=_/v}}if(r<o-Number.MIN_VALUE){return false}}if(y>=0){t.fraction=o;s=i.R;l=this.m_normals[y];t.normal.x=s.col1.x*l.x+s.col2.x*l.y;t.normal.y=s.col1.y*l.x+s.col2.y*l.y;return true}return false};s.prototype.ComputeAABB=function(t,e){var i=e.R;var o=this.m_vertices[0];var r=e.position.x+(i.col1.x*o.x+i.col2.x*o.y);var n=e.position.y+(i.col1.y*o.x+i.col2.y*o.y);var a=r;var s=n;for(var l=1;l<this.m_vertexCount;++l){o=this.m_vertices[l];var c=e.position.x+(i.col1.x*o.x+i.col2.x*o.y);var h=e.position.y+(i.col1.y*o.x+i.col2.y*o.y);r=r<c?r:c;n=n<h?n:h;a=a>c?a:c;s=s>h?s:h}t.lowerBound.x=r-this.m_radius;t.lowerBound.y=n-this.m_radius;t.upperBound.x=a+this.m_radius;t.upperBound.y=s+this.m_radius};s.prototype.ComputeMass=function(t,e){if(e===undefined)e=0;if(this.m_vertexCount==2){t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x);t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y);t.mass=0;t.I=0;return}var i=0;var o=0;var r=0;var n=0;var a=0;var s=0;var l=1/3;for(var c=0;c<this.m_vertexCount;++c){var h=this.m_vertices[c];var m=c+1<this.m_vertexCount?this.m_vertices[parseInt(c+1)]:this.m_vertices[0];var p=h.x-a;var u=h.y-s;var f=m.x-a;var y=m.y-s;var d=p*y-u*f;var _=.5*d;r+=_;i+=_*l*(a+h.x+m.x);o+=_*l*(s+h.y+m.y);var v=a;var x=s;var E=p;var g=u;var b=f;var T=y;var R=l*(.25*(E*E+b*E+b*b)+(v*E+v*b))+.5*v*v;var w=l*(.25*(g*g+T*g+T*T)+(x*g+x*T))+.5*x*x;n+=d*(R+w)}t.mass=e*r;i*=1/r;o*=1/r;t.center.Set(i,o);t.I=e*n};s.prototype.ComputeSubmergedArea=function(t,e,i,o){if(e===undefined)e=0;var r=m.MulTMV(i.R,t);var n=e-m.Dot(t,i.position);var s=new Vector_a2j_Number;var l=0;var c=parseInt(-1);var h=parseInt(-1);var p=false;var u=0;for(u=0;u<this.m_vertexCount;++u){s[u]=m.Dot(r,this.m_vertices[u])-n;var y=s[u]<-Number.MIN_VALUE;if(u>0){if(y){if(!p){c=u-1;l++}}else{if(p){h=u-1;l++}}}p=y}switch(l){case 0:if(p){var d=new a;this.ComputeMass(d,1);o.SetV(m.MulX(i,d.center));return d.mass}else{return 0}break;case 1:if(c==-1){c=this.m_vertexCount-1}else{h=this.m_vertexCount-1}break}var _=parseInt((c+1)%this.m_vertexCount);var v=parseInt((h+1)%this.m_vertexCount);var x=(0-s[c])/(s[_]-s[c]);var E=(0-s[h])/(s[v]-s[h]);var g=new f(this.m_vertices[c].x*(1-x)+this.m_vertices[_].x*x,this.m_vertices[c].y*(1-x)+this.m_vertices[_].y*x);var b=new f(this.m_vertices[h].x*(1-E)+this.m_vertices[v].x*E,this.m_vertices[h].y*(1-E)+this.m_vertices[v].y*E);var T=0;var R=new f;var w=this.m_vertices[_];var S;u=_;while(u!=v){u=(u+1)%this.m_vertexCount;if(u==v)S=b;else S=this.m_vertices[u];var C=.5*((w.x-g.x)*(S.y-g.y)-(w.y-g.y)*(S.x-g.x));T+=C;R.x+=C*(g.x+w.x+S.x)/3;R.y+=C*(g.y+w.y+S.y)/3;w=S}R.Multiply(1/T);o.SetV(m.MulX(i,R));return T};s.prototype.GetVertexCount=function(){return this.m_vertexCount};s.prototype.GetVertices=function(){return this.m_vertices};s.prototype.GetNormals=function(){return this.m_normals};s.prototype.GetSupport=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var o=1;o<this.m_vertexCount;++o){var r=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;if(r>i){e=o;i=r}}return e};s.prototype.GetSupportVertex=function(t){var e=0;var i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y;for(var o=1;o<this.m_vertexCount;++o){var r=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;if(r>i){e=o;i=r}}return this.m_vertices[e]};s.prototype.Validate=function(){return false};s.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=l.e_polygonShape;this.m_centroid=new f;this.m_vertices=new Vector;this.m_normals=new Vector};s.prototype.Reserve=function(t){if(t===undefined)t=0;for(var e=parseInt(this.m_vertices.length);e<t;e++){this.m_vertices[e]=new f;this.m_normals[e]=new f}};s.ComputeCentroid=function(t,e){if(e===undefined)e=0;var i=new f;var o=0;var r=0;var n=0;var a=1/3;for(var s=0;s<e;++s){var l=t[s];var c=s+1<e?t[parseInt(s+1)]:t[0];var h=l.x-r;var m=l.y-n;var p=c.x-r;var u=c.y-n;var y=h*u-m*p;var d=.5*y;o+=d;i.x+=d*a*(r+l.x+c.x);i.y+=d*a*(n+l.y+c.y)}i.x*=1/o;i.y*=1/o;return i};s.ComputeOBB=function(t,e,i){if(i===undefined)i=0;var o=0;var r=new Vector(i+1);for(o=0;o<i;++o){r[o]=e[o]}r[i]=r[0];var n=Number.MAX_VALUE;for(o=1;o<=i;++o){var a=r[parseInt(o-1)];var s=r[o].x-a.x;var l=r[o].y-a.y;var c=Math.sqrt(s*s+l*l);s/=c;l/=c;var h=-l;var m=s;var p=Number.MAX_VALUE;var u=Number.MAX_VALUE;var f=-Number.MAX_VALUE;var y=-Number.MAX_VALUE;for(var d=0;d<i;++d){var _=r[d].x-a.x;var v=r[d].y-a.y;var x=s*_+l*v;var E=h*_+m*v;if(x<p)p=x;if(E<u)u=E;if(x>f)f=x;if(E>y)y=E}var g=(f-p)*(y-u);if(g<.95*n){n=g;t.R.col1.x=s;t.R.col1.y=l;t.R.col2.x=h;t.R.col2.y=m;var b=.5*(p+f);var T=.5*(u+y);var R=t.R;t.center.x=a.x+(R.col1.x*b+R.col2.x*T);t.center.y=a.y+(R.col1.y*b+R.col2.y*T);t.extents.x=.5*(f-p);t.extents.y=.5*(y-u)}}};Box2D.postDefs.push((function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new c}));l.b2Shape=function(){};l.prototype.Copy=function(){return null};l.prototype.Set=function(t){this.m_radius=t.m_radius};l.prototype.GetType=function(){return this.m_type};l.prototype.TestPoint=function(t,e){return false};l.prototype.RayCast=function(t,e,i){return false};l.prototype.ComputeAABB=function(t,e){};l.prototype.ComputeMass=function(t,e){if(e===undefined)e=0};l.prototype.ComputeSubmergedArea=function(t,e,i,o){if(e===undefined)e=0;return 0};l.TestOverlap=function(t,e,i,o){var r=new I;r.proxyA=new G;r.proxyA.Set(t);r.proxyB=new G;r.proxyB.Set(i);r.transformA=e;r.transformB=o;r.useRadii=true;var n=new Q;n.count=0;var a=new U;F.Distance(a,n,r);return a.distance<10*Number.MIN_VALUE};l.prototype.b2Shape=function(){this.m_type=l.e_unknownShape;this.m_radius=i.b2_linearSlop};Box2D.postDefs.push((function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)}))})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,o=Box2D.Common.Math.b2Mat22,r=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math,a=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,l=Box2D.Common.Math.b2Vec2,c=Box2D.Common.Math.b2Vec3;t.b2Color=function(){this._r=0;this._g=0;this._b=0};t.prototype.b2Color=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this._r=Box2D.parseUInt(255*n.Clamp(t,0,1));this._g=Box2D.parseUInt(255*n.Clamp(e,0,1));this._b=Box2D.parseUInt(255*n.Clamp(i,0,1))};t.prototype.Set=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this._r=Box2D.parseUInt(255*n.Clamp(t,0,1));this._g=Box2D.parseUInt(255*n.Clamp(e,0,1));this._b=Box2D.parseUInt(255*n.Clamp(i,0,1))};Object.defineProperty(t.prototype,"r",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._r=Box2D.parseUInt(255*n.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"g",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._g=Box2D.parseUInt(255*n.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"b",{enumerable:false,configurable:true,set:function(t){if(t===undefined)t=0;this._b=Box2D.parseUInt(255*n.Clamp(t,0,1))}});Object.defineProperty(t.prototype,"color",{enumerable:false,configurable:true,get:function(){return this._r<<16|this._g<<8|this._b}});i.b2Settings=function(){};i.b2MixFriction=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return Math.sqrt(t*e)};i.b2MixRestitution=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t>e?t:e};i.b2Assert=function(t){if(!t){throw"Assertion Failed"}};Box2D.postDefs.push((function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*i.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*i.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*i.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=1;Box2D.Common.b2Settings.b2_maxLinearCorrection=.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*i.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=i.b2_maxTranslation*i.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=.5*i.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=i.b2_maxRotation*i.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=.2;Box2D.Common.b2Settings.b2_timeToSleep=.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*i.b2_pi}))})();(function(){var t=Box2D.Collision.b2AABB,e=Box2D.Common.b2Color,i=Box2D.Common.b2internal,o=Box2D.Common.b2Settings,r=Box2D.Common.Math.b2Mat22,n=Box2D.Common.Math.b2Mat33,a=Box2D.Common.Math.b2Math,s=Box2D.Common.Math.b2Sweep,l=Box2D.Common.Math.b2Transform,c=Box2D.Common.Math.b2Vec2,h=Box2D.Common.Math.b2Vec3;r.b2Mat22=function(){this.col1=new c;this.col2=new c};r.prototype.b2Mat22=function(){this.SetIdentity()};r.FromAngle=function(t){if(t===undefined)t=0;var e=new r;e.Set(t);return e};r.FromVV=function(t,e){var i=new r;i.SetVV(t,e);return i};r.prototype.Set=function(t){if(t===undefined)t=0;var e=Math.cos(t);var i=Math.sin(t);this.col1.x=e;this.col2.x=-i;this.col1.y=i;this.col2.y=e};r.prototype.SetVV=function(t,e){this.col1.SetV(t);this.col2.SetV(e)};r.prototype.Copy=function(){var t=new r;t.SetM(this);return t};r.prototype.SetM=function(t){this.col1.SetV(t.col1);this.col2.SetV(t.col2)};r.prototype.AddM=function(t){this.col1.x+=t.col1.x;this.col1.y+=t.col1.y;this.col2.x+=t.col2.x;this.col2.y+=t.col2.y};r.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};r.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};r.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};r.prototype.GetInverse=function(t){var e=this.col1.x;var i=this.col2.x;var o=this.col1.y;var r=this.col2.y;var n=e*r-i*o;if(n!=0){n=1/n}t.col1.x=n*r;t.col2.x=-n*i;t.col1.y=-n*o;t.col2.y=n*e;return t};r.prototype.Solve=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var o=this.col1.x;var r=this.col2.x;var n=this.col1.y;var a=this.col2.y;var s=o*a-r*n;if(s!=0){s=1/s}t.x=s*(a*e-r*i);t.y=s*(o*i-n*e);return t};r.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};n.b2Mat33=function(){this.col1=new h;this.col2=new h;this.col3=new h};n.prototype.b2Mat33=function(t,e,i){if(t===undefined)t=null;if(e===undefined)e=null;if(i===undefined)i=null;if(!t&&!e&&!i){this.col1.SetZero();this.col2.SetZero();this.col3.SetZero()}else{this.col1.SetV(t);this.col2.SetV(e);this.col3.SetV(i)}};n.prototype.SetVVV=function(t,e,i){this.col1.SetV(t);this.col2.SetV(e);this.col3.SetV(i)};n.prototype.Copy=function(){return new n(this.col1,this.col2,this.col3)};n.prototype.SetM=function(t){this.col1.SetV(t.col1);this.col2.SetV(t.col2);this.col3.SetV(t.col3)};n.prototype.AddM=function(t){this.col1.x+=t.col1.x;this.col1.y+=t.col1.y;this.col1.z+=t.col1.z;this.col2.x+=t.col2.x;this.col2.y+=t.col2.y;this.col2.z+=t.col2.z;this.col3.x+=t.col3.x;this.col3.y+=t.col3.y;this.col3.z+=t.col3.z};n.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};n.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};n.prototype.Solve22=function(t,e,i){if(e===undefined)e=0;if(i===undefined)i=0;var o=this.col1.x;var r=this.col2.x;var n=this.col1.y;var a=this.col2.y;var s=o*a-r*n;if(s!=0){s=1/s}t.x=s*(a*e-r*i);t.y=s*(o*i-n*e);return t};n.prototype.Solve33=function(t,e,i,o){if(e===undefined)e=0;if(i===undefined)i=0;if(o===undefined)o=0;var r=this.col1.x;var n=this.col1.y;var a=this.col1.z;var s=this.col2.x;var l=this.col2.y;var c=this.col2.z;var h=this.col3.x;var m=this.col3.y;var p=this.col3.z;var u=r*(l*p-c*m)+n*(c*h-s*p)+a*(s*m-l*h);if(u!=0){u=1/u}t.x=u*(e*(l*p-c*m)+i*(c*h-s*p)+o*(s*m-l*h));t.y=u*(r*(i*p-o*m)+n*(o*h-e*p)+a*(e*m-i*h));t.z=u*(r*(l*o-c*i)+n*(c*e-s*o)+a*(s*i-l*e));return t};a.b2Math=function(){};a.IsValid=function(t){if(t===undefined)t=0;return isFinite(t)};a.Dot=function(t,e){return t.x*e.x+t.y*e.y};a.CrossVV=function(t,e){return t.x*e.y-t.y*e.x};a.CrossVF=function(t,e){if(e===undefined)e=0;var i=new c(e*t.y,-e*t.x);return i};a.CrossFV=function(t,e){if(t===undefined)t=0;var i=new c(-t*e.y,t*e.x);return i};a.MulMV=function(t,e){var i=new c(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return i};a.MulTMV=function(t,e){var i=new c(a.Dot(e,t.col1),a.Dot(e,t.col2));return i};a.MulX=function(t,e){var i=a.MulMV(t.R,e);i.x+=t.position.x;i.y+=t.position.y;return i};a.MulXT=function(t,e){var i=a.SubtractVV(e,t.position);var o=i.x*t.R.col1.x+i.y*t.R.col1.y;i.y=i.x*t.R.col2.x+i.y*t.R.col2.y;i.x=o;return i};a.AddVV=function(t,e){var i=new c(t.x+e.x,t.y+e.y);return i};a.SubtractVV=function(t,e){var i=new c(t.x-e.x,t.y-e.y);return i};a.Distance=function(t,e){var i=t.x-e.x;var o=t.y-e.y;return Math.sqrt(i*i+o*o)};a.DistanceSquared=function(t,e){var i=t.x-e.x;var o=t.y-e.y;return i*i+o*o};a.MulFV=function(t,e){if(t===undefined)t=0;var i=new c(t*e.x,t*e.y);return i};a.AddMM=function(t,e){var i=r.FromVV(a.AddVV(t.col1,e.col1),a.AddVV(t.col2,e.col2));return i};a.MulMM=function(t,e){var i=r.FromVV(a.MulMV(t,e.col1),a.MulMV(t,e.col2));return i};a.MulTMM=function(t,e){var i=new c(a.Dot(t.col1,e.col1),a.Dot(t.col2,e.col1));var o=new c(a.Dot(t.col1,e.col2),a.Dot(t.col2,e.col2));var n=r.FromVV(i,o);return n};a.Abs=function(t){if(t===undefined)t=0;return t>0?t:-t};a.AbsV=function(t){var e=new c(a.Abs(t.x),a.Abs(t.y));return e};a.AbsM=function(t){var e=r.FromVV(a.AbsV(t.col1),a.AbsV(t.col2));return e};a.Min=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t<e?t:e};a.MinV=function(t,e){var i=new c(a.Min(t.x,e.x),a.Min(t.y,e.y));return i};a.Max=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return t>e?t:e};a.MaxV=function(t,e){var i=new c(a.Max(t.x,e.x),a.Max(t.y,e.y));return i};a.Clamp=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;return t<e?e:t>i?i:t};a.ClampV=function(t,e,i){return a.MaxV(e,a.MinV(t,i))};a.Swap=function(t,e){var i=t[0];t[0]=e[0];e[0]=i};a.Random=function(){return Math.random()*2-1};a.RandomRange=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;var i=Math.random();i=(e-t)*i+t;return i};a.NextPowerOfTwo=function(t){if(t===undefined)t=0;t|=t>>1&2147483647;t|=t>>2&1073741823;t|=t>>4&268435455;t|=t>>8&16777215;t|=t>>16&65535;return t+1};a.IsPowerOfTwo=function(t){if(t===undefined)t=0;var e=t>0&&(t&t-1)==0;return e};Box2D.postDefs.push((function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new c(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=r.FromVV(new c(1,0),new c(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new l(a.b2Vec2_zero,a.b2Mat22_identity)}));s.b2Sweep=function(){this.localCenter=new c;this.c0=new c;this.c=new c};s.prototype.Set=function(t){this.localCenter.SetV(t.localCenter);this.c0.SetV(t.c0);this.c.SetV(t.c);this.a0=t.a0;this.a=t.a;this.t0=t.t0};s.prototype.Copy=function(){var t=new s;t.localCenter.SetV(this.localCenter);t.c0.SetV(this.c0);t.c.SetV(this.c);t.a0=this.a0;t.a=this.a;t.t0=this.t0;return t};s.prototype.GetTransform=function(t,e){if(e===undefined)e=0;t.position.x=(1-e)*this.c0.x+e*this.c.x;t.position.y=(1-e)*this.c0.y+e*this.c.y;var i=(1-e)*this.a0+e*this.a;t.R.Set(i);var o=t.R;t.position.x-=o.col1.x*this.localCenter.x+o.col2.x*this.localCenter.y;t.position.y-=o.col1.y*this.localCenter.x+o.col2.y*this.localCenter.y};s.prototype.Advance=function(t){if(t===undefined)t=0;if(this.t0<t&&1-this.t0>Number.MIN_VALUE){var e=(t-this.t0)/(1-this.t0);this.c0.x=(1-e)*this.c0.x+e*this.c.x;this.c0.y=(1-e)*this.c0.y+e*this.c.y;this.a0=(1-e)*this.a0+e*this.a;this.t0=t}};l.b2Transform=function(){this.position=new c;this.R=new r};l.prototype.b2Transform=function(t,e){if(t===undefined)t=null;if(e===undefined)e=null;if(t){this.position.SetV(t);this.R.SetM(e)}};l.prototype.Initialize=function(t,e){this.position.SetV(t);this.R.SetM(e)};l.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};l.prototype.Set=function(t){this.position.SetV(t.position);this.R.SetM(t.R)};l.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};c.b2Vec2=function(){};c.prototype.b2Vec2=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.x=t;this.y=e};c.prototype.SetZero=function(){this.x=0;this.y=0};c.prototype.Set=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.x=t;this.y=e};c.prototype.SetV=function(t){this.x=t.x;this.y=t.y};c.prototype.GetNegative=function(){return new c(-this.x,-this.y)};c.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};c.Make=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;return new c(t,e)};c.prototype.Copy=function(){return new c(this.x,this.y)};c.prototype.Add=function(t){this.x+=t.x;this.y+=t.y};c.prototype.Subtract=function(t){this.x-=t.x;this.y-=t.y};c.prototype.Multiply=function(t){if(t===undefined)t=0;this.x*=t;this.y*=t};c.prototype.MulM=function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y;this.y=t.col1.y*e+t.col2.y*this.y};c.prototype.MulTM=function(t){var e=a.Dot(this,t.col1);this.y=a.Dot(this,t.col2);this.x=e};c.prototype.CrossVF=function(t){if(t===undefined)t=0;var e=this.x;this.x=t*this.y;this.y=-t*e};c.prototype.CrossFV=function(t){if(t===undefined)t=0;var e=this.x;this.x=-t*this.y;this.y=t*e};c.prototype.MinV=function(t){this.x=this.x<t.x?this.x:t.x;this.y=this.y<t.y?this.y:t.y};c.prototype.MaxV=function(t){this.x=this.x>t.x?this.x:t.x;this.y=this.y>t.y?this.y:t.y};c.prototype.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};c.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};c.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};c.prototype.Normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t<Number.MIN_VALUE){return 0}var e=1/t;this.x*=e;this.y*=e;return t};c.prototype.IsValid=function(){return a.IsValid(this.x)&&a.IsValid(this.y)};h.b2Vec3=function(){};h.prototype.b2Vec3=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this.x=t;this.y=e;this.z=i};h.prototype.SetZero=function(){this.x=this.y=this.z=0};h.prototype.Set=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;this.x=t;this.y=e;this.z=i};h.prototype.SetV=function(t){this.x=t.x;this.y=t.y;this.z=t.z};h.prototype.GetNegative=function(){return new h(-this.x,-this.y,-this.z)};h.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};h.prototype.Copy=function(){return new h(this.x,this.y,this.z)};h.prototype.Add=function(t){this.x+=t.x;this.y+=t.y;this.z+=t.z};h.prototype.Subtract=function(t){this.x-=t.x;this.y-=t.y;this.z-=t.z};h.prototype.Multiply=function(t){if(t===undefined)t=0;this.x*=t;this.y*=t;this.z*=t}})();(function(){var t=Box2D.Dynamics.Controllers.b2ControllerEdge,e=Box2D.Common.Math.b2Mat22,i=Box2D.Common.Math.b2Mat33,o=Box2D.Common.Math.b2Math,r=Box2D.Common.Math.b2Sweep,n=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,s=Box2D.Common.Math.b2Vec3,l=Box2D.Common.b2Color,c=Box2D.Common.b2internal,h=Box2D.Common.b2Settings,m=Box2D.Collision.b2AABB,p=Box2D.Collision.b2Bound,u=Box2D.Collision.b2BoundValues,f=Box2D.Collision.b2Collision,y=Box2D.Collision.b2ContactID,d=Box2D.Collision.b2ContactPoint,_=Box2D.Collision.b2Distance,v=Box2D.Collision.b2DistanceInput,x=Box2D.Collision.b2DistanceOutput,E=Box2D.Collision.b2DistanceProxy,g=Box2D.Collision.b2DynamicTree,b=Box2D.Collision.b2DynamicTreeBroadPhase,T=Box2D.Collision.b2DynamicTreeNode,R=Box2D.Collision.b2DynamicTreePair,w=Box2D.Collision.b2Manifold,S=Box2D.Collision.b2ManifoldPoint,C=Box2D.Collision.b2Point,A=Box2D.Collision.b2RayCastInput,M=Box2D.Collision.b2RayCastOutput,D=Box2D.Collision.b2Segment,B=Box2D.Collision.b2SeparationFunction,H=Box2D.Collision.b2Simplex,V=Box2D.Collision.b2SimplexCache,L=Box2D.Collision.b2SimplexVertex,P=Box2D.Collision.b2TimeOfImpact,F=Box2D.Collision.b2TOIInput,I=Box2D.Collision.b2WorldManifold,U=Box2D.Collision.ClipVertex,G=Box2D.Collision.Features,z=Box2D.Collision.IBroadPhase,N=Box2D.Collision.Shapes.b2CircleShape,k=Box2D.Collision.Shapes.b2EdgeChainDef,O=Box2D.Collision.Shapes.b2EdgeShape,W=Box2D.Collision.Shapes.b2MassData,j=Box2D.Collision.Shapes.b2PolygonShape,J=Box2D.Collision.Shapes.b2Shape,X=Box2D.Dynamics.b2Body,q=Box2D.Dynamics.b2BodyDef,Y=Box2D.Dynamics.b2ContactFilter,K=Box2D.Dynamics.b2ContactImpulse,Z=Box2D.Dynamics.b2ContactListener,Q=Box2D.Dynamics.b2ContactManager,$=Box2D.Dynamics.b2DebugDraw,tt=Box2D.Dynamics.b2DestructionListener,et=Box2D.Dynamics.b2FilterData,it=Box2D.Dynamics.b2Fixture,ot=Box2D.Dynamics.b2FixtureDef,rt=Box2D.Dynamics.b2Island,nt=Box2D.Dynamics.b2TimeStep,at=Box2D.Dynamics.b2World,st=Box2D.Dynamics.Contacts.b2CircleContact,lt=Box2D.Dynamics.Contacts.b2Contact,ct=Box2D.Dynamics.Contacts.b2ContactConstraint,ht=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,mt=Box2D.Dynamics.Contacts.b2ContactEdge,pt=Box2D.Dynamics.Contacts.b2ContactFactory,ut=Box2D.Dynamics.Contacts.b2ContactRegister,ft=Box2D.Dynamics.Contacts.b2ContactResult,yt=Box2D.Dynamics.Contacts.b2ContactSolver,dt=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,_t=Box2D.Dynamics.Contacts.b2NullContact,vt=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,xt=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Et=Box2D.Dynamics.Contacts.b2PolygonContact,gt=Box2D.Dynamics.Contacts.b2PositionSolverManifold,bt=Box2D.Dynamics.Controllers.b2Controller,Tt=Box2D.Dynamics.Joints.b2DistanceJoint,Rt=Box2D.Dynamics.Joints.b2DistanceJointDef,wt=Box2D.Dynamics.Joints.b2FrictionJoint,St=Box2D.Dynamics.Joints.b2FrictionJointDef,Ct=Box2D.Dynamics.Joints.b2GearJoint,At=Box2D.Dynamics.Joints.b2GearJointDef,Mt=Box2D.Dynamics.Joints.b2Jacobian,Dt=Box2D.Dynamics.Joints.b2Joint,Bt=Box2D.Dynamics.Joints.b2JointDef,Ht=Box2D.Dynamics.Joints.b2JointEdge,Vt=Box2D.Dynamics.Joints.b2LineJoint,Lt=Box2D.Dynamics.Joints.b2LineJointDef,Pt=Box2D.Dynamics.Joints.b2MouseJoint,Ft=Box2D.Dynamics.Joints.b2MouseJointDef,It=Box2D.Dynamics.Joints.b2PrismaticJoint,Ut=Box2D.Dynamics.Joints.b2PrismaticJointDef,Gt=Box2D.Dynamics.Joints.b2PulleyJoint,zt=Box2D.Dynamics.Joints.b2PulleyJointDef,Nt=Box2D.Dynamics.Joints.b2RevoluteJoint,kt=Box2D.Dynamics.Joints.b2RevoluteJointDef,Ot=Box2D.Dynamics.Joints.b2WeldJoint,Wt=Box2D.Dynamics.Joints.b2WeldJointDef;X.b2Body=function(){this.m_xf=new n;this.m_sweep=new r;this.m_linearVelocity=new a;this.m_force=new a};X.prototype.connectEdges=function(t,e,i){if(i===undefined)i=0;var r=Math.atan2(e.GetDirectionVector().y,e.GetDirectionVector().x);var n=Math.tan((r-i)*.5);var a=o.MulFV(n,e.GetDirectionVector());a=o.SubtractVV(a,e.GetNormalVector());a=o.MulFV(h.b2_toiSlop,a);a=o.AddVV(a,e.GetVertex1());var s=o.AddVV(t.GetDirectionVector(),e.GetDirectionVector());s.Normalize();var l=o.Dot(t.GetDirectionVector(),e.GetNormalVector())>0;t.SetNextEdge(e,a,s,l);e.SetPrevEdge(t,a,s,l);return r};X.prototype.CreateFixture=function(t){if(this.m_world.IsLocked()==true){return null}var e=new it;e.Create(this,this.m_xf,t);if(this.m_flags&X.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;e.CreateProxy(i,this.m_xf)}e.m_next=this.m_fixtureList;this.m_fixtureList=e;++this.m_fixtureCount;e.m_body=this;if(e.m_density>0){this.ResetMassData()}this.m_world.m_flags|=at.e_newFixture;return e};X.prototype.CreateFixture2=function(t,e){if(e===undefined)e=0;var i=new ot;i.shape=t;i.density=e;return this.CreateFixture(i)};X.prototype.DestroyFixture=function(t){if(this.m_world.IsLocked()==true){return}var e=this.m_fixtureList;var i=null;var o=false;while(e!=null){if(e==t){if(i)i.m_next=t.m_next;else this.m_fixtureList=t.m_next;o=true;break}i=e;e=e.m_next}var r=this.m_contactList;while(r){var n=r.contact;r=r.next;var a=n.GetFixtureA();var s=n.GetFixtureB();if(t==a||t==s){this.m_world.m_contactManager.Destroy(n)}}if(this.m_flags&X.e_activeFlag){var l=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxy(l)}else{}t.Destroy();t.m_body=null;t.m_next=null;--this.m_fixtureCount;this.ResetMassData()};X.prototype.SetPositionAndAngle=function(t,e){if(e===undefined)e=0;var i;if(this.m_world.IsLocked()==true){return}this.m_xf.R.Set(e);this.m_xf.position.SetV(t);var o=this.m_xf.R;var r=this.m_sweep.localCenter;this.m_sweep.c.x=o.col1.x*r.x+o.col2.x*r.y;this.m_sweep.c.y=o.col1.y*r.x+o.col2.y*r.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=e;var n=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.Synchronize(n,this.m_xf,this.m_xf)}this.m_world.m_contactManager.FindNewContacts()};X.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())};X.prototype.GetTransform=function(){return this.m_xf};X.prototype.GetPosition=function(){return this.m_xf.position};X.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())};X.prototype.GetAngle=function(){return this.m_sweep.a};X.prototype.SetAngle=function(t){if(t===undefined)t=0;this.SetPositionAndAngle(this.GetPosition(),t)};X.prototype.GetWorldCenter=function(){return this.m_sweep.c};X.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};X.prototype.SetLinearVelocity=function(t){if(this.m_type==X.b2_staticBody){return}this.m_linearVelocity.SetV(t)};X.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};X.prototype.SetAngularVelocity=function(t){if(t===undefined)t=0;if(this.m_type==X.b2_staticBody){return}this.m_angularVelocity=t};X.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};X.prototype.GetDefinition=function(){var t=new q;t.type=this.GetType();t.allowSleep=(this.m_flags&X.e_allowSleepFlag)==X.e_allowSleepFlag;t.angle=this.GetAngle();t.angularDamping=this.m_angularDamping;t.angularVelocity=this.m_angularVelocity;t.fixedRotation=(this.m_flags&X.e_fixedRotationFlag)==X.e_fixedRotationFlag;t.bullet=(this.m_flags&X.e_bulletFlag)==X.e_bulletFlag;t.awake=(this.m_flags&X.e_awakeFlag)==X.e_awakeFlag;t.linearDamping=this.m_linearDamping;t.linearVelocity.SetV(this.GetLinearVelocity());t.position=this.GetPosition();t.userData=this.GetUserData();return t};X.prototype.ApplyForce=function(t,e){if(this.m_type!=X.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_force.x+=t.x;this.m_force.y+=t.y;this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x};X.prototype.ApplyTorque=function(t){if(t===undefined)t=0;if(this.m_type!=X.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_torque+=t};X.prototype.ApplyImpulse=function(t,e){if(this.m_type!=X.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_linearVelocity.x+=this.m_invMass*t.x;this.m_linearVelocity.y+=this.m_invMass*t.y;this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)};X.prototype.Split=function(t){var e=this.GetLinearVelocity().Copy();var i=this.GetAngularVelocity();var r=this.GetWorldCenter();var n=this;var a=this.m_world.CreateBody(this.GetDefinition());var s;for(var l=n.m_fixtureList;l;){if(t(l)){var c=l.m_next;if(s){s.m_next=c}else{n.m_fixtureList=c}n.m_fixtureCount--;l.m_next=a.m_fixtureList;a.m_fixtureList=l;a.m_fixtureCount++;l.m_body=a;l=c}else{s=l;l=l.m_next}}n.ResetMassData();a.ResetMassData();var h=n.GetWorldCenter();var m=a.GetWorldCenter();var p=o.AddVV(e,o.CrossFV(i,o.SubtractVV(h,r)));var u=o.AddVV(e,o.CrossFV(i,o.SubtractVV(m,r)));n.SetLinearVelocity(p);a.SetLinearVelocity(u);n.SetAngularVelocity(i);a.SetAngularVelocity(i);n.SynchronizeFixtures();a.SynchronizeFixtures();return a};X.prototype.Merge=function(t){var e;for(e=t.m_fixtureList;e;){var i=e.m_next;t.m_fixtureCount--;e.m_next=this.m_fixtureList;this.m_fixtureList=e;this.m_fixtureCount++;e.m_body=r;e=i}o.m_fixtureCount=0;var o=this;var r=t;var n=o.GetWorldCenter();var a=r.GetWorldCenter();var s=o.GetLinearVelocity().Copy();var l=r.GetLinearVelocity().Copy();var c=o.GetAngularVelocity();var h=r.GetAngularVelocity();o.ResetMassData();this.SynchronizeFixtures()};X.prototype.GetMass=function(){return this.m_mass};X.prototype.GetInertia=function(){return this.m_I};X.prototype.GetMassData=function(t){t.mass=this.m_mass;t.I=this.m_I;t.center.SetV(this.m_sweep.localCenter)};X.prototype.SetMassData=function(t){h.b2Assert(this.m_world.IsLocked()==false);if(this.m_world.IsLocked()==true){return}if(this.m_type!=X.b2_dynamicBody){return}this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_mass=t.mass;if(this.m_mass<=0){this.m_mass=1}this.m_invMass=1/this.m_mass;if(t.I>0&&(this.m_flags&X.e_fixedRotationFlag)==0){this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y);this.m_invI=1/this.m_I}var e=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t.center);this.m_sweep.c0.SetV(o.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-e.x)};X.prototype.ResetMassData=function(){this.m_mass=0;this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_sweep.localCenter.SetZero();if(this.m_type==X.b2_staticBody||this.m_type==X.b2_kinematicBody){return}var t=a.Make(0,0);for(var e=this.m_fixtureList;e;e=e.m_next){if(e.m_density==0){continue}var i=e.GetMassData();this.m_mass+=i.mass;t.x+=i.center.x*i.mass;t.y+=i.center.y*i.mass;this.m_I+=i.I}if(this.m_mass>0){this.m_invMass=1/this.m_mass;t.x*=this.m_invMass;t.y*=this.m_invMass}else{this.m_mass=1;this.m_invMass=1}if(this.m_I>0&&(this.m_flags&X.e_fixedRotationFlag)==0){this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y);this.m_I*=this.m_inertiaScale;h.b2Assert(this.m_I>0);this.m_invI=1/this.m_I}else{this.m_I=0;this.m_invI=0}var r=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t);this.m_sweep.c0.SetV(o.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-r.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-r.x)};X.prototype.GetWorldPoint=function(t){var e=this.m_xf.R;var i=new a(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);i.x+=this.m_xf.position.x;i.y+=this.m_xf.position.y;return i};X.prototype.GetWorldVector=function(t){return o.MulMV(this.m_xf.R,t)};X.prototype.GetLocalPoint=function(t){return o.MulXT(this.m_xf,t)};X.prototype.GetLocalVector=function(t){return o.MulTMV(this.m_xf.R,t)};X.prototype.GetLinearVelocityFromWorldPoint=function(t){return new a(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))};X.prototype.GetLinearVelocityFromLocalPoint=function(t){var e=this.m_xf.R;var i=new a(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);i.x+=this.m_xf.position.x;i.y+=this.m_xf.position.y;return new a(this.m_linearVelocity.x-this.m_angularVelocity*(i.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(i.x-this.m_sweep.c.x))};X.prototype.GetLinearDamping=function(){return this.m_linearDamping};X.prototype.SetLinearDamping=function(t){if(t===undefined)t=0;this.m_linearDamping=t};X.prototype.GetAngularDamping=function(){return this.m_angularDamping};X.prototype.SetAngularDamping=function(t){if(t===undefined)t=0;this.m_angularDamping=t};X.prototype.SetType=function(t){if(t===undefined)t=0;if(this.m_type==t){return}this.m_type=t;this.ResetMassData();if(this.m_type==X.b2_staticBody){this.m_linearVelocity.SetZero();this.m_angularVelocity=0}this.SetAwake(true);this.m_force.SetZero();this.m_torque=0;for(var e=this.m_contactList;e;e=e.next){e.contact.FlagForFiltering()}};X.prototype.GetType=function(){return this.m_type};X.prototype.SetBullet=function(t){if(t){this.m_flags|=X.e_bulletFlag}else{this.m_flags&=~X.e_bulletFlag}};X.prototype.IsBullet=function(){return(this.m_flags&X.e_bulletFlag)==X.e_bulletFlag};X.prototype.SetSleepingAllowed=function(t){if(t){this.m_flags|=X.e_allowSleepFlag}else{this.m_flags&=~X.e_allowSleepFlag;this.SetAwake(true)}};X.prototype.SetAwake=function(t){if(t){this.m_flags|=X.e_awakeFlag;this.m_sleepTime=0}else{this.m_flags&=~X.e_awakeFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0}};X.prototype.IsAwake=function(){return(this.m_flags&X.e_awakeFlag)==X.e_awakeFlag};X.prototype.SetFixedRotation=function(t){if(t){this.m_flags|=X.e_fixedRotationFlag}else{this.m_flags&=~X.e_fixedRotationFlag}this.ResetMassData()};X.prototype.IsFixedRotation=function(){return(this.m_flags&X.e_fixedRotationFlag)==X.e_fixedRotationFlag};X.prototype.SetActive=function(t){if(t==this.IsActive()){return}var e;var i;if(t){this.m_flags|=X.e_activeFlag;e=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.CreateProxy(e,this.m_xf)}}else{this.m_flags&=~X.e_activeFlag;e=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next){i.DestroyProxy(e)}var o=this.m_contactList;while(o){var r=o;o=o.next;this.m_world.m_contactManager.Destroy(r.contact)}this.m_contactList=null}};X.prototype.IsActive=function(){return(this.m_flags&X.e_activeFlag)==X.e_activeFlag};X.prototype.IsSleepingAllowed=function(){return(this.m_flags&X.e_allowSleepFlag)==X.e_allowSleepFlag};X.prototype.GetFixtureList=function(){return this.m_fixtureList};X.prototype.GetJointList=function(){return this.m_jointList};X.prototype.GetControllerList=function(){return this.m_controllerList};X.prototype.GetContactList=function(){return this.m_contactList};X.prototype.GetNext=function(){return this.m_next};X.prototype.GetUserData=function(){return this.m_userData};X.prototype.SetUserData=function(t){this.m_userData=t};X.prototype.GetWorld=function(){return this.m_world};X.prototype.b2Body=function(t,e){this.m_flags=0;if(t.bullet){this.m_flags|=X.e_bulletFlag}if(t.fixedRotation){this.m_flags|=X.e_fixedRotationFlag}if(t.allowSleep){this.m_flags|=X.e_allowSleepFlag}if(t.awake){this.m_flags|=X.e_awakeFlag}if(t.active){this.m_flags|=X.e_activeFlag}this.m_world=e;this.m_xf.position.SetV(t.position);this.m_xf.R.Set(t.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=t.angle;var i=this.m_xf.R;var o=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*o.x+i.col2.x*o.y;this.m_sweep.c.y=i.col1.y*o.x+i.col2.y*o.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_jointList=null;this.m_controllerList=null;this.m_contactList=null;this.m_controllerCount=0;this.m_prev=null;this.m_next=null;this.m_linearVelocity.SetV(t.linearVelocity);this.m_angularVelocity=t.angularVelocity;this.m_linearDamping=t.linearDamping;this.m_angularDamping=t.angularDamping;this.m_force.Set(0,0);this.m_torque=0;this.m_sleepTime=0;this.m_type=t.type;if(this.m_type==X.b2_dynamicBody){this.m_mass=1;this.m_invMass=1}else{this.m_mass=0;this.m_invMass=0}this.m_I=0;this.m_invI=0;this.m_inertiaScale=t.inertiaScale;this.m_userData=t.userData;this.m_fixtureList=null;this.m_fixtureCount=0};X.prototype.SynchronizeFixtures=function(){var t=X.s_xf1;t.R.Set(this.m_sweep.a0);var e=t.R;var i=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(e.col1.x*i.x+e.col2.x*i.y);t.position.y=this.m_sweep.c0.y-(e.col1.y*i.x+e.col2.y*i.y);var o;var r=this.m_world.m_contactManager.m_broadPhase;for(o=this.m_fixtureList;o;o=o.m_next){o.Synchronize(r,t,this.m_xf)}};X.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R;var e=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*e.x+t.col2.x*e.y);this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*e.x+t.col2.y*e.y)};X.prototype.ShouldCollide=function(t){if(this.m_type!=X.b2_dynamicBody&&t.m_type!=X.b2_dynamicBody){return false}for(var e=this.m_jointList;e;e=e.next){if(e.other==t)if(e.joint.m_collideConnected==false){return false}}return true};X.prototype.Advance=function(t){if(t===undefined)t=0;this.m_sweep.Advance(t);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push((function(){Box2D.Dynamics.b2Body.s_xf1=new n;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2}));q.b2BodyDef=function(){this.position=new a;this.linearVelocity=new a};q.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularVelocity=0;this.linearDamping=0;this.angularDamping=0;this.allowSleep=true;this.awake=true;this.fixedRotation=false;this.bullet=false;this.type=X.b2_staticBody;this.active=true;this.inertiaScale=1};Y.b2ContactFilter=function(){};Y.prototype.ShouldCollide=function(t,e){var i=t.GetFilterData();var o=e.GetFilterData();if(i.groupIndex==o.groupIndex&&i.groupIndex!=0){return i.groupIndex>0}var r=(i.maskBits&o.categoryBits)!=0&&(i.categoryBits&o.maskBits)!=0;return r};Y.prototype.RayCollide=function(t,e){if(!t)return true;return this.ShouldCollide(t instanceof it?t:null,e)};Box2D.postDefs.push((function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new Y}));K.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(h.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(h.b2_maxManifoldPoints)};Z.b2ContactListener=function(){};Z.prototype.BeginContact=function(t){};Z.prototype.EndContact=function(t){};Z.prototype.PreSolve=function(t,e){};Z.prototype.PostSolve=function(t,e){};Box2D.postDefs.push((function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new Z}));Q.b2ContactManager=function(){};Q.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=Y.b2_defaultFilter;this.m_contactListener=Z.b2_defaultListener;this.m_contactFactory=new pt(this.m_allocator);this.m_broadPhase=new b};Q.prototype.AddPair=function(t,e){var i=t instanceof it?t:null;var o=e instanceof it?e:null;var r=i.GetBody();var n=o.GetBody();if(r==n)return;var a=n.GetContactList();while(a){if(a.other==r){var s=a.contact.GetFixtureA();var l=a.contact.GetFixtureB();if(s==i&&l==o)return;if(s==o&&l==i)return}a=a.next}if(n.ShouldCollide(r)==false){return}if(this.m_contactFilter.ShouldCollide(i,o)==false){return}var c=this.m_contactFactory.Create(i,o);i=c.GetFixtureA();o=c.GetFixtureB();r=i.m_body;n=o.m_body;c.m_prev=null;c.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null){this.m_world.m_contactList.m_prev=c}this.m_world.m_contactList=c;c.m_nodeA.contact=c;c.m_nodeA.other=n;c.m_nodeA.prev=null;c.m_nodeA.next=r.m_contactList;if(r.m_contactList!=null){r.m_contactList.prev=c.m_nodeA}r.m_contactList=c.m_nodeA;c.m_nodeB.contact=c;c.m_nodeB.other=r;c.m_nodeB.prev=null;c.m_nodeB.next=n.m_contactList;if(n.m_contactList!=null){n.m_contactList.prev=c.m_nodeB}n.m_contactList=c.m_nodeB;++this.m_world.m_contactCount;return};Q.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};Q.prototype.Destroy=function(t){var e=t.GetFixtureA();var i=t.GetFixtureB();var o=e.GetBody();var r=i.GetBody();if(t.IsTouching()){this.m_contactListener.EndContact(t)}if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_world.m_contactList){this.m_world.m_contactList=t.m_next}if(t.m_nodeA.prev){t.m_nodeA.prev.next=t.m_nodeA.next}if(t.m_nodeA.next){t.m_nodeA.next.prev=t.m_nodeA.prev}if(t.m_nodeA==o.m_contactList){o.m_contactList=t.m_nodeA.next}if(t.m_nodeB.prev){t.m_nodeB.prev.next=t.m_nodeB.next}if(t.m_nodeB.next){t.m_nodeB.next.prev=t.m_nodeB.prev}if(t.m_nodeB==r.m_contactList){r.m_contactList=t.m_nodeB.next}this.m_contactFactory.Destroy(t);--this.m_contactCount};Q.prototype.Collide=function(){var t=this.m_world.m_contactList;while(t){var e=t.GetFixtureA();var i=t.GetFixtureB();var o=e.GetBody();var r=i.GetBody();if(o.IsAwake()==false&&r.IsAwake()==false){t=t.GetNext();continue}if(t.m_flags&lt.e_filterFlag){if(r.ShouldCollide(o)==false){var n=t;t=n.GetNext();this.Destroy(n);continue}if(this.m_contactFilter.ShouldCollide(e,i)==false){n=t;t=n.GetNext();this.Destroy(n);continue}t.m_flags&=~lt.e_filterFlag}var a=e.m_proxy;var s=i.m_proxy;var l=this.m_broadPhase.TestOverlap(a,s);if(l==false){n=t;t=n.GetNext();this.Destroy(n);continue}t.Update(this.m_contactListener);t=t.GetNext()}};Box2D.postDefs.push((function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new d}));$.b2DebugDraw=function(){};$.prototype.b2DebugDraw=function(){};$.prototype.SetFlags=function(t){if(t===undefined)t=0};$.prototype.GetFlags=function(){};$.prototype.AppendFlags=function(t){if(t===undefined)t=0};$.prototype.ClearFlags=function(t){if(t===undefined)t=0};$.prototype.SetSprite=function(t){};$.prototype.GetSprite=function(){};$.prototype.SetDrawScale=function(t){if(t===undefined)t=0};$.prototype.GetDrawScale=function(){};$.prototype.SetLineThickness=function(t){if(t===undefined)t=0};$.prototype.GetLineThickness=function(){};$.prototype.SetAlpha=function(t){if(t===undefined)t=0};$.prototype.GetAlpha=function(){};$.prototype.SetFillAlpha=function(t){if(t===undefined)t=0};$.prototype.GetFillAlpha=function(){};$.prototype.SetXFormScale=function(t){if(t===undefined)t=0};$.prototype.GetXFormScale=function(){};$.prototype.DrawPolygon=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawSolidPolygon=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawCircle=function(t,e,i){if(e===undefined)e=0};$.prototype.DrawSolidCircle=function(t,e,i,o){if(e===undefined)e=0};$.prototype.DrawSegment=function(t,e,i){};$.prototype.DrawTransform=function(t){};Box2D.postDefs.push((function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32}));tt.b2DestructionListener=function(){};tt.prototype.SayGoodbyeJoint=function(t){};tt.prototype.SayGoodbyeFixture=function(t){};et.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};et.prototype.Copy=function(){var t=new et;t.categoryBits=this.categoryBits;t.maskBits=this.maskBits;t.groupIndex=this.groupIndex;return t};it.b2Fixture=function(){this.m_filter=new et};it.prototype.GetType=function(){return this.m_shape.GetType()};it.prototype.GetShape=function(){return this.m_shape};it.prototype.SetSensor=function(t){if(this.m_isSensor==t)return;this.m_isSensor=t;if(this.m_body==null)return;var e=this.m_body.GetContactList();while(e){var i=e.contact;var o=i.GetFixtureA();var r=i.GetFixtureB();if(o==this||r==this)i.SetSensor(o.IsSensor()||r.IsSensor());e=e.next}};it.prototype.IsSensor=function(){return this.m_isSensor};it.prototype.SetFilterData=function(t){this.m_filter=t.Copy();if(this.m_body)return;var e=this.m_body.GetContactList();while(e){var i=e.contact;var o=i.GetFixtureA();var r=i.GetFixtureB();if(o==this||r==this)i.FlagForFiltering();e=e.next}};it.prototype.GetFilterData=function(){return this.m_filter.Copy()};it.prototype.GetBody=function(){return this.m_body};it.prototype.GetNext=function(){return this.m_next};it.prototype.GetUserData=function(){return this.m_userData};it.prototype.SetUserData=function(t){this.m_userData=t};it.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)};it.prototype.RayCast=function(t,e){return this.m_shape.RayCast(t,e,this.m_body.GetTransform())};it.prototype.GetMassData=function(t){if(t===undefined)t=null;if(t==null){t=new W}this.m_shape.ComputeMass(t,this.m_density);return t};it.prototype.SetDensity=function(t){if(t===undefined)t=0;this.m_density=t};it.prototype.GetDensity=function(){return this.m_density};it.prototype.GetFriction=function(){return this.m_friction};it.prototype.SetFriction=function(t){if(t===undefined)t=0;this.m_friction=t};it.prototype.GetRestitution=function(){return this.m_restitution};it.prototype.SetRestitution=function(t){if(t===undefined)t=0;this.m_restitution=t};it.prototype.GetAABB=function(){return this.m_aabb};it.prototype.b2Fixture=function(){this.m_aabb=new m;this.m_userData=null;this.m_body=null;this.m_next=null;this.m_shape=null;this.m_density=0;this.m_friction=0;this.m_restitution=0};it.prototype.Create=function(t,e,i){this.m_userData=i.userData;this.m_friction=i.friction;this.m_restitution=i.restitution;this.m_body=t;this.m_next=null;this.m_filter=i.filter.Copy();this.m_isSensor=i.isSensor;this.m_shape=i.shape.Copy();this.m_density=i.density};it.prototype.Destroy=function(){this.m_shape=null};it.prototype.CreateProxy=function(t,e){this.m_shape.ComputeAABB(this.m_aabb,e);this.m_proxy=t.CreateProxy(this.m_aabb,this)};it.prototype.DestroyProxy=function(t){if(this.m_proxy==null){return}t.DestroyProxy(this.m_proxy);this.m_proxy=null};it.prototype.Synchronize=function(t,e,i){if(!this.m_proxy)return;var r=new m;var n=new m;this.m_shape.ComputeAABB(r,e);this.m_shape.ComputeAABB(n,i);this.m_aabb.Combine(r,n);var a=o.SubtractVV(i.position,e.position);t.MoveProxy(this.m_proxy,this.m_aabb,a)};ot.b2FixtureDef=function(){this.filter=new et};ot.prototype.b2FixtureDef=function(){this.shape=null;this.userData=null;this.friction=.2;this.restitution=0;this.density=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=false};rt.b2Island=function(){};rt.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};rt.prototype.Initialize=function(t,e,i,o,r,n){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;var a=0;this.m_bodyCapacity=t;this.m_contactCapacity=e;this.m_jointCapacity=i;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_allocator=o;this.m_listener=r;this.m_contactSolver=n;for(a=this.m_bodies.length;a<t;a++)this.m_bodies[a]=null;for(a=this.m_contacts.length;a<e;a++)this.m_contacts[a]=null;for(a=this.m_joints.length;a<i;a++)this.m_joints[a]=null};rt.prototype.Clear=function(){this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0};rt.prototype.Solve=function(t,e,i){var r=0;var n=0;var a;var s;for(r=0;r<this.m_bodyCount;++r){a=this.m_bodies[r];if(a.GetType()!=X.b2_dynamicBody)continue;a.m_linearVelocity.x+=t.dt*(e.x+a.m_invMass*a.m_force.x);a.m_linearVelocity.y+=t.dt*(e.y+a.m_invMass*a.m_force.y);a.m_angularVelocity+=t.dt*a.m_invI*a.m_torque;a.m_linearVelocity.Multiply(o.Clamp(1-t.dt*a.m_linearDamping,0,1));a.m_angularVelocity*=o.Clamp(1-t.dt*a.m_angularDamping,0,1)}this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var l=this.m_contactSolver;l.InitVelocityConstraints(t);for(r=0;r<this.m_jointCount;++r){s=this.m_joints[r];s.InitVelocityConstraints(t)}for(r=0;r<t.velocityIterations;++r){for(n=0;n<this.m_jointCount;++n){s=this.m_joints[n];s.SolveVelocityConstraints(t)}l.SolveVelocityConstraints()}for(r=0;r<this.m_jointCount;++r){s=this.m_joints[r];s.FinalizeVelocityConstraints()}l.FinalizeVelocityConstraints();for(r=0;r<this.m_bodyCount;++r){a=this.m_bodies[r];if(a.GetType()==X.b2_staticBody)continue;var c=t.dt*a.m_linearVelocity.x;var m=t.dt*a.m_linearVelocity.y;if(c*c+m*m>h.b2_maxTranslationSquared){a.m_linearVelocity.Normalize();a.m_linearVelocity.x*=h.b2_maxTranslation*t.inv_dt;a.m_linearVelocity.y*=h.b2_maxTranslation*t.inv_dt}var p=t.dt*a.m_angularVelocity;if(p*p>h.b2_maxRotationSquared){if(a.m_angularVelocity<0){a.m_angularVelocity=-h.b2_maxRotation*t.inv_dt}else{a.m_angularVelocity=h.b2_maxRotation*t.inv_dt}}a.m_sweep.c0.SetV(a.m_sweep.c);a.m_sweep.a0=a.m_sweep.a;a.m_sweep.c.x+=t.dt*a.m_linearVelocity.x;a.m_sweep.c.y+=t.dt*a.m_linearVelocity.y;a.m_sweep.a+=t.dt*a.m_angularVelocity;a.SynchronizeTransform()}for(r=0;r<t.positionIterations;++r){var u=l.SolvePositionConstraints(h.b2_contactBaumgarte);var f=true;for(n=0;n<this.m_jointCount;++n){s=this.m_joints[n];var y=s.SolvePositionConstraints(h.b2_contactBaumgarte);f=f&&y}if(u&&f){break}}this.Report(l.m_constraints);if(i){var d=Number.MAX_VALUE;var _=h.b2_linearSleepTolerance*h.b2_linearSleepTolerance;var v=h.b2_angularSleepTolerance*h.b2_angularSleepTolerance;for(r=0;r<this.m_bodyCount;++r){a=this.m_bodies[r];if(a.GetType()==X.b2_staticBody){continue}if((a.m_flags&X.e_allowSleepFlag)==0){a.m_sleepTime=0;d=0}if((a.m_flags&X.e_allowSleepFlag)==0||a.m_angularVelocity*a.m_angularVelocity>v||o.Dot(a.m_linearVelocity,a.m_linearVelocity)>_){a.m_sleepTime=0;d=0}else{a.m_sleepTime+=t.dt;d=o.Min(d,a.m_sleepTime)}}if(d>=h.b2_timeToSleep){for(r=0;r<this.m_bodyCount;++r){a=this.m_bodies[r];a.SetAwake(false)}}}};rt.prototype.SolveTOI=function(t){var e=0;var i=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var o=this.m_contactSolver;for(e=0;e<this.m_jointCount;++e){this.m_joints[e].InitVelocityConstraints(t)}for(e=0;e<t.velocityIterations;++e){o.SolveVelocityConstraints();for(i=0;i<this.m_jointCount;++i){this.m_joints[i].SolveVelocityConstraints(t)}}for(e=0;e<this.m_bodyCount;++e){var r=this.m_bodies[e];if(r.GetType()==X.b2_staticBody)continue;var n=t.dt*r.m_linearVelocity.x;var a=t.dt*r.m_linearVelocity.y;if(n*n+a*a>h.b2_maxTranslationSquared){r.m_linearVelocity.Normalize();r.m_linearVelocity.x*=h.b2_maxTranslation*t.inv_dt;r.m_linearVelocity.y*=h.b2_maxTranslation*t.inv_dt}var s=t.dt*r.m_angularVelocity;if(s*s>h.b2_maxRotationSquared){if(r.m_angularVelocity<0){r.m_angularVelocity=-h.b2_maxRotation*t.inv_dt}else{r.m_angularVelocity=h.b2_maxRotation*t.inv_dt}}r.m_sweep.c0.SetV(r.m_sweep.c);r.m_sweep.a0=r.m_sweep.a;r.m_sweep.c.x+=t.dt*r.m_linearVelocity.x;r.m_sweep.c.y+=t.dt*r.m_linearVelocity.y;r.m_sweep.a+=t.dt*r.m_angularVelocity;r.SynchronizeTransform()}var l=.75;for(e=0;e<t.positionIterations;++e){var c=o.SolvePositionConstraints(l);var m=true;for(i=0;i<this.m_jointCount;++i){var p=this.m_joints[i].SolvePositionConstraints(h.b2_contactBaumgarte);m=m&&p}if(c&&m){break}}this.Report(o.m_constraints)};rt.prototype.Report=function(t){if(this.m_listener==null){return}for(var e=0;e<this.m_contactCount;++e){var i=this.m_contacts[e];var o=t[e];for(var r=0;r<o.pointCount;++r){rt.s_impulse.normalImpulses[r]=o.points[r].normalImpulse;rt.s_impulse.tangentImpulses[r]=o.points[r].tangentImpulse}this.m_listener.PostSolve(i,rt.s_impulse)}};rt.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=t};rt.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t};rt.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t};Box2D.postDefs.push((function(){Box2D.Dynamics.b2Island.s_impulse=new K}));nt.b2TimeStep=function(){};nt.prototype.Set=function(t){this.dt=t.dt;this.inv_dt=t.inv_dt;this.positionIterations=t.positionIterations;this.velocityIterations=t.velocityIterations;this.warmStarting=t.warmStarting};at.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new Q;this.m_contactSolver=new yt;this.m_island=new rt};at.prototype.b2World=function(t,e){this.m_destructionListener=null;this.m_debugDraw=null;this.m_bodyList=null;this.m_contactList=null;this.m_jointList=null;this.m_controllerList=null;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_controllerCount=0;at.m_warmStarting=true;at.m_continuousPhysics=true;this.m_allowSleep=e;this.m_gravity=t;this.m_inv_dt0=0;this.m_contactManager.m_world=this;var i=new q;this.m_groundBody=this.CreateBody(i)};at.prototype.SetDestructionListener=function(t){this.m_destructionListener=t};at.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t};at.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t};at.prototype.SetDebugDraw=function(t){this.m_debugDraw=t};at.prototype.SetBroadPhase=function(t){var e=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var i=this.m_bodyList;i;i=i.m_next){for(var o=i.m_fixtureList;o;o=o.m_next){o.m_proxy=t.CreateProxy(e.GetFatAABB(o.m_proxy),o)}}};at.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};at.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};at.prototype.CreateBody=function(t){if(this.IsLocked()==true){return null}var e=new X(t,this);e.m_prev=null;e.m_next=this.m_bodyList;if(this.m_bodyList){this.m_bodyList.m_prev=e}this.m_bodyList=e;++this.m_bodyCount;return e};at.prototype.DestroyBody=function(t){if(this.IsLocked()==true){return}var e=t.m_jointList;while(e){var i=e;e=e.next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeJoint(i.joint)}this.DestroyJoint(i.joint)}var o=t.m_controllerList;while(o){var r=o;o=o.nextController;r.controller.RemoveBody(t)}var n=t.m_contactList;while(n){var a=n;n=n.next;this.m_contactManager.Destroy(a.contact)}t.m_contactList=null;var s=t.m_fixtureList;while(s){var l=s;s=s.m_next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeFixture(l)}l.DestroyProxy(this.m_contactManager.m_broadPhase);l.Destroy()}t.m_fixtureList=null;t.m_fixtureCount=0;if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_bodyList){this.m_bodyList=t.m_next}--this.m_bodyCount};at.prototype.CreateJoint=function(t){var e=Dt.Create(t,null);e.m_prev=null;e.m_next=this.m_jointList;if(this.m_jointList){this.m_jointList.m_prev=e}this.m_jointList=e;++this.m_jointCount;e.m_edgeA.joint=e;e.m_edgeA.other=e.m_bodyB;e.m_edgeA.prev=null;e.m_edgeA.next=e.m_bodyA.m_jointList;if(e.m_bodyA.m_jointList)e.m_bodyA.m_jointList.prev=e.m_edgeA;e.m_bodyA.m_jointList=e.m_edgeA;e.m_edgeB.joint=e;e.m_edgeB.other=e.m_bodyA;e.m_edgeB.prev=null;e.m_edgeB.next=e.m_bodyB.m_jointList;if(e.m_bodyB.m_jointList)e.m_bodyB.m_jointList.prev=e.m_edgeB;e.m_bodyB.m_jointList=e.m_edgeB;var i=t.bodyA;var o=t.bodyB;if(t.collideConnected==false){var r=o.GetContactList();while(r){if(r.other==i){r.contact.FlagForFiltering()}r=r.next}}return e};at.prototype.DestroyJoint=function(t){var e=t.m_collideConnected;if(t.m_prev){t.m_prev.m_next=t.m_next}if(t.m_next){t.m_next.m_prev=t.m_prev}if(t==this.m_jointList){this.m_jointList=t.m_next}var i=t.m_bodyA;var o=t.m_bodyB;i.SetAwake(true);o.SetAwake(true);if(t.m_edgeA.prev){t.m_edgeA.prev.next=t.m_edgeA.next}if(t.m_edgeA.next){t.m_edgeA.next.prev=t.m_edgeA.prev}if(t.m_edgeA==i.m_jointList){i.m_jointList=t.m_edgeA.next}t.m_edgeA.prev=null;t.m_edgeA.next=null;if(t.m_edgeB.prev){t.m_edgeB.prev.next=t.m_edgeB.next}if(t.m_edgeB.next){t.m_edgeB.next.prev=t.m_edgeB.prev}if(t.m_edgeB==o.m_jointList){o.m_jointList=t.m_edgeB.next}t.m_edgeB.prev=null;t.m_edgeB.next=null;Dt.Destroy(t,null);--this.m_jointCount;if(e==false){var r=o.GetContactList();while(r){if(r.other==i){r.contact.FlagForFiltering()}r=r.next}}};at.prototype.AddController=function(t){t.m_next=this.m_controllerList;t.m_prev=null;this.m_controllerList=t;t.m_world=this;this.m_controllerCount++;return t};at.prototype.RemoveController=function(t){if(t.m_prev)t.m_prev.m_next=t.m_next;if(t.m_next)t.m_next.m_prev=t.m_prev;if(this.m_controllerList==t)this.m_controllerList=t.m_next;this.m_controllerCount--};at.prototype.CreateController=function(t){if(t.m_world!=this)throw new Error("Controller can only be a member of one world");t.m_next=this.m_controllerList;t.m_prev=null;if(this.m_controllerList)this.m_controllerList.m_prev=t;this.m_controllerList=t;++this.m_controllerCount;t.m_world=this;return t};at.prototype.DestroyController=function(t){t.Clear();if(t.m_next)t.m_next.m_prev=t.m_prev;if(t.m_prev)t.m_prev.m_next=t.m_next;if(t==this.m_controllerList)this.m_controllerList=t.m_next;--this.m_controllerCount};at.prototype.SetWarmStarting=function(t){at.m_warmStarting=t};at.prototype.SetContinuousPhysics=function(t){at.m_continuousPhysics=t};at.prototype.GetBodyCount=function(){return this.m_bodyCount};at.prototype.GetJointCount=function(){return this.m_jointCount};at.prototype.GetContactCount=function(){return this.m_contactCount};at.prototype.SetGravity=function(t){this.m_gravity=t};at.prototype.GetGravity=function(){return this.m_gravity};at.prototype.GetGroundBody=function(){return this.m_groundBody};at.prototype.Step=function(t,e,i){if(t===undefined)t=0;if(e===undefined)e=0;if(i===undefined)i=0;if(this.m_flags&at.e_newFixture){this.m_contactManager.FindNewContacts();this.m_flags&=~at.e_newFixture}this.m_flags|=at.e_locked;var o=at.s_timestep2;o.dt=t;o.velocityIterations=e;o.positionIterations=i;if(t>0){o.inv_dt=1/t}else{o.inv_dt=0}o.dtRatio=this.m_inv_dt0*t;o.warmStarting=at.m_warmStarting;this.m_contactManager.Collide();if(o.dt>0){this.Solve(o)}if(at.m_continuousPhysics&&o.dt>0){this.SolveTOI(o)}if(o.dt>0){this.m_inv_dt0=o.inv_dt}this.m_flags&=~at.e_locked};at.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next){t.m_force.SetZero();t.m_torque=0}};at.prototype.DrawDebugData=function(){if(this.m_debugDraw==null){return}this.m_debugDraw.m_sprite.graphics.clear();var t=this.m_debugDraw.GetFlags();var e=0;var i;var o;var r;var n;var s;var c=new a;var h=new a;var p=new a;var u;var f=new m;var y=new m;var d=[new a,new a,new a,new a];var _=new l(0,0,0);if(t&$.e_shapeBit){for(i=this.m_bodyList;i;i=i.m_next){u=i.m_xf;for(o=i.GetFixtureList();o;o=o.m_next){r=o.GetShape();if(i.IsActive()==false){_.Set(.5,.5,.3);this.DrawShape(r,u,_)}else if(i.GetType()==X.b2_staticBody){_.Set(.5,.9,.5);this.DrawShape(r,u,_)}else if(i.GetType()==X.b2_kinematicBody){_.Set(.5,.5,.9);this.DrawShape(r,u,_)}else if(i.IsAwake()==false){_.Set(.6,.6,.6);this.DrawShape(r,u,_)}else{_.Set(.9,.7,.7);this.DrawShape(r,u,_)}}}}if(t&$.e_jointBit){for(n=this.m_jointList;n;n=n.m_next){this.DrawJoint(n)}}if(t&$.e_controllerBit){for(var v=this.m_controllerList;v;v=v.m_next){v.Draw(this.m_debugDraw)}}if(t&$.e_pairBit){_.Set(.3,.9,.9);for(var x=this.m_contactManager.m_contactList;x;x=x.GetNext()){var E=x.GetFixtureA();var g=x.GetFixtureB();var b=E.GetAABB().GetCenter();var T=g.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(b,T,_)}}if(t&$.e_aabbBit){s=this.m_contactManager.m_broadPhase;d=[new a,new a,new a,new a];for(i=this.m_bodyList;i;i=i.GetNext()){if(i.IsActive()==false){continue}for(o=i.GetFixtureList();o;o=o.GetNext()){var R=s.GetFatAABB(o.m_proxy);d[0].Set(R.lowerBound.x,R.lowerBound.y);d[1].Set(R.upperBound.x,R.lowerBound.y);d[2].Set(R.upperBound.x,R.upperBound.y);d[3].Set(R.lowerBound.x,R.upperBound.y);this.m_debugDraw.DrawPolygon(d,4,_)}}}if(t&$.e_centerOfMassBit){for(i=this.m_bodyList;i;i=i.m_next){u=at.s_xf;u.R=i.m_xf.R;u.position=i.GetWorldCenter();this.m_debugDraw.DrawTransform(u)}}};at.prototype.QueryAABB=function(t,e){var i=this;var o=i.m_contactManager.m_broadPhase;function r(e){return t(o.GetUserData(e))}o.Query(r,e)};at.prototype.QueryShape=function(t,e,i){var o=this;if(i===undefined)i=null;if(i==null){i=new n;i.SetIdentity()}var r=o.m_contactManager.m_broadPhase;function a(o){var n=r.GetUserData(o)instanceof it?r.GetUserData(o):null;if(J.TestOverlap(e,i,n.GetShape(),n.GetBody().GetTransform()))return t(n);return true}var s=new m;e.ComputeAABB(s,i);r.Query(a,s)};at.prototype.QueryPoint=function(t,e){var i=this;var o=i.m_contactManager.m_broadPhase;function r(i){var r=o.GetUserData(i)instanceof it?o.GetUserData(i):null;if(r.TestPoint(e))return t(r);return true}var n=new m;n.lowerBound.Set(e.x-h.b2_linearSlop,e.y-h.b2_linearSlop);n.upperBound.Set(e.x+h.b2_linearSlop,e.y+h.b2_linearSlop);o.Query(r,n)};at.prototype.RayCast=function(t,e,i){var o=this;var r=o.m_contactManager.m_broadPhase;var n=new M;function s(o,s){var l=r.GetUserData(s);var c=l instanceof it?l:null;var h=c.RayCast(n,o);if(h){var m=n.fraction;var p=new a((1-m)*e.x+m*i.x,(1-m)*e.y+m*i.y);return t(c,p,n.normal,m)}return o.maxFraction}var l=new A(e,i);r.RayCast(s,l)};at.prototype.RayCastOne=function(t,e){var i=this;var o;function r(t,e,i,r){if(r===undefined)r=0;o=t;return r}i.RayCast(r,t,e);return o};at.prototype.RayCastAll=function(t,e){var i=this;var o=new Vector;function r(t,e,i,r){if(r===undefined)r=0;o[o.length]=t;return 1}i.RayCast(r,t,e);return o};at.prototype.GetBodyList=function(){return this.m_bodyList};at.prototype.GetJointList=function(){return this.m_jointList};at.prototype.GetContactList=function(){return this.m_contactList};at.prototype.IsLocked=function(){return(this.m_flags&at.e_locked)>0};at.prototype.Solve=function(t){var e;for(var i=this.m_controllerList;i;i=i.m_next){i.Step(t)}var o=this.m_island;o.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(e=this.m_bodyList;e;e=e.m_next){e.m_flags&=~X.e_islandFlag}for(var r=this.m_contactList;r;r=r.m_next){r.m_flags&=~lt.e_islandFlag}for(var n=this.m_jointList;n;n=n.m_next){n.m_islandFlag=false}var a=parseInt(this.m_bodyCount);var s=this.s_stack;for(var l=this.m_bodyList;l;l=l.m_next){if(l.m_flags&X.e_islandFlag){continue}if(l.IsAwake()==false||l.IsActive()==false){continue}if(l.GetType()==X.b2_staticBody){continue}o.Clear();var c=0;s[c++]=l;l.m_flags|=X.e_islandFlag;while(c>0){e=s[--c];o.AddBody(e);if(e.IsAwake()==false){e.SetAwake(true)}if(e.GetType()==X.b2_staticBody){continue}var h;for(var m=e.m_contactList;m;m=m.next){if(m.contact.m_flags&lt.e_islandFlag){continue}if(m.contact.IsSensor()==true||m.contact.IsEnabled()==false||m.contact.IsTouching()==false){continue}o.AddContact(m.contact);m.contact.m_flags|=lt.e_islandFlag;h=m.other;if(h.m_flags&X.e_islandFlag){continue}s[c++]=h;h.m_flags|=X.e_islandFlag}for(var p=e.m_jointList;p;p=p.next){if(p.joint.m_islandFlag==true){continue}h=p.other;if(h.IsActive()==false){continue}o.AddJoint(p.joint);p.joint.m_islandFlag=true;if(h.m_flags&X.e_islandFlag){continue}s[c++]=h;h.m_flags|=X.e_islandFlag}}o.Solve(t,this.m_gravity,this.m_allowSleep);for(var u=0;u<o.m_bodyCount;++u){e=o.m_bodies[u];if(e.GetType()==X.b2_staticBody){e.m_flags&=~X.e_islandFlag}}}for(u=0;u<s.length;++u){if(!s[u])break;s[u]=null}for(e=this.m_bodyList;e;e=e.m_next){if(e.IsAwake()==false||e.IsActive()==false){continue}if(e.GetType()==X.b2_staticBody){continue}e.SynchronizeFixtures()}this.m_contactManager.FindNewContacts()};at.prototype.SolveTOI=function(t){var e;var i;var o;var r;var n;var a;var s;var l=this.m_island;l.Initialize(this.m_bodyCount,h.b2_maxTOIContactsPerIsland,h.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var c=at.s_queue;for(e=this.m_bodyList;e;e=e.m_next){e.m_flags&=~X.e_islandFlag;e.m_sweep.t0=0}var m;for(m=this.m_contactList;m;m=m.m_next){m.m_flags&=~(lt.e_toiFlag|lt.e_islandFlag)}for(s=this.m_jointList;s;s=s.m_next){s.m_islandFlag=false}for(;;){var p=null;var u=1;for(m=this.m_contactList;m;m=m.m_next){if(m.IsSensor()==true||m.IsEnabled()==false||m.IsContinuous()==false){continue}var f=1;if(m.m_flags&lt.e_toiFlag){f=m.m_toi}else{i=m.m_fixtureA;o=m.m_fixtureB;r=i.m_body;n=o.m_body;if((r.GetType()!=X.b2_dynamicBody||r.IsAwake()==false)&&(n.GetType()!=X.b2_dynamicBody||n.IsAwake()==false)){continue}var y=r.m_sweep.t0;if(r.m_sweep.t0<n.m_sweep.t0){y=n.m_sweep.t0;r.m_sweep.Advance(y)}else if(n.m_sweep.t0<r.m_sweep.t0){y=r.m_sweep.t0;n.m_sweep.Advance(y)}f=m.ComputeTOI(r.m_sweep,n.m_sweep);h.b2Assert(0<=f&&f<=1);if(f>0&&f<1){f=(1-f)*y+f;if(f>1)f=1}m.m_toi=f;m.m_flags|=lt.e_toiFlag}if(Number.MIN_VALUE<f&&f<u){p=m;u=f}}if(p==null||1-100*Number.MIN_VALUE<u){break}i=p.m_fixtureA;o=p.m_fixtureB;r=i.m_body;n=o.m_body;at.s_backupA.Set(r.m_sweep);at.s_backupB.Set(n.m_sweep);r.Advance(u);n.Advance(u);p.Update(this.m_contactManager.m_contactListener);p.m_flags&=~lt.e_toiFlag;if(p.IsSensor()==true||p.IsEnabled()==false){r.m_sweep.Set(at.s_backupA);n.m_sweep.Set(at.s_backupB);r.SynchronizeTransform();n.SynchronizeTransform();continue}if(p.IsTouching()==false){continue}var d=r;if(d.GetType()!=X.b2_dynamicBody){d=n}l.Clear();var _=0;var v=0;c[_+v++]=d;d.m_flags|=X.e_islandFlag;while(v>0){e=c[_++];--v;l.AddBody(e);if(e.IsAwake()==false){e.SetAwake(true)}if(e.GetType()!=X.b2_dynamicBody){continue}for(a=e.m_contactList;a;a=a.next){if(l.m_contactCount==l.m_contactCapacity){break}if(a.contact.m_flags&lt.e_islandFlag){continue}if(a.contact.IsSensor()==true||a.contact.IsEnabled()==false||a.contact.IsTouching()==false){continue}l.AddContact(a.contact);a.contact.m_flags|=lt.e_islandFlag;var x=a.other;if(x.m_flags&X.e_islandFlag){continue}if(x.GetType()!=X.b2_staticBody){x.Advance(u);x.SetAwake(true)}c[_+v]=x;++v;x.m_flags|=X.e_islandFlag}for(var E=e.m_jointList;E;E=E.next){if(l.m_jointCount==l.m_jointCapacity)continue;if(E.joint.m_islandFlag==true)continue;x=E.other;if(x.IsActive()==false){continue}l.AddJoint(E.joint);E.joint.m_islandFlag=true;if(x.m_flags&X.e_islandFlag)continue;if(x.GetType()!=X.b2_staticBody){x.Advance(u);x.SetAwake(true)}c[_+v]=x;++v;x.m_flags|=X.e_islandFlag}}var g=at.s_timestep;g.warmStarting=false;g.dt=(1-u)*t.dt;g.inv_dt=1/g.dt;g.dtRatio=0;g.velocityIterations=t.velocityIterations;g.positionIterations=t.positionIterations;l.SolveTOI(g);var b=0;for(b=0;b<l.m_bodyCount;++b){e=l.m_bodies[b];e.m_flags&=~X.e_islandFlag;if(e.IsAwake()==false){continue}if(e.GetType()!=X.b2_dynamicBody){continue}e.SynchronizeFixtures();for(a=e.m_contactList;a;a=a.next){a.contact.m_flags&=~lt.e_toiFlag}}for(b=0;b<l.m_contactCount;++b){m=l.m_contacts[b];m.m_flags&=~(lt.e_toiFlag|lt.e_islandFlag)}for(b=0;b<l.m_jointCount;++b){s=l.m_joints[b];s.m_islandFlag=false}this.m_contactManager.FindNewContacts()}};at.prototype.DrawJoint=function(t){var e=t.GetBodyA();var i=t.GetBodyB();var o=e.m_xf;var r=i.m_xf;var n=o.position;var a=r.position;var s=t.GetAnchorA();var l=t.GetAnchorB();var c=at.s_jointColor;switch(t.m_type){case Dt.e_distanceJoint:this.m_debugDraw.DrawSegment(s,l,c);break;case Dt.e_pulleyJoint:{var h=t instanceof Gt?t:null;var m=h.GetGroundAnchorA();var p=h.GetGroundAnchorB();this.m_debugDraw.DrawSegment(m,s,c);this.m_debugDraw.DrawSegment(p,l,c);this.m_debugDraw.DrawSegment(m,p,c)}break;case Dt.e_mouseJoint:this.m_debugDraw.DrawSegment(s,l,c);break;default:if(e!=this.m_groundBody)this.m_debugDraw.DrawSegment(n,s,c);this.m_debugDraw.DrawSegment(s,l,c);if(i!=this.m_groundBody)this.m_debugDraw.DrawSegment(a,l,c)}};at.prototype.DrawShape=function(t,e,i){switch(t.m_type){case J.e_circleShape:{var r=t instanceof N?t:null;var n=o.MulX(e,r.m_p);var a=r.m_radius;var s=e.R.col1;this.m_debugDraw.DrawSolidCircle(n,a,s,i)}break;case J.e_polygonShape:{var l=0;var c=t instanceof j?t:null;var h=parseInt(c.GetVertexCount());var m=c.GetVertices();var p=new Vector(h);for(l=0;l<h;++l){p[l]=o.MulX(e,m[l])}this.m_debugDraw.DrawSolidPolygon(p,h,i)}break;case J.e_edgeShape:{var u=t instanceof O?t:null;this.m_debugDraw.DrawSegment(o.MulX(e,u.GetVertex1()),o.MulX(e,u.GetVertex2()),i)}break}};Box2D.postDefs.push((function(){Box2D.Dynamics.b2World.s_timestep2=new nt;Box2D.Dynamics.b2World.s_xf=new n;Box2D.Dynamics.b2World.s_backupA=new r;Box2D.Dynamics.b2World.s_backupB=new r;Box2D.Dynamics.b2World.s_timestep=new nt;Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new l(.5,.8,.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2}))})();(function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2EdgeChainDef,i=Box2D.Collision.Shapes.b2EdgeShape,o=Box2D.Collision.Shapes.b2MassData,r=Box2D.Collision.Shapes.b2PolygonShape,n=Box2D.Collision.Shapes.b2Shape,a=Box2D.Dynamics.Contacts.b2CircleContact,s=Box2D.Dynamics.Contacts.b2Contact,l=Box2D.Dynamics.Contacts.b2ContactConstraint,c=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,h=Box2D.Dynamics.Contacts.b2ContactEdge,m=Box2D.Dynamics.Contacts.b2ContactFactory,p=Box2D.Dynamics.Contacts.b2ContactRegister,u=Box2D.Dynamics.Contacts.b2ContactResult,f=Box2D.Dynamics.Contacts.b2ContactSolver,y=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,d=Box2D.Dynamics.Contacts.b2NullContact,_=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,v=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,x=Box2D.Dynamics.Contacts.b2PolygonContact,E=Box2D.Dynamics.Contacts.b2PositionSolverManifold,g=Box2D.Dynamics.b2Body,b=Box2D.Dynamics.b2BodyDef,T=Box2D.Dynamics.b2ContactFilter,R=Box2D.Dynamics.b2ContactImpulse,w=Box2D.Dynamics.b2ContactListener,S=Box2D.Dynamics.b2ContactManager,C=Box2D.Dynamics.b2DebugDraw,A=Box2D.Dynamics.b2DestructionListener,M=Box2D.Dynamics.b2FilterData,D=Box2D.Dynamics.b2Fixture,B=Box2D.Dynamics.b2FixtureDef,H=Box2D.Dynamics.b2Island,V=Box2D.Dynamics.b2TimeStep,L=Box2D.Dynamics.b2World,P=Box2D.Common.b2Color,F=Box2D.Common.b2internal,I=Box2D.Common.b2Settings,U=Box2D.Common.Math.b2Mat22,G=Box2D.Common.Math.b2Mat33,z=Box2D.Common.Math.b2Math,N=Box2D.Common.Math.b2Sweep,k=Box2D.Common.Math.b2Transform,O=Box2D.Common.Math.b2Vec2,W=Box2D.Common.Math.b2Vec3,j=Box2D.Collision.b2AABB,J=Box2D.Collision.b2Bound,X=Box2D.Collision.b2BoundValues,q=Box2D.Collision.b2Collision,Y=Box2D.Collision.b2ContactID,K=Box2D.Collision.b2ContactPoint,Z=Box2D.Collision.b2Distance,Q=Box2D.Collision.b2DistanceInput,$=Box2D.Collision.b2DistanceOutput,tt=Box2D.Collision.b2DistanceProxy,et=Box2D.Collision.b2DynamicTree,it=Box2D.Collision.b2DynamicTreeBroadPhase,ot=Box2D.Collision.b2DynamicTreeNode,rt=Box2D.Collision.b2DynamicTreePair,nt=Box2D.Collision.b2Manifold,at=Box2D.Collision.b2ManifoldPoint,st=Box2D.Collision.b2Point,lt=Box2D.Collision.b2RayCastInput,ct=Box2D.Collision.b2RayCastOutput,ht=Box2D.Collision.b2Segment,mt=Box2D.Collision.b2SeparationFunction,pt=Box2D.Collision.b2Simplex,ut=Box2D.Collision.b2SimplexCache,ft=Box2D.Collision.b2SimplexVertex,yt=Box2D.Collision.b2TimeOfImpact,dt=Box2D.Collision.b2TOIInput,_t=Box2D.Collision.b2WorldManifold,vt=Box2D.Collision.ClipVertex,xt=Box2D.Collision.Features,Et=Box2D.Collision.IBroadPhase;Box2D.inherit(a,Box2D.Dynamics.Contacts.b2Contact);a.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;a.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};a.Create=function(t){return new a};a.Destroy=function(t,e){};a.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)};a.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody();var i=this.m_fixtureB.GetBody();q.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)};s.b2Contact=function(){this.m_nodeA=new h;this.m_nodeB=new h;this.m_manifold=new nt;this.m_oldManifold=new nt};s.prototype.GetManifold=function(){return this.m_manifold};s.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody();var i=this.m_fixtureB.GetBody();var o=this.m_fixtureA.GetShape();var r=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),o.m_radius,i.GetTransform(),r.m_radius)};s.prototype.IsTouching=function(){return(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag};s.prototype.IsContinuous=function(){return(this.m_flags&s.e_continuousFlag)==s.e_continuousFlag};s.prototype.SetSensor=function(t){if(t){this.m_flags|=s.e_sensorFlag}else{this.m_flags&=~s.e_sensorFlag}};s.prototype.IsSensor=function(){return(this.m_flags&s.e_sensorFlag)==s.e_sensorFlag};s.prototype.SetEnabled=function(t){if(t){this.m_flags|=s.e_enabledFlag}else{this.m_flags&=~s.e_enabledFlag}};s.prototype.IsEnabled=function(){return(this.m_flags&s.e_enabledFlag)==s.e_enabledFlag};s.prototype.GetNext=function(){return this.m_next};s.prototype.GetFixtureA=function(){return this.m_fixtureA};s.prototype.GetFixtureB=function(){return this.m_fixtureB};s.prototype.FlagForFiltering=function(){this.m_flags|=s.e_filterFlag};s.prototype.b2Contact=function(){};s.prototype.Reset=function(t,e){if(t===undefined)t=null;if(e===undefined)e=null;this.m_flags=s.e_enabledFlag;if(!t||!e){this.m_fixtureA=null;this.m_fixtureB=null;return}if(t.IsSensor()||e.IsSensor()){this.m_flags|=s.e_sensorFlag}var i=t.GetBody();var o=e.GetBody();if(i.GetType()!=g.b2_dynamicBody||i.IsBullet()||o.GetType()!=g.b2_dynamicBody||o.IsBullet()){this.m_flags|=s.e_continuousFlag}this.m_fixtureA=t;this.m_fixtureB=e;this.m_manifold.m_pointCount=0;this.m_prev=null;this.m_next=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null};s.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=e;this.m_flags|=s.e_enabledFlag;var i=false;var o=(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag;var r=this.m_fixtureA.m_body;var a=this.m_fixtureB.m_body;var l=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&s.e_sensorFlag){if(l){var c=this.m_fixtureA.GetShape();var h=this.m_fixtureB.GetShape();var m=r.GetTransform();var p=a.GetTransform();i=n.TestOverlap(c,m,h,p)}this.m_manifold.m_pointCount=0}else{if(r.GetType()!=g.b2_dynamicBody||r.IsBullet()||a.GetType()!=g.b2_dynamicBody||a.IsBullet()){this.m_flags|=s.e_continuousFlag}else{this.m_flags&=~s.e_continuousFlag}if(l){this.Evaluate();i=this.m_manifold.m_pointCount>0;for(var u=0;u<this.m_manifold.m_pointCount;++u){var f=this.m_manifold.m_points[u];f.m_normalImpulse=0;f.m_tangentImpulse=0;var y=f.m_id;for(var d=0;d<this.m_oldManifold.m_pointCount;++d){var _=this.m_oldManifold.m_points[d];if(_.m_id.key==y.key){f.m_normalImpulse=_.m_normalImpulse;f.m_tangentImpulse=_.m_tangentImpulse;break}}}}else{this.m_manifold.m_pointCount=0}if(i!=o){r.SetAwake(true);a.SetAwake(true)}}if(i){this.m_flags|=s.e_touchingFlag}else{this.m_flags&=~s.e_touchingFlag}if(o==false&&i==true){t.BeginContact(this)}if(o==true&&i==false){t.EndContact(this)}if((this.m_flags&s.e_sensorFlag)==0){t.PreSolve(this,this.m_oldManifold)}};s.prototype.Evaluate=function(){};s.prototype.ComputeTOI=function(t,e){s.s_input.proxyA.Set(this.m_fixtureA.GetShape());s.s_input.proxyB.Set(this.m_fixtureB.GetShape());s.s_input.sweepA=t;s.s_input.sweepB=e;s.s_input.tolerance=I.b2_linearSlop;return yt.TimeOfImpact(s.s_input)};Box2D.postDefs.push((function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64;Box2D.Dynamics.Contacts.b2Contact.s_input=new dt}));l.b2ContactConstraint=function(){this.localPlaneNormal=new O;this.localPoint=new O;this.normal=new O;this.normalMass=new U;this.K=new U};l.prototype.b2ContactConstraint=function(){this.points=new Vector(I.b2_maxManifoldPoints);for(var t=0;t<I.b2_maxManifoldPoints;t++){this.points[t]=new c}};c.b2ContactConstraintPoint=function(){this.localPoint=new O;this.rA=new O;this.rB=new O};h.b2ContactEdge=function(){};m.b2ContactFactory=function(){};m.prototype.b2ContactFactory=function(t){this.m_allocator=t;this.InitializeRegisters()};m.prototype.AddType=function(t,e,i,o){if(i===undefined)i=0;if(o===undefined)o=0;this.m_registers[i][o].createFcn=t;this.m_registers[i][o].destroyFcn=e;this.m_registers[i][o].primary=true;if(i!=o){this.m_registers[o][i].createFcn=t;this.m_registers[o][i].destroyFcn=e;this.m_registers[o][i].primary=false}};m.prototype.InitializeRegisters=function(){this.m_registers=new Vector(n.e_shapeTypeCount);for(var t=0;t<n.e_shapeTypeCount;t++){this.m_registers[t]=new Vector(n.e_shapeTypeCount);for(var e=0;e<n.e_shapeTypeCount;e++){this.m_registers[t][e]=new p}}this.AddType(a.Create,a.Destroy,n.e_circleShape,n.e_circleShape);this.AddType(_.Create,_.Destroy,n.e_polygonShape,n.e_circleShape);this.AddType(x.Create,x.Destroy,n.e_polygonShape,n.e_polygonShape);this.AddType(y.Create,y.Destroy,n.e_edgeShape,n.e_circleShape);this.AddType(v.Create,v.Destroy,n.e_polygonShape,n.e_edgeShape)};m.prototype.Create=function(t,e){var i=parseInt(t.GetType());var o=parseInt(e.GetType());var r=this.m_registers[i][o];var n;if(r.pool){n=r.pool;r.pool=n.m_next;r.poolCount--;n.Reset(t,e);return n}var a=r.createFcn;if(a!=null){if(r.primary){n=a(this.m_allocator);n.Reset(t,e);return n}else{n=a(this.m_allocator);n.Reset(e,t);return n}}else{return null}};m.prototype.Destroy=function(t){if(t.m_manifold.m_pointCount>0){t.m_fixtureA.m_body.SetAwake(true);t.m_fixtureB.m_body.SetAwake(true)}var e=parseInt(t.m_fixtureA.GetType());var i=parseInt(t.m_fixtureB.GetType());var o=this.m_registers[e][i];if(true){o.poolCount++;t.m_next=o.pool;o.pool=t}var r=o.destroyFcn;r(t,this.m_allocator)};p.b2ContactRegister=function(){};u.b2ContactResult=function(){this.position=new O;this.normal=new O;this.id=new Y};f.b2ContactSolver=function(){this.m_step=new V;this.m_constraints=new Vector};f.prototype.b2ContactSolver=function(){};f.prototype.Initialize=function(t,e,i,o){if(i===undefined)i=0;var r;this.m_step.Set(t);this.m_allocator=o;var n=0;var a;var s;this.m_constraintCount=i;while(this.m_constraints.length<this.m_constraintCount){this.m_constraints[this.m_constraints.length]=new l}for(n=0;n<i;++n){r=e[n];var c=r.m_fixtureA;var h=r.m_fixtureB;var m=c.m_shape;var p=h.m_shape;var u=m.m_radius;var y=p.m_radius;var d=c.m_body;var _=h.m_body;var v=r.GetManifold();var x=I.b2MixFriction(c.GetFriction(),h.GetFriction());var E=I.b2MixRestitution(c.GetRestitution(),h.GetRestitution());var g=d.m_linearVelocity.x;var b=d.m_linearVelocity.y;var T=_.m_linearVelocity.x;var R=_.m_linearVelocity.y;var w=d.m_angularVelocity;var S=_.m_angularVelocity;I.b2Assert(v.m_pointCount>0);f.s_worldManifold.Initialize(v,d.m_xf,u,_.m_xf,y);var C=f.s_worldManifold.m_normal.x;var A=f.s_worldManifold.m_normal.y;var M=this.m_constraints[n];M.bodyA=d;M.bodyB=_;M.manifold=v;M.normal.x=C;M.normal.y=A;M.pointCount=v.m_pointCount;M.friction=x;M.restitution=E;M.localPlaneNormal.x=v.m_localPlaneNormal.x;M.localPlaneNormal.y=v.m_localPlaneNormal.y;M.localPoint.x=v.m_localPoint.x;M.localPoint.y=v.m_localPoint.y;M.radius=u+y;M.type=v.m_type;for(var D=0;D<M.pointCount;++D){var B=v.m_points[D];var H=M.points[D];H.normalImpulse=B.m_normalImpulse;H.tangentImpulse=B.m_tangentImpulse;H.localPoint.SetV(B.m_localPoint);var V=H.rA.x=f.s_worldManifold.m_points[D].x-d.m_sweep.c.x;var L=H.rA.y=f.s_worldManifold.m_points[D].y-d.m_sweep.c.y;var P=H.rB.x=f.s_worldManifold.m_points[D].x-_.m_sweep.c.x;var F=H.rB.y=f.s_worldManifold.m_points[D].y-_.m_sweep.c.y;var U=V*A-L*C;var G=P*A-F*C;U*=U;G*=G;var z=d.m_invMass+_.m_invMass+d.m_invI*U+_.m_invI*G;H.normalMass=1/z;var N=d.m_mass*d.m_invMass+_.m_mass*_.m_invMass;N+=d.m_mass*d.m_invI*U+_.m_mass*_.m_invI*G;H.equalizedMass=1/N;var k=A;var O=-C;var W=V*O-L*k;var j=P*O-F*k;W*=W;j*=j;var J=d.m_invMass+_.m_invMass+d.m_invI*W+_.m_invI*j;H.tangentMass=1/J;H.velocityBias=0;var X=T+-S*F-g- -w*L;var q=R+S*P-b-w*V;var Y=M.normal.x*X+M.normal.y*q;if(Y<-I.b2_velocityThreshold){H.velocityBias+=-M.restitution*Y}}if(M.pointCount==2){var K=M.points[0];var Z=M.points[1];var Q=d.m_invMass;var $=d.m_invI;var tt=_.m_invMass;var et=_.m_invI;var it=K.rA.x*A-K.rA.y*C;var ot=K.rB.x*A-K.rB.y*C;var rt=Z.rA.x*A-Z.rA.y*C;var nt=Z.rB.x*A-Z.rB.y*C;var at=Q+tt+$*it*it+et*ot*ot;var st=Q+tt+$*rt*rt+et*nt*nt;var lt=Q+tt+$*it*rt+et*ot*nt;var ct=100;if(at*at<ct*(at*st-lt*lt)){M.K.col1.Set(at,lt);M.K.col2.Set(lt,st);M.K.GetInverse(M.normalMass)}else{M.pointCount=1}}}};f.prototype.InitVelocityConstraints=function(t){var e;var i;var o;for(var r=0;r<this.m_constraintCount;++r){var n=this.m_constraints[r];var a=n.bodyA;var s=n.bodyB;var l=a.m_invMass;var c=a.m_invI;var h=s.m_invMass;var m=s.m_invI;var p=n.normal.x;var u=n.normal.y;var f=u;var y=-p;var d=0;var _=0;var v=0;if(t.warmStarting){v=n.pointCount;for(_=0;_<v;++_){var x=n.points[_];x.normalImpulse*=t.dtRatio;x.tangentImpulse*=t.dtRatio;var E=x.normalImpulse*p+x.tangentImpulse*f;var g=x.normalImpulse*u+x.tangentImpulse*y;a.m_angularVelocity-=c*(x.rA.x*g-x.rA.y*E);a.m_linearVelocity.x-=l*E;a.m_linearVelocity.y-=l*g;s.m_angularVelocity+=m*(x.rB.x*g-x.rB.y*E);s.m_linearVelocity.x+=h*E;s.m_linearVelocity.y+=h*g}}else{v=n.pointCount;for(_=0;_<v;++_){var b=n.points[_];b.normalImpulse=0;b.tangentImpulse=0}}}};f.prototype.SolveVelocityConstraints=function(){var t=0;var e;var i=0;var o=0;var r=0;var n=0;var a=0;var s=0;var l=0;var c=0;var h=0;var m=0;var p=0;var u=0;var f=0;var y=0;var d=0;var _=0;var v=0;var x=0;var E=0;var g;var b;for(var T=0;T<this.m_constraintCount;++T){var R=this.m_constraints[T];var w=R.bodyA;var S=R.bodyB;var C=w.m_angularVelocity;var A=S.m_angularVelocity;var M=w.m_linearVelocity;var D=S.m_linearVelocity;var B=w.m_invMass;var H=w.m_invI;var V=S.m_invMass;var L=S.m_invI;var P=R.normal.x;var F=R.normal.y;var I=F;var U=-P;var G=R.friction;var N=0;for(t=0;t<R.pointCount;t++){e=R.points[t];a=D.x-A*e.rB.y-M.x+C*e.rA.y;s=D.y+A*e.rB.x-M.y-C*e.rA.x;c=a*I+s*U;h=e.tangentMass*-c;m=G*e.normalImpulse;p=z.Clamp(e.tangentImpulse+h,-m,m);h=p-e.tangentImpulse;u=h*I;f=h*U;M.x-=B*u;M.y-=B*f;C-=H*(e.rA.x*f-e.rA.y*u);D.x+=V*u;D.y+=V*f;A+=L*(e.rB.x*f-e.rB.y*u);e.tangentImpulse=p}var k=parseInt(R.pointCount);if(R.pointCount==1){e=R.points[0];a=D.x+-A*e.rB.y-M.x- -C*e.rA.y;s=D.y+A*e.rB.x-M.y-C*e.rA.x;l=a*P+s*F;h=-e.normalMass*(l-e.velocityBias);p=e.normalImpulse+h;p=p>0?p:0;h=p-e.normalImpulse;u=h*P;f=h*F;M.x-=B*u;M.y-=B*f;C-=H*(e.rA.x*f-e.rA.y*u);D.x+=V*u;D.y+=V*f;A+=L*(e.rB.x*f-e.rB.y*u);e.normalImpulse=p}else{var O=R.points[0];var W=R.points[1];var j=O.normalImpulse;var J=W.normalImpulse;var X=D.x-A*O.rB.y-M.x+C*O.rA.y;var q=D.y+A*O.rB.x-M.y-C*O.rA.x;var Y=D.x-A*W.rB.y-M.x+C*W.rA.y;var K=D.y+A*W.rB.x-M.y-C*W.rA.x;var Z=X*P+q*F;var Q=Y*P+K*F;var $=Z-O.velocityBias;var tt=Q-W.velocityBias;g=R.K;$-=g.col1.x*j+g.col2.x*J;tt-=g.col1.y*j+g.col2.y*J;var et=.001;for(;;){g=R.normalMass;var it=-(g.col1.x*$+g.col2.x*tt);var ot=-(g.col1.y*$+g.col2.y*tt);if(it>=0&&ot>=0){y=it-j;d=ot-J;_=y*P;v=y*F;x=d*P;E=d*F;M.x-=B*(_+x);M.y-=B*(v+E);C-=H*(O.rA.x*v-O.rA.y*_+W.rA.x*E-W.rA.y*x);D.x+=V*(_+x);D.y+=V*(v+E);A+=L*(O.rB.x*v-O.rB.y*_+W.rB.x*E-W.rB.y*x);O.normalImpulse=it;W.normalImpulse=ot;break}it=-O.normalMass*$;ot=0;Z=0;Q=R.K.col1.y*it+tt;if(it>=0&&Q>=0){y=it-j;d=ot-J;_=y*P;v=y*F;x=d*P;E=d*F;M.x-=B*(_+x);M.y-=B*(v+E);C-=H*(O.rA.x*v-O.rA.y*_+W.rA.x*E-W.rA.y*x);D.x+=V*(_+x);D.y+=V*(v+E);A+=L*(O.rB.x*v-O.rB.y*_+W.rB.x*E-W.rB.y*x);O.normalImpulse=it;W.normalImpulse=ot;break}it=0;ot=-W.normalMass*tt;Z=R.K.col2.x*ot+$;Q=0;if(ot>=0&&Z>=0){y=it-j;d=ot-J;_=y*P;v=y*F;x=d*P;E=d*F;M.x-=B*(_+x);M.y-=B*(v+E);C-=H*(O.rA.x*v-O.rA.y*_+W.rA.x*E-W.rA.y*x);D.x+=V*(_+x);D.y+=V*(v+E);A+=L*(O.rB.x*v-O.rB.y*_+W.rB.x*E-W.rB.y*x);O.normalImpulse=it;W.normalImpulse=ot;break}it=0;ot=0;Z=$;Q=tt;if(Z>=0&&Q>=0){y=it-j;d=ot-J;_=y*P;v=y*F;x=d*P;E=d*F;M.x-=B*(_+x);M.y-=B*(v+E);C-=H*(O.rA.x*v-O.rA.y*_+W.rA.x*E-W.rA.y*x);D.x+=V*(_+x);D.y+=V*(v+E);A+=L*(O.rB.x*v-O.rB.y*_+W.rB.x*E-W.rB.y*x);O.normalImpulse=it;W.normalImpulse=ot;break}break}}w.m_angularVelocity=C;S.m_angularVelocity=A}};f.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t){var e=this.m_constraints[t];var i=e.manifold;for(var o=0;o<e.pointCount;++o){var r=i.m_points[o];var n=e.points[o];r.m_normalImpulse=n.normalImpulse;r.m_tangentImpulse=n.tangentImpulse}}};f.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;for(var i=0;i<this.m_constraintCount;i++){var o=this.m_constraints[i];var r=o.bodyA;var n=o.bodyB;var a=r.m_mass*r.m_invMass;var s=r.m_mass*r.m_invI;var l=n.m_mass*n.m_invMass;var c=n.m_mass*n.m_invI;f.s_psm.Initialize(o);var h=f.s_psm.m_normal;for(var m=0;m<o.pointCount;m++){var p=o.points[m];var u=f.s_psm.m_points[m];var y=f.s_psm.m_separations[m];var d=u.x-r.m_sweep.c.x;var _=u.y-r.m_sweep.c.y;var v=u.x-n.m_sweep.c.x;var x=u.y-n.m_sweep.c.y;e=e<y?e:y;var E=z.Clamp(t*(y+I.b2_linearSlop),-I.b2_maxLinearCorrection,0);var g=-p.equalizedMass*E;var b=g*h.x;var T=g*h.y;r.m_sweep.c.x-=a*b;r.m_sweep.c.y-=a*T;r.m_sweep.a-=s*(d*T-_*b);r.SynchronizeTransform();n.m_sweep.c.x+=l*b;n.m_sweep.c.y+=l*T;n.m_sweep.a+=c*(v*T-x*b);n.SynchronizeTransform()}}return e>-1.5*I.b2_linearSlop};Box2D.postDefs.push((function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new _t;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new E}));Box2D.inherit(y,Box2D.Dynamics.Contacts.b2Contact);y.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;y.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};y.Create=function(t){return new y};y.Destroy=function(t,e){};y.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)};y.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody();var o=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,o.m_xf)};y.prototype.b2CollideEdgeAndCircle=function(t,e,i,o,r){};Box2D.inherit(d,Box2D.Dynamics.Contacts.b2Contact);d.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;d.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};d.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};d.prototype.Evaluate=function(){};Box2D.inherit(_,Box2D.Dynamics.Contacts.b2Contact);_.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;_.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};_.Create=function(t){return new _};_.Destroy=function(t,e){};_.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e);I.b2Assert(t.GetType()==n.e_polygonShape);I.b2Assert(e.GetType()==n.e_circleShape)};_.prototype.Evaluate=function(){var e=this.m_fixtureA.m_body;var i=this.m_fixtureB.m_body;q.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)};Box2D.inherit(v,Box2D.Dynamics.Contacts.b2Contact);v.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;v.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};v.Create=function(t){return new v};v.Destroy=function(t,e){};v.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e);I.b2Assert(t.GetType()==n.e_polygonShape);I.b2Assert(e.GetType()==n.e_edgeShape)};v.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody();var e=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,e.m_xf)};v.prototype.b2CollidePolyAndEdge=function(t,e,i,o,r){};Box2D.inherit(x,Box2D.Dynamics.Contacts.b2Contact);x.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;x.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};x.Create=function(t){return new x};x.Destroy=function(t,e){};x.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)};x.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody();var e=this.m_fixtureB.GetBody();q.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof r?this.m_fixtureB.GetShape():null,e.m_xf)};E.b2PositionSolverManifold=function(){};E.prototype.b2PositionSolverManifold=function(){this.m_normal=new O;this.m_separations=new Vector_a2j_Number(I.b2_maxManifoldPoints);this.m_points=new Vector(I.b2_maxManifoldPoints);for(var t=0;t<I.b2_maxManifoldPoints;t++){this.m_points[t]=new O}};E.prototype.Initialize=function(t){I.b2Assert(t.pointCount>0);var e=0;var i=0;var o=0;var r;var n;var a=0;var s=0;switch(t.type){case nt.e_circles:{r=t.bodyA.m_xf.R;n=t.localPoint;var l=t.bodyA.m_xf.position.x+(r.col1.x*n.x+r.col2.x*n.y);var c=t.bodyA.m_xf.position.y+(r.col1.y*n.x+r.col2.y*n.y);r=t.bodyB.m_xf.R;n=t.points[0].localPoint;var h=t.bodyB.m_xf.position.x+(r.col1.x*n.x+r.col2.x*n.y);var m=t.bodyB.m_xf.position.y+(r.col1.y*n.x+r.col2.y*n.y);var p=h-l;var u=m-c;var f=p*p+u*u;if(f>Number.MIN_VALUE*Number.MIN_VALUE){var y=Math.sqrt(f);this.m_normal.x=p/y;this.m_normal.y=u/y}else{this.m_normal.x=1;this.m_normal.y=0}this.m_points[0].x=.5*(l+h);this.m_points[0].y=.5*(c+m);this.m_separations[0]=p*this.m_normal.x+u*this.m_normal.y-t.radius}break;case nt.e_faceA:{r=t.bodyA.m_xf.R;n=t.localPlaneNormal;this.m_normal.x=r.col1.x*n.x+r.col2.x*n.y;this.m_normal.y=r.col1.y*n.x+r.col2.y*n.y;r=t.bodyA.m_xf.R;n=t.localPoint;a=t.bodyA.m_xf.position.x+(r.col1.x*n.x+r.col2.x*n.y);s=t.bodyA.m_xf.position.y+(r.col1.y*n.x+r.col2.y*n.y);r=t.bodyB.m_xf.R;for(e=0;e<t.pointCount;++e){n=t.points[e].localPoint;i=t.bodyB.m_xf.position.x+(r.col1.x*n.x+r.col2.x*n.y);o=t.bodyB.m_xf.position.y+(r.col1.y*n.x+r.col2.y*n.y);this.m_separations[e]=(i-a)*this.m_normal.x+(o-s)*this.m_normal.y-t.radius;this.m_points[e].x=i;this.m_points[e].y=o}}break;case nt.e_faceB:{r=t.bodyB.m_xf.R;n=t.localPlaneNormal;this.m_normal.x=r.col1.x*n.x+r.col2.x*n.y;this.m_normal.y=r.col1.y*n.x+r.col2.y*n.y;r=t.bodyB.m_xf.R;n=t.localPoint;a=t.bodyB.m_xf.position.x+(r.col1.x*n.x+r.col2.x*n.y);s=t.bodyB.m_xf.position.y+(r.col1.y*n.x+r.col2.y*n.y);r=t.bodyA.m_xf.R;for(e=0;e<t.pointCount;++e){n=t.points[e].localPoint;i=t.bodyA.m_xf.position.x+(r.col1.x*n.x+r.col2.x*n.y);o=t.bodyA.m_xf.position.y+(r.col1.y*n.x+r.col2.y*n.y);this.m_separations[e]=(i-a)*this.m_normal.x+(o-s)*this.m_normal.y-t.radius;this.m_points[e].Set(i,o)}this.m_normal.x*=-1;this.m_normal.y*=-1}break}};Box2D.postDefs.push((function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new O;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new O}))})();(function(){var t=Box2D.Dynamics.b2Body,e=Box2D.Dynamics.b2BodyDef,i=Box2D.Dynamics.b2ContactFilter,o=Box2D.Dynamics.b2ContactImpulse,r=Box2D.Dynamics.b2ContactListener,n=Box2D.Dynamics.b2ContactManager,a=Box2D.Dynamics.b2DebugDraw,s=Box2D.Dynamics.b2DestructionListener,l=Box2D.Dynamics.b2FilterData,c=Box2D.Dynamics.b2Fixture,h=Box2D.Dynamics.b2FixtureDef,m=Box2D.Dynamics.b2Island,p=Box2D.Dynamics.b2TimeStep,u=Box2D.Dynamics.b2World,f=Box2D.Common.Math.b2Mat22,y=Box2D.Common.Math.b2Mat33,d=Box2D.Common.Math.b2Math,_=Box2D.Common.Math.b2Sweep,v=Box2D.Common.Math.b2Transform,x=Box2D.Common.Math.b2Vec2,E=Box2D.Common.Math.b2Vec3,g=Box2D.Common.b2Color,b=Box2D.Common.b2internal,T=Box2D.Common.b2Settings,R=Box2D.Collision.Shapes.b2CircleShape,w=Box2D.Collision.Shapes.b2EdgeChainDef,S=Box2D.Collision.Shapes.b2EdgeShape,C=Box2D.Collision.Shapes.b2MassData,A=Box2D.Collision.Shapes.b2PolygonShape,M=Box2D.Collision.Shapes.b2Shape,D=Box2D.Dynamics.Controllers.b2BuoyancyController,B=Box2D.Dynamics.Controllers.b2ConstantAccelController,H=Box2D.Dynamics.Controllers.b2ConstantForceController,V=Box2D.Dynamics.Controllers.b2Controller,L=Box2D.Dynamics.Controllers.b2ControllerEdge,P=Box2D.Dynamics.Controllers.b2GravityController,F=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(D,Box2D.Dynamics.Controllers.b2Controller);D.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;D.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new x(0,-1);this.offset=0;this.density=0;this.velocity=new x(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=false;this.useWorldGravity=true;this.gravity=null};D.prototype.Step=function(t){if(!this.m_bodyList)return;if(this.useWorldGravity){this.gravity=this.GetWorld().GetGravity().Copy()}for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(i.IsAwake()==false){continue}var o=new x;var r=new x;var n=0;var a=0;for(var s=i.GetFixtureList();s;s=s.GetNext()){var l=new x;var c=s.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),l);n+=c;o.x+=c*l.x;o.y+=c*l.y;var h=0;if(this.useDensity){h=1}else{h=1}a+=c*h;r.x+=c*l.x*h;r.y+=c*l.y*h}o.x/=n;o.y/=n;r.x/=a;r.y/=a;if(n<Number.MIN_VALUE)continue;var m=this.gravity.GetNegative();m.Multiply(this.density*n);i.ApplyForce(m,r);var p=i.GetLinearVelocityFromWorldPoint(o);p.Subtract(this.velocity);p.Multiply(-this.linearDrag*n);i.ApplyForce(p,o);i.ApplyTorque(-i.GetInertia()/i.GetMass()*n*i.GetAngularVelocity()*this.angularDrag)}};D.prototype.Draw=function(t){var e=1e3;var i=new x;var o=new x;i.x=this.normal.x*this.offset+this.normal.y*e;i.y=this.normal.y*this.offset-this.normal.x*e;o.x=this.normal.x*this.offset-this.normal.y*e;o.y=this.normal.y*this.offset+this.normal.x*e;var r=new g(0,0,1);t.DrawSegment(i,o,r)};Box2D.inherit(B,Box2D.Dynamics.Controllers.b2Controller);B.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;B.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new x(0,0)};B.prototype.Step=function(t){var e=new x(this.A.x*t.dt,this.A.y*t.dt);for(var i=this.m_bodyList;i;i=i.nextBody){var o=i.body;if(!o.IsAwake())continue;o.SetLinearVelocity(new x(o.GetLinearVelocity().x+e.x,o.GetLinearVelocity().y+e.y))}};Box2D.inherit(H,Box2D.Dynamics.Controllers.b2Controller);H.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;H.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new x(0,0)};H.prototype.Step=function(t){for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(!i.IsAwake())continue;i.ApplyForce(this.F,i.GetWorldCenter())}};V.b2Controller=function(){};V.prototype.Step=function(t){};V.prototype.Draw=function(t){};V.prototype.AddBody=function(t){var e=new L;e.controller=this;e.body=t;e.nextBody=this.m_bodyList;e.prevBody=null;this.m_bodyList=e;if(e.nextBody)e.nextBody.prevBody=e;this.m_bodyCount++;e.nextController=t.m_controllerList;e.prevController=null;t.m_controllerList=e;if(e.nextController)e.nextController.prevController=e;t.m_controllerCount++};V.prototype.RemoveBody=function(t){var e=t.m_controllerList;while(e&&e.controller!=this)e=e.nextController;if(e.prevBody)e.prevBody.nextBody=e.nextBody;if(e.nextBody)e.nextBody.prevBody=e.prevBody;if(e.nextController)e.nextController.prevController=e.prevController;if(e.prevController)e.prevController.nextController=e.nextController;if(this.m_bodyList==e)this.m_bodyList=e.nextBody;if(t.m_controllerList==e)t.m_controllerList=e.nextController;t.m_controllerCount--;this.m_bodyCount--};V.prototype.Clear=function(){while(this.m_bodyList)this.RemoveBody(this.m_bodyList.body)};V.prototype.GetNext=function(){return this.m_next};V.prototype.GetWorld=function(){return this.m_world};V.prototype.GetBodyList=function(){return this.m_bodyList};L.b2ControllerEdge=function(){};Box2D.inherit(P,Box2D.Dynamics.Controllers.b2Controller);P.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;P.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=true};P.prototype.Step=function(t){var e=null;var i=null;var o=null;var r=0;var n=null;var a=null;var s=null;var l=0;var c=0;var h=0;var m=null;if(this.invSqr){for(e=this.m_bodyList;e;e=e.nextBody){i=e.body;o=i.GetWorldCenter();r=i.GetMass();for(n=this.m_bodyList;n!=e;n=n.nextBody){a=n.body;s=a.GetWorldCenter();l=s.x-o.x;c=s.y-o.y;h=l*l+c*c;if(h<Number.MIN_VALUE)continue;m=new x(l,c);m.Multiply(this.G/h/Math.sqrt(h)*r*a.GetMass());if(i.IsAwake())i.ApplyForce(m,o);m.Multiply(-1);if(a.IsAwake())a.ApplyForce(m,s)}}}else{for(e=this.m_bodyList;e;e=e.nextBody){i=e.body;o=i.GetWorldCenter();r=i.GetMass();for(n=this.m_bodyList;n!=e;n=n.nextBody){a=n.body;s=a.GetWorldCenter();l=s.x-o.x;c=s.y-o.y;h=l*l+c*c;if(h<Number.MIN_VALUE)continue;m=new x(l,c);m.Multiply(this.G/h*r*a.GetMass());if(i.IsAwake())i.ApplyForce(m,o);m.Multiply(-1);if(a.IsAwake())a.ApplyForce(m,s)}}}};Box2D.inherit(F,Box2D.Dynamics.Controllers.b2Controller);F.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;F.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new f;this.maxTimestep=0};F.prototype.SetAxisAligned=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.T.col1.x=-t;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-e;if(t>0||e>0){this.maxTimestep=1/Math.max(t,e)}else{this.maxTimestep=0}};F.prototype.Step=function(t){var e=t.dt;if(e<=Number.MIN_VALUE)return;if(e>this.maxTimestep&&this.maxTimestep>0)e=this.maxTimestep;for(var i=this.m_bodyList;i;i=i.nextBody){var o=i.body;if(!o.IsAwake()){continue}var r=o.GetWorldVector(d.MulMV(this.T,o.GetLocalVector(o.GetLinearVelocity())));o.SetLinearVelocity(new x(o.GetLinearVelocity().x+r.x*e,o.GetLinearVelocity().y+r.y*e))}}})();(function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2internal,i=Box2D.Common.b2Settings,o=Box2D.Common.Math.b2Mat22,r=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math,a=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,l=Box2D.Common.Math.b2Vec2,c=Box2D.Common.Math.b2Vec3,h=Box2D.Dynamics.Joints.b2DistanceJoint,m=Box2D.Dynamics.Joints.b2DistanceJointDef,p=Box2D.Dynamics.Joints.b2FrictionJoint,u=Box2D.Dynamics.Joints.b2FrictionJointDef,f=Box2D.Dynamics.Joints.b2GearJoint,y=Box2D.Dynamics.Joints.b2GearJointDef,d=Box2D.Dynamics.Joints.b2Jacobian,_=Box2D.Dynamics.Joints.b2Joint,v=Box2D.Dynamics.Joints.b2JointDef,x=Box2D.Dynamics.Joints.b2JointEdge,E=Box2D.Dynamics.Joints.b2LineJoint,g=Box2D.Dynamics.Joints.b2LineJointDef,b=Box2D.Dynamics.Joints.b2MouseJoint,T=Box2D.Dynamics.Joints.b2MouseJointDef,R=Box2D.Dynamics.Joints.b2PrismaticJoint,w=Box2D.Dynamics.Joints.b2PrismaticJointDef,S=Box2D.Dynamics.Joints.b2PulleyJoint,C=Box2D.Dynamics.Joints.b2PulleyJointDef,A=Box2D.Dynamics.Joints.b2RevoluteJoint,M=Box2D.Dynamics.Joints.b2RevoluteJointDef,D=Box2D.Dynamics.Joints.b2WeldJoint,B=Box2D.Dynamics.Joints.b2WeldJointDef,H=Box2D.Dynamics.b2Body,V=Box2D.Dynamics.b2BodyDef,L=Box2D.Dynamics.b2ContactFilter,P=Box2D.Dynamics.b2ContactImpulse,F=Box2D.Dynamics.b2ContactListener,I=Box2D.Dynamics.b2ContactManager,U=Box2D.Dynamics.b2DebugDraw,G=Box2D.Dynamics.b2DestructionListener,z=Box2D.Dynamics.b2FilterData,N=Box2D.Dynamics.b2Fixture,k=Box2D.Dynamics.b2FixtureDef,O=Box2D.Dynamics.b2Island,W=Box2D.Dynamics.b2TimeStep,j=Box2D.Dynamics.b2World;Box2D.inherit(h,Box2D.Dynamics.Joints.b2Joint);h.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;h.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_u=new l};h.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};h.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};h.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)};h.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};h.prototype.GetLength=function(){return this.m_length};h.prototype.SetLength=function(t){if(t===undefined)t=0;this.m_length=t};h.prototype.GetFrequency=function(){return this.m_frequencyHz};h.prototype.SetFrequency=function(t){if(t===undefined)t=0;this.m_frequencyHz=t};h.prototype.GetDampingRatio=function(){return this.m_dampingRatio};h.prototype.SetDampingRatio=function(t){if(t===undefined)t=0;this.m_dampingRatio=t};h.prototype.b2DistanceJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var o=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_length=t.length;this.m_frequencyHz=t.frequencyHz;this.m_dampingRatio=t.dampingRatio;this.m_impulse=0;this.m_gamma=0;this.m_bias=0};h.prototype.InitVelocityConstraints=function(t){var e;var o=0;var r=this.m_bodyA;var n=this.m_bodyB;e=r.m_xf.R;var a=this.m_localAnchor1.x-r.m_sweep.localCenter.x;var s=this.m_localAnchor1.y-r.m_sweep.localCenter.y;o=e.col1.x*a+e.col2.x*s;s=e.col1.y*a+e.col2.y*s;a=o;e=n.m_xf.R;var l=this.m_localAnchor2.x-n.m_sweep.localCenter.x;var c=this.m_localAnchor2.y-n.m_sweep.localCenter.y;o=e.col1.x*l+e.col2.x*c;c=e.col1.y*l+e.col2.y*c;l=o;this.m_u.x=n.m_sweep.c.x+l-r.m_sweep.c.x-a;this.m_u.y=n.m_sweep.c.y+c-r.m_sweep.c.y-s;var h=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);if(h>i.b2_linearSlop){this.m_u.Multiply(1/h)}else{this.m_u.SetZero()}var m=a*this.m_u.y-s*this.m_u.x;var p=l*this.m_u.y-c*this.m_u.x;var u=r.m_invMass+r.m_invI*m*m+n.m_invMass+n.m_invI*p*p;this.m_mass=u!=0?1/u:0;if(this.m_frequencyHz>0){var f=h-this.m_length;var y=2*Math.PI*this.m_frequencyHz;var d=2*this.m_mass*this.m_dampingRatio*y;var _=this.m_mass*y*y;this.m_gamma=t.dt*(d+t.dt*_);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_bias=f*t.dt*_*this.m_gamma;this.m_mass=u+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(t.warmStarting){this.m_impulse*=t.dtRatio;var v=this.m_impulse*this.m_u.x;var x=this.m_impulse*this.m_u.y;r.m_linearVelocity.x-=r.m_invMass*v;r.m_linearVelocity.y-=r.m_invMass*x;r.m_angularVelocity-=r.m_invI*(a*x-s*v);n.m_linearVelocity.x+=n.m_invMass*v;n.m_linearVelocity.y+=n.m_invMass*x;n.m_angularVelocity+=n.m_invI*(l*x-c*v)}else{this.m_impulse=0}};h.prototype.SolveVelocityConstraints=function(t){var e;var i=this.m_bodyA;var o=this.m_bodyB;e=i.m_xf.R;var r=this.m_localAnchor1.x-i.m_sweep.localCenter.x;var n=this.m_localAnchor1.y-i.m_sweep.localCenter.y;var a=e.col1.x*r+e.col2.x*n;n=e.col1.y*r+e.col2.y*n;r=a;e=o.m_xf.R;var s=this.m_localAnchor2.x-o.m_sweep.localCenter.x;var l=this.m_localAnchor2.y-o.m_sweep.localCenter.y;a=e.col1.x*s+e.col2.x*l;l=e.col1.y*s+e.col2.y*l;s=a;var c=i.m_linearVelocity.x+-i.m_angularVelocity*n;var h=i.m_linearVelocity.y+i.m_angularVelocity*r;var m=o.m_linearVelocity.x+-o.m_angularVelocity*l;var p=o.m_linearVelocity.y+o.m_angularVelocity*s;var u=this.m_u.x*(m-c)+this.m_u.y*(p-h);var f=-this.m_mass*(u+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=f;var y=f*this.m_u.x;var d=f*this.m_u.y;i.m_linearVelocity.x-=i.m_invMass*y;i.m_linearVelocity.y-=i.m_invMass*d;i.m_angularVelocity-=i.m_invI*(r*d-n*y);o.m_linearVelocity.x+=o.m_invMass*y;o.m_linearVelocity.y+=o.m_invMass*d;o.m_angularVelocity+=o.m_invI*(s*d-l*y)};h.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e;if(this.m_frequencyHz>0){return true}var o=this.m_bodyA;var r=this.m_bodyB;e=o.m_xf.R;var a=this.m_localAnchor1.x-o.m_sweep.localCenter.x;var s=this.m_localAnchor1.y-o.m_sweep.localCenter.y;var l=e.col1.x*a+e.col2.x*s;s=e.col1.y*a+e.col2.y*s;a=l;e=r.m_xf.R;var c=this.m_localAnchor2.x-r.m_sweep.localCenter.x;var h=this.m_localAnchor2.y-r.m_sweep.localCenter.y;l=e.col1.x*c+e.col2.x*h;h=e.col1.y*c+e.col2.y*h;c=l;var m=r.m_sweep.c.x+c-o.m_sweep.c.x-a;var p=r.m_sweep.c.y+h-o.m_sweep.c.y-s;var u=Math.sqrt(m*m+p*p);m/=u;p/=u;var f=u-this.m_length;f=n.Clamp(f,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);var y=-this.m_mass*f;this.m_u.Set(m,p);var d=y*this.m_u.x;var _=y*this.m_u.y;o.m_sweep.c.x-=o.m_invMass*d;o.m_sweep.c.y-=o.m_invMass*_;o.m_sweep.a-=o.m_invI*(a*_-s*d);r.m_sweep.c.x+=r.m_invMass*d;r.m_sweep.c.y+=r.m_invMass*_;r.m_sweep.a+=r.m_invI*(c*_-h*d);o.SynchronizeTransform();r.SynchronizeTransform();return n.Abs(f)<i.b2_linearSlop};Box2D.inherit(m,Box2D.Dynamics.Joints.b2JointDef);m.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;m.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l};m.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=_.e_distanceJoint;this.length=1;this.frequencyHz=0;this.dampingRatio=0};m.prototype.Initialize=function(t,e,i,o){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o));var r=o.x-i.x;var n=o.y-i.y;this.length=Math.sqrt(r*r+n*n);this.frequencyHz=0;this.dampingRatio=0};Box2D.inherit(p,Box2D.Dynamics.Joints.b2Joint);p.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;p.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new l;this.m_localAnchorB=new l;this.m_linearMass=new o;this.m_linearImpulse=new l};p.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};p.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};p.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)};p.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_angularImpulse};p.prototype.SetMaxForce=function(t){if(t===undefined)t=0;this.m_maxForce=t};p.prototype.GetMaxForce=function(){return this.m_maxForce};p.prototype.SetMaxTorque=function(t){if(t===undefined)t=0;this.m_maxTorque=t};p.prototype.GetMaxTorque=function(){return this.m_maxTorque};p.prototype.b2FrictionJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchorA.SetV(t.localAnchorA);this.m_localAnchorB.SetV(t.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=t.maxForce;this.m_maxTorque=t.maxTorque};p.prototype.InitVelocityConstraints=function(t){var e;var i=0;var r=this.m_bodyA;var n=this.m_bodyB;e=r.m_xf.R;var a=this.m_localAnchorA.x-r.m_sweep.localCenter.x;var s=this.m_localAnchorA.y-r.m_sweep.localCenter.y;i=e.col1.x*a+e.col2.x*s;s=e.col1.y*a+e.col2.y*s;a=i;e=n.m_xf.R;var l=this.m_localAnchorB.x-n.m_sweep.localCenter.x;var c=this.m_localAnchorB.y-n.m_sweep.localCenter.y;i=e.col1.x*l+e.col2.x*c;c=e.col1.y*l+e.col2.y*c;l=i;var h=r.m_invMass;var m=n.m_invMass;var p=r.m_invI;var u=n.m_invI;var f=new o;f.col1.x=h+m;f.col2.x=0;f.col1.y=0;f.col2.y=h+m;f.col1.x+=p*s*s;f.col2.x+=-p*a*s;f.col1.y+=-p*a*s;f.col2.y+=p*a*a;f.col1.x+=u*c*c;f.col2.x+=-u*l*c;f.col1.y+=-u*l*c;f.col2.y+=u*l*l;f.GetInverse(this.m_linearMass);this.m_angularMass=p+u;if(this.m_angularMass>0){this.m_angularMass=1/this.m_angularMass}if(t.warmStarting){this.m_linearImpulse.x*=t.dtRatio;this.m_linearImpulse.y*=t.dtRatio;this.m_angularImpulse*=t.dtRatio;var y=this.m_linearImpulse;r.m_linearVelocity.x-=h*y.x;r.m_linearVelocity.y-=h*y.y;r.m_angularVelocity-=p*(a*y.y-s*y.x+this.m_angularImpulse);n.m_linearVelocity.x+=m*y.x;n.m_linearVelocity.y+=m*y.y;n.m_angularVelocity+=u*(l*y.y-c*y.x+this.m_angularImpulse)}else{this.m_linearImpulse.SetZero();this.m_angularImpulse=0}};p.prototype.SolveVelocityConstraints=function(t){var e;var i=0;var o=this.m_bodyA;var r=this.m_bodyB;var a=o.m_linearVelocity;var s=o.m_angularVelocity;var c=r.m_linearVelocity;var h=r.m_angularVelocity;var m=o.m_invMass;var p=r.m_invMass;var u=o.m_invI;var f=r.m_invI;e=o.m_xf.R;var y=this.m_localAnchorA.x-o.m_sweep.localCenter.x;var d=this.m_localAnchorA.y-o.m_sweep.localCenter.y;i=e.col1.x*y+e.col2.x*d;d=e.col1.y*y+e.col2.y*d;y=i;e=r.m_xf.R;var _=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var v=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*_+e.col2.x*v;v=e.col1.y*_+e.col2.y*v;_=i;var x=0;{var E=h-s;var g=-this.m_angularMass*E;var b=this.m_angularImpulse;x=t.dt*this.m_maxTorque;this.m_angularImpulse=n.Clamp(this.m_angularImpulse+g,-x,x);g=this.m_angularImpulse-b;s-=u*g;h+=f*g}{var T=c.x-h*v-a.x+s*d;var R=c.y+h*_-a.y-s*y;var w=n.MulMV(this.m_linearMass,new l(-T,-R));var S=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(w);x=t.dt*this.m_maxForce;if(this.m_linearImpulse.LengthSquared()>x*x){this.m_linearImpulse.Normalize();this.m_linearImpulse.Multiply(x)}w=n.SubtractVV(this.m_linearImpulse,S);a.x-=m*w.x;a.y-=m*w.y;s-=u*(y*w.y-d*w.x);c.x+=p*w.x;c.y+=p*w.y;h+=f*(_*w.y-v*w.x)}o.m_angularVelocity=s;r.m_angularVelocity=h};p.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return true};Box2D.inherit(u,Box2D.Dynamics.Joints.b2JointDef);u.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;u.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l};u.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=_.e_frictionJoint;this.maxForce=0;this.maxTorque=0};u.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i))};Box2D.inherit(f,Box2D.Dynamics.Joints.b2Joint);f.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;f.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new l;this.m_groundAnchor2=new l;this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_J=new d};f.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};f.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};f.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)};f.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;var e=this.m_bodyB.m_xf.R;var i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x;var o=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y;var r=e.col1.x*i+e.col2.x*o;o=e.col1.y*i+e.col2.y*o;i=r;var n=this.m_impulse*this.m_J.linearB.x;var a=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-i*a+o*n)};f.prototype.GetRatio=function(){return this.m_ratio};f.prototype.SetRatio=function(t){if(t===undefined)t=0;this.m_ratio=t};f.prototype.b2GearJoint=function(t){this.__super.b2Joint.call(this,t);var e=parseInt(t.joint1.m_type);var i=parseInt(t.joint2.m_type);this.m_revolute1=null;this.m_prismatic1=null;this.m_revolute2=null;this.m_prismatic2=null;var o=0;var r=0;this.m_ground1=t.joint1.GetBodyA();this.m_bodyA=t.joint1.GetBodyB();if(e==_.e_revoluteJoint){this.m_revolute1=t.joint1 instanceof A?t.joint1:null;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);o=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=t.joint1 instanceof R?t.joint1:null;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);o=this.m_prismatic1.GetJointTranslation()}this.m_ground2=t.joint2.GetBodyA();this.m_bodyB=t.joint2.GetBodyB();if(i==_.e_revoluteJoint){this.m_revolute2=t.joint2 instanceof A?t.joint2:null;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);r=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=t.joint2 instanceof R?t.joint2:null;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);r=this.m_prismatic2.GetJointTranslation()}this.m_ratio=t.ratio;this.m_constant=o+this.m_ratio*r;this.m_impulse=0};f.prototype.InitVelocityConstraints=function(t){var e=this.m_ground1;var i=this.m_ground2;var o=this.m_bodyA;var r=this.m_bodyB;var n=0;var a=0;var s=0;var l=0;var c;var h;var m=0;var p=0;var u=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angularA=-1;u+=o.m_invI}else{c=e.m_xf.R;h=this.m_prismatic1.m_localXAxis1;n=c.col1.x*h.x+c.col2.x*h.y;a=c.col1.y*h.x+c.col2.y*h.y;c=o.m_xf.R;s=this.m_localAnchor1.x-o.m_sweep.localCenter.x;l=this.m_localAnchor1.y-o.m_sweep.localCenter.y;p=c.col1.x*s+c.col2.x*l;l=c.col1.y*s+c.col2.y*l;s=p;m=s*a-l*n;this.m_J.linearA.Set(-n,-a);this.m_J.angularA=-m;u+=o.m_invMass+o.m_invI*m*m}if(this.m_revolute2){this.m_J.angularB=-this.m_ratio;u+=this.m_ratio*this.m_ratio*r.m_invI}else{c=i.m_xf.R;h=this.m_prismatic2.m_localXAxis1;n=c.col1.x*h.x+c.col2.x*h.y;a=c.col1.y*h.x+c.col2.y*h.y;c=r.m_xf.R;s=this.m_localAnchor2.x-r.m_sweep.localCenter.x;l=this.m_localAnchor2.y-r.m_sweep.localCenter.y;p=c.col1.x*s+c.col2.x*l;l=c.col1.y*s+c.col2.y*l;s=p;m=s*a-l*n;this.m_J.linearB.Set(-this.m_ratio*n,-this.m_ratio*a);this.m_J.angularB=-this.m_ratio*m;u+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*m*m)}this.m_mass=u>0?1/u:0;if(t.warmStarting){o.m_linearVelocity.x+=o.m_invMass*this.m_impulse*this.m_J.linearA.x;o.m_linearVelocity.y+=o.m_invMass*this.m_impulse*this.m_J.linearA.y;o.m_angularVelocity+=o.m_invI*this.m_impulse*this.m_J.angularA;r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x;r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y;r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB}else{this.m_impulse=0}};f.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var o=this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,i.m_linearVelocity,i.m_angularVelocity);var r=-this.m_mass*o;this.m_impulse+=r;e.m_linearVelocity.x+=e.m_invMass*r*this.m_J.linearA.x;e.m_linearVelocity.y+=e.m_invMass*r*this.m_J.linearA.y;e.m_angularVelocity+=e.m_invI*r*this.m_J.angularA;i.m_linearVelocity.x+=i.m_invMass*r*this.m_J.linearB.x;i.m_linearVelocity.y+=i.m_invMass*r*this.m_J.linearB.y;i.m_angularVelocity+=i.m_invI*r*this.m_J.angularB};f.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var o=this.m_bodyA;var r=this.m_bodyB;var n=0;var a=0;if(this.m_revolute1){n=this.m_revolute1.GetJointAngle()}else{n=this.m_prismatic1.GetJointTranslation()}if(this.m_revolute2){a=this.m_revolute2.GetJointAngle()}else{a=this.m_prismatic2.GetJointTranslation()}var s=this.m_constant-(n+this.m_ratio*a);var l=-this.m_mass*s;o.m_sweep.c.x+=o.m_invMass*l*this.m_J.linearA.x;o.m_sweep.c.y+=o.m_invMass*l*this.m_J.linearA.y;o.m_sweep.a+=o.m_invI*l*this.m_J.angularA;r.m_sweep.c.x+=r.m_invMass*l*this.m_J.linearB.x;r.m_sweep.c.y+=r.m_invMass*l*this.m_J.linearB.y;r.m_sweep.a+=r.m_invI*l*this.m_J.angularB;o.SynchronizeTransform();r.SynchronizeTransform();return e<i.b2_linearSlop};Box2D.inherit(y,Box2D.Dynamics.Joints.b2JointDef);y.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;y.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};y.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=_.e_gearJoint;this.joint1=null;this.joint2=null;this.ratio=1};d.b2Jacobian=function(){this.linearA=new l;this.linearB=new l};d.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};d.prototype.Set=function(t,e,i,o){if(e===undefined)e=0;if(o===undefined)o=0;this.linearA.SetV(t);this.angularA=e;this.linearB.SetV(i);this.angularB=o};d.prototype.Compute=function(t,e,i,o){if(e===undefined)e=0;if(o===undefined)o=0;return this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*e+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*o};_.b2Joint=function(){this.m_edgeA=new x;this.m_edgeB=new x;this.m_localCenterA=new l;this.m_localCenterB=new l};_.prototype.GetType=function(){return this.m_type};_.prototype.GetAnchorA=function(){return null};_.prototype.GetAnchorB=function(){return null};_.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return null};_.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};_.prototype.GetBodyA=function(){return this.m_bodyA};_.prototype.GetBodyB=function(){return this.m_bodyB};_.prototype.GetNext=function(){return this.m_next};_.prototype.GetUserData=function(){return this.m_userData};_.prototype.SetUserData=function(t){this.m_userData=t};_.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};_.Create=function(t,e){var i=null;switch(t.type){case _.e_distanceJoint:{i=new h(t instanceof m?t:null)}break;case _.e_mouseJoint:{i=new b(t instanceof T?t:null)}break;case _.e_prismaticJoint:{i=new R(t instanceof w?t:null)}break;case _.e_revoluteJoint:{i=new A(t instanceof M?t:null)}break;case _.e_pulleyJoint:{i=new S(t instanceof C?t:null)}break;case _.e_gearJoint:{i=new f(t instanceof y?t:null)}break;case _.e_lineJoint:{i=new E(t instanceof g?t:null)}break;case _.e_weldJoint:{i=new D(t instanceof B?t:null)}break;case _.e_frictionJoint:{i=new p(t instanceof u?t:null)}break;default:break}return i};_.Destroy=function(t,e){};_.prototype.b2Joint=function(t){i.b2Assert(t.bodyA!=t.bodyB);this.m_type=t.type;this.m_prev=null;this.m_next=null;this.m_bodyA=t.bodyA;this.m_bodyB=t.bodyB;this.m_collideConnected=t.collideConnected;this.m_islandFlag=false;this.m_userData=t.userData};_.prototype.InitVelocityConstraints=function(t){};_.prototype.SolveVelocityConstraints=function(t){};_.prototype.FinalizeVelocityConstraints=function(){};_.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return false};Box2D.postDefs.push((function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3}));v.b2JointDef=function(){};v.prototype.b2JointDef=function(){this.type=_.e_unknownJoint;this.userData=null;this.bodyA=null;this.bodyB=null;this.collideConnected=false};x.b2JointEdge=function(){};Box2D.inherit(E,Box2D.Dynamics.Joints.b2Joint);E.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;E.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_localXAxis1=new l;this.m_localYAxis1=new l;this.m_axis=new l;this.m_perp=new l;this.m_K=new o;this.m_impulse=new l};E.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};E.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};E.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};E.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.y};E.prototype.GetJointTranslation=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;var o=t.GetWorldPoint(this.m_localAnchor1);var r=e.GetWorldPoint(this.m_localAnchor2);var n=r.x-o.x;var a=r.y-o.y;var s=t.GetWorldVector(this.m_localXAxis1);var l=s.x*n+s.y*a;return l};E.prototype.GetJointSpeed=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;i=t.m_xf.R;var o=this.m_localAnchor1.x-t.m_sweep.localCenter.x;var r=this.m_localAnchor1.y-t.m_sweep.localCenter.y;var n=i.col1.x*o+i.col2.x*r;r=i.col1.y*o+i.col2.y*r;o=n;i=e.m_xf.R;var a=this.m_localAnchor2.x-e.m_sweep.localCenter.x;var s=this.m_localAnchor2.y-e.m_sweep.localCenter.y;n=i.col1.x*a+i.col2.x*s;s=i.col1.y*a+i.col2.y*s;a=n;var l=t.m_sweep.c.x+o;var c=t.m_sweep.c.y+r;var h=e.m_sweep.c.x+a;var m=e.m_sweep.c.y+s;var p=h-l;var u=m-c;var f=t.GetWorldVector(this.m_localXAxis1);var y=t.m_linearVelocity;var d=e.m_linearVelocity;var _=t.m_angularVelocity;var v=e.m_angularVelocity;var x=p*(-_*f.y)+u*(_*f.x)+(f.x*(d.x+-v*s-y.x- -_*r)+f.y*(d.y+v*a-y.y-_*o));return x};E.prototype.IsLimitEnabled=function(){return this.m_enableLimit};E.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=t};E.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};E.prototype.GetUpperLimit=function(){return this.m_upperTranslation};E.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=t;this.m_upperTranslation=e};E.prototype.IsMotorEnabled=function(){return this.m_enableMotor};E.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=t};E.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};E.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};E.prototype.SetMaxMotorForce=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=t};E.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};E.prototype.GetMotorForce=function(){return this.m_motorImpulse};E.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var o=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_localXAxis1.SetV(t.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=t.lowerTranslation;this.m_upperTranslation=t.upperTranslation;this.m_maxMotorForce=t.maxMotorForce;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=_.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};E.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var o=this.m_bodyB;var r;var a=0;this.m_localCenterA.SetV(e.GetLocalCenter());this.m_localCenterB.SetV(o.GetLocalCenter());var s=e.GetTransform();var l=o.GetTransform();r=e.m_xf.R;var c=this.m_localAnchor1.x-this.m_localCenterA.x;var h=this.m_localAnchor1.y-this.m_localCenterA.y;a=r.col1.x*c+r.col2.x*h;h=r.col1.y*c+r.col2.y*h;c=a;r=o.m_xf.R;var m=this.m_localAnchor2.x-this.m_localCenterB.x;var p=this.m_localAnchor2.y-this.m_localCenterB.y;a=r.col1.x*m+r.col2.x*p;p=r.col1.y*m+r.col2.y*p;m=a;var u=o.m_sweep.c.x+m-e.m_sweep.c.x-c;var f=o.m_sweep.c.y+p-e.m_sweep.c.y-h;this.m_invMassA=e.m_invMass;this.m_invMassB=o.m_invMass;this.m_invIA=e.m_invI;this.m_invIB=o.m_invI;{this.m_axis.SetV(n.MulMV(s.R,this.m_localXAxis1));this.m_a1=(u+c)*this.m_axis.y-(f+h)*this.m_axis.x;this.m_a2=m*this.m_axis.y-p*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0}{this.m_perp.SetV(n.MulMV(s.R,this.m_localYAxis1));this.m_s1=(u+c)*this.m_perp.y-(f+h)*this.m_perp.x;this.m_s2=m*this.m_perp.y-p*this.m_perp.x;var y=this.m_invMassA;var d=this.m_invMassB;var v=this.m_invIA;var x=this.m_invIB;this.m_K.col1.x=y+d+v*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2;this.m_K.col1.y=v*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=y+d+v*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2}if(this.m_enableLimit){var E=this.m_axis.x*u+this.m_axis.y*f;if(n.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){this.m_limitState=_.e_equalLimits}else if(E<=this.m_lowerTranslation){if(this.m_limitState!=_.e_atLowerLimit){this.m_limitState=_.e_atLowerLimit;this.m_impulse.y=0}}else if(E>=this.m_upperTranslation){if(this.m_limitState!=_.e_atUpperLimit){this.m_limitState=_.e_atUpperLimit;this.m_impulse.y=0}}else{this.m_limitState=_.e_inactiveLimit;this.m_impulse.y=0}}else{this.m_limitState=_.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var g=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x;var b=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y;var T=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1;var R=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;e.m_linearVelocity.x-=this.m_invMassA*g;e.m_linearVelocity.y-=this.m_invMassA*b;e.m_angularVelocity-=this.m_invIA*T;o.m_linearVelocity.x+=this.m_invMassB*g;o.m_linearVelocity.y+=this.m_invMassB*b;o.m_angularVelocity+=this.m_invIB*R}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};E.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var o=e.m_linearVelocity;var r=e.m_angularVelocity;var a=i.m_linearVelocity;var s=i.m_angularVelocity;var c=0;var h=0;var m=0;var p=0;if(this.m_enableMotor&&this.m_limitState!=_.e_equalLimits){var u=this.m_axis.x*(a.x-o.x)+this.m_axis.y*(a.y-o.y)+this.m_a2*s-this.m_a1*r;var f=this.m_motorMass*(this.m_motorSpeed-u);var y=this.m_motorImpulse;var d=t.dt*this.m_maxMotorForce;this.m_motorImpulse=n.Clamp(this.m_motorImpulse+f,-d,d);f=this.m_motorImpulse-y;c=f*this.m_axis.x;h=f*this.m_axis.y;m=f*this.m_a1;p=f*this.m_a2;o.x-=this.m_invMassA*c;o.y-=this.m_invMassA*h;r-=this.m_invIA*m;a.x+=this.m_invMassB*c;a.y+=this.m_invMassB*h;s+=this.m_invIB*p}var v=this.m_perp.x*(a.x-o.x)+this.m_perp.y*(a.y-o.y)+this.m_s2*s-this.m_s1*r;if(this.m_enableLimit&&this.m_limitState!=_.e_inactiveLimit){var x=this.m_axis.x*(a.x-o.x)+this.m_axis.y*(a.y-o.y)+this.m_a2*s-this.m_a1*r;var E=this.m_impulse.Copy();var g=this.m_K.Solve(new l,-v,-x);this.m_impulse.Add(g);if(this.m_limitState==_.e_atLowerLimit){this.m_impulse.y=n.Max(this.m_impulse.y,0)}else if(this.m_limitState==_.e_atUpperLimit){this.m_impulse.y=n.Min(this.m_impulse.y,0)}var b=-v-(this.m_impulse.y-E.y)*this.m_K.col2.x;var T=0;if(this.m_K.col1.x!=0){T=b/this.m_K.col1.x+E.x}else{T=E.x}this.m_impulse.x=T;g.x=this.m_impulse.x-E.x;g.y=this.m_impulse.y-E.y;c=g.x*this.m_perp.x+g.y*this.m_axis.x;h=g.x*this.m_perp.y+g.y*this.m_axis.y;m=g.x*this.m_s1+g.y*this.m_a1;p=g.x*this.m_s2+g.y*this.m_a2;o.x-=this.m_invMassA*c;o.y-=this.m_invMassA*h;r-=this.m_invIA*m;a.x+=this.m_invMassB*c;a.y+=this.m_invMassB*h;s+=this.m_invIB*p}else{var R=0;if(this.m_K.col1.x!=0){R=-v/this.m_K.col1.x}else{R=0}this.m_impulse.x+=R;c=R*this.m_perp.x;h=R*this.m_perp.y;m=R*this.m_s1;p=R*this.m_s2;o.x-=this.m_invMassA*c;o.y-=this.m_invMassA*h;r-=this.m_invIA*m;a.x+=this.m_invMassB*c;a.y+=this.m_invMassB*h;s+=this.m_invIB*p}e.m_linearVelocity.SetV(o);e.m_angularVelocity=r;i.m_linearVelocity.SetV(a);i.m_angularVelocity=s};E.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var r=0;var a=this.m_bodyA;var s=this.m_bodyB;var c=a.m_sweep.c;var h=a.m_sweep.a;var m=s.m_sweep.c;var p=s.m_sweep.a;var u;var f=0;var y=0;var d=0;var _=0;var v=0;var x=0;var E=0;var g=false;var b=0;var T=o.FromAngle(h);var R=o.FromAngle(p);u=T;var w=this.m_localAnchor1.x-this.m_localCenterA.x;var S=this.m_localAnchor1.y-this.m_localCenterA.y;f=u.col1.x*w+u.col2.x*S;S=u.col1.y*w+u.col2.y*S;w=f;u=R;var C=this.m_localAnchor2.x-this.m_localCenterB.x;var A=this.m_localAnchor2.y-this.m_localCenterB.y;f=u.col1.x*C+u.col2.x*A;A=u.col1.y*C+u.col2.y*A;C=f;var M=m.x+C-c.x-w;var D=m.y+A-c.y-S;if(this.m_enableLimit){this.m_axis=n.MulMV(T,this.m_localXAxis1);this.m_a1=(M+w)*this.m_axis.y-(D+S)*this.m_axis.x;this.m_a2=C*this.m_axis.y-A*this.m_axis.x;var B=this.m_axis.x*M+this.m_axis.y*D;if(n.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){b=n.Clamp(B,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);x=n.Abs(B);g=true}else if(B<=this.m_lowerTranslation){b=n.Clamp(B-this.m_lowerTranslation+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);x=this.m_lowerTranslation-B;g=true}else if(B>=this.m_upperTranslation){b=n.Clamp(B-this.m_upperTranslation+i.b2_linearSlop,0,i.b2_maxLinearCorrection);x=B-this.m_upperTranslation;g=true}}this.m_perp=n.MulMV(T,this.m_localYAxis1);this.m_s1=(M+w)*this.m_perp.y-(D+S)*this.m_perp.x;this.m_s2=C*this.m_perp.y-A*this.m_perp.x;var H=new l;var V=this.m_perp.x*M+this.m_perp.y*D;x=n.Max(x,n.Abs(V));E=0;if(g){y=this.m_invMassA;d=this.m_invMassB;_=this.m_invIA;v=this.m_invIB;this.m_K.col1.x=y+d+_*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2;this.m_K.col1.y=_*this.m_s1*this.m_a1+v*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=y+d+_*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2;this.m_K.Solve(H,-V,-b)}else{y=this.m_invMassA;d=this.m_invMassB;_=this.m_invIA;v=this.m_invIB;var L=y+d+_*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2;var P=0;if(L!=0){P=-V/L}else{P=0}H.x=P;H.y=0}var F=H.x*this.m_perp.x+H.y*this.m_axis.x;var I=H.x*this.m_perp.y+H.y*this.m_axis.y;var U=H.x*this.m_s1+H.y*this.m_a1;var G=H.x*this.m_s2+H.y*this.m_a2;c.x-=this.m_invMassA*F;c.y-=this.m_invMassA*I;h-=this.m_invIA*U;m.x+=this.m_invMassB*F;m.y+=this.m_invMassB*I;p+=this.m_invIB*G;a.m_sweep.a=h;s.m_sweep.a=p;a.SynchronizeTransform();s.SynchronizeTransform();return x<=i.b2_linearSlop&&E<=i.b2_angularSlop};Box2D.inherit(g,Box2D.Dynamics.Joints.b2JointDef);g.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;g.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l;this.localAxisA=new l};g.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=_.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=false;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=false;this.maxMotorForce=0;this.motorSpeed=0};g.prototype.Initialize=function(t,e,i,o){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.localAxisA=this.bodyA.GetLocalVector(o)};Box2D.inherit(b,Box2D.Dynamics.Joints.b2Joint);b.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;b.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new o;this.K1=new o;this.K2=new o;this.m_localAnchor=new l;this.m_target=new l;this.m_impulse=new l;this.m_mass=new o;this.m_C=new l};b.prototype.GetAnchorA=function(){return this.m_target};b.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};b.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse.x,t*this.m_impulse.y)};b.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};b.prototype.GetTarget=function(){return this.m_target};b.prototype.SetTarget=function(t){if(this.m_bodyB.IsAwake()==false){this.m_bodyB.SetAwake(true)}this.m_target=t};b.prototype.GetMaxForce=function(){return this.m_maxForce};b.prototype.SetMaxForce=function(t){if(t===undefined)t=0;this.m_maxForce=t};b.prototype.GetFrequency=function(){return this.m_frequencyHz};b.prototype.SetFrequency=function(t){if(t===undefined)t=0;this.m_frequencyHz=t};b.prototype.GetDampingRatio=function(){return this.m_dampingRatio};b.prototype.SetDampingRatio=function(t){if(t===undefined)t=0;this.m_dampingRatio=t};b.prototype.b2MouseJoint=function(t){this.__super.b2Joint.call(this,t);this.m_target.SetV(t.target);var e=this.m_target.x-this.m_bodyB.m_xf.position.x;var i=this.m_target.y-this.m_bodyB.m_xf.position.y;var o=this.m_bodyB.m_xf.R;this.m_localAnchor.x=e*o.col1.x+i*o.col1.y;this.m_localAnchor.y=e*o.col2.x+i*o.col2.y;this.m_maxForce=t.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=t.frequencyHz;this.m_dampingRatio=t.dampingRatio;this.m_beta=0;this.m_gamma=0};b.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyB;var i=e.GetMass();var o=2*Math.PI*this.m_frequencyHz;var r=2*i*this.m_dampingRatio*o;var n=i*o*o;this.m_gamma=t.dt*(r+t.dt*n);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=t.dt*n*this.m_gamma;var a;a=e.m_xf.R;var s=this.m_localAnchor.x-e.m_sweep.localCenter.x;var l=this.m_localAnchor.y-e.m_sweep.localCenter.y;var c=a.col1.x*s+a.col2.x*l;l=a.col1.y*s+a.col2.y*l;s=c;var h=e.m_invMass;var m=e.m_invI;this.K1.col1.x=h;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=h;this.K2.col1.x=m*l*l;this.K2.col2.x=-m*s*l;this.K2.col1.y=-m*s*l;this.K2.col2.y=m*s*s;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=e.m_sweep.c.x+s-this.m_target.x;this.m_C.y=e.m_sweep.c.y+l-this.m_target.y;e.m_angularVelocity*=.98;this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;e.m_linearVelocity.x+=h*this.m_impulse.x;e.m_linearVelocity.y+=h*this.m_impulse.y;e.m_angularVelocity+=m*(s*this.m_impulse.y-l*this.m_impulse.x)};b.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyB;var i;var o=0;var r=0;i=e.m_xf.R;var n=this.m_localAnchor.x-e.m_sweep.localCenter.x;var a=this.m_localAnchor.y-e.m_sweep.localCenter.y;o=i.col1.x*n+i.col2.x*a;a=i.col1.y*n+i.col2.y*a;n=o;var s=e.m_linearVelocity.x+-e.m_angularVelocity*a;var l=e.m_linearVelocity.y+e.m_angularVelocity*n;i=this.m_mass;o=s+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;r=l+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var c=-(i.col1.x*o+i.col2.x*r);var h=-(i.col1.y*o+i.col2.y*r);var m=this.m_impulse.x;var p=this.m_impulse.y;this.m_impulse.x+=c;this.m_impulse.y+=h;var u=t.dt*this.m_maxForce;if(this.m_impulse.LengthSquared()>u*u){this.m_impulse.Multiply(u/this.m_impulse.Length())}c=this.m_impulse.x-m;h=this.m_impulse.y-p;e.m_linearVelocity.x+=e.m_invMass*c;e.m_linearVelocity.y+=e.m_invMass*h;e.m_angularVelocity+=e.m_invI*(n*h-a*c)};b.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;return true};Box2D.inherit(T,Box2D.Dynamics.Joints.b2JointDef);T.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;T.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new l};T.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=_.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7};Box2D.inherit(R,Box2D.Dynamics.Joints.b2Joint);R.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;R.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_localXAxis1=new l;this.m_localYAxis1=new l;this.m_axis=new l;this.m_perp=new l;this.m_K=new r;this.m_impulse=new c};R.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};R.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};R.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};R.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.y};R.prototype.GetJointTranslation=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;var o=t.GetWorldPoint(this.m_localAnchor1);var r=e.GetWorldPoint(this.m_localAnchor2);var n=r.x-o.x;var a=r.y-o.y;var s=t.GetWorldVector(this.m_localXAxis1);var l=s.x*n+s.y*a;return l};R.prototype.GetJointSpeed=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i;i=t.m_xf.R;var o=this.m_localAnchor1.x-t.m_sweep.localCenter.x;var r=this.m_localAnchor1.y-t.m_sweep.localCenter.y;var n=i.col1.x*o+i.col2.x*r;r=i.col1.y*o+i.col2.y*r;o=n;i=e.m_xf.R;var a=this.m_localAnchor2.x-e.m_sweep.localCenter.x;var s=this.m_localAnchor2.y-e.m_sweep.localCenter.y;n=i.col1.x*a+i.col2.x*s;s=i.col1.y*a+i.col2.y*s;a=n;var l=t.m_sweep.c.x+o;var c=t.m_sweep.c.y+r;var h=e.m_sweep.c.x+a;var m=e.m_sweep.c.y+s;var p=h-l;var u=m-c;var f=t.GetWorldVector(this.m_localXAxis1);var y=t.m_linearVelocity;var d=e.m_linearVelocity;var _=t.m_angularVelocity;var v=e.m_angularVelocity;var x=p*(-_*f.y)+u*(_*f.x)+(f.x*(d.x+-v*s-y.x- -_*r)+f.y*(d.y+v*a-y.y-_*o));return x};R.prototype.IsLimitEnabled=function(){return this.m_enableLimit};R.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=t};R.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};R.prototype.GetUpperLimit=function(){return this.m_upperTranslation};R.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=t;this.m_upperTranslation=e};R.prototype.IsMotorEnabled=function(){return this.m_enableMotor};R.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=t};R.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};R.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};R.prototype.SetMaxMotorForce=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=t};R.prototype.GetMotorForce=function(){return this.m_motorImpulse};R.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var o=0;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_localXAxis1.SetV(t.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=t.lowerTranslation;this.m_upperTranslation=t.upperTranslation;this.m_maxMotorForce=t.maxMotorForce;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=_.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};R.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var o=this.m_bodyB;var r;var a=0;this.m_localCenterA.SetV(e.GetLocalCenter());this.m_localCenterB.SetV(o.GetLocalCenter());var s=e.GetTransform();var l=o.GetTransform();r=e.m_xf.R;var c=this.m_localAnchor1.x-this.m_localCenterA.x;var h=this.m_localAnchor1.y-this.m_localCenterA.y;a=r.col1.x*c+r.col2.x*h;h=r.col1.y*c+r.col2.y*h;c=a;r=o.m_xf.R;var m=this.m_localAnchor2.x-this.m_localCenterB.x;var p=this.m_localAnchor2.y-this.m_localCenterB.y;a=r.col1.x*m+r.col2.x*p;p=r.col1.y*m+r.col2.y*p;m=a;var u=o.m_sweep.c.x+m-e.m_sweep.c.x-c;var f=o.m_sweep.c.y+p-e.m_sweep.c.y-h;this.m_invMassA=e.m_invMass;this.m_invMassB=o.m_invMass;this.m_invIA=e.m_invI;this.m_invIB=o.m_invI;{this.m_axis.SetV(n.MulMV(s.R,this.m_localXAxis1));this.m_a1=(u+c)*this.m_axis.y-(f+h)*this.m_axis.x;this.m_a2=m*this.m_axis.y-p*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Number.MIN_VALUE)this.m_motorMass=1/this.m_motorMass}{this.m_perp.SetV(n.MulMV(s.R,this.m_localYAxis1));this.m_s1=(u+c)*this.m_perp.y-(f+h)*this.m_perp.x;this.m_s2=m*this.m_perp.y-p*this.m_perp.x;var y=this.m_invMassA;var d=this.m_invMassB;var v=this.m_invIA;var x=this.m_invIB;this.m_K.col1.x=y+d+v*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2;this.m_K.col1.y=v*this.m_s1+x*this.m_s2;this.m_K.col1.z=v*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=v+x;this.m_K.col2.z=v*this.m_a1+x*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=y+d+v*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2}if(this.m_enableLimit){var E=this.m_axis.x*u+this.m_axis.y*f;if(n.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){this.m_limitState=_.e_equalLimits}else if(E<=this.m_lowerTranslation){if(this.m_limitState!=_.e_atLowerLimit){this.m_limitState=_.e_atLowerLimit;this.m_impulse.z=0}}else if(E>=this.m_upperTranslation){if(this.m_limitState!=_.e_atUpperLimit){this.m_limitState=_.e_atUpperLimit;this.m_impulse.z=0}}else{this.m_limitState=_.e_inactiveLimit;this.m_impulse.z=0}}else{this.m_limitState=_.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var g=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x;var b=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y;var T=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1;var R=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;e.m_linearVelocity.x-=this.m_invMassA*g;e.m_linearVelocity.y-=this.m_invMassA*b;e.m_angularVelocity-=this.m_invIA*T;o.m_linearVelocity.x+=this.m_invMassB*g;o.m_linearVelocity.y+=this.m_invMassB*b;o.m_angularVelocity+=this.m_invIB*R}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};R.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var o=e.m_linearVelocity;var r=e.m_angularVelocity;var a=i.m_linearVelocity;var s=i.m_angularVelocity;var h=0;var m=0;var p=0;var u=0;if(this.m_enableMotor&&this.m_limitState!=_.e_equalLimits){var f=this.m_axis.x*(a.x-o.x)+this.m_axis.y*(a.y-o.y)+this.m_a2*s-this.m_a1*r;var y=this.m_motorMass*(this.m_motorSpeed-f);var d=this.m_motorImpulse;var v=t.dt*this.m_maxMotorForce;this.m_motorImpulse=n.Clamp(this.m_motorImpulse+y,-v,v);y=this.m_motorImpulse-d;h=y*this.m_axis.x;m=y*this.m_axis.y;p=y*this.m_a1;u=y*this.m_a2;o.x-=this.m_invMassA*h;o.y-=this.m_invMassA*m;r-=this.m_invIA*p;a.x+=this.m_invMassB*h;a.y+=this.m_invMassB*m;s+=this.m_invIB*u}var x=this.m_perp.x*(a.x-o.x)+this.m_perp.y*(a.y-o.y)+this.m_s2*s-this.m_s1*r;var E=s-r;if(this.m_enableLimit&&this.m_limitState!=_.e_inactiveLimit){var g=this.m_axis.x*(a.x-o.x)+this.m_axis.y*(a.y-o.y)+this.m_a2*s-this.m_a1*r;var b=this.m_impulse.Copy();var T=this.m_K.Solve33(new c,-x,-E,-g);this.m_impulse.Add(T);if(this.m_limitState==_.e_atLowerLimit){this.m_impulse.z=n.Max(this.m_impulse.z,0)}else if(this.m_limitState==_.e_atUpperLimit){this.m_impulse.z=n.Min(this.m_impulse.z,0)}var R=-x-(this.m_impulse.z-b.z)*this.m_K.col3.x;var w=-E-(this.m_impulse.z-b.z)*this.m_K.col3.y;var S=this.m_K.Solve22(new l,R,w);S.x+=b.x;S.y+=b.y;this.m_impulse.x=S.x;this.m_impulse.y=S.y;T.x=this.m_impulse.x-b.x;T.y=this.m_impulse.y-b.y;T.z=this.m_impulse.z-b.z;h=T.x*this.m_perp.x+T.z*this.m_axis.x;m=T.x*this.m_perp.y+T.z*this.m_axis.y;p=T.x*this.m_s1+T.y+T.z*this.m_a1;u=T.x*this.m_s2+T.y+T.z*this.m_a2;o.x-=this.m_invMassA*h;o.y-=this.m_invMassA*m;r-=this.m_invIA*p;a.x+=this.m_invMassB*h;a.y+=this.m_invMassB*m;s+=this.m_invIB*u}else{var C=this.m_K.Solve22(new l,-x,-E);this.m_impulse.x+=C.x;this.m_impulse.y+=C.y;h=C.x*this.m_perp.x;m=C.x*this.m_perp.y;p=C.x*this.m_s1+C.y;u=C.x*this.m_s2+C.y;o.x-=this.m_invMassA*h;o.y-=this.m_invMassA*m;r-=this.m_invIA*p;a.x+=this.m_invMassB*h;a.y+=this.m_invMassB*m;s+=this.m_invIB*u}e.m_linearVelocity.SetV(o);e.m_angularVelocity=r;i.m_linearVelocity.SetV(a);i.m_angularVelocity=s};R.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var r=0;var a=this.m_bodyA;var s=this.m_bodyB;var h=a.m_sweep.c;var m=a.m_sweep.a;var p=s.m_sweep.c;var u=s.m_sweep.a;var f;var y=0;var d=0;var _=0;var v=0;var x=0;var E=0;var g=0;var b=false;var T=0;var R=o.FromAngle(m);var w=o.FromAngle(u);f=R;var S=this.m_localAnchor1.x-this.m_localCenterA.x;var C=this.m_localAnchor1.y-this.m_localCenterA.y;y=f.col1.x*S+f.col2.x*C;C=f.col1.y*S+f.col2.y*C;S=y;f=w;var A=this.m_localAnchor2.x-this.m_localCenterB.x;var M=this.m_localAnchor2.y-this.m_localCenterB.y;y=f.col1.x*A+f.col2.x*M;M=f.col1.y*A+f.col2.y*M;A=y;var D=p.x+A-h.x-S;var B=p.y+M-h.y-C;if(this.m_enableLimit){this.m_axis=n.MulMV(R,this.m_localXAxis1);this.m_a1=(D+S)*this.m_axis.y-(B+C)*this.m_axis.x;this.m_a2=A*this.m_axis.y-M*this.m_axis.x;var H=this.m_axis.x*D+this.m_axis.y*B;if(n.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop){T=n.Clamp(H,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);E=n.Abs(H);b=true}else if(H<=this.m_lowerTranslation){T=n.Clamp(H-this.m_lowerTranslation+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);E=this.m_lowerTranslation-H;b=true}else if(H>=this.m_upperTranslation){T=n.Clamp(H-this.m_upperTranslation+i.b2_linearSlop,0,i.b2_maxLinearCorrection);E=H-this.m_upperTranslation;b=true}}this.m_perp=n.MulMV(R,this.m_localYAxis1);this.m_s1=(D+S)*this.m_perp.y-(B+C)*this.m_perp.x;this.m_s2=A*this.m_perp.y-M*this.m_perp.x;var V=new c;var L=this.m_perp.x*D+this.m_perp.y*B;var P=u-m-this.m_refAngle;E=n.Max(E,n.Abs(L));g=n.Abs(P);if(b){d=this.m_invMassA;_=this.m_invMassB;v=this.m_invIA;x=this.m_invIB;this.m_K.col1.x=d+_+v*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2;this.m_K.col1.y=v*this.m_s1+x*this.m_s2;this.m_K.col1.z=v*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=v+x;this.m_K.col2.z=v*this.m_a1+x*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=d+_+v*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2;this.m_K.Solve33(V,-L,-P,-T)}else{d=this.m_invMassA;_=this.m_invMassB;v=this.m_invIA;x=this.m_invIB;var F=d+_+v*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2;var I=v*this.m_s1+x*this.m_s2;var U=v+x;this.m_K.col1.Set(F,I,0);this.m_K.col2.Set(I,U,0);var G=this.m_K.Solve22(new l,-L,-P);V.x=G.x;V.y=G.y;V.z=0}var z=V.x*this.m_perp.x+V.z*this.m_axis.x;var N=V.x*this.m_perp.y+V.z*this.m_axis.y;var k=V.x*this.m_s1+V.y+V.z*this.m_a1;var O=V.x*this.m_s2+V.y+V.z*this.m_a2;h.x-=this.m_invMassA*z;h.y-=this.m_invMassA*N;m-=this.m_invIA*k;p.x+=this.m_invMassB*z;p.y+=this.m_invMassB*N;u+=this.m_invIB*O;a.m_sweep.a=m;s.m_sweep.a=u;a.SynchronizeTransform();s.SynchronizeTransform();return E<=i.b2_linearSlop&&g<=i.b2_angularSlop};Box2D.inherit(w,Box2D.Dynamics.Joints.b2JointDef);w.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;w.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l;this.localAxisA=new l};w.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=_.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=false;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=false;this.maxMotorForce=0;this.motorSpeed=0};w.prototype.Initialize=function(t,e,i,o){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.localAxisA=this.bodyA.GetLocalVector(o);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(S,Box2D.Dynamics.Joints.b2Joint);S.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;S.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new l;this.m_groundAnchor2=new l;this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_u1=new l;this.m_u2=new l};S.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};S.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};S.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)};S.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return 0};S.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();t.Add(this.m_groundAnchor1);return t};S.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();t.Add(this.m_groundAnchor2);return t};S.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1);var e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var o=t.x-e;var r=t.y-i;return Math.sqrt(o*o+r*r)};S.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2);var e=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var i=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;var o=t.x-e;var r=t.y-i;return Math.sqrt(o*o+r*r)};S.prototype.GetRatio=function(){return this.m_ratio};S.prototype.b2PulleyJoint=function(t){this.__super.b2Joint.call(this,t);var e;var i=0;var o=0;this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_ratio=t.ratio;this.m_constant=t.lengthA+this.m_ratio*t.lengthB;this.m_maxLength1=n.Min(t.maxLengthA,this.m_constant-this.m_ratio*S.b2_minPulleyLength);this.m_maxLength2=n.Min(t.maxLengthB,(this.m_constant-S.b2_minPulleyLength)/this.m_ratio);this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0};S.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var o=this.m_bodyB;var r;r=e.m_xf.R;var n=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var a=this.m_localAnchor1.y-e.m_sweep.localCenter.y;var s=r.col1.x*n+r.col2.x*a;a=r.col1.y*n+r.col2.y*a;n=s;r=o.m_xf.R;var l=this.m_localAnchor2.x-o.m_sweep.localCenter.x;var c=this.m_localAnchor2.y-o.m_sweep.localCenter.y;s=r.col1.x*l+r.col2.x*c;c=r.col1.y*l+r.col2.y*c;l=s;var h=e.m_sweep.c.x+n;var m=e.m_sweep.c.y+a;var p=o.m_sweep.c.x+l;var u=o.m_sweep.c.y+c;var f=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var y=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var d=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var v=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(h-f,m-y);this.m_u2.Set(p-d,u-v);var x=this.m_u1.Length();var E=this.m_u2.Length();if(x>i.b2_linearSlop){this.m_u1.Multiply(1/x)}else{this.m_u1.SetZero()}if(E>i.b2_linearSlop){this.m_u2.Multiply(1/E)}else{this.m_u2.SetZero()}var g=this.m_constant-x-this.m_ratio*E;if(g>0){this.m_state=_.e_inactiveLimit;this.m_impulse=0}else{this.m_state=_.e_atUpperLimit}if(x<this.m_maxLength1){this.m_limitState1=_.e_inactiveLimit;this.m_limitImpulse1=0}else{this.m_limitState1=_.e_atUpperLimit}if(E<this.m_maxLength2){this.m_limitState2=_.e_inactiveLimit;this.m_limitImpulse2=0}else{this.m_limitState2=_.e_atUpperLimit}var b=n*this.m_u1.y-a*this.m_u1.x;var T=l*this.m_u2.y-c*this.m_u2.x;this.m_limitMass1=e.m_invMass+e.m_invI*b*b;this.m_limitMass2=o.m_invMass+o.m_invI*T*T;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;if(t.warmStarting){this.m_impulse*=t.dtRatio;this.m_limitImpulse1*=t.dtRatio;this.m_limitImpulse2*=t.dtRatio;var R=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x;var w=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y;var S=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x;var C=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;e.m_linearVelocity.x+=e.m_invMass*R;e.m_linearVelocity.y+=e.m_invMass*w;e.m_angularVelocity+=e.m_invI*(n*w-a*R);o.m_linearVelocity.x+=o.m_invMass*S;o.m_linearVelocity.y+=o.m_invMass*C;o.m_angularVelocity+=o.m_invI*(l*C-c*S)}else{this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0}};S.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var o;o=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var a=this.m_localAnchor1.y-e.m_sweep.localCenter.y;var s=o.col1.x*r+o.col2.x*a;a=o.col1.y*r+o.col2.y*a;r=s;o=i.m_xf.R;var l=this.m_localAnchor2.x-i.m_sweep.localCenter.x;var c=this.m_localAnchor2.y-i.m_sweep.localCenter.y;s=o.col1.x*l+o.col2.x*c;c=o.col1.y*l+o.col2.y*c;l=s;var h=0;var m=0;var p=0;var u=0;var f=0;var y=0;var d=0;var v=0;var x=0;var E=0;var g=0;if(this.m_state==_.e_atUpperLimit){h=e.m_linearVelocity.x+-e.m_angularVelocity*a;m=e.m_linearVelocity.y+e.m_angularVelocity*r;p=i.m_linearVelocity.x+-i.m_angularVelocity*c;u=i.m_linearVelocity.y+i.m_angularVelocity*l;x=-(this.m_u1.x*h+this.m_u1.y*m)-this.m_ratio*(this.m_u2.x*p+this.m_u2.y*u);E=this.m_pulleyMass*-x;g=this.m_impulse;this.m_impulse=n.Max(0,this.m_impulse+E);E=this.m_impulse-g;f=-E*this.m_u1.x;y=-E*this.m_u1.y;d=-this.m_ratio*E*this.m_u2.x;v=-this.m_ratio*E*this.m_u2.y;e.m_linearVelocity.x+=e.m_invMass*f;e.m_linearVelocity.y+=e.m_invMass*y;e.m_angularVelocity+=e.m_invI*(r*y-a*f);i.m_linearVelocity.x+=i.m_invMass*d;i.m_linearVelocity.y+=i.m_invMass*v;i.m_angularVelocity+=i.m_invI*(l*v-c*d)}if(this.m_limitState1==_.e_atUpperLimit){h=e.m_linearVelocity.x+-e.m_angularVelocity*a;m=e.m_linearVelocity.y+e.m_angularVelocity*r;x=-(this.m_u1.x*h+this.m_u1.y*m);E=-this.m_limitMass1*x;g=this.m_limitImpulse1;this.m_limitImpulse1=n.Max(0,this.m_limitImpulse1+E);E=this.m_limitImpulse1-g;f=-E*this.m_u1.x;y=-E*this.m_u1.y;e.m_linearVelocity.x+=e.m_invMass*f;e.m_linearVelocity.y+=e.m_invMass*y;e.m_angularVelocity+=e.m_invI*(r*y-a*f)}if(this.m_limitState2==_.e_atUpperLimit){p=i.m_linearVelocity.x+-i.m_angularVelocity*c;u=i.m_linearVelocity.y+i.m_angularVelocity*l;x=-(this.m_u2.x*p+this.m_u2.y*u);E=-this.m_limitMass2*x;g=this.m_limitImpulse2;this.m_limitImpulse2=n.Max(0,this.m_limitImpulse2+E);E=this.m_limitImpulse2-g;d=-E*this.m_u2.x;v=-E*this.m_u2.y;i.m_linearVelocity.x+=i.m_invMass*d;i.m_linearVelocity.y+=i.m_invMass*v;i.m_angularVelocity+=i.m_invI*(l*v-c*d)}};S.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=this.m_bodyA;var o=this.m_bodyB;var r;var a=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var s=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var c=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;var h=0;var m=0;var p=0;var u=0;var f=0;var y=0;var d=0;var v=0;var x=0;var E=0;var g=0;var b=0;var T=0;var R=0;var w=0;var S=0;if(this.m_state==_.e_atUpperLimit){r=e.m_xf.R;h=this.m_localAnchor1.x-e.m_sweep.localCenter.x;m=this.m_localAnchor1.y-e.m_sweep.localCenter.y;w=r.col1.x*h+r.col2.x*m;m=r.col1.y*h+r.col2.y*m;h=w;r=o.m_xf.R;p=this.m_localAnchor2.x-o.m_sweep.localCenter.x;u=this.m_localAnchor2.y-o.m_sweep.localCenter.y;w=r.col1.x*p+r.col2.x*u;u=r.col1.y*p+r.col2.y*u;p=w;f=e.m_sweep.c.x+h;y=e.m_sweep.c.y+m;d=o.m_sweep.c.x+p;v=o.m_sweep.c.y+u;this.m_u1.Set(f-a,y-s);this.m_u2.Set(d-l,v-c);x=this.m_u1.Length();E=this.m_u2.Length();if(x>i.b2_linearSlop){this.m_u1.Multiply(1/x)}else{this.m_u1.SetZero()}if(E>i.b2_linearSlop){this.m_u2.Multiply(1/E)}else{this.m_u2.SetZero()}g=this.m_constant-x-this.m_ratio*E;S=n.Max(S,-g);g=n.Clamp(g+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);b=-this.m_pulleyMass*g;f=-b*this.m_u1.x;y=-b*this.m_u1.y;d=-this.m_ratio*b*this.m_u2.x;v=-this.m_ratio*b*this.m_u2.y;e.m_sweep.c.x+=e.m_invMass*f;e.m_sweep.c.y+=e.m_invMass*y;e.m_sweep.a+=e.m_invI*(h*y-m*f);o.m_sweep.c.x+=o.m_invMass*d;o.m_sweep.c.y+=o.m_invMass*v;o.m_sweep.a+=o.m_invI*(p*v-u*d);e.SynchronizeTransform();o.SynchronizeTransform()}if(this.m_limitState1==_.e_atUpperLimit){r=e.m_xf.R;h=this.m_localAnchor1.x-e.m_sweep.localCenter.x;m=this.m_localAnchor1.y-e.m_sweep.localCenter.y;w=r.col1.x*h+r.col2.x*m;m=r.col1.y*h+r.col2.y*m;h=w;f=e.m_sweep.c.x+h;y=e.m_sweep.c.y+m;this.m_u1.Set(f-a,y-s);x=this.m_u1.Length();if(x>i.b2_linearSlop){this.m_u1.x*=1/x;this.m_u1.y*=1/x}else{this.m_u1.SetZero()}g=this.m_maxLength1-x;S=n.Max(S,-g);g=n.Clamp(g+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);b=-this.m_limitMass1*g;f=-b*this.m_u1.x;y=-b*this.m_u1.y;e.m_sweep.c.x+=e.m_invMass*f;e.m_sweep.c.y+=e.m_invMass*y;e.m_sweep.a+=e.m_invI*(h*y-m*f);e.SynchronizeTransform()}if(this.m_limitState2==_.e_atUpperLimit){r=o.m_xf.R;p=this.m_localAnchor2.x-o.m_sweep.localCenter.x;u=this.m_localAnchor2.y-o.m_sweep.localCenter.y;w=r.col1.x*p+r.col2.x*u;u=r.col1.y*p+r.col2.y*u;p=w;d=o.m_sweep.c.x+p;v=o.m_sweep.c.y+u;this.m_u2.Set(d-l,v-c);E=this.m_u2.Length();if(E>i.b2_linearSlop){this.m_u2.x*=1/E;this.m_u2.y*=1/E}else{this.m_u2.SetZero()}g=this.m_maxLength2-E;S=n.Max(S,-g);g=n.Clamp(g+i.b2_linearSlop,-i.b2_maxLinearCorrection,0);b=-this.m_limitMass2*g;d=-b*this.m_u2.x;v=-b*this.m_u2.y;o.m_sweep.c.x+=o.m_invMass*d;o.m_sweep.c.y+=o.m_invMass*v;o.m_sweep.a+=o.m_invI*(p*v-u*d);o.SynchronizeTransform()}return S<i.b2_linearSlop};Box2D.postDefs.push((function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}));Box2D.inherit(C,Box2D.Dynamics.Joints.b2JointDef);C.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;C.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new l;this.groundAnchorB=new l;this.localAnchorA=new l;this.localAnchorB=new l};C.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=_.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.lengthA=0;this.maxLengthA=0;this.lengthB=0;this.maxLengthB=0;this.ratio=1;this.collideConnected=true};C.prototype.Initialize=function(t,e,i,o,r,n,a){if(a===undefined)a=0;this.bodyA=t;this.bodyB=e;this.groundAnchorA.SetV(i);this.groundAnchorB.SetV(o);this.localAnchorA=this.bodyA.GetLocalPoint(r);this.localAnchorB=this.bodyB.GetLocalPoint(n);var s=r.x-i.x;var l=r.y-i.y;this.lengthA=Math.sqrt(s*s+l*l);var c=n.x-o.x;var h=n.y-o.y;this.lengthB=Math.sqrt(c*c+h*h);this.ratio=a;var m=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=m-this.ratio*S.b2_minPulleyLength;this.maxLengthB=(m-S.b2_minPulleyLength)/this.ratio};Box2D.inherit(A,Box2D.Dynamics.Joints.b2Joint);A.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;A.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new o;this.K1=new o;this.K2=new o;this.K3=new o;this.impulse3=new c;this.impulse2=new l;this.reduced=new l;this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_impulse=new c;this.m_mass=new r};A.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};A.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};A.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse.x,t*this.m_impulse.y)};A.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.z};A.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};A.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};A.prototype.IsLimitEnabled=function(){return this.m_enableLimit};A.prototype.EnableLimit=function(t){this.m_enableLimit=t};A.prototype.GetLowerLimit=function(){return this.m_lowerAngle};A.prototype.GetUpperLimit=function(){return this.m_upperAngle};A.prototype.SetLimits=function(t,e){if(t===undefined)t=0;if(e===undefined)e=0;this.m_lowerAngle=t;this.m_upperAngle=e};A.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);return this.m_enableMotor};A.prototype.EnableMotor=function(t){this.m_enableMotor=t};A.prototype.SetMotorSpeed=function(t){if(t===undefined)t=0;this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=t};A.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};A.prototype.SetMaxMotorTorque=function(t){if(t===undefined)t=0;this.m_maxMotorTorque=t};A.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};A.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_referenceAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=t.lowerAngle;this.m_upperAngle=t.upperAngle;this.m_maxMotorTorque=t.maxMotorTorque;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=_.e_inactiveLimit};A.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyA;var o=this.m_bodyB;var r;var a=0;if(this.m_enableMotor||this.m_enableLimit){}r=e.m_xf.R;var s=this.m_localAnchor1.x-e.m_sweep.localCenter.x;var l=this.m_localAnchor1.y-e.m_sweep.localCenter.y;a=r.col1.x*s+r.col2.x*l;l=r.col1.y*s+r.col2.y*l;s=a;r=o.m_xf.R;var c=this.m_localAnchor2.x-o.m_sweep.localCenter.x;var h=this.m_localAnchor2.y-o.m_sweep.localCenter.y;a=r.col1.x*c+r.col2.x*h;h=r.col1.y*c+r.col2.y*h;c=a;var m=e.m_invMass;var p=o.m_invMass;var u=e.m_invI;var f=o.m_invI;this.m_mass.col1.x=m+p+l*l*u+h*h*f;this.m_mass.col2.x=-l*s*u-h*c*f;this.m_mass.col3.x=-l*u-h*f;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=m+p+s*s*u+c*c*f;this.m_mass.col3.y=s*u+c*f;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=u+f;this.m_motorMass=1/(u+f);if(this.m_enableMotor==false){this.m_motorImpulse=0}if(this.m_enableLimit){var y=o.m_sweep.a-e.m_sweep.a-this.m_referenceAngle;if(n.Abs(this.m_upperAngle-this.m_lowerAngle)<2*i.b2_angularSlop){this.m_limitState=_.e_equalLimits}else if(y<=this.m_lowerAngle){if(this.m_limitState!=_.e_atLowerLimit){this.m_impulse.z=0}this.m_limitState=_.e_atLowerLimit}else if(y>=this.m_upperAngle){if(this.m_limitState!=_.e_atUpperLimit){this.m_impulse.z=0}this.m_limitState=_.e_atUpperLimit}else{this.m_limitState=_.e_inactiveLimit;this.m_impulse.z=0}}else{this.m_limitState=_.e_inactiveLimit}if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var d=this.m_impulse.x;var v=this.m_impulse.y;e.m_linearVelocity.x-=m*d;e.m_linearVelocity.y-=m*v;e.m_angularVelocity-=u*(s*v-l*d+this.m_motorImpulse+this.m_impulse.z);o.m_linearVelocity.x+=p*d;o.m_linearVelocity.y+=p*v;o.m_angularVelocity+=f*(c*v-h*d+this.m_motorImpulse+this.m_impulse.z)}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};A.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA;var i=this.m_bodyB;var o;var r=0;var a=0;var s=0;var l=0;var c=0;var h=0;var m=e.m_linearVelocity;var p=e.m_angularVelocity;var u=i.m_linearVelocity;var f=i.m_angularVelocity;var y=e.m_invMass;var d=i.m_invMass;var v=e.m_invI;var x=i.m_invI;if(this.m_enableMotor&&this.m_limitState!=_.e_equalLimits){var E=f-p-this.m_motorSpeed;var g=this.m_motorMass*-E;var b=this.m_motorImpulse;var T=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=n.Clamp(this.m_motorImpulse+g,-T,T);g=this.m_motorImpulse-b;p-=v*g;f+=x*g}if(this.m_enableLimit&&this.m_limitState!=_.e_inactiveLimit){o=e.m_xf.R;s=this.m_localAnchor1.x-e.m_sweep.localCenter.x;l=this.m_localAnchor1.y-e.m_sweep.localCenter.y;r=o.col1.x*s+o.col2.x*l;l=o.col1.y*s+o.col2.y*l;s=r;o=i.m_xf.R;c=this.m_localAnchor2.x-i.m_sweep.localCenter.x;h=this.m_localAnchor2.y-i.m_sweep.localCenter.y;r=o.col1.x*c+o.col2.x*h;h=o.col1.y*c+o.col2.y*h;c=r;var R=u.x+-f*h-m.x- -p*l;var w=u.y+f*c-m.y-p*s;var S=f-p;this.m_mass.Solve33(this.impulse3,-R,-w,-S);if(this.m_limitState==_.e_equalLimits){this.m_impulse.Add(this.impulse3)}else if(this.m_limitState==_.e_atLowerLimit){a=this.m_impulse.z+this.impulse3.z;if(a<0){this.m_mass.Solve22(this.reduced,-R,-w);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}else if(this.m_limitState==_.e_atUpperLimit){a=this.m_impulse.z+this.impulse3.z;if(a>0){this.m_mass.Solve22(this.reduced,-R,-w);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}m.x-=y*this.impulse3.x;m.y-=y*this.impulse3.y;p-=v*(s*this.impulse3.y-l*this.impulse3.x+this.impulse3.z);u.x+=d*this.impulse3.x;u.y+=d*this.impulse3.y;f+=x*(c*this.impulse3.y-h*this.impulse3.x+this.impulse3.z)}else{o=e.m_xf.R;s=this.m_localAnchor1.x-e.m_sweep.localCenter.x;l=this.m_localAnchor1.y-e.m_sweep.localCenter.y;r=o.col1.x*s+o.col2.x*l;l=o.col1.y*s+o.col2.y*l;s=r;o=i.m_xf.R;c=this.m_localAnchor2.x-i.m_sweep.localCenter.x;h=this.m_localAnchor2.y-i.m_sweep.localCenter.y;r=o.col1.x*c+o.col2.x*h;h=o.col1.y*c+o.col2.y*h;c=r;var C=u.x+-f*h-m.x- -p*l;var A=u.y+f*c-m.y-p*s;this.m_mass.Solve22(this.impulse2,-C,-A);this.m_impulse.x+=this.impulse2.x;this.m_impulse.y+=this.impulse2.y;m.x-=y*this.impulse2.x;m.y-=y*this.impulse2.y;p-=v*(s*this.impulse2.y-l*this.impulse2.x);u.x+=d*this.impulse2.x;u.y+=d*this.impulse2.y;f+=x*(c*this.impulse2.y-h*this.impulse2.x)}e.m_linearVelocity.SetV(m);e.m_angularVelocity=p;i.m_linearVelocity.SetV(u);i.m_angularVelocity=f};A.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e=0;var o=0;var r;var a=this.m_bodyA;var s=this.m_bodyB;var l=0;var c=0;var h=0;var m=0;var p=0;if(this.m_enableLimit&&this.m_limitState!=_.e_inactiveLimit){var u=s.m_sweep.a-a.m_sweep.a-this.m_referenceAngle;var f=0;if(this.m_limitState==_.e_equalLimits){o=n.Clamp(u-this.m_lowerAngle,-i.b2_maxAngularCorrection,i.b2_maxAngularCorrection);f=-this.m_motorMass*o;l=n.Abs(o)}else if(this.m_limitState==_.e_atLowerLimit){o=u-this.m_lowerAngle;l=-o;o=n.Clamp(o+i.b2_angularSlop,-i.b2_maxAngularCorrection,0);f=-this.m_motorMass*o}else if(this.m_limitState==_.e_atUpperLimit){o=u-this.m_upperAngle;l=o;o=n.Clamp(o-i.b2_angularSlop,0,i.b2_maxAngularCorrection);f=-this.m_motorMass*o}a.m_sweep.a-=a.m_invI*f;s.m_sweep.a+=s.m_invI*f;a.SynchronizeTransform();s.SynchronizeTransform()}{r=a.m_xf.R;var y=this.m_localAnchor1.x-a.m_sweep.localCenter.x;var d=this.m_localAnchor1.y-a.m_sweep.localCenter.y;h=r.col1.x*y+r.col2.x*d;d=r.col1.y*y+r.col2.y*d;y=h;r=s.m_xf.R;var v=this.m_localAnchor2.x-s.m_sweep.localCenter.x;var x=this.m_localAnchor2.y-s.m_sweep.localCenter.y;h=r.col1.x*v+r.col2.x*x;x=r.col1.y*v+r.col2.y*x;v=h;var E=s.m_sweep.c.x+v-a.m_sweep.c.x-y;var g=s.m_sweep.c.y+x-a.m_sweep.c.y-d;var b=E*E+g*g;var T=Math.sqrt(b);c=T;var R=a.m_invMass;var w=s.m_invMass;var S=a.m_invI;var C=s.m_invI;var M=10*i.b2_linearSlop;if(b>M*M){var D=E/T;var B=g/T;var H=R+w;var V=1/H;m=V*-E;p=V*-g;var L=.5;a.m_sweep.c.x-=L*R*m;a.m_sweep.c.y-=L*R*p;s.m_sweep.c.x+=L*w*m;s.m_sweep.c.y+=L*w*p;E=s.m_sweep.c.x+v-a.m_sweep.c.x-y;g=s.m_sweep.c.y+x-a.m_sweep.c.y-d}this.K1.col1.x=R+w;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=R+w;this.K2.col1.x=S*d*d;this.K2.col2.x=-S*y*d;this.K2.col1.y=-S*y*d;this.K2.col2.y=S*y*y;this.K3.col1.x=C*x*x;this.K3.col2.x=-C*v*x;this.K3.col1.y=-C*v*x;this.K3.col2.y=C*v*v;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(A.tImpulse,-E,-g);m=A.tImpulse.x;p=A.tImpulse.y;a.m_sweep.c.x-=a.m_invMass*m;a.m_sweep.c.y-=a.m_invMass*p;a.m_sweep.a-=a.m_invI*(y*p-d*m);s.m_sweep.c.x+=s.m_invMass*m;s.m_sweep.c.y+=s.m_invMass*p;s.m_sweep.a+=s.m_invI*(v*p-x*m);a.SynchronizeTransform();s.SynchronizeTransform()}return c<=i.b2_linearSlop&&l<=i.b2_angularSlop};Box2D.postDefs.push((function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new l}));Box2D.inherit(M,Box2D.Dynamics.Joints.b2JointDef);M.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;M.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l};M.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=_.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.referenceAngle=0;this.lowerAngle=0;this.upperAngle=0;this.maxMotorTorque=0;this.motorSpeed=0;this.enableLimit=false;this.enableMotor=false};M.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(D,Box2D.Dynamics.Joints.b2Joint);D.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;D.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new l;this.m_localAnchorB=new l;this.m_impulse=new c;this.m_mass=new r};D.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};D.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};D.prototype.GetReactionForce=function(t){if(t===undefined)t=0;return new l(t*this.m_impulse.x,t*this.m_impulse.y)};D.prototype.GetReactionTorque=function(t){if(t===undefined)t=0;return t*this.m_impulse.z};D.prototype.b2WeldJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchorA.SetV(t.localAnchorA);this.m_localAnchorB.SetV(t.localAnchorB);this.m_referenceAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_mass=new r};D.prototype.InitVelocityConstraints=function(t){var e;var i=0;var o=this.m_bodyA;var r=this.m_bodyB;e=o.m_xf.R;var n=this.m_localAnchorA.x-o.m_sweep.localCenter.x;var a=this.m_localAnchorA.y-o.m_sweep.localCenter.y;i=e.col1.x*n+e.col2.x*a;a=e.col1.y*n+e.col2.y*a;n=i;e=r.m_xf.R;var s=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var l=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*s+e.col2.x*l;l=e.col1.y*s+e.col2.y*l;s=i;var c=o.m_invMass;var h=r.m_invMass;var m=o.m_invI;var p=r.m_invI;this.m_mass.col1.x=c+h+a*a*m+l*l*p;this.m_mass.col2.x=-a*n*m-l*s*p;this.m_mass.col3.x=-a*m-l*p;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=c+h+n*n*m+s*s*p;this.m_mass.col3.y=n*m+s*p;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=m+p;if(t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_impulse.z*=t.dtRatio;o.m_linearVelocity.x-=c*this.m_impulse.x;o.m_linearVelocity.y-=c*this.m_impulse.y;o.m_angularVelocity-=m*(n*this.m_impulse.y-a*this.m_impulse.x+this.m_impulse.z);r.m_linearVelocity.x+=h*this.m_impulse.x;r.m_linearVelocity.y+=h*this.m_impulse.y;r.m_angularVelocity+=p*(s*this.m_impulse.y-l*this.m_impulse.x+this.m_impulse.z)}else{this.m_impulse.SetZero()}};D.prototype.SolveVelocityConstraints=function(t){var e;var i=0;var o=this.m_bodyA;var r=this.m_bodyB;var n=o.m_linearVelocity;var a=o.m_angularVelocity;var s=r.m_linearVelocity;var l=r.m_angularVelocity;var h=o.m_invMass;var m=r.m_invMass;var p=o.m_invI;var u=r.m_invI;e=o.m_xf.R;var f=this.m_localAnchorA.x-o.m_sweep.localCenter.x;var y=this.m_localAnchorA.y-o.m_sweep.localCenter.y;i=e.col1.x*f+e.col2.x*y;y=e.col1.y*f+e.col2.y*y;f=i;e=r.m_xf.R;var d=this.m_localAnchorB.x-r.m_sweep.localCenter.x;var _=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=e.col1.x*d+e.col2.x*_;_=e.col1.y*d+e.col2.y*_;d=i;var v=s.x-l*_-n.x+a*y;var x=s.y+l*d-n.y-a*f;var E=l-a;var g=new c;this.m_mass.Solve33(g,-v,-x,-E);this.m_impulse.Add(g);n.x-=h*g.x;n.y-=h*g.y;a-=p*(f*g.y-y*g.x+g.z);s.x+=m*g.x;s.y+=m*g.y;l+=u*(d*g.y-_*g.x+g.z);o.m_angularVelocity=a;r.m_angularVelocity=l};D.prototype.SolvePositionConstraints=function(t){if(t===undefined)t=0;var e;var o=0;var r=this.m_bodyA;var a=this.m_bodyB;e=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x;var l=this.m_localAnchorA.y-r.m_sweep.localCenter.y;o=e.col1.x*s+e.col2.x*l;l=e.col1.y*s+e.col2.y*l;s=o;e=a.m_xf.R;var h=this.m_localAnchorB.x-a.m_sweep.localCenter.x;var m=this.m_localAnchorB.y-a.m_sweep.localCenter.y;o=e.col1.x*h+e.col2.x*m;m=e.col1.y*h+e.col2.y*m;h=o;var p=r.m_invMass;var u=a.m_invMass;var f=r.m_invI;var y=a.m_invI;var d=a.m_sweep.c.x+h-r.m_sweep.c.x-s;var _=a.m_sweep.c.y+m-r.m_sweep.c.y-l;var v=a.m_sweep.a-r.m_sweep.a-this.m_referenceAngle;var x=10*i.b2_linearSlop;var E=Math.sqrt(d*d+_*_);var g=n.Abs(v);if(E>x){f*=1;y*=1}this.m_mass.col1.x=p+u+l*l*f+m*m*y;this.m_mass.col2.x=-l*s*f-m*h*y;this.m_mass.col3.x=-l*f-m*y;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=p+u+s*s*f+h*h*y;this.m_mass.col3.y=s*f+h*y;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=f+y;var b=new c;this.m_mass.Solve33(b,-d,-_,-v);r.m_sweep.c.x-=p*b.x;r.m_sweep.c.y-=p*b.y;r.m_sweep.a-=f*(s*b.y-l*b.x+b.z);a.m_sweep.c.x+=u*b.x;a.m_sweep.c.y+=u*b.y;a.m_sweep.a+=y*(h*b.y-m*b.x+b.z);r.SynchronizeTransform();a.SynchronizeTransform();return E<=i.b2_linearSlop&&g<=i.b2_angularSlop};Box2D.inherit(B,Box2D.Dynamics.Joints.b2JointDef);B.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;B.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l};B.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=_.e_weldJoint;this.referenceAngle=0};B.prototype.Initialize=function(t,e,i){this.bodyA=t;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();(function(){var t=Box2D.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_drawScale=1;this.m_lineThickness=1;this.m_alpha=1;this.m_fillAlpha=1;this.m_xformScale=1;var t=this;this.m_sprite={graphics:{clear:function(){t.m_ctx.clearRect(0,0,t.m_ctx.canvas.width,t.m_ctx.canvas.height)}}}};t.prototype._color=function(t,e){return"rgba("+((t&16711680)>>16)+","+((t&65280)>>8)+","+(t&255)+","+e+")"};t.prototype.b2DebugDraw=function(){this.m_drawFlags=0};t.prototype.SetFlags=function(t){if(t===undefined)t=0;this.m_drawFlags=t};t.prototype.GetFlags=function(){return this.m_drawFlags};t.prototype.AppendFlags=function(t){if(t===undefined)t=0;this.m_drawFlags|=t};t.prototype.ClearFlags=function(t){if(t===undefined)t=0;this.m_drawFlags&=~t};t.prototype.SetSprite=function(t){this.m_ctx=t};t.prototype.GetSprite=function(){return this.m_ctx};t.prototype.SetDrawScale=function(t){if(t===undefined)t=0;this.m_drawScale=t};t.prototype.GetDrawScale=function(){return this.m_drawScale};t.prototype.SetLineThickness=function(t){if(t===undefined)t=0;this.m_lineThickness=t;this.m_ctx.strokeWidth=t};t.prototype.GetLineThickness=function(){return this.m_lineThickness};t.prototype.SetAlpha=function(t){if(t===undefined)t=0;this.m_alpha=t};t.prototype.GetAlpha=function(){return this.m_alpha};t.prototype.SetFillAlpha=function(t){if(t===undefined)t=0;this.m_fillAlpha=t};t.prototype.GetFillAlpha=function(){return this.m_fillAlpha};t.prototype.SetXFormScale=function(t){if(t===undefined)t=0;this.m_xformScale=t};t.prototype.GetXFormScale=function(){return this.m_xformScale};t.prototype.DrawPolygon=function(t,e,i){if(!e)return;var o=this.m_ctx;var r=this.m_drawScale;o.beginPath();o.strokeStyle=this._color(i.color,this.m_alpha);o.moveTo(t[0].x*r,t[0].y*r);for(var n=1;n<e;n++){o.lineTo(t[n].x*r,t[n].y*r)}o.lineTo(t[0].x*r,t[0].y*r);o.closePath();o.stroke()};t.prototype.DrawSolidPolygon=function(t,e,i){if(!e)return;var o=this.m_ctx;var r=this.m_drawScale;o.beginPath();o.strokeStyle=this._color(i.color,this.m_alpha);o.fillStyle=this._color(i.color,this.m_fillAlpha);o.moveTo(t[0].x*r,t[0].y*r);for(var n=1;n<e;n++){o.lineTo(t[n].x*r,t[n].y*r)}o.lineTo(t[0].x*r,t[0].y*r);o.closePath();o.fill();o.stroke()};t.prototype.DrawCircle=function(t,e,i){if(!e)return;var o=this.m_ctx;var r=this.m_drawScale;o.beginPath();o.strokeStyle=this._color(i.color,this.m_alpha);o.arc(t.x*r,t.y*r,e*r,0,Math.PI*2,true);o.closePath();o.stroke()};t.prototype.DrawSolidCircle=function(t,e,i,o){if(!e)return;var r=this.m_ctx,n=this.m_drawScale,a=t.x*n,s=t.y*n;r.moveTo(0,0);r.beginPath();r.strokeStyle=this._color(o.color,this.m_alpha);r.fillStyle=this._color(o.color,this.m_fillAlpha);r.arc(a,s,e*n,0,Math.PI*2,true);r.moveTo(a,s);r.lineTo((t.x+i.x*e)*n,(t.y+i.y*e)*n);r.closePath();r.fill();r.stroke()};t.prototype.DrawSegment=function(t,e,i){var o=this.m_ctx,r=this.m_drawScale;o.strokeStyle=this._color(i.color,this.m_alpha);o.beginPath();o.moveTo(t.x*r,t.y*r);o.lineTo(e.x*r,e.y*r);o.closePath();o.stroke()};t.prototype.DrawTransform=function(t){var e=this.m_ctx,i=this.m_drawScale;e.beginPath();e.strokeStyle=this._color(16711680,this.m_alpha);e.moveTo(t.position.x*i,t.position.y*i);e.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*i,(t.position.y+this.m_xformScale*t.R.col1.y)*i);e.strokeStyle=this._color(65280,this.m_alpha);e.moveTo(t.position.x*i,t.position.y*i);e.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*i,(t.position.y+this.m_xformScale*t.R.col2.y)*i);e.closePath();e.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;"use strict";var THREE=THREE||{REVISION:"49"};self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array);(function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i){window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(e){var i=Date.now(),o=Math.max(0,16-(i-t)),r=window.setTimeout((function(){e(i+o)}),o);t=i+o;return r};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(t){clearTimeout(t)}})();THREE.Clock=function(t){this.autoStart=t!==void 0?t:true;this.elapsedTime=this.oldTime=this.startTime=0;this.running=false};THREE.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now();this.running=true};THREE.Clock.prototype.stop=function(){this.getElapsedTime();this.running=false};THREE.Clock.prototype.getElapsedTime=function(){return this.elapsedTime=this.elapsedTime+this.getDelta()};THREE.Clock.prototype.getDelta=function(){var t=0;this.autoStart&&!this.running&&this.start();if(this.running){var e=Date.now(),t=.001*(e-this.oldTime);this.oldTime=e;this.elapsedTime=this.elapsedTime+t}return t};THREE.Color=function(t){t!==void 0&&this.setHex(t);return this};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(t){this.r=t.r;this.g=t.g;this.b=t.b;return this},copyGammaToLinear:function(t){this.r=t.r*t.r;this.g=t.g*t.g;this.b=t.b*t.b;return this},copyLinearToGamma:function(t){this.r=Math.sqrt(t.r);this.g=Math.sqrt(t.g);this.b=Math.sqrt(t.b);return this},convertGammaToLinear:function(){var t=this.r,e=this.g,i=this.b;this.r=t*t;this.g=e*e;this.b=i*i;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},setRGB:function(t,e,i){this.r=t;this.g=e;this.b=i;return this},setHSV:function(t,e,i){var o,r,n;if(i===0)this.r=this.g=this.b=0;else{o=Math.floor(t*6);r=t*6-o;t=i*(1-e);n=i*(1-e*r);e=i*(1-e*(1-r));switch(o){case 1:this.r=n;this.g=i;this.b=t;break;case 2:this.r=t;this.g=i;this.b=e;break;case 3:this.r=t;this.g=n;this.b=i;break;case 4:this.r=e;this.g=t;this.b=i;break;case 5:this.r=i;this.g=t;this.b=n;break;case 6:case 0:this.r=i;this.g=e;this.b=t}}return this},setHex:function(t){t=Math.floor(t);this.r=(t>>16&255)/255;this.g=(t>>8&255)/255;this.b=(t&255)/255;return this},lerpSelf:function(t,e){this.r=this.r+(t.r-this.r)*e;this.g=this.g+(t.g-this.g)*e;this.b=this.b+(t.b-this.b)*e;return this},getHex:function(){return Math.floor(this.r*255)<<16^Math.floor(this.g*255)<<8^Math.floor(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};THREE.Vector2=function(t,e){this.x=t||0;this.y=e||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(t,e){this.x=t;this.y=e;return this},copy:function(t){this.x=t.x;this.y=t.y;return this},add:function(t,e){this.x=t.x+e.x;this.y=t.y+e.y;return this},addSelf:function(t){this.x=this.x+t.x;this.y=this.y+t.y;return this},sub:function(t,e){this.x=t.x-e.x;this.y=t.y-e.y;return this},subSelf:function(t){this.x=this.x-t.x;this.y=this.y-t.y;return this},multiplyScalar:function(t){this.x=this.x*t;this.y=this.y*t;return this},divideScalar:function(t){if(t){this.x=this.x/t;this.y=this.y/t}else this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,t=this.y-t.y;return e*e+t*t},setLength:function(t){return this.normalize().multiplyScalar(t)},lerpSelf:function(t,e){this.x=this.x+(t.x-this.x)*e;this.y=this.y+(t.y-this.y)*e;return this},equals:function(t){return t.x===this.x&&t.y===this.y},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(t,e,i){this.x=t||0;this.y=e||0;this.z=i||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(t,e,i){this.x=t;this.y=e;this.z=i;return this},setX:function(t){this.x=t;return this},setY:function(t){this.y=t;return this},setZ:function(t){this.z=t;return this},copy:function(t){this.x=t.x;this.y=t.y;this.z=t.z;return this},add:function(t,e){this.x=t.x+e.x;this.y=t.y+e.y;this.z=t.z+e.z;return this},addSelf:function(t){this.x=this.x+t.x;this.y=this.y+t.y;this.z=this.z+t.z;return this},addScalar:function(t){this.x=this.x+t;this.y=this.y+t;this.z=this.z+t;return this},sub:function(t,e){this.x=t.x-e.x;this.y=t.y-e.y;this.z=t.z-e.z;return this},subSelf:function(t){this.x=this.x-t.x;this.y=this.y-t.y;this.z=this.z-t.z;return this},multiply:function(t,e){this.x=t.x*e.x;this.y=t.y*e.y;this.z=t.z*e.z;return this},multiplySelf:function(t){this.x=this.x*t.x;this.y=this.y*t.y;this.z=this.z*t.z;return this},multiplyScalar:function(t){this.x=this.x*t;this.y=this.y*t;this.z=this.z*t;return this},divideSelf:function(t){this.x=this.x/t.x;this.y=this.y/t.y;this.z=this.z/t.z;return this},divideScalar:function(t){if(t){this.x=this.x/t;this.y=this.y/t;this.z=this.z/t}else this.z=this.y=this.x=0;return this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.normalize().multiplyScalar(t)},lerpSelf:function(t,e){this.x=this.x+(t.x-this.x)*e;this.y=this.y+(t.y-this.y)*e;this.z=this.z+(t.z-this.z)*e;return this},cross:function(t,e){this.x=t.y*e.z-t.z*e.y;this.y=t.z*e.x-t.x*e.z;this.z=t.x*e.y-t.y*e.x;return this},crossSelf:function(t){var e=this.x,i=this.y,o=this.z;this.x=i*t.z-o*t.y;this.y=o*t.x-e*t.z;this.z=e*t.y-i*t.x;return this},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){return(new THREE.Vector3).sub(this,t).lengthSq()},getPositionFromMatrix:function(t){this.x=t.elements[12];this.y=t.elements[13];this.z=t.elements[14];return this},getRotationFromMatrix:function(t,e){var i=e?e.x:1,o=e?e.y:1,r=e?e.z:1,n=t.elements[0]/i,a=t.elements[4]/o,i=t.elements[1]/i,o=t.elements[5]/o,s=t.elements[9]/r,l=t.elements[10]/r;this.y=Math.asin(t.elements[8]/r);r=Math.cos(this.y);if(Math.abs(r)>1e-5){this.x=Math.atan2(-s/r,l/r);this.z=Math.atan2(-a/r,n/r)}else{this.x=0;this.z=Math.atan2(i,o)}return this},getScaleFromMatrix:function(t){var e=this.set(t.elements[0],t.elements[1],t.elements[2]).length(),i=this.set(t.elements[4],t.elements[5],t.elements[6]).length(),t=this.set(t.elements[8],t.elements[9],t.elements[10]).length();this.x=e;this.y=i;this.z=t},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(t,e,i,o){this.x=t||0;this.y=e||0;this.z=i||0;this.w=o!==void 0?o:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(t,e,i,o){this.x=t;this.y=e;this.z=i;this.w=o;return this},copy:function(t){this.x=t.x;this.y=t.y;this.z=t.z;this.w=t.w!==void 0?t.w:1;return this},add:function(t,e){this.x=t.x+e.x;this.y=t.y+e.y;this.z=t.z+e.z;this.w=t.w+e.w;return this},addSelf:function(t){this.x=this.x+t.x;this.y=this.y+t.y;this.z=this.z+t.z;this.w=this.w+t.w;return this},sub:function(t,e){this.x=t.x-e.x;this.y=t.y-e.y;this.z=t.z-e.z;this.w=t.w-e.w;return this},subSelf:function(t){this.x=this.x-t.x;this.y=this.y-t.y;this.z=this.z-t.z;this.w=this.w-t.w;return this},multiplyScalar:function(t){this.x=this.x*t;this.y=this.y*t;this.z=this.z*t;this.w=this.w*t;return this},divideScalar:function(t){if(t){this.x=this.x/t;this.y=this.y/t;this.z=this.z/t;this.w=this.w/t}else{this.z=this.y=this.x=0;this.w=1}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.normalize().multiplyScalar(t)},lerpSelf:function(t,e){this.x=this.x+(t.x-this.x)*e;this.y=this.y+(t.y-this.y)*e;this.z=this.z+(t.z-this.z)*e;this.w=this.w+(t.w-this.w)*e;return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Frustum=function(){this.planes=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4]};THREE.Frustum.prototype.setFromMatrix=function(t){var e,i=this.planes,o=t.elements,t=o[0];e=o[1];var r=o[2],n=o[3],a=o[4],s=o[5],l=o[6],c=o[7],h=o[8],m=o[9],p=o[10],u=o[11],f=o[12],y=o[13],d=o[14],o=o[15];i[0].set(n-t,c-a,u-h,o-f);i[1].set(n+t,c+a,u+h,o+f);i[2].set(n+e,c+s,u+m,o+y);i[3].set(n-e,c-s,u-m,o-y);i[4].set(n-r,c-l,u-p,o-d);i[5].set(n+r,c+l,u+p,o+d);for(t=0;t<6;t++){e=i[t];e.divideScalar(Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z))}};THREE.Frustum.prototype.contains=function(t){for(var e=this.planes,i=t.matrixWorld,o=i.elements,i=-t.geometry.boundingSphere.radius*i.getMaxScaleOnAxis(),r=0;r<6;r++){t=e[r].x*o[12]+e[r].y*o[13]+e[r].z*o[14]+e[r].w;if(t<=i)return false}return true};THREE.Frustum.__v1=new THREE.Vector3;THREE.Ray=function(t,e){function i(t,e,i){f.sub(i,t);_=f.dot(e);v=y.add(t,d.copy(e).multiplyScalar(_));return x=i.distanceTo(v)}function o(t,e,i,o){f.sub(o,e);y.sub(i,e);d.sub(t,e);E=f.dot(f);g=f.dot(y);b=f.dot(d);T=y.dot(y);R=y.dot(d);w=1/(E*T-g*g);S=(T*b-g*R)*w;C=(E*R-g*b)*w;return S>=0&&C>=0&&S+C<1}this.origin=t||new THREE.Vector3;this.direction=e||new THREE.Vector3;var r=1e-4;this.setPrecision=function(t){r=t};var n=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector3,m=new THREE.Vector3,p=new THREE.Vector3,u=new THREE.Vector3;this.intersectObject=function(t){var e,f=[];if(t instanceof THREE.Particle){var y=i(this.origin,this.direction,t.matrixWorld.getPosition());if(y>t.scale.x)return[];e={distance:y,point:t.position,face:null,object:t};f.push(e)}else if(t instanceof THREE.Mesh){var y=i(this.origin,this.direction,t.matrixWorld.getPosition()),d=THREE.Frustum.__v1.set(t.matrixWorld.getColumnX().length(),t.matrixWorld.getColumnY().length(),t.matrixWorld.getColumnZ().length());if(y>t.geometry.boundingSphere.radius*Math.max(d.x,Math.max(d.y,d.z)))return f;var _,v,x=t.geometry,E=x.vertices,g;t.matrixRotationWorld.extractRotation(t.matrixWorld);y=0;for(d=x.faces.length;y<d;y++){e=x.faces[y];c.copy(this.origin);h.copy(this.direction);g=t.matrixWorld;m=g.multiplyVector3(m.copy(e.centroid)).subSelf(c);p=t.matrixRotationWorld.multiplyVector3(p.copy(e.normal));_=h.dot(p);if(!(Math.abs(_)<r)){v=p.dot(m)/_;if(!(v<0)&&(t.doubleSided||(t.flipSided?_>0:_<0))){u.add(c,h.multiplyScalar(v));if(e instanceof THREE.Face3){n=g.multiplyVector3(n.copy(E[e.a]));a=g.multiplyVector3(a.copy(E[e.b]));s=g.multiplyVector3(s.copy(E[e.c]));if(o(u,n,a,s)){e={distance:c.distanceTo(u),point:u.clone(),face:e,object:t};f.push(e)}}else if(e instanceof THREE.Face4){n=g.multiplyVector3(n.copy(E[e.a]));a=g.multiplyVector3(a.copy(E[e.b]));s=g.multiplyVector3(s.copy(E[e.c]));l=g.multiplyVector3(l.copy(E[e.d]));if(o(u,n,a,l)||o(u,a,s,l)){e={distance:c.distanceTo(u),point:u.clone(),face:e,object:t};f.push(e)}}}}}}return f};this.intersectObjects=function(t){for(var e=[],i=0,o=t.length;i<o;i++)Array.prototype.push.apply(e,this.intersectObject(t[i]));e.sort((function(t,e){return t.distance-e.distance}));return e};var f=new THREE.Vector3,y=new THREE.Vector3,d=new THREE.Vector3,_,v,x,E,g,b,T,R,w,S,C};THREE.Rectangle=function(){function t(){n=o-e;a=r-i}var e,i,o,r,n,a,s=true;this.getX=function(){return e};this.getY=function(){return i};this.getWidth=function(){return n};this.getHeight=function(){return a};this.getLeft=function(){return e};this.getTop=function(){return i};this.getRight=function(){return o};this.getBottom=function(){return r};this.set=function(n,a,l,c){s=false;e=n;i=a;o=l;r=c;t()};this.addPoint=function(n,a){if(s){s=false;e=n;i=a;o=n;r=a}else{e=e<n?e:n;i=i<a?i:a;o=o>n?o:n;r=r>a?r:a}t()};this.add3Points=function(n,a,l,c,h,m){if(s){s=false;e=n<l?n<h?n:h:l<h?l:h;i=a<c?a<m?a:m:c<m?c:m;o=n>l?n>h?n:h:l>h?l:h;r=a>c?a>m?a:m:c>m?c:m}else{e=n<l?n<h?n<e?n:e:h<e?h:e:l<h?l<e?l:e:h<e?h:e;i=a<c?a<m?a<i?a:i:m<i?m:i:c<m?c<i?c:i:m<i?m:i;o=n>l?n>h?n>o?n:o:h>o?h:o:l>h?l>o?l:o:h>o?h:o;r=a>c?a>m?a>r?a:r:m>r?m:r:c>m?c>r?c:r:m>r?m:r}t()};this.addRectangle=function(n){if(s){s=false;e=n.getLeft();i=n.getTop();o=n.getRight();r=n.getBottom()}else{e=e<n.getLeft()?e:n.getLeft();i=i<n.getTop()?i:n.getTop();o=o>n.getRight()?o:n.getRight();r=r>n.getBottom()?r:n.getBottom()}t()};this.inflate=function(n){e=e-n;i=i-n;o=o+n;r=r+n;t()};this.minSelf=function(n){e=e>n.getLeft()?e:n.getLeft();i=i>n.getTop()?i:n.getTop();o=o<n.getRight()?o:n.getRight();r=r<n.getBottom()?r:n.getBottom();t()};this.intersects=function(t){return o<t.getLeft()||e>t.getRight()||r<t.getTop()||i>t.getBottom()?false:true};this.empty=function(){s=true;r=o=i=e=0;t()};this.isEmpty=function(){return s}};THREE.Math={clamp:function(t,e,i){return t<e?e:t>i?i:t},clampBottom:function(t,e){return t<e?e:t},mapLinear:function(t,e,i,o,r){return o+(t-e)*(r-o)/(i-e)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},sign:function(t){return t<0?-1:t>0?1:0}};THREE.Matrix3=function(){this.elements=new Float32Array(9)};THREE.Matrix3.prototype={constructor:THREE.Matrix3,getInverse:function(t){var e=t.elements,t=e[10]*e[5]-e[6]*e[9],i=-e[10]*e[1]+e[2]*e[9],o=e[6]*e[1]-e[2]*e[5],r=-e[10]*e[4]+e[6]*e[8],n=e[10]*e[0]-e[2]*e[8],a=-e[6]*e[0]+e[2]*e[4],s=e[9]*e[4]-e[5]*e[8],l=-e[9]*e[0]+e[1]*e[8],c=e[5]*e[0]-e[1]*e[4],e=e[0]*t+e[1]*r+e[2]*s;e===0&&console.warn("Matrix3.getInverse(): determinant == 0");var e=1/e,h=this.elements;h[0]=e*t;h[1]=e*i;h[2]=e*o;h[3]=e*r;h[4]=e*n;h[5]=e*a;h[6]=e*s;h[7]=e*l;h[8]=e*c;return this},transpose:function(){var t,e=this.elements;t=e[1];e[1]=e[3];e[3]=t;t=e[2];e[2]=e[6];e[6]=t;t=e[5];e[5]=e[7];e[7]=t;return this},transposeIntoArray:function(t){var e=this.m;t[0]=e[0];t[1]=e[3];t[2]=e[6];t[3]=e[1];t[4]=e[4];t[5]=e[7];t[6]=e[2];t[7]=e[5];t[8]=e[8];return this}};THREE.Matrix4=function(t,e,i,o,r,n,a,s,l,c,h,m,p,u,f,y){this.elements=new Float32Array(16);this.set(t!==void 0?t:1,e||0,i||0,o||0,r||0,n!==void 0?n:1,a||0,s||0,l||0,c||0,h!==void 0?h:1,m||0,p||0,u||0,f||0,y!==void 0?y:1)};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(t,e,i,o,r,n,a,s,l,c,h,m,p,u,f,y){var d=this.elements;d[0]=t;d[4]=e;d[8]=i;d[12]=o;d[1]=r;d[5]=n;d[9]=a;d[13]=s;d[2]=l;d[6]=c;d[10]=h;d[14]=m;d[3]=p;d[7]=u;d[11]=f;d[15]=y;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(t){t=t.elements;this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]);return this},lookAt:function(t,e,i){var o=this.elements,r=THREE.Matrix4.__v1,n=THREE.Matrix4.__v2,a=THREE.Matrix4.__v3;a.sub(t,e).normalize();if(a.length()===0)a.z=1;r.cross(i,a).normalize();if(r.length()===0){a.x=a.x+1e-4;r.cross(i,a).normalize()}n.cross(a,r);o[0]=r.x;o[4]=n.x;o[8]=a.x;o[1]=r.y;o[5]=n.y;o[9]=a.y;o[2]=r.z;o[6]=n.z;o[10]=a.z;return this},multiply:function(t,e){var i=t.elements,o=e.elements,r=this.elements,n=i[0],a=i[4],s=i[8],l=i[12],c=i[1],h=i[5],m=i[9],p=i[13],u=i[2],f=i[6],y=i[10],d=i[14],_=i[3],v=i[7],x=i[11],i=i[15],E=o[0],g=o[4],b=o[8],T=o[12],R=o[1],w=o[5],S=o[9],C=o[13],A=o[2],M=o[6],D=o[10],B=o[14],H=o[3],V=o[7],L=o[11],o=o[15];r[0]=n*E+a*R+s*A+l*H;r[4]=n*g+a*w+s*M+l*V;r[8]=n*b+a*S+s*D+l*L;r[12]=n*T+a*C+s*B+l*o;r[1]=c*E+h*R+m*A+p*H;r[5]=c*g+h*w+m*M+p*V;r[9]=c*b+h*S+m*D+p*L;r[13]=c*T+h*C+m*B+p*o;r[2]=u*E+f*R+y*A+d*H;r[6]=u*g+f*w+y*M+d*V;r[10]=u*b+f*S+y*D+d*L;r[14]=u*T+f*C+y*B+d*o;r[3]=_*E+v*R+x*A+i*H;r[7]=_*g+v*w+x*M+i*V;r[11]=_*b+v*S+x*D+i*L;r[15]=_*T+v*C+x*B+i*o;return this},multiplySelf:function(t){return this.multiply(this,t)},multiplyToArray:function(t,e,i){var o=this.elements;this.multiply(t,e);i[0]=o[0];i[1]=o[1];i[2]=o[2];i[3]=o[3];i[4]=o[4];i[5]=o[5];i[6]=o[6];i[7]=o[7];i[8]=o[8];i[9]=o[9];i[10]=o[10];i[11]=o[11];i[12]=o[12];i[13]=o[13];i[14]=o[14];i[15]=o[15];return this},multiplyScalar:function(t){var e=this.elements;e[0]=e[0]*t;e[4]=e[4]*t;e[8]=e[8]*t;e[12]=e[12]*t;e[1]=e[1]*t;e[5]=e[5]*t;e[9]=e[9]*t;e[13]=e[13]*t;e[2]=e[2]*t;e[6]=e[6]*t;e[10]=e[10]*t;e[14]=e[14]*t;e[3]=e[3]*t;e[7]=e[7]*t;e[11]=e[11]*t;e[15]=e[15]*t;return this},multiplyVector3:function(t){var e=this.elements,i=t.x,o=t.y,r=t.z,n=1/(e[3]*i+e[7]*o+e[11]*r+e[15]);t.x=(e[0]*i+e[4]*o+e[8]*r+e[12])*n;t.y=(e[1]*i+e[5]*o+e[9]*r+e[13])*n;t.z=(e[2]*i+e[6]*o+e[10]*r+e[14])*n;return t},multiplyVector4:function(t){var e=this.elements,i=t.x,o=t.y,r=t.z,n=t.w;t.x=e[0]*i+e[4]*o+e[8]*r+e[12]*n;t.y=e[1]*i+e[5]*o+e[9]*r+e[13]*n;t.z=e[2]*i+e[6]*o+e[10]*r+e[14]*n;t.w=e[3]*i+e[7]*o+e[11]*r+e[15]*n;return t},rotateAxis:function(t){var e=this.elements,i=t.x,o=t.y,r=t.z;t.x=i*e[0]+o*e[4]+r*e[8];t.y=i*e[1]+o*e[5]+r*e[9];t.z=i*e[2]+o*e[6]+r*e[10];t.normalize();return t},crossVector:function(t){var e=this.elements,i=new THREE.Vector4;i.x=e[0]*t.x+e[4]*t.y+e[8]*t.z+e[12]*t.w;i.y=e[1]*t.x+e[5]*t.y+e[9]*t.z+e[13]*t.w;i.z=e[2]*t.x+e[6]*t.y+e[10]*t.z+e[14]*t.w;i.w=t.w?e[3]*t.x+e[7]*t.y+e[11]*t.z+e[15]*t.w:1;return i},determinant:function(){var t=this.elements,e=t[0],i=t[4],o=t[8],r=t[12],n=t[1],a=t[5],s=t[9],l=t[13],c=t[2],h=t[6],m=t[10],p=t[14],u=t[3],f=t[7],y=t[11],t=t[15];return r*s*h*u-o*l*h*u-r*a*m*u+i*l*m*u+o*a*p*u-i*s*p*u-r*s*c*f+o*l*c*f+r*n*m*f-e*l*m*f-o*n*p*f+e*s*p*f+r*a*c*y-i*l*c*y-r*n*h*y+e*l*h*y+i*n*p*y-e*a*p*y-o*a*c*t+i*s*c*t+o*n*h*t-e*s*h*t-i*n*m*t+e*a*m*t},transpose:function(){var t=this.elements,e;e=t[1];t[1]=t[4];t[4]=e;e=t[2];t[2]=t[8];t[8]=e;e=t[6];t[6]=t[9];t[9]=e;e=t[3];t[3]=t[12];t[12]=e;e=t[7];t[7]=t[13];t[13]=e;e=t[11];t[11]=t[14];t[14]=e;return this},flattenToArray:function(t){var e=this.elements;t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t},flattenToArrayOffset:function(t,e){var i=this.elements;t[e]=i[0];t[e+1]=i[1];t[e+2]=i[2];t[e+3]=i[3];t[e+4]=i[4];t[e+5]=i[5];t[e+6]=i[6];t[e+7]=i[7];t[e+8]=i[8];t[e+9]=i[9];t[e+10]=i[10];t[e+11]=i[11];t[e+12]=i[12];t[e+13]=i[13];t[e+14]=i[14];t[e+15]=i[15];return t},getPosition:function(){var t=this.elements;return THREE.Matrix4.__v1.set(t[12],t[13],t[14])},setPosition:function(t){var e=this.elements;e[12]=t.x;e[13]=t.y;e[14]=t.z;return this},getColumnX:function(){var t=this.elements;return THREE.Matrix4.__v1.set(t[0],t[1],t[2])},getColumnY:function(){var t=this.elements;return THREE.Matrix4.__v1.set(t[4],t[5],t[6])},getColumnZ:function(){var t=this.elements;return THREE.Matrix4.__v1.set(t[8],t[9],t[10])},getInverse:function(t){var e=this.elements,i=t.elements,o=i[0],r=i[4],n=i[8],a=i[12],s=i[1],l=i[5],c=i[9],h=i[13],m=i[2],p=i[6],u=i[10],f=i[14],y=i[3],d=i[7],_=i[11],i=i[15];e[0]=c*f*d-h*u*d+h*p*_-l*f*_-c*p*i+l*u*i;e[4]=a*u*d-n*f*d-a*p*_+r*f*_+n*p*i-r*u*i;e[8]=n*h*d-a*c*d+a*l*_-r*h*_-n*l*i+r*c*i;e[12]=a*c*p-n*h*p-a*l*u+r*h*u+n*l*f-r*c*f;e[1]=h*u*y-c*f*y-h*m*_+s*f*_+c*m*i-s*u*i;e[5]=n*f*y-a*u*y+a*m*_-o*f*_-n*m*i+o*u*i;e[9]=a*c*y-n*h*y-a*s*_+o*h*_+n*s*i-o*c*i;e[13]=n*h*m-a*c*m+a*s*u-o*h*u-n*s*f+o*c*f;e[2]=l*f*y-h*p*y+h*m*d-s*f*d-l*m*i+s*p*i;e[6]=a*p*y-r*f*y-a*m*d+o*f*d+r*m*i-o*p*i;e[10]=r*h*y-a*l*y+a*s*d-o*h*d-r*s*i+o*l*i;e[14]=a*l*m-r*h*m-a*s*p+o*h*p+r*s*f-o*l*f;e[3]=c*p*y-l*u*y-c*m*d+s*u*d+l*m*_-s*p*_;e[7]=r*u*y-n*p*y+n*m*d-o*u*d-r*m*_+o*p*_;e[11]=n*l*y-r*c*y-n*s*d+o*c*d+r*s*_-o*l*_;e[15]=r*c*m-n*l*m+n*s*p-o*c*p-r*s*u+o*l*u;this.multiplyScalar(1/t.determinant());return this},setRotationFromEuler:function(t,e){var i=this.elements,o=t.x,r=t.y,n=t.z,a=Math.cos(o),o=Math.sin(o),s=Math.cos(r),r=Math.sin(r),l=Math.cos(n),n=Math.sin(n);switch(e){case"YXZ":var c=s*l,h=s*n,m=r*l,p=r*n;i[0]=c+p*o;i[4]=m*o-h;i[8]=a*r;i[1]=a*n;i[5]=a*l;i[9]=-o;i[2]=h*o-m;i[6]=p+c*o;i[10]=a*s;break;case"ZXY":c=s*l;h=s*n;m=r*l;p=r*n;i[0]=c-p*o;i[4]=-a*n;i[8]=m+h*o;i[1]=h+m*o;i[5]=a*l;i[9]=p-c*o;i[2]=-a*r;i[6]=o;i[10]=a*s;break;case"ZYX":c=a*l;h=a*n;m=o*l;p=o*n;i[0]=s*l;i[4]=m*r-h;i[8]=c*r+p;i[1]=s*n;i[5]=p*r+c;i[9]=h*r-m;i[2]=-r;i[6]=o*s;i[10]=a*s;break;case"YZX":c=a*s;h=a*r;m=o*s;p=o*r;i[0]=s*l;i[4]=p-c*n;i[8]=m*n+h;i[1]=n;i[5]=a*l;i[9]=-o*l;i[2]=-r*l;i[6]=h*n+m;i[10]=c-p*n;break;case"XZY":c=a*s;h=a*r;m=o*s;p=o*r;i[0]=s*l;i[4]=-n;i[8]=r*l;i[1]=c*n+p;i[5]=a*l;i[9]=h*n-m;i[2]=m*n-h;i[6]=o*l;i[10]=p*n+c;break;default:c=a*l;h=a*n;m=o*l;p=o*n;i[0]=s*l;i[4]=-s*n;i[8]=r;i[1]=h+m*r;i[5]=c-p*r;i[9]=-o*s;i[2]=p-c*r;i[6]=m+h*r;i[10]=a*s}return this},setRotationFromQuaternion:function(t){var e=this.elements,i=t.x,o=t.y,r=t.z,n=t.w,a=i+i,s=o+o,l=r+r,t=i*a,c=i*s,i=i*l,h=o*s,o=o*l,r=r*l,a=n*a,s=n*s,n=n*l;e[0]=1-(h+r);e[4]=c-n;e[8]=i+s;e[1]=c+n;e[5]=1-(t+r);e[9]=o-a;e[2]=i-s;e[6]=o+a;e[10]=1-(t+h);return this},compose:function(t,e,i){var o=this.elements,r=THREE.Matrix4.__m1,n=THREE.Matrix4.__m2;r.identity();r.setRotationFromQuaternion(e);n.makeScale(i.x,i.y,i.z);this.multiply(r,n);o[12]=t.x;o[13]=t.y;o[14]=t.z;return this},decompose:function(t,e,i){var o=this.elements,r=THREE.Matrix4.__v1,n=THREE.Matrix4.__v2,a=THREE.Matrix4.__v3;r.set(o[0],o[1],o[2]);n.set(o[4],o[5],o[6]);a.set(o[8],o[9],o[10]);t=t instanceof THREE.Vector3?t:new THREE.Vector3;e=e instanceof THREE.Quaternion?e:new THREE.Quaternion;i=i instanceof THREE.Vector3?i:new THREE.Vector3;i.x=r.length();i.y=n.length();i.z=a.length();t.x=o[12];t.y=o[13];t.z=o[14];o=THREE.Matrix4.__m1;o.copy(this);o.elements[0]=o.elements[0]/i.x;o.elements[1]=o.elements[1]/i.x;o.elements[2]=o.elements[2]/i.x;o.elements[4]=o.elements[4]/i.y;o.elements[5]=o.elements[5]/i.y;o.elements[6]=o.elements[6]/i.y;o.elements[8]=o.elements[8]/i.z;o.elements[9]=o.elements[9]/i.z;o.elements[10]=o.elements[10]/i.z;e.setFromRotationMatrix(o);return[t,e,i]},extractPosition:function(t){var e=this.elements,t=t.elements;e[12]=t[12];e[13]=t[13];e[14]=t[14];return this},extractRotation:function(t){var e=this.elements,t=t.elements,i=THREE.Matrix4.__v1,o=1/i.set(t[0],t[1],t[2]).length(),r=1/i.set(t[4],t[5],t[6]).length(),i=1/i.set(t[8],t[9],t[10]).length();e[0]=t[0]*o;e[1]=t[1]*o;e[2]=t[2]*o;e[4]=t[4]*r;e[5]=t[5]*r;e[6]=t[6]*r;e[8]=t[8]*i;e[9]=t[9]*i;e[10]=t[10]*i;return this},translate:function(t){var e=this.elements,i=t.x,o=t.y,t=t.z;e[12]=e[0]*i+e[4]*o+e[8]*t+e[12];e[13]=e[1]*i+e[5]*o+e[9]*t+e[13];e[14]=e[2]*i+e[6]*o+e[10]*t+e[14];e[15]=e[3]*i+e[7]*o+e[11]*t+e[15];return this},rotateX:function(t){var e=this.elements,i=e[4],o=e[5],r=e[6],n=e[7],a=e[8],s=e[9],l=e[10],c=e[11],h=Math.cos(t),t=Math.sin(t);e[4]=h*i+t*a;e[5]=h*o+t*s;e[6]=h*r+t*l;e[7]=h*n+t*c;e[8]=h*a-t*i;e[9]=h*s-t*o;e[10]=h*l-t*r;e[11]=h*c-t*n;return this},rotateY:function(t){var e=this.elements,i=e[0],o=e[1],r=e[2],n=e[3],a=e[8],s=e[9],l=e[10],c=e[11],h=Math.cos(t),t=Math.sin(t);e[0]=h*i-t*a;e[1]=h*o-t*s;e[2]=h*r-t*l;e[3]=h*n-t*c;e[8]=h*a+t*i;e[9]=h*s+t*o;e[10]=h*l+t*r;e[11]=h*c+t*n;return this},rotateZ:function(t){var e=this.elements,i=e[0],o=e[1],r=e[2],n=e[3],a=e[4],s=e[5],l=e[6],c=e[7],h=Math.cos(t),t=Math.sin(t);e[0]=h*i+t*a;e[1]=h*o+t*s;e[2]=h*r+t*l;e[3]=h*n+t*c;e[4]=h*a-t*i;e[5]=h*s-t*o;e[6]=h*l-t*r;e[7]=h*c-t*n;return this},rotateByAxis:function(t,e){var i=this.elements;if(t.x===1&&t.y===0&&t.z===0)return this.rotateX(e);if(t.x===0&&t.y===1&&t.z===0)return this.rotateY(e);if(t.x===0&&t.y===0&&t.z===1)return this.rotateZ(e);var o=t.x,r=t.y,n=t.z,a=Math.sqrt(o*o+r*r+n*n),o=o/a,r=r/a,n=n/a,a=o*o,s=r*r,l=n*n,c=Math.cos(e),h=Math.sin(e),m=1-c,p=o*r*m,u=o*n*m,m=r*n*m,o=o*h,f=r*h,h=n*h,n=a+(1-a)*c,a=p+h,r=u-f,p=p-h,s=s+(1-s)*c,h=m+o,u=u+f,m=m-o,l=l+(1-l)*c,c=i[0],o=i[1],f=i[2],y=i[3],d=i[4],_=i[5],v=i[6],x=i[7],E=i[8],g=i[9],b=i[10],T=i[11];i[0]=n*c+a*d+r*E;i[1]=n*o+a*_+r*g;i[2]=n*f+a*v+r*b;i[3]=n*y+a*x+r*T;i[4]=p*c+s*d+h*E;i[5]=p*o+s*_+h*g;i[6]=p*f+s*v+h*b;i[7]=p*y+s*x+h*T;i[8]=u*c+m*d+l*E;i[9]=u*o+m*_+l*g;i[10]=u*f+m*v+l*b;i[11]=u*y+m*x+l*T;return this},scale:function(t){var e=this.elements,i=t.x,o=t.y,t=t.z;e[0]=e[0]*i;e[4]=e[4]*o;e[8]=e[8]*t;e[1]=e[1]*i;e[5]=e[5]*o;e[9]=e[9]*t;e[2]=e[2]*i;e[6]=e[6]*o;e[10]=e[10]*t;e[3]=e[3]*i;e[7]=e[7]*o;e[11]=e[11]*t;return this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],Math.max(t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10])))},makeTranslation:function(t,e,i){this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1);return this},makeRotationX:function(t){var e=Math.cos(t),t=Math.sin(t);this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1);return this},makeRotationY:function(t){var e=Math.cos(t),t=Math.sin(t);this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1);return this},makeRotationZ:function(t){var e=Math.cos(t),t=Math.sin(t);this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(t,e){var i=Math.cos(e),o=Math.sin(e),r=1-i,n=t.x,a=t.y,s=t.z,l=r*n,c=r*a;this.set(l*n+i,l*a-o*s,l*s+o*a,0,l*a+o*s,c*a+i,c*s-o*n,0,l*s-o*a,c*s+o*n,r*s*s+i,0,0,0,0,1);return this},makeScale:function(t,e,i){this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1);return this},makeFrustum:function(t,e,i,o,r,n){var a=this.elements;a[0]=2*r/(e-t);a[4]=0;a[8]=(e+t)/(e-t);a[12]=0;a[1]=0;a[5]=2*r/(o-i);a[9]=(o+i)/(o-i);a[13]=0;a[2]=0;a[6]=0;a[10]=-(n+r)/(n-r);a[14]=-2*n*r/(n-r);a[3]=0;a[7]=0;a[11]=-1;a[15]=0;return this},makePerspective:function(t,e,i,o){var t=i*Math.tan(t*Math.PI/360),r=-t;return this.makeFrustum(r*e,t*e,r,t,i,o)},makeOrthographic:function(t,e,i,o,r,n){var a=this.elements,s=e-t,l=i-o,c=n-r;a[0]=2/s;a[4]=0;a[8]=0;a[12]=-((e+t)/s);a[1]=0;a[5]=2/l;a[9]=0;a[13]=-((i+o)/l);a[2]=0;a[6]=0;a[10]=-2/c;a[14]=-((n+r)/c);a[3]=0;a[7]=0;a[11]=0;a[15]=1;return this},clone:function(){var t=this.elements;return new THREE.Matrix4(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;THREE.Matrix4.__m1=new THREE.Matrix4;THREE.Matrix4.__m2=new THREE.Matrix4;THREE.Object3D=function(){this.id=THREE.Object3DCount++;this.name="";this.parent=void 0;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.eulerOrder="XYZ";this.scale=new THREE.Vector3(1,1,1);this.flipSided=this.doubleSided=false;this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=true;this.quaternion=new THREE.Quaternion;this.useQuaternion=false;this.boundRadius=0;this.boundRadiusScale=1;this.visible=true;this.receiveShadow=this.castShadow=false;this.frustumCulled=true;this._vector=new THREE.Vector3};THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(t){this.matrix.multiply(t,this.matrix);this.scale.getScaleFromMatrix(this.matrix);this.rotation.getRotationFromMatrix(this.matrix,this.scale);this.position.getPositionFromMatrix(this.matrix)},translate:function(t,e){this.matrix.rotateAxis(e);this.position.addSelf(e.multiplyScalar(t))},translateX:function(t){this.translate(t,this._vector.set(1,0,0))},translateY:function(t){this.translate(t,this._vector.set(0,1,0))},translateZ:function(t){this.translate(t,this._vector.set(0,0,1))},lookAt:function(t){this.matrix.lookAt(t,this.position,this.up);this.rotationAutoUpdate&&this.rotation.getRotationFromMatrix(this.matrix)},add:function(t){if(t===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(t instanceof THREE.Object3D){t.parent!==void 0&&t.parent.remove(t);t.parent=this;this.children.push(t);for(var e=this;e.parent!==void 0;)e=e.parent;e!==void 0&&e instanceof THREE.Scene&&e.__addObject(t)}},remove:function(t){var e=this.children.indexOf(t);if(e!==-1){t.parent=void 0;this.children.splice(e,1);for(e=this;e.parent!==void 0;)e=e.parent;e!==void 0&&e instanceof THREE.Scene&&e.__removeObject(t)}},getChildByName:function(t,e){var i,o,r;i=0;for(o=this.children.length;i<o;i++){r=this.children[i];if(r.name===t)return r;if(e){r=r.getChildByName(t,e);if(r!==void 0)return r}}},updateMatrix:function(){this.matrix.setPosition(this.position);this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||t){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=false;t=true}for(var e=0,i=this.children.length;e<i;e++)this.children[e].updateMatrixWorld(t)}};THREE.Object3DCount=0;THREE.Projector=function(){function t(){var t=a[n]=a[n]||new THREE.RenderableObject;n++;return t}function e(){var t=c[l]=c[l]||new THREE.RenderableVertex;l++;return t}function i(t,e){return e.z-t.z}function o(t,e){var i=0,o=1,r=t.z+t.w,n=e.z+e.w,a=-t.z+t.w,s=-e.z+e.w;if(r>=0&&n>=0&&a>=0&&s>=0)return true;if(r<0&&n<0||a<0&&s<0)return false;r<0?i=Math.max(i,r/(r-n)):n<0&&(o=Math.min(o,r/(r-n)));a<0?i=Math.max(i,a/(a-s)):s<0&&(o=Math.min(o,a/(a-s)));if(o<i)return false;t.lerpSelf(e,i);e.lerpSelf(t,1-o);return true}var r,n,a=[],s,l,c=[],h,m,p=[],u,f=[],y,d,_=[],v,x,E=[],g={objects:[],sprites:[],lights:[],elements:[]},b=new THREE.Vector3,T=new THREE.Vector4,R=new THREE.Matrix4,w=new THREE.Matrix4,S=new THREE.Frustum,C=new THREE.Vector4,A=new THREE.Vector4;this.projectVector=function(t,e){e.matrixWorldInverse.getInverse(e.matrixWorld);R.multiply(e.projectionMatrix,e.matrixWorldInverse);R.multiplyVector3(t);return t};this.unprojectVector=function(t,e){e.projectionMatrixInverse.getInverse(e.projectionMatrix);R.multiply(e.matrixWorld,e.projectionMatrixInverse);R.multiplyVector3(t);return t};this.pickingRay=function(t,e){var i;t.z=-1;i=new THREE.Vector3(t.x,t.y,1);this.unprojectVector(t,e);this.unprojectVector(i,e);i.subSelf(t).normalize();return new THREE.Ray(t,i)};this.projectGraph=function(e,o){n=0;g.objects.length=0;g.sprites.length=0;g.lights.length=0;var a=function(e){if(e.visible!==false){if((e instanceof THREE.Mesh||e instanceof THREE.Line)&&(e.frustumCulled===false||S.contains(e))){b.copy(e.matrixWorld.getPosition());R.multiplyVector3(b);r=t();r.object=e;r.z=b.z;g.objects.push(r)}else if(e instanceof THREE.Sprite||e instanceof THREE.Particle){b.copy(e.matrixWorld.getPosition());R.multiplyVector3(b);r=t();r.object=e;r.z=b.z;g.sprites.push(r)}else e instanceof THREE.Light&&g.lights.push(e);for(var i=0,o=e.children.length;i<o;i++)a(e.children[i])}};a(e);o&&g.objects.sort(i);return g};this.projectScene=function(t,r,n){var a=r.near,b=r.far,M=false,D,B,H,V,L,P,F,I,U,G,z,N,k,O,W;x=d=u=m=0;g.elements.length=0;if(r.parent===void 0){console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it...");t.add(r)}t.updateMatrixWorld();r.matrixWorldInverse.getInverse(r.matrixWorld);R.multiply(r.projectionMatrix,r.matrixWorldInverse);S.setFromMatrix(R);g=this.projectGraph(t,false);t=0;for(D=g.objects.length;t<D;t++){U=g.objects[t].object;G=U.matrixWorld;l=0;if(U instanceof THREE.Mesh){z=U.geometry;N=U.geometry.materials;V=z.vertices;k=z.faces;O=z.faceVertexUvs;z=U.matrixRotationWorld.extractRotation(G);B=0;for(H=V.length;B<H;B++){s=e();s.positionWorld.copy(V[B]);G.multiplyVector3(s.positionWorld);s.positionScreen.copy(s.positionWorld);R.multiplyVector4(s.positionScreen);s.positionScreen.x=s.positionScreen.x/s.positionScreen.w;s.positionScreen.y=s.positionScreen.y/s.positionScreen.w;s.visible=s.positionScreen.z>a&&s.positionScreen.z<b}V=0;for(B=k.length;V<B;V++){H=k[V];if(H instanceof THREE.Face3){L=c[H.a];P=c[H.b];F=c[H.c];if(L.visible&&P.visible&&F.visible){M=(F.positionScreen.x-L.positionScreen.x)*(P.positionScreen.y-L.positionScreen.y)-(F.positionScreen.y-L.positionScreen.y)*(P.positionScreen.x-L.positionScreen.x)<0;if(U.doubleSided||M!=U.flipSided){I=p[m]=p[m]||new THREE.RenderableFace3;m++;h=I;h.v1.copy(L);h.v2.copy(P);h.v3.copy(F)}else continue}else continue}else if(H instanceof THREE.Face4){L=c[H.a];P=c[H.b];F=c[H.c];I=c[H.d];if(L.visible&&P.visible&&F.visible&&I.visible){M=(I.positionScreen.x-L.positionScreen.x)*(P.positionScreen.y-L.positionScreen.y)-(I.positionScreen.y-L.positionScreen.y)*(P.positionScreen.x-L.positionScreen.x)<0||(P.positionScreen.x-F.positionScreen.x)*(I.positionScreen.y-F.positionScreen.y)-(P.positionScreen.y-F.positionScreen.y)*(I.positionScreen.x-F.positionScreen.x)<0;if(U.doubleSided||M!=U.flipSided){W=f[u]=f[u]||new THREE.RenderableFace4;u++;h=W;h.v1.copy(L);h.v2.copy(P);h.v3.copy(F);h.v4.copy(I)}else continue}else continue}h.normalWorld.copy(H.normal);!M&&(U.flipSided||U.doubleSided)&&h.normalWorld.negate();z.multiplyVector3(h.normalWorld);h.centroidWorld.copy(H.centroid);G.multiplyVector3(h.centroidWorld);h.centroidScreen.copy(h.centroidWorld);R.multiplyVector3(h.centroidScreen);F=H.vertexNormals;L=0;for(P=F.length;L<P;L++){I=h.vertexNormalsWorld[L];I.copy(F[L]);!M&&(U.flipSided||U.doubleSided)&&I.negate();z.multiplyVector3(I)}L=0;for(P=O.length;L<P;L++)if(W=O[L][V]){F=0;for(I=W.length;F<I;F++)h.uvs[L][F]=W[F]}h.material=U.material;h.faceMaterial=H.materialIndex!==null?N[H.materialIndex]:null;h.z=h.centroidScreen.z;g.elements.push(h)}}else if(U instanceof THREE.Line){w.multiply(R,G);V=U.geometry.vertices;L=e();L.positionScreen.copy(V[0]);w.multiplyVector4(L.positionScreen);G=U.type===THREE.LinePieces?2:1;B=1;for(H=V.length;B<H;B++){L=e();L.positionScreen.copy(V[B]);w.multiplyVector4(L.positionScreen);if(!((B+1)%G>0)){P=c[l-2];C.copy(L.positionScreen);A.copy(P.positionScreen);if(o(C,A)){C.multiplyScalar(1/C.w);A.multiplyScalar(1/A.w);N=_[d]=_[d]||new THREE.RenderableLine;d++;y=N;y.v1.positionScreen.copy(C);y.v2.positionScreen.copy(A);y.z=Math.max(C.z,A.z);y.material=U.material;g.elements.push(y)}}}}}t=0;for(D=g.sprites.length;t<D;t++){U=g.sprites[t].object;G=U.matrixWorld;if(U instanceof THREE.Particle){T.set(G.elements[12],G.elements[13],G.elements[14],1);R.multiplyVector4(T);T.z=T.z/T.w;if(T.z>0&&T.z<1){a=E[x]=E[x]||new THREE.RenderableParticle;x++;v=a;v.x=T.x/T.w;v.y=T.y/T.w;v.z=T.z;v.rotation=U.rotation.z;v.scale.x=U.scale.x*Math.abs(v.x-(T.x+r.projectionMatrix.elements[0])/(T.w+r.projectionMatrix.elements[12]));v.scale.y=U.scale.y*Math.abs(v.y-(T.y+r.projectionMatrix.elements[5])/(T.w+r.projectionMatrix.elements[13]));v.material=U.material;g.elements.push(v)}}}n&&g.elements.sort(i);return g}};THREE.Quaternion=function(t,e,i,o){this.x=t||0;this.y=e||0;this.z=i||0;this.w=o!==void 0?o:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(t,e,i,o){this.x=t;this.y=e;this.z=i;this.w=o;return this},copy:function(t){this.x=t.x;this.y=t.y;this.z=t.z;this.w=t.w;return this},setFromEuler:function(t){var e=Math.PI/360,i=t.x*e,o=t.y*e,r=t.z*e,t=Math.cos(o),o=Math.sin(o),e=Math.cos(-r),r=Math.sin(-r),n=Math.cos(i),i=Math.sin(i),a=t*e,s=o*r;this.w=a*n-s*i;this.x=a*i+s*n;this.y=o*e*n+t*r*i;this.z=t*r*n-o*e*i;return this},setFromAxisAngle:function(t,e){var i=e/2,o=Math.sin(i);this.x=t.x*o;this.y=t.y*o;this.z=t.z*o;this.w=Math.cos(i);return this},setFromRotationMatrix:function(t){var e=Math.pow(t.determinant(),1/3);this.w=Math.sqrt(Math.max(0,e+t.elements[0]+t.elements[5]+t.elements[10]))/2;this.x=Math.sqrt(Math.max(0,e+t.elements[0]-t.elements[5]-t.elements[10]))/2;this.y=Math.sqrt(Math.max(0,e-t.elements[0]+t.elements[5]-t.elements[10]))/2;this.z=Math.sqrt(Math.max(0,e-t.elements[0]-t.elements[5]+t.elements[10]))/2;this.x=t.elements[6]-t.elements[9]<0?-Math.abs(this.x):Math.abs(this.x);this.y=t.elements[8]-t.elements[2]<0?-Math.abs(this.y):Math.abs(this.y);this.z=t.elements[1]-t.elements[4]<0?-Math.abs(this.z):Math.abs(this.z);this.normalize();return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x=this.x*-1;this.y=this.y*-1;this.z=this.z*-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(t===0)this.w=this.z=this.y=this.x=0;else{t=1/t;this.x=this.x*t;this.y=this.y*t;this.z=this.z*t;this.w=this.w*t}return this},multiply:function(t,e){this.x=t.x*e.w+t.y*e.z-t.z*e.y+t.w*e.x;this.y=-t.x*e.z+t.y*e.w+t.z*e.x+t.w*e.y;this.z=t.x*e.y-t.y*e.x+t.z*e.w+t.w*e.z;this.w=-t.x*e.x-t.y*e.y-t.z*e.z+t.w*e.w;return this},multiplySelf:function(t){var e=this.x,i=this.y,o=this.z,r=this.w,n=t.x,a=t.y,s=t.z,t=t.w;this.x=e*t+r*n+i*s-o*a;this.y=i*t+r*a+o*n-e*s;this.z=o*t+r*s+e*a-i*n;this.w=r*t-e*n-i*a-o*s;return this},multiplyVector3:function(t,e){e||(e=t);var i=t.x,o=t.y,r=t.z,n=this.x,a=this.y,s=this.z,l=this.w,c=l*i+a*r-s*o,h=l*o+s*i-n*r,m=l*r+n*o-a*i,i=-n*i-a*o-s*r;e.x=c*l+i*-n+h*-s-m*-a;e.y=h*l+i*-a+m*-n-c*-s;e.z=m*l+i*-s+c*-a-h*-n;return e},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)}};THREE.Quaternion.slerp=function(t,e,i,o){var r=t.w*e.w+t.x*e.x+t.y*e.y+t.z*e.z;if(r<0){i.w=-e.w;i.x=-e.x;i.y=-e.y;i.z=-e.z;r=-r}else i.copy(e);if(Math.abs(r)>=1){i.w=t.w;i.x=t.x;i.y=t.y;i.z=t.z;return i}var n=Math.acos(r),r=Math.sqrt(1-r*r);if(Math.abs(r)<.001){i.w=.5*(t.w+e.w);i.x=.5*(t.x+e.x);i.y=.5*(t.y+e.y);i.z=.5*(t.z+e.z);return i}e=Math.sin((1-o)*n)/r;o=Math.sin(o*n)/r;i.w=t.w*e+i.w*o;i.x=t.x*e+i.x*o;i.y=t.y*e+i.y*o;i.z=t.z*e+i.z*o;return i};THREE.Vertex=function(){console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.")};THREE.Face3=function(t,e,i,o,r,n){this.a=t;this.b=e;this.c=i;this.normal=o instanceof THREE.Vector3?o:new THREE.Vector3;this.vertexNormals=o instanceof Array?o:[];this.color=r instanceof THREE.Color?r:new THREE.Color;this.vertexColors=r instanceof Array?r:[];this.vertexTangents=[];this.materialIndex=n;this.centroid=new THREE.Vector3};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var t=new THREE.Face3(this.a,this.b,this.c);t.normal.copy(this.normal);t.color.copy(this.color);t.centroid.copy(this.centroid);t.materialIndex=this.materialIndex;var e,i;e=0;for(i=this.vertexNormals.length;e<i;e++)t.vertexNormals[e]=this.vertexNormals[e].clone();e=0;for(i=this.vertexColors.length;e<i;e++)t.vertexColors[e]=this.vertexColors[e].clone();e=0;for(i=this.vertexTangents.length;e<i;e++)t.vertexTangents[e]=this.vertexTangents[e].clone();return t}};THREE.Face4=function(t,e,i,o,r,n,a){this.a=t;this.b=e;this.c=i;this.d=o;this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3;this.vertexNormals=r instanceof Array?r:[];this.color=n instanceof THREE.Color?n:new THREE.Color;this.vertexColors=n instanceof Array?n:[];this.vertexTangents=[];this.materialIndex=a;this.centroid=new THREE.Vector3};THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var t=new THREE.Face4(this.a,this.b,this.c,this.d);t.normal.copy(this.normal);t.color.copy(this.color);t.centroid.copy(this.centroid);t.materialIndex=this.materialIndex;var e,i;e=0;for(i=this.vertexNormals.length;e<i;e++)t.vertexNormals[e]=this.vertexNormals[e].clone();e=0;for(i=this.vertexColors.length;e<i;e++)t.vertexColors[e]=this.vertexColors[e].clone();e=0;for(i=this.vertexTangents.length;e<i;e++)t.vertexTangents[e]=this.vertexTangents[e].clone();return t}};THREE.UV=function(t,e){this.u=t||0;this.v=e||0};THREE.UV.prototype={constructor:THREE.UV,set:function(t,e){this.u=t;this.v=e;return this},copy:function(t){this.u=t.u;this.v=t.v;return this},lerpSelf:function(t,e){this.u=this.u+(t.u-this.u)*e;this.v=this.v+(t.v-this.v)*e;return this},clone:function(){return new THREE.UV(this.u,this.v)}};THREE.Geometry=function(){this.id=THREE.GeometryCount++;this.vertices=[];this.colors=[];this.materials=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.dynamic=this.hasTangents=false};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(t){var e=new THREE.Matrix4;e.extractRotation(t);for(var i=0,o=this.vertices.length;i<o;i++)t.multiplyVector3(this.vertices[i]);i=0;for(o=this.faces.length;i<o;i++){var r=this.faces[i];e.multiplyVector3(r.normal);for(var n=0,a=r.vertexNormals.length;n<a;n++)e.multiplyVector3(r.vertexNormals[n]);t.multiplyVector3(r.centroid)}},computeCentroids:function(){var t,e,i;t=0;for(e=this.faces.length;t<e;t++){i=this.faces[t];i.centroid.set(0,0,0);if(i instanceof THREE.Face3){i.centroid.addSelf(this.vertices[i.a]);i.centroid.addSelf(this.vertices[i.b]);i.centroid.addSelf(this.vertices[i.c]);i.centroid.divideScalar(3)}else if(i instanceof THREE.Face4){i.centroid.addSelf(this.vertices[i.a]);i.centroid.addSelf(this.vertices[i.b]);i.centroid.addSelf(this.vertices[i.c]);i.centroid.addSelf(this.vertices[i.d]);i.centroid.divideScalar(4)}}},computeFaceNormals:function(){var t,e,i,o,r,n,a=new THREE.Vector3,s=new THREE.Vector3;t=0;for(e=this.faces.length;t<e;t++){i=this.faces[t];o=this.vertices[i.a];r=this.vertices[i.b];n=this.vertices[i.c];a.sub(n,r);s.sub(o,r);a.crossSelf(s);a.isZero()||a.normalize();i.normal.copy(a)}},computeVertexNormals:function(){var t,e,i,o;if(this.__tmpVertices===void 0){o=this.__tmpVertices=Array(this.vertices.length);t=0;for(e=this.vertices.length;t<e;t++)o[t]=new THREE.Vector3;t=0;for(e=this.faces.length;t<e;t++){i=this.faces[t];if(i instanceof THREE.Face3)i.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(i instanceof THREE.Face4)i.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}else{o=this.__tmpVertices;t=0;for(e=this.vertices.length;t<e;t++)o[t].set(0,0,0)}t=0;for(e=this.faces.length;t<e;t++){i=this.faces[t];if(i instanceof THREE.Face3){o[i.a].addSelf(i.normal);o[i.b].addSelf(i.normal);o[i.c].addSelf(i.normal)}else if(i instanceof THREE.Face4){o[i.a].addSelf(i.normal);o[i.b].addSelf(i.normal);o[i.c].addSelf(i.normal);o[i.d].addSelf(i.normal)}}t=0;for(e=this.vertices.length;t<e;t++)o[t].normalize();t=0;for(e=this.faces.length;t<e;t++){i=this.faces[t];if(i instanceof THREE.Face3){i.vertexNormals[0].copy(o[i.a]);i.vertexNormals[1].copy(o[i.b]);i.vertexNormals[2].copy(o[i.c])}else if(i instanceof THREE.Face4){i.vertexNormals[0].copy(o[i.a]);i.vertexNormals[1].copy(o[i.b]);i.vertexNormals[2].copy(o[i.c]);i.vertexNormals[3].copy(o[i.d])}}},computeMorphNormals:function(){var t,e,i,o,r;i=0;for(o=this.faces.length;i<o;i++){r=this.faces[i];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone();if(!r.__originalVertexNormals)r.__originalVertexNormals=[];t=0;for(e=r.vertexNormals.length;t<e;t++)r.__originalVertexNormals[t]?r.__originalVertexNormals[t].copy(r.vertexNormals[t]):r.__originalVertexNormals[t]=r.vertexNormals[t].clone()}var n=new THREE.Geometry;n.faces=this.faces;t=0;for(e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={};this.morphNormals[t].faceNormals=[];this.morphNormals[t].vertexNormals=[];var a=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals,l,c;i=0;for(o=this.faces.length;i<o;i++){r=this.faces[i];l=new THREE.Vector3;c=r instanceof THREE.Face3?{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3}:{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3};a.push(l);s.push(c)}}a=this.morphNormals[t];n.vertices=this.morphTargets[t].vertices;n.computeFaceNormals();n.computeVertexNormals();i=0;for(o=this.faces.length;i<o;i++){r=this.faces[i];l=a.faceNormals[i];c=a.vertexNormals[i];l.copy(r.normal);if(r instanceof THREE.Face3){c.a.copy(r.vertexNormals[0]);c.b.copy(r.vertexNormals[1]);c.c.copy(r.vertexNormals[2])}else{c.a.copy(r.vertexNormals[0]);c.b.copy(r.vertexNormals[1]);c.c.copy(r.vertexNormals[2]);c.d.copy(r.vertexNormals[3])}}}i=0;for(o=this.faces.length;i<o;i++){r=this.faces[i];r.normal=r.__originalFaceNormal;r.vertexNormals=r.__originalVertexNormals}},computeTangents:function(){function t(t,e,i,o,r,n,R){s=t.vertices[e];l=t.vertices[i];c=t.vertices[o];h=a[r];m=a[n];p=a[R];u=l.x-s.x;f=c.x-s.x;y=l.y-s.y;d=c.y-s.y;_=l.z-s.z;v=c.z-s.z;x=m.u-h.u;E=p.u-h.u;g=m.v-h.v;b=p.v-h.v;T=1/(x*b-E*g);C.set((b*u-g*f)*T,(b*y-g*d)*T,(b*_-g*v)*T);A.set((x*f-E*u)*T,(x*d-E*y)*T,(x*v-E*_)*T);w[e].addSelf(C);w[i].addSelf(C);w[o].addSelf(C);S[e].addSelf(A);S[i].addSelf(A);S[o].addSelf(A)}var e,i,o,r,n,a,s,l,c,h,m,p,u,f,y,d,_,v,x,E,g,b,T,R,w=[],S=[],C=new THREE.Vector3,A=new THREE.Vector3,M=new THREE.Vector3,D=new THREE.Vector3,B=new THREE.Vector3;e=0;for(i=this.vertices.length;e<i;e++){w[e]=new THREE.Vector3;S[e]=new THREE.Vector3}e=0;for(i=this.faces.length;e<i;e++){n=this.faces[e];a=this.faceVertexUvs[0][e];if(n instanceof THREE.Face3)t(this,n.a,n.b,n.c,0,1,2);else if(n instanceof THREE.Face4){t(this,n.a,n.b,n.d,0,1,3);t(this,n.b,n.c,n.d,1,2,3)}}var H=["a","b","c","d"];e=0;for(i=this.faces.length;e<i;e++){n=this.faces[e];for(o=0;o<n.vertexNormals.length;o++){B.copy(n.vertexNormals[o]);r=n[H[o]];R=w[r];M.copy(R);M.subSelf(B.multiplyScalar(B.dot(R))).normalize();D.cross(n.vertexNormals[o],R);r=D.dot(S[r]);r=r<0?-1:1;n.vertexTangents[o]=new THREE.Vector4(M.x,M.y,M.z,r)}}this.hasTangents=true},computeBoundingBox:function(){if(!this.boundingBox)this.boundingBox={min:new THREE.Vector3,max:new THREE.Vector3};if(this.vertices.length>0){var t;t=this.vertices[0];this.boundingBox.min.copy(t);this.boundingBox.max.copy(t);for(var e=this.boundingBox.min,i=this.boundingBox.max,o=1,r=this.vertices.length;o<r;o++){t=this.vertices[o];if(t.x<e.x)e.x=t.x;else if(t.x>i.x)i.x=t.x;if(t.y<e.y)e.y=t.y;else if(t.y>i.y)i.y=t.y;if(t.z<e.z)e.z=t.z;else if(t.z>i.z)i.z=t.z}}else{this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}},computeBoundingSphere:function(){if(!this.boundingSphere)this.boundingSphere={radius:0};for(var t,e=0,i=0,o=this.vertices.length;i<o;i++){t=this.vertices[i].length();t>e&&(e=t)}this.boundingSphere.radius=e},mergeVertices:function(){var t={},e=[],i=[],o,r=Math.pow(10,4),n,a,s;n=0;for(a=this.vertices.length;n<a;n++){o=this.vertices[n];o=[Math.round(o.x*r),Math.round(o.y*r),Math.round(o.z*r)].join("_");if(t[o]===void 0){t[o]=n;e.push(this.vertices[n]);i[n]=e.length-1}else i[n]=i[t[o]]}n=0;for(a=this.faces.length;n<a;n++){r=this.faces[n];if(r instanceof THREE.Face3){r.a=i[r.a];r.b=i[r.b];r.c=i[r.c]}else if(r instanceof THREE.Face4){r.a=i[r.a];r.b=i[r.b];r.c=i[r.c];r.d=i[r.d];o=[r.a,r.b,r.c,r.d];for(t=3;t>0;t--)if(o.indexOf(r["abcd"[t]])!=t){o.splice(t,1);this.faces[n]=new THREE.Face3(o[0],o[1],o[2]);r=0;for(o=this.faceVertexUvs.length;r<o;r++)(s=this.faceVertexUvs[r][n])&&s.splice(t,1);break}}}i=this.vertices.length-e.length;this.vertices=e;return i}};THREE.GeometryCount=0;THREE.Spline=function(t){function e(t,e,i,o,r,n,a){t=(i-t)*.5;o=(o-e)*.5;return(2*(e-i)+t+o)*a+(-3*(e-i)-2*t-o)*n+t*r+e}this.points=t;var i=[],o={x:0,y:0,z:0},r,n,a,s,l,c,h,m,p;this.initFromArray=function(t){this.points=[];for(var e=0;e<t.length;e++)this.points[e]={x:t[e][0],y:t[e][1],z:t[e][2]}};this.getPoint=function(t){r=(this.points.length-1)*t;n=Math.floor(r);a=r-n;i[0]=n===0?n:n-1;i[1]=n;i[2]=n>this.points.length-2?this.points.length-1:n+1;i[3]=n>this.points.length-3?this.points.length-1:n+2;c=this.points[i[0]];h=this.points[i[1]];m=this.points[i[2]];p=this.points[i[3]];s=a*a;l=a*s;o.x=e(c.x,h.x,m.x,p.x,a,s,l);o.y=e(c.y,h.y,m.y,p.y,a,s,l);o.z=e(c.z,h.z,m.z,p.z,a,s,l);return o};this.getControlPointsArray=function(){var t,e,i=this.points.length,o=[];for(t=0;t<i;t++){e=this.points[t];o[t]=[e.x,e.y,e.z]}return o};this.getLength=function(t){var e,i,o,r=e=e=0,n=new THREE.Vector3,a=new THREE.Vector3,s=[],l=0;s[0]=0;t||(t=100);i=this.points.length*t;n.copy(this.points[0]);for(t=1;t<i;t++){e=t/i;o=this.getPoint(e);a.copy(o);l=l+a.distanceTo(n);n.copy(o);e=(this.points.length-1)*e;e=Math.floor(e);if(e!=r){s[e]=l;r=e}}s[s.length]=l;return{chunks:s,total:l}};this.reparametrizeByArcLength=function(t){var e,i,o,r,n,a,s=[],l=new THREE.Vector3,c=this.getLength();s.push(l.copy(this.points[0]).clone());for(e=1;e<this.points.length;e++){i=c.chunks[e]-c.chunks[e-1];a=Math.ceil(t*i/c.total);r=(e-1)/(this.points.length-1);n=e/(this.points.length-1);for(i=1;i<a-1;i++){o=r+i*(1/a)*(n-r);o=this.getPoint(o);s.push(l.copy(o).clone())}s.push(l.copy(this.points[e]).clone())}this.points=s}};THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4;this.projectionMatrixInverse=new THREE.Matrix4};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.lookAt=function(t){this.matrix.lookAt(this.position,t,this.up);this.rotationAutoUpdate&&this.rotation.getRotationFromMatrix(this.matrix)};THREE.OrthographicCamera=function(t,e,i,o,r,n){THREE.Camera.call(this);this.left=t;this.right=e;this.top=i;this.bottom=o;this.near=r!==void 0?r:.1;this.far=n!==void 0?n:2e3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=new THREE.Camera;THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)};THREE.PerspectiveCamera=function(t,e,i,o){THREE.Camera.call(this);this.fov=t!==void 0?t:50;this.aspect=e!==void 0?e:1;this.near=i!==void 0?i:.1;this.far=o!==void 0?o:2e3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=new THREE.Camera;THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(t,e){this.fov=2*Math.atan((e!==void 0?e:24)/(t*2))*(180/Math.PI);this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(t,e,i,o,r,n){this.fullWidth=t;this.fullHeight=e;this.x=i;this.y=o;this.width=r;this.height=n;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var t=this.fullWidth/this.fullHeight,e=Math.tan(this.fov*Math.PI/360)*this.near,i=-e,o=t*i,t=Math.abs(t*e-o),i=Math.abs(e-i);this.projectionMatrix.makeFrustum(o+this.x*t/this.fullWidth,o+(this.x+this.width)*t/this.fullWidth,e-(this.y+this.height)*i/this.fullHeight,e-this.y*i/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)};THREE.Light=function(t){THREE.Object3D.call(this);this.color=new THREE.Color(t)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(t){THREE.Light.call(this,t)};THREE.AmbientLight.prototype=new THREE.Light;THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(t,e,i){THREE.Light.call(this,t);this.position=new THREE.Vector3(0,1,0);this.target=new THREE.Object3D;this.intensity=e!==void 0?e:1;this.distance=i!==void 0?i:0;this.onlyShadow=this.castShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraTop=this.shadowCameraRight=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowCascade=false;this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(t,e,i){THREE.Light.call(this,t);this.position=new THREE.Vector3(0,0,0);this.intensity=e!==void 0?e:1;this.distance=i!==void 0?i:0};THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.SpotLight=function(t,e,i,o,r){THREE.Light.call(this,t);this.position=new THREE.Vector3(0,1,0);this.target=new THREE.Object3D;this.intensity=e!==void 0?e:1;this.distance=i!==void 0?i:0;this.angle=o!==void 0?o:Math.PI/2;this.exponent=r!==void 0?r:10;this.onlyShadow=this.castShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null};THREE.SpotLight.prototype=new THREE.Light;THREE.SpotLight.prototype.constructor=THREE.SpotLight;THREE.Loader=function(t){this.statusDomElement=(this.showStatus=t)?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var t=document.createElement("div");t.style.position="absolute";t.style.right="0px";t.style.top="0px";t.style.fontSize="0.8em";t.style.textAlign="left";t.style.background="rgba(0,0,0,0.25)";t.style.color="#fff";t.style.width="120px";t.style.padding="0.5em 0.5em 0.5em 0.5em";t.style.zIndex=1e3;t.innerHTML="Loading ...";return t},updateProgress:function(t){var e="Loaded ",e=t.total?e+((100*t.loaded/t.total).toFixed(0)+"%"):e+((t.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=e},extractUrlBase:function(t){t=t.split("/");t.pop();return(t.length<1?".":t.join("/"))+"/"},initMaterials:function(t,e,i){t.materials=[];for(var o=0;o<e.length;++o)t.materials[o]=THREE.Loader.prototype.createMaterial(e[o],i)},hasNormals:function(t){var e,i,o=t.materials.length;for(i=0;i<o;i++){e=t.materials[i];if(e instanceof THREE.ShaderMaterial)return true}return false},createMaterial:function(t,e){function i(t){t=Math.log(t)/Math.LN2;return Math.floor(t)==t}function o(t){t=Math.log(t)/Math.LN2;return Math.pow(2,Math.round(t))}function r(t,e){var r=new Image;r.onload=function(){if(!i(this.width)||!i(this.height)){var e=o(this.width),r=o(this.height);t.image.width=e;t.image.height=r;t.image.getContext("2d").drawImage(this,0,0,e,r)}else t.image=this;t.needsUpdate=true};r.crossOrigin=s.crossOrigin;r.src=e}function n(t,i,o,n,a,s){var l=document.createElement("canvas");t[i]=new THREE.Texture(l);t[i].sourceFile=o;if(n){t[i].repeat.set(n[0],n[1]);if(n[0]!=1)t[i].wrapS=THREE.RepeatWrapping;if(n[1]!=1)t[i].wrapT=THREE.RepeatWrapping}a&&t[i].offset.set(a[0],a[1]);if(s){n={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(n[s[0]]!==void 0)t[i].wrapS=n[s[0]];if(n[s[1]]!==void 0)t[i].wrapT=n[s[1]]}r(t[i],e+"/"+o)}function a(t){return(t[0]*255<<16)+(t[1]*255<<8)+t[2]*255}var s=this,l="MeshLambertMaterial",c={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:t.wireframe};if(t.shading){var h=t.shading.toLowerCase();h==="phong"?l="MeshPhongMaterial":h==="basic"&&(l="MeshBasicMaterial")}if(t.blending!==void 0&&THREE[t.blending]!==void 0)c.blending=THREE[t.blending];if(t.transparent!==void 0||t.opacity<1)c.transparent=t.transparent;if(t.depthTest!==void 0)c.depthTest=t.depthTest;if(t.depthWrite!==void 0)c.depthWrite=t.depthWrite;if(t.vertexColors!==void 0)if(t.vertexColors=="face")c.vertexColors=THREE.FaceColors;else if(t.vertexColors)c.vertexColors=THREE.VertexColors;if(t.colorDiffuse)c.color=a(t.colorDiffuse);else if(t.DbgColor)c.color=t.DbgColor;if(t.colorSpecular)c.specular=a(t.colorSpecular);if(t.colorAmbient)c.ambient=a(t.colorAmbient);if(t.transparency)c.opacity=t.transparency;if(t.specularCoef)c.shininess=t.specularCoef;t.mapDiffuse&&e&&n(c,"map",t.mapDiffuse,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap);t.mapLight&&e&&n(c,"lightMap",t.mapLight,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap);t.mapNormal&&e&&n(c,"normalMap",t.mapNormal,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap);t.mapSpecular&&e&&n(c,"specularMap",t.mapSpecular,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap);if(t.mapNormal){l=THREE.ShaderUtils.lib.normal;h=THREE.UniformsUtils.clone(l.uniforms);h.tNormal.texture=c.normalMap;if(t.mapNormalFactor)h.uNormalScale.value=t.mapNormalFactor;if(c.map){h.tDiffuse.texture=c.map;h.enableDiffuse.value=true}if(c.specularMap){h.tSpecular.texture=c.specularMap;h.enableSpecular.value=true}if(c.lightMap){h.tAO.texture=c.lightMap;h.enableAO.value=true}h.uDiffuseColor.value.setHex(c.color);h.uSpecularColor.value.setHex(c.specular);h.uAmbientColor.value.setHex(c.ambient);h.uShininess.value=c.shininess;if(c.opacity!==void 0)h.uOpacity.value=c.opacity;c=new THREE.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:h,lights:true,fog:true})}else c=new THREE[l](c);if(t.DbgName!==void 0)c.name=t.DbgName;return c}};THREE.BinaryLoader=function(t){THREE.Loader.call(this,t)};THREE.BinaryLoader.prototype=new THREE.Loader;THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader;THREE.BinaryLoader.prototype.load=function(t,e,i,o){var i=i?i:this.extractUrlBase(t),o=o?o:this.extractUrlBase(t),r=this.showProgress?THREE.Loader.prototype.updateProgress:null;this.onLoadStart();this.loadAjaxJSON(this,t,e,i,o,r)};THREE.BinaryLoader.prototype.loadAjaxJSON=function(t,e,i,o,r,n){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState==4)if(a.status==200||a.status==0){var s=JSON.parse(a.responseText);t.loadAjaxBuffers(s,i,r,o,n)}else console.error("THREE.BinaryLoader: Couldn't load ["+e+"] ["+a.status+"]")};a.open("GET",e,true);a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined");a.setRequestHeader("Content-Type","text/plain");a.send(null)};THREE.BinaryLoader.prototype.loadAjaxBuffers=function(t,e,i,o,r){var n=new XMLHttpRequest,a=i+"/"+t.buffers,s=0;n.onreadystatechange=function(){if(n.readyState==4)n.status==200||n.status==0?THREE.BinaryLoader.prototype.createBinModel(n.response,e,o,t.materials):console.error("THREE.BinaryLoader: Couldn't load ["+a+"] ["+n.status+"]");else if(n.readyState==3){if(r){s==0&&(s=n.getResponseHeader("Content-Length"));r({total:s,loaded:n.responseText.length})}}else n.readyState==2&&(s=n.getResponseHeader("Content-Length"))};n.open("GET",a,true);n.responseType="arraybuffer";n.send(null)};THREE.BinaryLoader.prototype.createBinModel=function(t,e,i,o){var r=function(e){var i,r,n,a,s,l,c,h,m,p,u,f,y,d,_;function v(t){return t%4?4-t%4:0}function x(t,e){return new Uint8Array(t,e,1)[0]}function E(t,e){return new Uint32Array(t,e,1)[0]}function g(e,i){var o,r,n,a,s,l,c,h,m=new Uint32Array(t,i,3*e);for(o=0;o<e;o++){r=m[o*3];n=m[o*3+1];a=m[o*3+2];s=D[r*2];r=D[r*2+1];l=D[n*2];c=D[n*2+1];n=D[a*2];h=D[a*2+1];a=C.faceVertexUvs[0];var p=[];p.push(new THREE.UV(s,r));p.push(new THREE.UV(l,c));p.push(new THREE.UV(n,h));a.push(p)}}function b(e,i){var o,r,n,a,s,l,c,h,m,p,u=new Uint32Array(t,i,4*e);for(o=0;o<e;o++){r=u[o*4];n=u[o*4+1];a=u[o*4+2];s=u[o*4+3];l=D[r*2];r=D[r*2+1];c=D[n*2];m=D[n*2+1];h=D[a*2];p=D[a*2+1];a=D[s*2];n=D[s*2+1];s=C.faceVertexUvs[0];var f=[];f.push(new THREE.UV(l,r));f.push(new THREE.UV(c,m));f.push(new THREE.UV(h,p));f.push(new THREE.UV(a,n));s.push(f)}}function T(e,i,o){for(var r,n,a,s,i=new Uint32Array(t,i,3*e),l=new Uint16Array(t,o,e),o=0;o<e;o++){r=i[o*3];n=i[o*3+1];a=i[o*3+2];s=l[o];C.faces.push(new THREE.Face3(r,n,a,null,null,s))}}function R(e,i,o){for(var r,n,a,s,l,i=new Uint32Array(t,i,4*e),c=new Uint16Array(t,o,e),o=0;o<e;o++){r=i[o*4];n=i[o*4+1];a=i[o*4+2];s=i[o*4+3];l=c[o];C.faces.push(new THREE.Face4(r,n,a,s,null,null,l))}}function w(e,i,o,r){for(var n,a,s,l,c,h,m,i=new Uint32Array(t,i,3*e),o=new Uint32Array(t,o,3*e),p=new Uint16Array(t,r,e),r=0;r<e;r++){n=i[r*3];a=i[r*3+1];s=i[r*3+2];c=o[r*3];h=o[r*3+1];m=o[r*3+2];l=p[r];var u=M[h*3],f=M[h*3+1];h=M[h*3+2];var y=M[m*3],d=M[m*3+1];m=M[m*3+2];C.faces.push(new THREE.Face3(n,a,s,[new THREE.Vector3(M[c*3],M[c*3+1],M[c*3+2]),new THREE.Vector3(u,f,h),new THREE.Vector3(y,d,m)],null,l))}}function S(e,i,o,r){for(var n,a,s,l,c,h,m,p,u,i=new Uint32Array(t,i,4*e),o=new Uint32Array(t,o,4*e),f=new Uint16Array(t,r,e),r=0;r<e;r++){n=i[r*4];a=i[r*4+1];s=i[r*4+2];l=i[r*4+3];h=o[r*4];m=o[r*4+1];p=o[r*4+2];u=o[r*4+3];c=f[r];var y=M[m*3],d=M[m*3+1];m=M[m*3+2];var _=M[p*3],v=M[p*3+1];p=M[p*3+2];var x=M[u*3],E=M[u*3+1];u=M[u*3+2];C.faces.push(new THREE.Face4(n,a,s,l,[new THREE.Vector3(M[h*3],M[h*3+1],M[h*3+2]),new THREE.Vector3(y,d,m),new THREE.Vector3(_,v,p),new THREE.Vector3(x,E,u)],null,c))}}var C=this,A=0,M=[],D=[],B,H,V;THREE.Geometry.call(this);THREE.Loader.prototype.initMaterials(C,o,e);(function(t,e,i){for(var t=new Uint8Array(t,e,i),o="",r=0;r<i;r++)o=o+String.fromCharCode(t[e+r]);return o})(t,A,12);i=x(t,A+12);x(t,A+13);x(t,A+14);x(t,A+15);r=x(t,A+16);n=x(t,A+17);a=x(t,A+18);s=x(t,A+19);l=E(t,A+20);c=E(t,A+20+4);h=E(t,A+20+8);e=E(t,A+20+12);m=E(t,A+20+16);p=E(t,A+20+20);u=E(t,A+20+24);f=E(t,A+20+28);y=E(t,A+20+32);d=E(t,A+20+36);_=E(t,A+20+40);A=A+i;i=r*3+s;V=r*4+s;B=e*i;H=m*(i+n*3);r=p*(i+a*3);s=u*(i+n*3+a*3);i=f*V;n=y*(V+n*4);a=d*(V+a*4);A=A+function(e){var e=new Float32Array(t,e,l*3),i,o,r,n;for(i=0;i<l;i++){o=e[i*3];r=e[i*3+1];n=e[i*3+2];C.vertices.push(new THREE.Vector3(o,r,n))}return l*3*Float32Array.BYTES_PER_ELEMENT}(A);A=A+function(e){if(c){var e=new Int8Array(t,e,c*3),i,o,r,n;for(i=0;i<c;i++){o=e[i*3];r=e[i*3+1];n=e[i*3+2];M.push(o/127,r/127,n/127)}}return c*3*Int8Array.BYTES_PER_ELEMENT}(A);A=A+v(c*3);A=A+function(e){if(h){var e=new Float32Array(t,e,h*2),i,o,r;for(i=0;i<h;i++){o=e[i*2];r=e[i*2+1];D.push(o,r)}}return h*2*Float32Array.BYTES_PER_ELEMENT}(A);B=A+B+v(e*2);H=B+H+v(m*2);r=H+r+v(p*2);s=r+s+v(u*2);i=s+i+v(f*2);n=i+n+v(y*2);a=n+a+v(d*2);(function(t){if(p){var e=t+p*Uint32Array.BYTES_PER_ELEMENT*3;T(p,t,e+p*Uint32Array.BYTES_PER_ELEMENT*3);g(p,e)}})(H);(function(t){if(u){var e=t+u*Uint32Array.BYTES_PER_ELEMENT*3,i=e+u*Uint32Array.BYTES_PER_ELEMENT*3;w(u,t,e,i+u*Uint32Array.BYTES_PER_ELEMENT*3);g(u,i)}})(r);(function(t){if(d){var e=t+d*Uint32Array.BYTES_PER_ELEMENT*4;R(d,t,e+d*Uint32Array.BYTES_PER_ELEMENT*4);b(d,e)}})(n);(function(t){if(_){var e=t+_*Uint32Array.BYTES_PER_ELEMENT*4,i=e+_*Uint32Array.BYTES_PER_ELEMENT*4;S(_,t,e,i+_*Uint32Array.BYTES_PER_ELEMENT*4);b(_,i)}})(a);e&&T(e,A,A+e*Uint32Array.BYTES_PER_ELEMENT*3);(function(t){if(m){var e=t+m*Uint32Array.BYTES_PER_ELEMENT*3;w(m,t,e,e+m*Uint32Array.BYTES_PER_ELEMENT*3)}})(B);f&&R(f,s,s+f*Uint32Array.BYTES_PER_ELEMENT*4);(function(t){if(y){var e=t+y*Uint32Array.BYTES_PER_ELEMENT*4;S(y,t,e,e+y*Uint32Array.BYTES_PER_ELEMENT*4)}})(i);this.computeCentroids();this.computeFaceNormals();THREE.Loader.prototype.hasNormals(this)&&this.computeTangents()};r.prototype=new THREE.Geometry;r.prototype.constructor=r;e(new r(i))};THREE.JSONLoader=function(t){THREE.Loader.call(this,t)};THREE.JSONLoader.prototype=new THREE.Loader;THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.load=function(t,e,i){i=i?i:this.extractUrlBase(t);this.onLoadStart();this.loadAjaxJSON(this,t,e,i)};THREE.JSONLoader.prototype.loadAjaxJSON=function(t,e,i,o,r){var n=new XMLHttpRequest,a=0;n.onreadystatechange=function(){if(n.readyState===n.DONE)if(n.status===200||n.status===0){if(n.responseText){var s=JSON.parse(n.responseText);t.createModel(s,i,o)}else console.warn("THREE.JSONLoader: ["+e+"] seems to be unreachable or file there is empty");t.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+e+"] ["+n.status+"]");else if(n.readyState===n.LOADING){if(r){a===0&&(a=n.getResponseHeader("Content-Length"));r({total:a,loaded:n.responseText.length})}}else n.readyState===n.HEADERS_RECEIVED&&(a=n.getResponseHeader("Content-Length"))};n.open("GET",e,true);n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined");n.setRequestHeader("Content-Type","text/plain");n.send(null)};THREE.JSONLoader.prototype.createModel=function(t,e,i){var o=new THREE.Geometry,r=t.scale!==void 0?1/t.scale:1;this.initMaterials(o,t.materials,i);(function(e){var i,r,n,a,s,l,c,h,m,p,u,f,y,d,_=t.faces;l=t.vertices;var v=t.normals,x=t.colors,E=0;for(i=0;i<t.uvs.length;i++)t.uvs[i].length&&E++;for(i=0;i<E;i++){o.faceUvs[i]=[];o.faceVertexUvs[i]=[]}a=0;for(s=l.length;a<s;){c=new THREE.Vector3;c.x=l[a++]*e;c.y=l[a++]*e;c.z=l[a++]*e;o.vertices.push(c)}a=0;for(s=_.length;a<s;){e=_[a++];l=e&1;n=e&2;i=e&4;r=e&8;h=e&16;c=e&32;p=e&64;e=e&128;if(l){u=new THREE.Face4;u.a=_[a++];u.b=_[a++];u.c=_[a++];u.d=_[a++];l=4}else{u=new THREE.Face3;u.a=_[a++];u.b=_[a++];u.c=_[a++];l=3}if(n){n=_[a++];u.materialIndex=n}n=o.faces.length;if(i)for(i=0;i<E;i++){f=t.uvs[i];m=_[a++];d=f[m*2];m=f[m*2+1];o.faceUvs[i][n]=new THREE.UV(d,m)}if(r)for(i=0;i<E;i++){f=t.uvs[i];y=[];for(r=0;r<l;r++){m=_[a++];d=f[m*2];m=f[m*2+1];y[r]=new THREE.UV(d,m)}o.faceVertexUvs[i][n]=y}if(h){h=_[a++]*3;r=new THREE.Vector3;r.x=v[h++];r.y=v[h++];r.z=v[h];u.normal=r}if(c)for(i=0;i<l;i++){h=_[a++]*3;r=new THREE.Vector3;r.x=v[h++];r.y=v[h++];r.z=v[h];u.vertexNormals.push(r)}if(p){c=_[a++];c=new THREE.Color(x[c]);u.color=c}if(e)for(i=0;i<l;i++){c=_[a++];c=new THREE.Color(x[c]);u.vertexColors.push(c)}o.faces.push(u)}})(r);(function(){var e,i,r,n;if(t.skinWeights){e=0;for(i=t.skinWeights.length;e<i;e=e+2){r=t.skinWeights[e];n=t.skinWeights[e+1];o.skinWeights.push(new THREE.Vector4(r,n,0,0))}}if(t.skinIndices){e=0;for(i=t.skinIndices.length;e<i;e=e+2){r=t.skinIndices[e];n=t.skinIndices[e+1];o.skinIndices.push(new THREE.Vector4(r,n,0,0))}}o.bones=t.bones;o.animation=t.animation})();(function(e){if(t.morphTargets!==void 0){var i,r,n,a,s,l;i=0;for(r=t.morphTargets.length;i<r;i++){o.morphTargets[i]={};o.morphTargets[i].name=t.morphTargets[i].name;o.morphTargets[i].vertices=[];s=o.morphTargets[i].vertices;l=t.morphTargets[i].vertices;n=0;for(a=l.length;n<a;n=n+3){var c=new THREE.Vector3;c.x=l[n]*e;c.y=l[n+1]*e;c.z=l[n+2]*e;s.push(c)}}}if(t.morphColors!==void 0){i=0;for(r=t.morphColors.length;i<r;i++){o.morphColors[i]={};o.morphColors[i].name=t.morphColors[i].name;o.morphColors[i].colors=[];a=o.morphColors[i].colors;s=t.morphColors[i].colors;e=0;for(n=s.length;e<n;e=e+3){l=new THREE.Color(16755200);l.setRGB(s[e],s[e+1],s[e+2]);a.push(l)}}}})(r);o.computeCentroids();o.computeFaceNormals();this.hasNormals(o)&&o.computeTangents();e(o)};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};THREE.SceneLoader.prototype.constructor=THREE.SceneLoader;THREE.SceneLoader.prototype.load=function(t,e){var i=this,o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState==4)if(o.status==200||o.status==0){var r=JSON.parse(o.responseText);i.createScene(r,e,t)}else console.error("THREE.SceneLoader: Couldn't load ["+t+"] ["+o.status+"]")};o.open("GET",t,true);o.overrideMimeType&&o.overrideMimeType("text/plain; charset=x-user-defined");o.setRequestHeader("Content-Type","text/plain");o.send(null)};THREE.SceneLoader.prototype.createScene=function(t,e,i){function o(t,e){return e=="relativeToHTML"?t:c+"/"+t}function r(){var t;for(p in B.objects)if(!I.objects[p]){_=B.objects[p];if(_.geometry!==void 0){if(C=I.geometries[_.geometry]){t=false;A=I.materials[_.materials[0]];(t=A instanceof THREE.ShaderMaterial)&&C.computeTangents();g=_.position;b=_.rotation;T=_.quaternion;R=_.scale;v=_.matrix;T=0;_.materials.length==0&&(A=new THREE.MeshFaceMaterial);_.materials.length>1&&(A=new THREE.MeshFaceMaterial);t=new THREE.Mesh(C,A);t.name=p;if(v){t.matrixAutoUpdate=false;t.matrix.set(v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15])}else{t.position.set(g[0],g[1],g[2]);if(T){t.quaternion.set(T[0],T[1],T[2],T[3]);t.useQuaternion=true}else t.rotation.set(b[0],b[1],b[2]);t.scale.set(R[0],R[1],R[2])}t.visible=_.visible;t.doubleSided=_.doubleSided;t.castShadow=_.castShadow;t.receiveShadow=_.receiveShadow;I.scene.add(t);I.objects[p]=t}}else{g=_.position;b=_.rotation;T=_.quaternion;R=_.scale;T=0;t=new THREE.Object3D;t.name=p;t.position.set(g[0],g[1],g[2]);if(T){t.quaternion.set(T[0],T[1],T[2],T[3]);t.useQuaternion=true}else t.rotation.set(b[0],b[1],b[2]);t.scale.set(R[0],R[1],R[2]);t.visible=_.visible!==void 0?_.visible:false;I.scene.add(t);I.objects[p]=t;I.empties[p]=t}}}function n(t){return function(e){I.geometries[t]=e;r();V=V-1;l.onLoadComplete();s()}}function a(t){return function(e){I.geometries[t]=e}}function s(){l.callbackProgress({totalModels:P,totalTextures:F,loadedModels:P-V,loadedTextures:F-L},I);l.onLoadProgress();V==0&&L==0&&e(I)}var l=this,c=THREE.Loader.prototype.extractUrlBase(i),h,m,p,u,f,y,d,_,v,x,E,g,b,T,R,w,S,C,A,M,D,B,H,V,L,P,F,I;B=t;i=new THREE.BinaryLoader;H=new THREE.JSONLoader;L=V=0;I={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{}};if(B.transform){t=B.transform.position;x=B.transform.rotation;w=B.transform.scale;t&&I.scene.position.set(t[0],t[1],t[2]);x&&I.scene.rotation.set(x[0],x[1],x[2]);w&&I.scene.scale.set(w[0],w[1],w[2]);if(t||x||w){I.scene.updateMatrix();I.scene.updateMatrixWorld()}}t=function(){L=L-1;s();l.onLoadComplete()};for(f in B.cameras){w=B.cameras[f];w.type=="perspective"?M=new THREE.PerspectiveCamera(w.fov,w.aspect,w.near,w.far):w.type=="ortho"&&(M=new THREE.OrthographicCamera(w.left,w.right,w.top,w.bottom,w.near,w.far));g=w.position;x=w.target;w=w.up;M.position.set(g[0],g[1],g[2]);M.target=new THREE.Vector3(x[0],x[1],x[2]);w&&M.up.set(w[0],w[1],w[2]);I.cameras[f]=M}for(u in B.lights){x=B.lights[u];f=x.color!==void 0?x.color:16777215;M=x.intensity!==void 0?x.intensity:1;if(x.type=="directional"){g=x.direction;E=new THREE.DirectionalLight(f,M);E.position.set(g[0],g[1],g[2]);E.position.normalize()}else if(x.type=="point"){g=x.position;E=x.distance;E=new THREE.PointLight(f,M,E);E.position.set(g[0],g[1],g[2])}else x.type=="ambient"&&(E=new THREE.AmbientLight(f));I.scene.add(E);I.lights[u]=E}for(y in B.fogs){u=B.fogs[y];u.type=="linear"?D=new THREE.Fog(0,u.near,u.far):u.type=="exp2"&&(D=new THREE.FogExp2(0,u.density));w=u.color;D.color.setRGB(w[0],w[1],w[2]);I.fogs[y]=D}if(I.cameras&&B.defaults.camera)I.currentCamera=I.cameras[B.defaults.camera];if(I.fogs&&B.defaults.fog)I.scene.fog=I.fogs[B.defaults.fog];w=B.defaults.bgcolor;I.bgColor=new THREE.Color;I.bgColor.setRGB(w[0],w[1],w[2]);I.bgColorAlpha=B.defaults.bgalpha;for(h in B.geometries){y=B.geometries[h];if(y.type=="bin_mesh"||y.type=="ascii_mesh"){V=V+1;l.onLoadStart()}}P=V;for(h in B.geometries){y=B.geometries[h];if(y.type=="cube"){C=new THREE.CubeGeometry(y.width,y.height,y.depth,y.segmentsWidth,y.segmentsHeight,y.segmentsDepth,null,y.flipped,y.sides);I.geometries[h]=C}else if(y.type=="plane"){C=new THREE.PlaneGeometry(y.width,y.height,y.segmentsWidth,y.segmentsHeight);I.geometries[h]=C}else if(y.type=="sphere"){C=new THREE.SphereGeometry(y.radius,y.segmentsWidth,y.segmentsHeight);I.geometries[h]=C}else if(y.type=="cylinder"){C=new THREE.CylinderGeometry(y.topRad,y.botRad,y.height,y.radSegs,y.heightSegs);I.geometries[h]=C}else if(y.type=="torus"){C=new THREE.TorusGeometry(y.radius,y.tube,y.segmentsR,y.segmentsT);I.geometries[h]=C}else if(y.type=="icosahedron"){C=new THREE.IcosahedronGeometry(y.radius,y.subdivisions);I.geometries[h]=C}else if(y.type=="bin_mesh")i.load(o(y.url,B.urlBaseType),n(h));else if(y.type=="ascii_mesh")H.load(o(y.url,B.urlBaseType),n(h));else if(y.type=="embedded_mesh"){y=B.embeds[y.id];y.metadata=B.metadata;y&&H.createModel(y,a(h),"")}}for(d in B.textures){h=B.textures[d];if(h.url instanceof Array){L=L+h.url.length;for(y=0;y<h.url.length;y++)l.onLoadStart()}else{L=L+1;l.onLoadStart()}}F=L;for(d in B.textures){h=B.textures[d];if(h.mapping!=void 0&&THREE[h.mapping]!=void 0)h.mapping=new THREE[h.mapping];if(h.url instanceof Array){y=[];for(D=0;D<h.url.length;D++)y[D]=o(h.url[D],B.urlBaseType);y=THREE.ImageUtils.loadTextureCube(y,h.mapping,t)}else{y=THREE.ImageUtils.loadTexture(o(h.url,B.urlBaseType),h.mapping,t);if(THREE[h.minFilter]!=void 0)y.minFilter=THREE[h.minFilter];if(THREE[h.magFilter]!=void 0)y.magFilter=THREE[h.magFilter];if(h.repeat){y.repeat.set(h.repeat[0],h.repeat[1]);if(h.repeat[0]!=1)y.wrapS=THREE.RepeatWrapping;if(h.repeat[1]!=1)y.wrapT=THREE.RepeatWrapping}h.offset&&y.offset.set(h.offset[0],h.offset[1]);if(h.wrap){D={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(D[h.wrap[0]]!==void 0)y.wrapS=D[h.wrap[0]];if(D[h.wrap[1]]!==void 0)y.wrapT=D[h.wrap[1]]}}I.textures[d]=y}for(m in B.materials){v=B.materials[m];for(S in v.parameters)if(S=="envMap"||S=="map"||S=="lightMap")v.parameters[S]=I.textures[v.parameters[S]];else if(S=="shading")v.parameters[S]=v.parameters[S]=="flat"?THREE.FlatShading:THREE.SmoothShading;else if(S=="blending")v.parameters[S]=THREE[v.parameters[S]]?THREE[v.parameters[S]]:THREE.NormalBlending;else if(S=="combine")v.parameters[S]=v.parameters[S]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation;else if(S=="vertexColors")if(v.parameters[S]=="face")v.parameters[S]=THREE.FaceColors;else if(v.parameters[S])v.parameters[S]=THREE.VertexColors;if(v.parameters.opacity!==void 0&&v.parameters.opacity<1)v.parameters.transparent=true;if(v.parameters.normalMap){d=THREE.ShaderUtils.lib.normal;t=THREE.UniformsUtils.clone(d.uniforms);h=v.parameters.color;y=v.parameters.specular;D=v.parameters.ambient;i=v.parameters.shininess;t.tNormal.texture=I.textures[v.parameters.normalMap];if(v.parameters.normalMapFactor)t.uNormalScale.value=v.parameters.normalMapFactor;if(v.parameters.map){t.tDiffuse.texture=v.parameters.map;t.enableDiffuse.value=true}if(v.parameters.lightMap){t.tAO.texture=v.parameters.lightMap;t.enableAO.value=true}if(v.parameters.specularMap){t.tSpecular.texture=I.textures[v.parameters.specularMap];t.enableSpecular.value=true}t.uDiffuseColor.value.setHex(h);t.uSpecularColor.value.setHex(y);t.uAmbientColor.value.setHex(D);t.uShininess.value=i;if(v.parameters.opacity)t.uOpacity.value=v.parameters.opacity;A=new THREE.ShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:t,lights:true,fog:true})}else A=new THREE[v.type](v.parameters);I.materials[m]=A}r();l.callbackSync(I);s()};THREE.Material=function(t){t=t||{};this.id=THREE.MaterialCount++;this.name="";this.opacity=t.opacity!==void 0?t.opacity:1;this.transparent=t.transparent!==void 0?t.transparent:false;this.blending=t.blending!==void 0?t.blending:THREE.NormalBlending;this.blendSrc=t.blendSrc!==void 0?t.blendSrc:THREE.SrcAlphaFactor;this.blendDst=t.blendDst!==void 0?t.blendDst:THREE.OneMinusSrcAlphaFactor;this.blendEquation=t.blendEquation!==void 0?t.blendEquation:THREE.AddEquation;this.depthTest=t.depthTest!==void 0?t.depthTest:true;this.depthWrite=t.depthWrite!==void 0?t.depthWrite:true;this.polygonOffset=t.polygonOffset!==void 0?t.polygonOffset:false;this.polygonOffsetFactor=t.polygonOffsetFactor!==void 0?t.polygonOffsetFactor:0;this.polygonOffsetUnits=t.polygonOffsetUnits!==void 0?t.polygonOffsetUnits:0;this.alphaTest=t.alphaTest!==void 0?t.alphaTest:0;this.overdraw=t.overdraw!==void 0?t.overdraw:false;this.needsUpdate=this.visible=true};THREE.MaterialCount=0;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.AdditiveAlphaBlending=5;THREE.CustomBlending=6;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.LineBasicMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.color=t.color!==void 0?new THREE.Color(t.color):new THREE.Color(16777215);this.linewidth=t.linewidth!==void 0?t.linewidth:1;this.linecap=t.linecap!==void 0?t.linecap:"round";this.linejoin=t.linejoin!==void 0?t.linejoin:"round";this.vertexColors=t.vertexColors?t.vertexColors:false;this.fog=t.fog!==void 0?t.fog:true};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;THREE.MeshBasicMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.color=t.color!==void 0?new THREE.Color(t.color):new THREE.Color(16777215);this.map=t.map!==void 0?t.map:null;this.lightMap=t.lightMap!==void 0?t.lightMap:null;this.envMap=t.envMap!==void 0?t.envMap:null;this.combine=t.combine!==void 0?t.combine:THREE.MultiplyOperation;this.reflectivity=t.reflectivity!==void 0?t.reflectivity:1;this.refractionRatio=t.refractionRatio!==void 0?t.refractionRatio:.98;this.fog=t.fog!==void 0?t.fog:true;this.shading=t.shading!==void 0?t.shading:THREE.SmoothShading;this.wireframe=t.wireframe!==void 0?t.wireframe:false;this.wireframeLinewidth=t.wireframeLinewidth!==void 0?t.wireframeLinewidth:1;this.wireframeLinecap=t.wireframeLinecap!==void 0?t.wireframeLinecap:"round";this.wireframeLinejoin=t.wireframeLinejoin!==void 0?t.wireframeLinejoin:"round";this.vertexColors=t.vertexColors!==void 0?t.vertexColors:THREE.NoColors;this.skinning=t.skinning!==void 0?t.skinning:false;this.morphTargets=t.morphTargets!==void 0?t.morphTargets:false};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;THREE.MeshLambertMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.color=t.color!==void 0?new THREE.Color(t.color):new THREE.Color(16777215);this.ambient=t.ambient!==void 0?new THREE.Color(t.ambient):new THREE.Color(16777215);this.emissive=t.emissive!==void 0?new THREE.Color(t.emissive):new THREE.Color(0);this.wrapAround=t.wrapAround!==void 0?t.wrapAround:false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=t.map!==void 0?t.map:null;this.lightMap=t.lightMap!==void 0?t.lightMap:null;this.envMap=t.envMap!==void 0?t.envMap:null;this.combine=t.combine!==void 0?t.combine:THREE.MultiplyOperation;this.reflectivity=t.reflectivity!==void 0?t.reflectivity:1;this.refractionRatio=t.refractionRatio!==void 0?t.refractionRatio:.98;this.fog=t.fog!==void 0?t.fog:true;this.shading=t.shading!==void 0?t.shading:THREE.SmoothShading;this.wireframe=t.wireframe!==void 0?t.wireframe:false;this.wireframeLinewidth=t.wireframeLinewidth!==void 0?t.wireframeLinewidth:1;this.wireframeLinecap=t.wireframeLinecap!==void 0?t.wireframeLinecap:"round";this.wireframeLinejoin=t.wireframeLinejoin!==void 0?t.wireframeLinejoin:"round";this.vertexColors=t.vertexColors!==void 0?t.vertexColors:THREE.NoColors;this.skinning=t.skinning!==void 0?t.skinning:false;this.morphTargets=t.morphTargets!==void 0?t.morphTargets:false;this.morphNormals=t.morphNormals!==void 0?t.morphNormals:false};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;THREE.MeshPhongMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.color=t.color!==void 0?new THREE.Color(t.color):new THREE.Color(16777215);this.ambient=t.ambient!==void 0?new THREE.Color(t.ambient):new THREE.Color(16777215);this.emissive=t.emissive!==void 0?new THREE.Color(t.emissive):new THREE.Color(0);this.specular=t.specular!==void 0?new THREE.Color(t.specular):new THREE.Color(1118481);this.shininess=t.shininess!==void 0?t.shininess:30;this.metal=t.metal!==void 0?t.metal:false;this.perPixel=t.perPixel!==void 0?t.perPixel:false;this.wrapAround=t.wrapAround!==void 0?t.wrapAround:false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=t.map!==void 0?t.map:null;this.lightMap=t.lightMap!==void 0?t.lightMap:null;this.envMap=t.envMap!==void 0?t.envMap:null;this.combine=t.combine!==void 0?t.combine:THREE.MultiplyOperation;this.reflectivity=t.reflectivity!==void 0?t.reflectivity:1;this.refractionRatio=t.refractionRatio!==void 0?t.refractionRatio:.98;this.fog=t.fog!==void 0?t.fog:true;this.shading=t.shading!==void 0?t.shading:THREE.SmoothShading;this.wireframe=t.wireframe!==void 0?t.wireframe:false;this.wireframeLinewidth=t.wireframeLinewidth!==void 0?t.wireframeLinewidth:1;this.wireframeLinecap=t.wireframeLinecap!==void 0?t.wireframeLinecap:"round";this.wireframeLinejoin=t.wireframeLinejoin!==void 0?t.wireframeLinejoin:"round";this.vertexColors=t.vertexColors!==void 0?t.vertexColors:THREE.NoColors;this.skinning=t.skinning!==void 0?t.skinning:false;this.morphTargets=t.morphTargets!==void 0?t.morphTargets:false;this.morphNormals=t.morphNormals!==void 0?t.morphNormals:false};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;THREE.MeshDepthMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.shading=t.shading!==void 0?t.shading:THREE.SmoothShading;this.wireframe=t.wireframe!==void 0?t.wireframe:false;this.wireframeLinewidth=t.wireframeLinewidth!==void 0?t.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshNormalMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.shading=t.shading?t.shading:THREE.FlatShading;this.wireframe=t.wireframe?t.wireframe:false;this.wireframeLinewidth=t.wireframeLinewidth?t.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};THREE.ParticleBasicMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.color=t.color!==void 0?new THREE.Color(t.color):new THREE.Color(16777215);this.map=t.map!==void 0?t.map:null;this.size=t.size!==void 0?t.size:1;this.sizeAttenuation=t.sizeAttenuation!==void 0?t.sizeAttenuation:true;this.vertexColors=t.vertexColors!==void 0?t.vertexColors:false;this.fog=t.fog!==void 0?t.fog:true};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;THREE.ParticleCanvasMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.color=t.color!==void 0?new THREE.Color(t.color):new THREE.Color(16777215);this.program=t.program!==void 0?t.program:function(){}};THREE.ParticleCanvasMaterial.prototype=new THREE.Material;THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial;THREE.ParticleDOMMaterial=function(t){THREE.Material.call(this);this.domElement=t};THREE.ShaderMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.fragmentShader=t.fragmentShader!==void 0?t.fragmentShader:"void main() {}";this.vertexShader=t.vertexShader!==void 0?t.vertexShader:"void main() {}";this.uniforms=t.uniforms!==void 0?t.uniforms:{};this.attributes=t.attributes;this.shading=t.shading!==void 0?t.shading:THREE.SmoothShading;this.wireframe=t.wireframe!==void 0?t.wireframe:false;this.wireframeLinewidth=t.wireframeLinewidth!==void 0?t.wireframeLinewidth:1;this.fog=t.fog!==void 0?t.fog:false;this.lights=t.lights!==void 0?t.lights:false;this.vertexColors=t.vertexColors!==void 0?t.vertexColors:THREE.NoColors;this.skinning=t.skinning!==void 0?t.skinning:false;this.morphTargets=t.morphTargets!==void 0?t.morphTargets:false;this.morphNormals=t.morphNormals!==void 0?t.morphNormals:false};THREE.ShaderMaterial.prototype=new THREE.Material;THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;THREE.Texture=function(t,e,i,o,r,n,a,s){this.id=THREE.TextureCount++;this.image=t;this.mapping=e!==void 0?e:new THREE.UVMapping;this.wrapS=i!==void 0?i:THREE.ClampToEdgeWrapping;this.wrapT=o!==void 0?o:THREE.ClampToEdgeWrapping;this.magFilter=r!==void 0?r:THREE.LinearFilter;this.minFilter=n!==void 0?n:THREE.LinearMipMapLinearFilter;this.format=a!==void 0?a:THREE.RGBAFormat;this.type=s!==void 0?s:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.needsUpdate=this.premultiplyAlpha=false;this.onUpdate=null};THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var t=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter,this.format,this.type);t.offset.copy(this.offset);t.repeat.copy(this.repeat);return t}};THREE.TextureCount=0;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.UVMapping=function(){};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.DataTexture=function(t,e,i,o,r,n,a,s,l,c){THREE.Texture.call(this,null,n,a,s,l,c,o,r);this.image={data:t,width:e,height:i}};THREE.DataTexture.prototype=new THREE.Texture;THREE.DataTexture.prototype.constructor=THREE.DataTexture;THREE.DataTexture.prototype.clone=function(){var t=new THREE.DataTexture(this.image.data,this.image.width,this.image.height,this.format,this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);t.offset.copy(this.offset);t.repeat.copy(this.repeat);return t};THREE.Particle=function(t){THREE.Object3D.call(this);this.material=t};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;THREE.ParticleSystem=function(t,e){THREE.Object3D.call(this);this.geometry=t;this.material=e!==void 0?e:new THREE.ParticleBasicMaterial({color:Math.random()*16777215});this.sortParticles=false;if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=t.boundingSphere.radius}this.frustumCulled=false};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;THREE.Line=function(t,e,i){THREE.Object3D.call(this);this.geometry=t;this.material=e!==void 0?e:new THREE.LineBasicMaterial({color:Math.random()*16777215});this.type=i!==void 0?i:THREE.LineStrip;this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;THREE.Mesh=function(t,e){THREE.Object3D.call(this);this.geometry=t;this.material=e!==void 0?e:new THREE.MeshBasicMaterial({color:Math.random()*16777215,wireframe:true});if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=t.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var i=0;i<this.geometry.morphTargets.length;i++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[i].name]=i}}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(t){if(this.morphTargetDictionary[t]!==void 0)return this.morphTargetDictionary[t];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+t+" does not exist. Returning 0.");return 0};THREE.Bone=function(t){THREE.Object3D.call(this);this.skin=t;this.skinMatrix=new THREE.Matrix4};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;THREE.Bone.prototype.update=function(t,e){this.matrixAutoUpdate&&(e=e|this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){t?this.skinMatrix.multiply(t,this.matrix):this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=false;e=true}var i,o=this.children.length;for(i=0;i<o;i++)this.children[i].update(this.skinMatrix,e)};THREE.SkinnedMesh=function(t,e){THREE.Mesh.call(this,t,e);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var i,o,r,n,a,s;if(this.geometry.bones!==void 0){for(i=0;i<this.geometry.bones.length;i++){r=this.geometry.bones[i];n=r.pos;a=r.rotq;s=r.scl;o=this.addBone();o.name=r.name;o.position.set(n[0],n[1],n[2]);o.quaternion.set(a[0],a[1],a[2],a[3]);o.useQuaternion=true;s!==void 0?o.scale.set(s[0],s[1],s[2]):o.scale.set(1,1,1)}for(i=0;i<this.bones.length;i++){r=this.geometry.bones[i];o=this.bones[i];r.parent===-1?this.add(o):this.bones[r.parent].add(o)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;THREE.SkinnedMesh.prototype.addBone=function(t){t===void 0&&(t=new THREE.Bone(this));this.bones.push(t);return t};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(t){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||t){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=false}for(var t=0,e=this.children.length;t<e;t++){var i=this.children[t];i instanceof THREE.Bone?i.update(this.identityMatrix,false):i.updateMatrixWorld(true)}for(var e=this.bones.length,i=this.bones,o=this.boneMatrices,t=0;t<e;t++)i[t].skinMatrix.flattenToArrayOffset(o,t*16)};THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(true);for(var t,e=[],i=0;i<this.bones.length;i++){t=this.bones[i];var o=new THREE.Matrix4;o.getInverse(t.skinMatrix);e.push(o);t.skinMatrix.flattenToArrayOffset(this.boneMatrices,i*16)}if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];for(t=0;t<this.geometry.skinIndices.length;t++){var i=this.geometry.vertices[t],r=this.geometry.skinIndices[t].x,n=this.geometry.skinIndices[t].y,o=new THREE.Vector3(i.x,i.y,i.z);this.geometry.skinVerticesA.push(e[r].multiplyVector3(o));o=new THREE.Vector3(i.x,i.y,i.z);this.geometry.skinVerticesB.push(e[n].multiplyVector3(o));if(this.geometry.skinWeights[t].x+this.geometry.skinWeights[t].y!==1){i=(1-(this.geometry.skinWeights[t].x+this.geometry.skinWeights[t].y))*.5;this.geometry.skinWeights[t].x=this.geometry.skinWeights[t].x+i;this.geometry.skinWeights[t].y=this.geometry.skinWeights[t].y+i}}}};THREE.MorphAnimMesh=function(t,e){THREE.Mesh.call(this,t,e);this.duration=1e3;this.mirroredLoop=false;this.currentKeyframe=this.lastKeyframe=this.time=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=new THREE.Mesh;THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh;THREE.MorphAnimMesh.prototype.setFrameRange=function(t,e){this.startKeyframe=t;this.endKeyframe=e;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var t=this.geometry;if(!t.animations)t.animations={};for(var e,i=t.animations,o=/([a-z]+)(\d+)/,r=0,n=t.morphTargets.length;r<n;r++){var a=t.morphTargets[r].name.match(o);if(a&&a.length>1){a=a[1];i[a]||(i[a]={start:Infinity,end:-Infinity});var s=i[a];if(r<s.start)s.start=r;if(r>s.end)s.end=r;e||(e=a)}}t.firstAnimation=e};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(t,e,i){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[t]={start:e,end:i}};THREE.MorphAnimMesh.prototype.playAnimation=function(t,e){var i=this.geometry.animations[t];if(i){this.setFrameRange(i.start,i.end);this.duration=1e3*((i.end-i.start)/e);this.time=0}else console.warn("animation["+t+"] undefined")};THREE.MorphAnimMesh.prototype.updateAnimation=function(t){var e=this.duration/this.length;this.time=this.time+this.direction*t;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction=this.direction*-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time=this.time+this.duration}t=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/e),0,this.length-1);if(t!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[t]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=t}e=this.time%e/e;this.directionBackwards&&(e=1-e);this.morphTargetInfluences[this.currentKeyframe]=e;this.morphTargetInfluences[this.lastKeyframe]=1-e};THREE.Ribbon=function(t,e){THREE.Object3D.call(this);this.geometry=t;this.material=e};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.addLevel=function(t,e){e===void 0&&(e=0);for(var e=Math.abs(e),i=0;i<this.LODs.length;i++)if(e<this.LODs[i].visibleAtDistance)break;this.LODs.splice(i,0,{visibleAtDistance:e,object3D:t});this.add(t)};THREE.LOD.prototype.update=function(t){if(this.LODs.length>1){t.matrixWorldInverse.getInverse(t.matrixWorld);t=t.matrixWorldInverse;t=-(t.elements[2]*this.matrixWorld.elements[12]+t.elements[6]*this.matrixWorld.elements[13]+t.elements[10]*this.matrixWorld.elements[14]+t.elements[14]);this.LODs[0].object3D.visible=true;for(var e=1;e<this.LODs.length;e++)if(t>=this.LODs[e].visibleAtDistance){this.LODs[e-1].object3D.visible=false;this.LODs[e].object3D.visible=true}else break;for(;e<this.LODs.length;e++)this.LODs[e].object3D.visible=false}};THREE.Sprite=function(t){THREE.Object3D.call(this);this.color=t.color!==void 0?new THREE.Color(t.color):new THREE.Color(16777215);this.map=t.map!==void 0?t.map:new THREE.Texture;this.blending=t.blending!==void 0?t.blending:THREE.NormalBlending;this.blendSrc=t.blendSrc!==void 0?t.blendSrc:THREE.SrcAlphaFactor;this.blendDst=t.blendDst!==void 0?t.blendDst:THREE.OneMinusSrcAlphaFactor;this.blendEquation=t.blendEquation!==void 0?t.blendEquation:THREE.AddEquation;this.useScreenCoordinates=t.useScreenCoordinates!==void 0?t.useScreenCoordinates:true;this.mergeWith3D=t.mergeWith3D!==void 0?t.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=t.affectedByDistance!==void 0?t.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=t.scaleByViewport!==void 0?t.scaleByViewport:!this.affectedByDistance;this.alignment=t.alignment instanceof THREE.Vector2?t.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=true};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);THREE.Scene=function(){THREE.Object3D.call(this);this.overrideMaterial=this.fog=null;this.matrixAutoUpdate=false;this.__objects=[];this.__lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.__addObject=function(t){if(t instanceof THREE.Light)this.__lights.indexOf(t)===-1&&this.__lights.push(t);else if(!(t instanceof THREE.Camera||t instanceof THREE.Bone)&&this.__objects.indexOf(t)===-1){this.__objects.push(t);this.__objectsAdded.push(t);var e=this.__objectsRemoved.indexOf(t);e!==-1&&this.__objectsRemoved.splice(e,1)}for(e=0;e<t.children.length;e++)this.__addObject(t.children[e])};THREE.Scene.prototype.__removeObject=function(t){if(t instanceof THREE.Light){var e=this.__lights.indexOf(t);e!==-1&&this.__lights.splice(e,1)}else if(!(t instanceof THREE.Camera)){e=this.__objects.indexOf(t);if(e!==-1){this.__objects.splice(e,1);this.__objectsRemoved.push(t);e=this.__objectsAdded.indexOf(t);e!==-1&&this.__objectsAdded.splice(e,1)}}for(e=0;e<t.children.length;e++)this.__removeObject(t.children[e])};THREE.Fog=function(t,e,i){this.color=new THREE.Color(t);this.near=e!==void 0?e:1;this.far=i!==void 0?i:1e3};THREE.FogExp2=function(t,e){this.color=new THREE.Color(t);this.density=e!==void 0?e:25e-5};THREE.DOMRenderer=function(){console.log("THREE.DOMRenderer",THREE.REVISION);var t,e,i,o,r,n,a,s=new THREE.Projector;a=function(t){for(var e=document.documentElement,i=0;i<t.length;i++)if(typeof e.style[t[i]]==="string")return t[i];return null}(["transform","MozTransform","WebkitTransform","msTransform","OTransform"]);this.domElement=document.createElement("div");this.setSize=function(t,e){i=t;o=e;r=i/2;n=o/2};this.render=function(i,o){var l,c,h,m,p,u;t=s.projectScene(i,o);e=t.elements;l=0;for(c=e.length;l<c;l++){h=e[l];if(h instanceof THREE.RenderableParticle&&h.material instanceof THREE.ParticleDOMMaterial){m=h.material.domElement;p=h.x*r+r-(m.offsetWidth>>1);u=h.y*n+n-(m.offsetHeight>>1);m.style.left=p+"px";m.style.top=u+"px";m.style.zIndex=Math.abs(Math.floor((1-h.z)*o.far/o.near));a&&(m.style[a]="scale("+h.scale.x*r+","+h.scale.y*n+")")}}}};THREE.CanvasRenderer=function(t){function e(t){if(v!=t)y.globalAlpha=v=t}function i(t){if(x!=t){switch(t){case THREE.NormalBlending:y.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:y.globalCompositeOperation="lighter"}x=t}}function o(t){if(E!=t)y.strokeStyle=E=t}function r(t){if(g!=t)y.fillStyle=g=t}console.log("THREE.CanvasRenderer",THREE.REVISION);var t=t||{},n=this,a,s,l,c=new THREE.Projector,h=t.canvas!==void 0?t.canvas:document.createElement("canvas"),m,p,u,f,y=h.getContext("2d"),d=new THREE.Color(0),_=0,v=1,x=0,E=null,g=null,b=null,T=null,R=null,w,S,C,A,M=new THREE.RenderableVertex,D=new THREE.RenderableVertex,B,H,V,L,P,F,I,U,G,z,N,k,O=new THREE.Color,W=new THREE.Color,j=new THREE.Color,J=new THREE.Color,X=new THREE.Color,q=[],Y=[],K,Z,Q,$,tt,et,it,ot,rt,nt,at=new THREE.Rectangle,st=new THREE.Rectangle,lt=new THREE.Rectangle,ct=false,ht=new THREE.Color,mt=new THREE.Color,pt=new THREE.Color,ut=new THREE.Vector3,ft,yt,dt,_t,vt,xt,t=16;ft=document.createElement("canvas");ft.width=ft.height=2;yt=ft.getContext("2d");yt.fillStyle="rgba(0,0,0,1)";yt.fillRect(0,0,2,2);dt=yt.getImageData(0,0,2,2);_t=dt.data;vt=document.createElement("canvas");vt.width=vt.height=t;xt=vt.getContext("2d");xt.translate(-t/2,-t/2);xt.scale(t,t);t--;this.domElement=h;this.sortElements=this.sortObjects=this.autoClear=true;this.info={render:{vertices:0,faces:0}};this.setSize=function(t,e){m=t;p=e;u=Math.floor(m/2);f=Math.floor(p/2);h.width=m;h.height=p;at.set(-u,-f,u,f);st.set(-u,-f,u,f);v=1;x=0;R=T=b=g=E=null};this.setClearColor=function(t,e){d.copy(t);_=e!==void 0?e:1;st.set(-u,-f,u,f)};this.setClearColorHex=function(t,e){d.setHex(t);_=e!==void 0?e:1;st.set(-u,-f,u,f)};this.clear=function(){y.setTransform(1,0,0,-1,u,f);if(!st.isEmpty()){st.minSelf(at);st.inflate(2);_<1&&y.clearRect(Math.floor(st.getX()),Math.floor(st.getY()),Math.floor(st.getWidth()),Math.floor(st.getHeight()));if(_>0){i(THREE.NormalBlending);e(1);r("rgba("+Math.floor(d.r*255)+","+Math.floor(d.g*255)+","+Math.floor(d.b*255)+","+_+")");y.fillRect(Math.floor(st.getX()),Math.floor(st.getY()),Math.floor(st.getWidth()),Math.floor(st.getHeight()))}st.empty()}};this.render=function(t,h){function m(t){var e,i,o,r;ht.setRGB(0,0,0);mt.setRGB(0,0,0);pt.setRGB(0,0,0);e=0;for(i=t.length;e<i;e++){o=t[e];r=o.color;if(o instanceof THREE.AmbientLight){ht.r=ht.r+r.r;ht.g=ht.g+r.g;ht.b=ht.b+r.b}else if(o instanceof THREE.DirectionalLight){mt.r=mt.r+r.r;mt.g=mt.g+r.g;mt.b=mt.b+r.b}else if(o instanceof THREE.PointLight){pt.r=pt.r+r.r;pt.g=pt.g+r.g;pt.b=pt.b+r.b}}}function p(t,e,i,o){var r,n,a,s,l,c;r=0;for(n=t.length;r<n;r++){a=t[r];s=a.color;if(a instanceof THREE.DirectionalLight){l=a.matrixWorld.getPosition();c=i.dot(l);if(!(c<=0)){c=c*a.intensity;o.r=o.r+s.r*c;o.g=o.g+s.g*c;o.b=o.b+s.b*c}}else if(a instanceof THREE.PointLight){l=a.matrixWorld.getPosition();c=i.dot(ut.sub(l,e).normalize());if(!(c<=0)){c=c*(a.distance==0?1:1-Math.min(e.distanceTo(l)/a.distance,1));if(c!=0){c=c*a.intensity;o.r=o.r+s.r*c;o.g=o.g+s.g*c;o.b=o.b+s.b*c}}}}}function d(t,n,a){e(a.opacity);i(a.blending);var s,l,c,h,m,p;if(a instanceof THREE.ParticleBasicMaterial){if(a.map){h=a.map.image;m=h.width>>1;p=h.height>>1;a=n.scale.x*u;c=n.scale.y*f;s=a*m;l=c*p;lt.set(t.x-s,t.y-l,t.x+s,t.y+l);if(at.intersects(lt)){y.save();y.translate(t.x,t.y);y.rotate(-n.rotation);y.scale(a,-c);y.translate(-m,-p);y.drawImage(h,0,0);y.restore()}}}else if(a instanceof THREE.ParticleCanvasMaterial){s=n.scale.x*u;l=n.scale.y*f;lt.set(t.x-s,t.y-l,t.x+s,t.y+l);if(at.intersects(lt)){o(a.color.getContextStyle());r(a.color.getContextStyle());y.save();y.translate(t.x,t.y);y.rotate(-n.rotation);y.scale(s,l);a.program(y);y.restore()}}}function _(t,r,n,a){e(a.opacity);i(a.blending);y.beginPath();y.moveTo(t.positionScreen.x,t.positionScreen.y);y.lineTo(r.positionScreen.x,r.positionScreen.y);y.closePath();if(a instanceof THREE.LineBasicMaterial){t=a.linewidth;if(b!=t)y.lineWidth=b=t;t=a.linecap;if(T!=t)y.lineCap=T=t;t=a.linejoin;if(R!=t)y.lineJoin=R=t;o(a.color.getContextStyle());y.stroke();lt.inflate(a.linewidth*2)}}function v(t,o,r,a,s,c,m,u){n.info.render.vertices=n.info.render.vertices+3;n.info.render.faces++;e(u.opacity);i(u.blending);B=t.positionScreen.x;H=t.positionScreen.y;V=o.positionScreen.x;L=o.positionScreen.y;P=r.positionScreen.x;F=r.positionScreen.y;E(B,H,V,L,P,F);if(u instanceof THREE.MeshBasicMaterial)if(u.map){if(u.map.mapping instanceof THREE.UVMapping){$=m.uvs[0];bt(B,H,V,L,P,F,$[a].u,$[a].v,$[s].u,$[s].v,$[c].u,$[c].v,u.map)}}else if(u.envMap){if(u.envMap.mapping instanceof THREE.SphericalReflectionMapping){t=h.matrixWorldInverse;ut.copy(m.vertexNormalsWorld[a]);tt=(ut.x*t.elements[0]+ut.y*t.elements[4]+ut.z*t.elements[8])*.5+.5;et=-(ut.x*t.elements[1]+ut.y*t.elements[5]+ut.z*t.elements[9])*.5+.5;ut.copy(m.vertexNormalsWorld[s]);it=(ut.x*t.elements[0]+ut.y*t.elements[4]+ut.z*t.elements[8])*.5+.5;ot=-(ut.x*t.elements[1]+ut.y*t.elements[5]+ut.z*t.elements[9])*.5+.5;ut.copy(m.vertexNormalsWorld[c]);rt=(ut.x*t.elements[0]+ut.y*t.elements[4]+ut.z*t.elements[8])*.5+.5;nt=-(ut.x*t.elements[1]+ut.y*t.elements[5]+ut.z*t.elements[9])*.5+.5;bt(B,H,V,L,P,F,tt,et,it,ot,rt,nt,u.envMap)}}else u.wireframe?Et(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):gt(u.color);else if(u instanceof THREE.MeshLambertMaterial)if(ct)if(!u.wireframe&&u.shading==THREE.SmoothShading&&m.vertexNormalsWorld.length==3){W.r=j.r=J.r=ht.r;W.g=j.g=J.g=ht.g;W.b=j.b=J.b=ht.b;p(l,m.v1.positionWorld,m.vertexNormalsWorld[0],W);p(l,m.v2.positionWorld,m.vertexNormalsWorld[1],j);p(l,m.v3.positionWorld,m.vertexNormalsWorld[2],J);W.r=Math.max(0,Math.min(u.color.r*W.r,1));W.g=Math.max(0,Math.min(u.color.g*W.g,1));W.b=Math.max(0,Math.min(u.color.b*W.b,1));j.r=Math.max(0,Math.min(u.color.r*j.r,1));j.g=Math.max(0,Math.min(u.color.g*j.g,1));j.b=Math.max(0,Math.min(u.color.b*j.b,1));J.r=Math.max(0,Math.min(u.color.r*J.r,1));J.g=Math.max(0,Math.min(u.color.g*J.g,1));J.b=Math.max(0,Math.min(u.color.b*J.b,1));X.r=(j.r+J.r)*.5;X.g=(j.g+J.g)*.5;X.b=(j.b+J.b)*.5;Q=Rt(W,j,J,X);Tt(B,H,V,L,P,F,0,0,1,0,0,1,Q)}else{O.r=ht.r;O.g=ht.g;O.b=ht.b;p(l,m.centroidWorld,m.normalWorld,O);O.r=Math.max(0,Math.min(u.color.r*O.r,1));O.g=Math.max(0,Math.min(u.color.g*O.g,1));O.b=Math.max(0,Math.min(u.color.b*O.b,1));u.wireframe?Et(O,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):gt(O)}else u.wireframe?Et(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):gt(u.color);else if(u instanceof THREE.MeshDepthMaterial){K=h.near;Z=h.far;W.r=W.g=W.b=1-wt(t.positionScreen.z,K,Z);j.r=j.g=j.b=1-wt(o.positionScreen.z,K,Z);J.r=J.g=J.b=1-wt(r.positionScreen.z,K,Z);X.r=(j.r+J.r)*.5;X.g=(j.g+J.g)*.5;X.b=(j.b+J.b)*.5;Q=Rt(W,j,J,X);Tt(B,H,V,L,P,F,0,0,1,0,0,1,Q)}else if(u instanceof THREE.MeshNormalMaterial){O.r=St(m.normalWorld.x);O.g=St(m.normalWorld.y);O.b=St(m.normalWorld.z);u.wireframe?Et(O,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):gt(O)}}function x(t,o,r,a,s,c,m,u,f){n.info.render.vertices=n.info.render.vertices+4;n.info.render.faces++;e(u.opacity);i(u.blending);if(u.map||u.envMap){v(t,o,a,0,1,3,m,u,f);v(s,r,c,1,2,3,m,u,f)}else{B=t.positionScreen.x;H=t.positionScreen.y;V=o.positionScreen.x;L=o.positionScreen.y;P=r.positionScreen.x;F=r.positionScreen.y;I=a.positionScreen.x;U=a.positionScreen.y;G=s.positionScreen.x;z=s.positionScreen.y;N=c.positionScreen.x;k=c.positionScreen.y;if(u instanceof THREE.MeshBasicMaterial){g(B,H,V,L,P,F,I,U);u.wireframe?Et(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):gt(u.color)}else if(u instanceof THREE.MeshLambertMaterial)if(ct)if(!u.wireframe&&u.shading==THREE.SmoothShading&&m.vertexNormalsWorld.length==4){W.r=j.r=J.r=X.r=ht.r;W.g=j.g=J.g=X.g=ht.g;W.b=j.b=J.b=X.b=ht.b;p(l,m.v1.positionWorld,m.vertexNormalsWorld[0],W);p(l,m.v2.positionWorld,m.vertexNormalsWorld[1],j);p(l,m.v4.positionWorld,m.vertexNormalsWorld[3],J);p(l,m.v3.positionWorld,m.vertexNormalsWorld[2],X);W.r=Math.max(0,Math.min(u.color.r*W.r,1));W.g=Math.max(0,Math.min(u.color.g*W.g,1));W.b=Math.max(0,Math.min(u.color.b*W.b,1));j.r=Math.max(0,Math.min(u.color.r*j.r,1));j.g=Math.max(0,Math.min(u.color.g*j.g,1));j.b=Math.max(0,Math.min(u.color.b*j.b,1));J.r=Math.max(0,Math.min(u.color.r*J.r,1));J.g=Math.max(0,Math.min(u.color.g*J.g,1));J.b=Math.max(0,Math.min(u.color.b*J.b,1));X.r=Math.max(0,Math.min(u.color.r*X.r,1));X.g=Math.max(0,Math.min(u.color.g*X.g,1));X.b=Math.max(0,Math.min(u.color.b*X.b,1));Q=Rt(W,j,J,X);E(B,H,V,L,I,U);Tt(B,H,V,L,I,U,0,0,1,0,0,1,Q);E(G,z,P,F,N,k);Tt(G,z,P,F,N,k,1,0,1,1,0,1,Q)}else{O.r=ht.r;O.g=ht.g;O.b=ht.b;p(l,m.centroidWorld,m.normalWorld,O);O.r=Math.max(0,Math.min(u.color.r*O.r,1));O.g=Math.max(0,Math.min(u.color.g*O.g,1));O.b=Math.max(0,Math.min(u.color.b*O.b,1));g(B,H,V,L,P,F,I,U);u.wireframe?Et(O,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):gt(O)}else{g(B,H,V,L,P,F,I,U);u.wireframe?Et(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):gt(u.color)}else if(u instanceof THREE.MeshNormalMaterial){O.r=St(m.normalWorld.x);O.g=St(m.normalWorld.y);O.b=St(m.normalWorld.z);g(B,H,V,L,P,F,I,U);u.wireframe?Et(O,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):gt(O)}else if(u instanceof THREE.MeshDepthMaterial){K=h.near;Z=h.far;W.r=W.g=W.b=1-wt(t.positionScreen.z,K,Z);j.r=j.g=j.b=1-wt(o.positionScreen.z,K,Z);J.r=J.g=J.b=1-wt(a.positionScreen.z,K,Z);X.r=X.g=X.b=1-wt(r.positionScreen.z,K,Z);Q=Rt(W,j,J,X);E(B,H,V,L,I,U);Tt(B,H,V,L,I,U,0,0,1,0,0,1,Q);E(G,z,P,F,N,k);Tt(G,z,P,F,N,k,1,0,1,1,0,1,Q)}}}function E(t,e,i,o,r,n){y.beginPath();y.moveTo(t,e);y.lineTo(i,o);y.lineTo(r,n);y.lineTo(t,e);y.closePath()}function g(t,e,i,o,r,n,a,s){y.beginPath();y.moveTo(t,e);y.lineTo(i,o);y.lineTo(r,n);y.lineTo(a,s);y.lineTo(t,e);y.closePath()}function Et(t,e,i,r){if(b!=e)y.lineWidth=b=e;if(T!=i)y.lineCap=T=i;if(R!=r)y.lineJoin=R=r;o(t.getContextStyle());y.stroke();lt.inflate(e*2)}function gt(t){r(t.getContextStyle());y.fill()}function bt(t,e,i,o,n,a,s,l,c,h,m,p,u){if(u.image.width!=0){if(u.needsUpdate==true||q[u.id]==void 0){var f=u.wrapS==THREE.RepeatWrapping,d=u.wrapT==THREE.RepeatWrapping;q[u.id]=y.createPattern(u.image,f&&d?"repeat":f&&!d?"repeat-x":!f&&d?"repeat-y":"no-repeat");u.needsUpdate=false}r(q[u.id]);var f=u.offset.x/u.repeat.x,d=u.offset.y/u.repeat.y,_=u.image.width*u.repeat.x,v=u.image.height*u.repeat.y,s=(s+f)*_,l=(l+d)*v,i=i-t,o=o-e,n=n-t,a=a-e,c=(c+f)*_-s,h=(h+d)*v-l,m=(m+f)*_-s,p=(p+d)*v-l,f=c*p-m*h;if(f==0){if(Y[u.id]===void 0){e=document.createElement("canvas");e.width=u.image.width;e.height=u.image.height;e=e.getContext("2d");e.drawImage(u.image,0,0);Y[u.id]=e.getImageData(0,0,u.image.width,u.image.height).data}e=Y[u.id];s=(Math.floor(s)+Math.floor(l)*u.image.width)*4;O.setRGB(e[s]/255,e[s+1]/255,e[s+2]/255);gt(O)}else{f=1/f;u=(p*i-h*n)*f;h=(p*o-h*a)*f;i=(c*n-m*i)*f;o=(c*a-m*o)*f;t=t-u*s-i*l;s=e-h*s-o*l;y.save();y.transform(u,h,i,o,t,s);y.fill();y.restore()}}}function Tt(t,e,i,o,r,n,a,s,l,c,h,m,p){var u,f;u=p.width-1;f=p.height-1;a=a*u;s=s*f;i=i-t;o=o-e;r=r-t;n=n-e;l=l*u-a;c=c*f-s;h=h*u-a;m=m*f-s;f=1/(l*m-h*c);u=(m*i-c*r)*f;c=(m*o-c*n)*f;i=(l*r-h*i)*f;o=(l*n-h*o)*f;t=t-u*a-i*s;e=e-c*a-o*s;y.save();y.transform(u,c,i,o,t,e);y.clip();y.drawImage(p,0,0);y.restore()}function Rt(t,e,i,o){var r=~~(t.r*255),n=~~(t.g*255),t=~~(t.b*255),a=~~(e.r*255),s=~~(e.g*255),e=~~(e.b*255),l=~~(i.r*255),c=~~(i.g*255),i=~~(i.b*255),h=~~(o.r*255),m=~~(o.g*255),o=~~(o.b*255);_t[0]=r<0?0:r>255?255:r;_t[1]=n<0?0:n>255?255:n;_t[2]=t<0?0:t>255?255:t;_t[4]=a<0?0:a>255?255:a;_t[5]=s<0?0:s>255?255:s;_t[6]=e<0?0:e>255?255:e;_t[8]=l<0?0:l>255?255:l;_t[9]=c<0?0:c>255?255:c;_t[10]=i<0?0:i>255?255:i;_t[12]=h<0?0:h>255?255:h;_t[13]=m<0?0:m>255?255:m;_t[14]=o<0?0:o>255?255:o;yt.putImageData(dt,0,0);xt.drawImage(ft,0,0);return vt}function wt(t,e,i){t=(t-e)/(i-e);return t*t*(3-2*t)}function St(t){t=(t+1)*.5;return t<0?0:t>1?1:t}function Ct(t,e){var i=e.x-t.x,o=e.y-t.y,r=i*i+o*o;if(r!=0){r=1/Math.sqrt(r);i=i*r;o=o*r;e.x=e.x+i;e.y=e.y+o;t.x=t.x-i;t.y=t.y-o}}var At,Mt,Dt,Bt;this.autoClear?this.clear():y.setTransform(1,0,0,-1,u,f);n.info.render.vertices=0;n.info.render.faces=0;a=c.projectScene(t,h,this.sortElements);s=a.elements;l=a.lights;(ct=l.length>0)&&m(l);At=0;for(Mt=s.length;At<Mt;At++){Dt=s[At];Bt=Dt.material;Bt=Bt instanceof THREE.MeshFaceMaterial?Dt.faceMaterial:Bt;if(!(Bt===void 0||Bt.visible===false)){lt.empty();if(Dt instanceof THREE.RenderableParticle){w=Dt;w.x=w.x*u;w.y=w.y*f;d(w,Dt,Bt,t)}else if(Dt instanceof THREE.RenderableLine){w=Dt.v1;S=Dt.v2;w.positionScreen.x=w.positionScreen.x*u;w.positionScreen.y=w.positionScreen.y*f;S.positionScreen.x=S.positionScreen.x*u;S.positionScreen.y=S.positionScreen.y*f;lt.addPoint(w.positionScreen.x,w.positionScreen.y);lt.addPoint(S.positionScreen.x,S.positionScreen.y);at.intersects(lt)&&_(w,S,Dt,Bt,t)}else if(Dt instanceof THREE.RenderableFace3){w=Dt.v1;S=Dt.v2;C=Dt.v3;w.positionScreen.x=w.positionScreen.x*u;w.positionScreen.y=w.positionScreen.y*f;S.positionScreen.x=S.positionScreen.x*u;S.positionScreen.y=S.positionScreen.y*f;C.positionScreen.x=C.positionScreen.x*u;C.positionScreen.y=C.positionScreen.y*f;if(Bt.overdraw){Ct(w.positionScreen,S.positionScreen);Ct(S.positionScreen,C.positionScreen);Ct(C.positionScreen,w.positionScreen)}lt.add3Points(w.positionScreen.x,w.positionScreen.y,S.positionScreen.x,S.positionScreen.y,C.positionScreen.x,C.positionScreen.y);at.intersects(lt)&&v(w,S,C,0,1,2,Dt,Bt,t)}else if(Dt instanceof THREE.RenderableFace4){w=Dt.v1;S=Dt.v2;C=Dt.v3;A=Dt.v4;w.positionScreen.x=w.positionScreen.x*u;w.positionScreen.y=w.positionScreen.y*f;S.positionScreen.x=S.positionScreen.x*u;S.positionScreen.y=S.positionScreen.y*f;C.positionScreen.x=C.positionScreen.x*u;C.positionScreen.y=C.positionScreen.y*f;A.positionScreen.x=A.positionScreen.x*u;A.positionScreen.y=A.positionScreen.y*f;M.positionScreen.copy(S.positionScreen);D.positionScreen.copy(A.positionScreen);if(Bt.overdraw){Ct(w.positionScreen,S.positionScreen);Ct(S.positionScreen,A.positionScreen);Ct(A.positionScreen,w.positionScreen);Ct(C.positionScreen,M.positionScreen);Ct(C.positionScreen,D.positionScreen)}lt.addPoint(w.positionScreen.x,w.positionScreen.y);lt.addPoint(S.positionScreen.x,S.positionScreen.y);lt.addPoint(C.positionScreen.x,C.positionScreen.y);lt.addPoint(A.positionScreen.x,A.positionScreen.y);at.intersects(lt)&&x(w,S,C,A,M,D,Dt,Bt,t)}st.addRectangle(lt)}}y.setTransform(1,0,0,1,0,0)}};THREE.SVGRenderer=function(){function t(t,e,i,o){var r,n,a,s,l,c;r=0;for(n=t.length;r<n;r++){a=t[r];s=a.color;if(a instanceof THREE.DirectionalLight){l=a.matrixWorld.getPosition();c=i.dot(l);if(!(c<=0)){c=c*a.intensity;o.r=o.r+s.r*c;o.g=o.g+s.g*c;o.b=o.b+s.b*c}}else if(a instanceof THREE.PointLight){l=a.matrixWorld.getPosition();c=i.dot(w.sub(l,e).normalize());if(!(c<=0)){c=c*(a.distance==0?1:1-Math.min(e.distanceTo(l)/a.distance,1));if(c!=0){c=c*a.intensity;o.r=o.r+s.r*c;o.g=o.g+s.g*c;o.b=o.b+s.b*c}}}}}function e(t){if(S[t]==null){S[t]=document.createElementNS("http://www.w3.org/2000/svg","path");B==0&&S[t].setAttribute("shape-rendering","crispEdges")}return S[t]}function i(t){t=(t+1)*.5;return t<0?0:t>1?1:t}console.log("THREE.SVGRenderer",THREE.REVISION);var o=this,r,n,a,s=new THREE.Projector,l=document.createElementNS("http://www.w3.org/2000/svg","svg"),c,h,m,p,u,f,y,d,_=new THREE.Rectangle,v=new THREE.Rectangle,x=false,E=new THREE.Color,g=new THREE.Color,b=new THREE.Color,T=new THREE.Color,R,w=new THREE.Vector3,S=[],C=[],A,M,D,B=1;this.domElement=l;this.sortElements=this.sortObjects=this.autoClear=true;this.info={render:{vertices:0,faces:0}};this.setQuality=function(t){switch(t){case"high":B=1;break;case"low":B=0}};this.setSize=function(t,e){c=t;h=e;m=c/2;p=h/2;l.setAttribute("viewBox",-m+" "+-p+" "+c+" "+h);l.setAttribute("width",c);l.setAttribute("height",h);_.set(-m,-p,m,p)};this.clear=function(){for(;l.childNodes.length>0;)l.removeChild(l.childNodes[0])};this.render=function(c,h){var w,S,H,V;this.autoClear&&this.clear();o.info.render.vertices=0;o.info.render.faces=0;r=s.projectScene(c,h,this.sortElements);n=r.elements;a=r.lights;D=M=0;if(x=a.length>0){g.setRGB(0,0,0);b.setRGB(0,0,0);T.setRGB(0,0,0);w=0;for(S=a.length;w<S;w++){V=a[w];H=V.color;if(V instanceof THREE.AmbientLight){g.r=g.r+H.r;g.g=g.g+H.g;g.b=g.b+H.b}else if(V instanceof THREE.DirectionalLight){b.r=b.r+H.r;b.g=b.g+H.g;b.b=b.b+H.b}else if(V instanceof THREE.PointLight){T.r=T.r+H.r;T.g=T.g+H.g;T.b=T.b+H.b}}}w=0;for(S=n.length;w<S;w++){H=n[w];V=H.material;V=V instanceof THREE.MeshFaceMaterial?H.faceMaterial:V;if(!(V===void 0||V.visible===false)){v.empty();if(H instanceof THREE.RenderableParticle){u=H;u.x=u.x*m;u.y=u.y*-p}else if(H instanceof THREE.RenderableLine){u=H.v1;f=H.v2;u.positionScreen.x=u.positionScreen.x*m;u.positionScreen.y=u.positionScreen.y*-p;f.positionScreen.x=f.positionScreen.x*m;f.positionScreen.y=f.positionScreen.y*-p;v.addPoint(u.positionScreen.x,u.positionScreen.y);v.addPoint(f.positionScreen.x,f.positionScreen.y);if(_.intersects(v)){H=u;var L=f,P=D++;if(C[P]==null){C[P]=document.createElementNS("http://www.w3.org/2000/svg","line");B==0&&C[P].setAttribute("shape-rendering","crispEdges")}A=C[P];A.setAttribute("x1",H.positionScreen.x);A.setAttribute("y1",H.positionScreen.y);A.setAttribute("x2",L.positionScreen.x);A.setAttribute("y2",L.positionScreen.y);if(V instanceof THREE.LineBasicMaterial){A.setAttribute("style","fill: none; stroke: "+V.color.getContextStyle()+"; stroke-width: "+V.linewidth+"; stroke-opacity: "+V.opacity+"; stroke-linecap: "+V.linecap+"; stroke-linejoin: "+V.linejoin);l.appendChild(A)}}}else if(H instanceof THREE.RenderableFace3){u=H.v1;f=H.v2;y=H.v3;u.positionScreen.x=u.positionScreen.x*m;u.positionScreen.y=u.positionScreen.y*-p;f.positionScreen.x=f.positionScreen.x*m;f.positionScreen.y=f.positionScreen.y*-p;y.positionScreen.x=y.positionScreen.x*m;y.positionScreen.y=y.positionScreen.y*-p;v.addPoint(u.positionScreen.x,u.positionScreen.y);v.addPoint(f.positionScreen.x,f.positionScreen.y);v.addPoint(y.positionScreen.x,y.positionScreen.y);if(_.intersects(v)){var L=u,P=f,F=y;o.info.render.vertices=o.info.render.vertices+3;o.info.render.faces++;A=e(M++);A.setAttribute("d","M "+L.positionScreen.x+" "+L.positionScreen.y+" L "+P.positionScreen.x+" "+P.positionScreen.y+" L "+F.positionScreen.x+","+F.positionScreen.y+"z");if(V instanceof THREE.MeshBasicMaterial)E.copy(V.color);else if(V instanceof THREE.MeshLambertMaterial)if(x){E.r=g.r;E.g=g.g;E.b=g.b;t(a,H.centroidWorld,H.normalWorld,E);E.r=Math.max(0,Math.min(V.color.r*E.r,1));E.g=Math.max(0,Math.min(V.color.g*E.g,1));E.b=Math.max(0,Math.min(V.color.b*E.b,1))}else E.copy(V.color);else if(V instanceof THREE.MeshDepthMaterial){R=1-V.__2near/(V.__farPlusNear-H.z*V.__farMinusNear);E.setRGB(R,R,R)}else V instanceof THREE.MeshNormalMaterial&&E.setRGB(i(H.normalWorld.x),i(H.normalWorld.y),i(H.normalWorld.z));V.wireframe?A.setAttribute("style","fill: none; stroke: "+E.getContextStyle()+"; stroke-width: "+V.wireframeLinewidth+"; stroke-opacity: "+V.opacity+"; stroke-linecap: "+V.wireframeLinecap+"; stroke-linejoin: "+V.wireframeLinejoin):A.setAttribute("style","fill: "+E.getContextStyle()+"; fill-opacity: "+V.opacity);l.appendChild(A)}}else if(H instanceof THREE.RenderableFace4){u=H.v1;f=H.v2;y=H.v3;d=H.v4;u.positionScreen.x=u.positionScreen.x*m;u.positionScreen.y=u.positionScreen.y*-p;f.positionScreen.x=f.positionScreen.x*m;f.positionScreen.y=f.positionScreen.y*-p;y.positionScreen.x=y.positionScreen.x*m;y.positionScreen.y=y.positionScreen.y*-p;d.positionScreen.x=d.positionScreen.x*m;d.positionScreen.y=d.positionScreen.y*-p;v.addPoint(u.positionScreen.x,u.positionScreen.y);v.addPoint(f.positionScreen.x,f.positionScreen.y);v.addPoint(y.positionScreen.x,y.positionScreen.y);v.addPoint(d.positionScreen.x,d.positionScreen.y);if(_.intersects(v)){var L=u,P=f,F=y,I=d;o.info.render.vertices=o.info.render.vertices+4;o.info.render.faces++;A=e(M++);A.setAttribute("d","M "+L.positionScreen.x+" "+L.positionScreen.y+" L "+P.positionScreen.x+" "+P.positionScreen.y+" L "+F.positionScreen.x+","+F.positionScreen.y+" L "+I.positionScreen.x+","+I.positionScreen.y+"z");if(V instanceof THREE.MeshBasicMaterial)E.copy(V.color);else if(V instanceof THREE.MeshLambertMaterial)if(x){E.r=g.r;E.g=g.g;E.b=g.b;t(a,H.centroidWorld,H.normalWorld,E);E.r=Math.max(0,Math.min(V.color.r*E.r,1));E.g=Math.max(0,Math.min(V.color.g*E.g,1));E.b=Math.max(0,Math.min(V.color.b*E.b,1))}else E.copy(V.color);else if(V instanceof THREE.MeshDepthMaterial){R=1-V.__2near/(V.__farPlusNear-H.z*V.__farMinusNear);E.setRGB(R,R,R)}else V instanceof THREE.MeshNormalMaterial&&E.setRGB(i(H.normalWorld.x),i(H.normalWorld.y),i(H.normalWorld.z));V.wireframe?A.setAttribute("style","fill: none; stroke: "+E.getContextStyle()+"; stroke-width: "+V.wireframeLinewidth+"; stroke-opacity: "+V.opacity+"; stroke-linecap: "+V.wireframeLinecap+"; stroke-linejoin: "+V.wireframeLinejoin):A.setAttribute("style","fill: "+E.getContextStyle()+"; fill-opacity: "+V.opacity);l.appendChild(A)}}}}}};THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nlVector = normalize( lVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - mPosition.xyz ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvWorldPosition = mPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * modelViewMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\nvec3 transformedNormal = normalMatrix * morphedNormal;\n#else\nvec3 transformedNormal = normalMatrix * normal;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n#ifdef USE_MORPHTARGETS\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( morphed, 1.0 );\n#else\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n#endif\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"};THREE.UniformsUtils={merge:function(t){var e,i,o,r={};for(e=0;e<t.length;e++){o=this.clone(t[e]);for(i in o)r[i]=o[i]}return r},clone:function(t){var e,i,o,r={};for(e in t){r[e]={};for(i in t[e]){o=t[e][i];r[e][i]=o instanceof THREE.Color||o instanceof THREE.Vector2||o instanceof THREE.Vector3||o instanceof THREE.Vector4||o instanceof THREE.Matrix4||o instanceof THREE.Texture?o.clone():o instanceof Array?o.slice():o}}return r}};THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngle:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};THREE.ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalMatrix * normal;\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["varying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif",THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.morphnormal_vertex,"vNormal = transformedNormal;",THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}};THREE.WebGLRenderer=function(t){function e(t,e){var i=t.vertices.length,o=e.material;if(o.attributes){if(t.__webglCustomAttributesList===void 0)t.__webglCustomAttributesList=[];for(var r in o.attributes){var n=o.attributes[r];if(!n.__webglInitialized||n.createUniqueBuffers){n.__webglInitialized=true;var a=1;n.type==="v2"?a=2:n.type==="v3"?a=3:n.type==="v4"?a=4:n.type==="c"&&(a=3);n.size=a;n.array=new Float32Array(i*a);n.buffer=L.createBuffer();n.buffer.belongsToAttribute=r;n.needsUpdate=true}t.__webglCustomAttributesList.push(n)}}}function i(t,e){if(t.material&&!(t.material instanceof THREE.MeshFaceMaterial))return t.material;if(e.materialIndex>=0)return t.geometry.materials[e.materialIndex]}function o(t){return t instanceof THREE.MeshBasicMaterial&&!t.envMap||t instanceof THREE.MeshDepthMaterial?false:t&&t.shading!==void 0&&t.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function r(t){return t.map||t.lightMap||t instanceof THREE.ShaderMaterial?true:false}function n(t,e,i){var o,r,n,a,s=t.vertices;a=s.length;var l=t.colors,c=l.length,h=t.__vertexArray,m=t.__colorArray,p=t.__sortArray,u=t.verticesNeedUpdate,f=t.colorsNeedUpdate,y=t.__webglCustomAttributesList;if(i.sortParticles){lt.copy(st);lt.multiplySelf(i.matrixWorld);for(o=0;o<a;o++){r=s[o];ct.copy(r);lt.multiplyVector3(ct);p[o]=[ct.z,o]}p.sort((function(t,e){return e[0]-t[0]}));for(o=0;o<a;o++){r=s[p[o][1]];n=o*3;h[n]=r.x;h[n+1]=r.y;h[n+2]=r.z}for(o=0;o<c;o++){n=o*3;r=l[p[o][1]];m[n]=r.r;m[n+1]=r.g;m[n+2]=r.b}if(y){l=0;for(c=y.length;l<c;l++){s=y[l];if(s.boundTo===void 0||s.boundTo==="vertices"){n=0;r=s.value.length;if(s.size===1)for(o=0;o<r;o++){a=p[o][1];s.array[o]=s.value[a]}else if(s.size===2)for(o=0;o<r;o++){a=p[o][1];a=s.value[a];s.array[n]=a.x;s.array[n+1]=a.y;n=n+2}else if(s.size===3)if(s.type==="c")for(o=0;o<r;o++){a=p[o][1];a=s.value[a];s.array[n]=a.r;s.array[n+1]=a.g;s.array[n+2]=a.b;n=n+3}else for(o=0;o<r;o++){a=p[o][1];a=s.value[a];s.array[n]=a.x;s.array[n+1]=a.y;s.array[n+2]=a.z;n=n+3}else if(s.size===4)for(o=0;o<r;o++){a=p[o][1];a=s.value[a];s.array[n]=a.x;s.array[n+1]=a.y;s.array[n+2]=a.z;s.array[n+3]=a.w;n=n+4}}}}}else{if(u)for(o=0;o<a;o++){r=s[o];n=o*3;h[n]=r.x;h[n+1]=r.y;h[n+2]=r.z}if(f)for(o=0;o<c;o++){r=l[o];n=o*3;m[n]=r.r;m[n+1]=r.g;m[n+2]=r.b}if(y){l=0;for(c=y.length;l<c;l++){s=y[l];if(s.needsUpdate&&(s.boundTo===void 0||s.boundTo==="vertices")){r=s.value.length;n=0;if(s.size===1)for(o=0;o<r;o++)s.array[o]=s.value[o];else if(s.size===2)for(o=0;o<r;o++){a=s.value[o];s.array[n]=a.x;s.array[n+1]=a.y;n=n+2}else if(s.size===3)if(s.type==="c")for(o=0;o<r;o++){a=s.value[o];s.array[n]=a.r;s.array[n+1]=a.g;s.array[n+2]=a.b;n=n+3}else for(o=0;o<r;o++){a=s.value[o];s.array[n]=a.x;s.array[n+1]=a.y;s.array[n+2]=a.z;n=n+3}else if(s.size===4)for(o=0;o<r;o++){a=s.value[o];s.array[n]=a.x;s.array[n+1]=a.y;s.array[n+2]=a.z;s.array[n+3]=a.w;n=n+4}}}}}if(u||i.sortParticles){L.bindBuffer(L.ARRAY_BUFFER,t.__webglVertexBuffer);L.bufferData(L.ARRAY_BUFFER,h,e)}if(f||i.sortParticles){L.bindBuffer(L.ARRAY_BUFFER,t.__webglColorBuffer);L.bufferData(L.ARRAY_BUFFER,m,e)}if(y){l=0;for(c=y.length;l<c;l++){s=y[l];if(s.needsUpdate||i.sortParticles){L.bindBuffer(L.ARRAY_BUFFER,s.buffer);L.bufferData(L.ARRAY_BUFFER,s.array,e)}}}}function a(t,e){return e.z-t.z}function s(t,e,i){if(t.length)for(var o=0,r=t.length;o<r;o++){z=F=null;U=G=O=k=Y=q=W=-1;mt=true;t[o].render(e,i,rt,nt);z=F=null;U=G=O=k=Y=q=W=-1;mt=true}}function l(t,e,i,o,r,n,a,s){var l,c,h,m;if(e){c=t.length-1;m=e=-1}else{c=0;e=t.length;m=1}for(var p=c;p!==e;p=p+m){l=t[p];if(l.render){c=l.object;h=l.buffer;if(s)l=s;else{l=l[i];if(!l)continue;a&&V.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst);V.setDepthTest(l.depthTest);V.setDepthWrite(l.depthWrite);_(l.polygonOffset,l.polygonOffsetFactor,l.polygonOffsetUnits)}V.setObjectFaces(c);h instanceof THREE.BufferGeometry?V.renderBufferDirect(o,r,n,l,h,c):V.renderBuffer(o,r,n,l,h,c)}}}function c(t,e,i,o,r,n,a){for(var s,l,c=0,h=t.length;c<h;c++){s=t[c];l=s.object;if(l.visible){if(a)s=a;else{s=s[e];if(!s)continue;n&&V.setBlending(s.blending,s.blendEquation,s.blendSrc,s.blendDst);V.setDepthTest(s.depthTest);V.setDepthWrite(s.depthWrite);_(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits)}V.renderImmediateObject(i,o,r,s,l)}}}function h(t,e,i){t.push({buffer:e,object:i,opaque:null,transparent:null})}function m(t){for(var e in t.attributes)if(t.attributes[e].needsUpdate)return true;return false}function p(t){for(var e in t.attributes)t.attributes[e].needsUpdate=false}function u(t,e){for(var i=t.length-1;i>=0;i--)t[i].object===e&&t.splice(i,1)}function f(t,e){for(var i=t.length-1;i>=0;i--)t[i]===e&&t.splice(i,1)}function y(t,e,i,o,r){if(!o.program||o.needsUpdate){V.initMaterial(o,e,i,r);o.needsUpdate=false}if(o.morphTargets&&!r.__webglMorphTargetInfluences){r.__webglMorphTargetInfluences=new Float32Array(V.maxMorphTargets);for(var n=0,a=V.maxMorphTargets;n<a;n++)r.__webglMorphTargetInfluences[n]=0}var s=false,n=o.program,a=n.uniforms,l=o.uniforms;if(n!==F){L.useProgram(n);F=n;s=true}if(o.id!==U){U=o.id;s=true}if(s||t!==z){L.uniformMatrix4fv(a.projectionMatrix,false,t._projectionMatrixArray);t!==z&&(z=t)}if(s){if(i&&o.fog){l.fogColor.value=i.color;if(i instanceof THREE.Fog){l.fogNear.value=i.near;l.fogFar.value=i.far}else if(i instanceof THREE.FogExp2)l.fogDensity.value=i.density}if(o instanceof THREE.MeshPhongMaterial||o instanceof THREE.MeshLambertMaterial||o.lights){if(mt){for(var c,h=0,m=0,p=0,u,f,y,d=pt,_=d.directional.colors,v=d.directional.positions,E=d.point.colors,g=d.point.positions,R=d.point.distances,w=d.spot.colors,S=d.spot.positions,C=d.spot.distances,A=d.spot.directions,M=d.spot.angles,D=d.spot.exponents,B=0,H=0,P=0,I=y=0,i=I=0,s=e.length;i<s;i++){c=e[i];if(!c.onlyShadow){u=c.color;f=c.intensity;y=c.distance;if(c instanceof THREE.AmbientLight)if(V.gammaInput){h=h+u.r*u.r;m=m+u.g*u.g;p=p+u.b*u.b}else{h=h+u.r;m=m+u.g;p=p+u.b}else if(c instanceof THREE.DirectionalLight){y=B*3;if(V.gammaInput){_[y]=u.r*u.r*f*f;_[y+1]=u.g*u.g*f*f;_[y+2]=u.b*u.b*f*f}else{_[y]=u.r*f;_[y+1]=u.g*f;_[y+2]=u.b*f}ht.copy(c.matrixWorld.getPosition());ht.subSelf(c.target.matrixWorld.getPosition());ht.normalize();v[y]=ht.x;v[y+1]=ht.y;v[y+2]=ht.z;B=B+1}else if(c instanceof THREE.PointLight){I=H*3;if(V.gammaInput){E[I]=u.r*u.r*f*f;E[I+1]=u.g*u.g*f*f;E[I+2]=u.b*u.b*f*f}else{E[I]=u.r*f;E[I+1]=u.g*f;E[I+2]=u.b*f}u=c.matrixWorld.getPosition();g[I]=u.x;g[I+1]=u.y;g[I+2]=u.z;R[H]=y;H=H+1}else if(c instanceof THREE.SpotLight){I=P*3;if(V.gammaInput){w[I]=u.r*u.r*f*f;w[I+1]=u.g*u.g*f*f;w[I+2]=u.b*u.b*f*f}else{w[I]=u.r*f;w[I+1]=u.g*f;w[I+2]=u.b*f}u=c.matrixWorld.getPosition();S[I]=u.x;S[I+1]=u.y;S[I+2]=u.z;C[P]=y;ht.copy(u);ht.subSelf(c.target.matrixWorld.getPosition());ht.normalize();A[I]=ht.x;A[I+1]=ht.y;A[I+2]=ht.z;M[P]=Math.cos(c.angle);D[P]=c.exponent;P=P+1}}}i=B*3;for(s=_.length;i<s;i++)_[i]=0;i=H*3;for(s=E.length;i<s;i++)E[i]=0;i=P*3;for(s=w.length;i<s;i++)w[i]=0;d.directional.length=B;d.point.length=H;d.spot.length=P;d.ambient[0]=h;d.ambient[1]=m;d.ambient[2]=p;mt=false}i=pt;l.ambientLightColor.value=i.ambient;l.directionalLightColor.value=i.directional.colors;l.directionalLightDirection.value=i.directional.positions;l.pointLightColor.value=i.point.colors;l.pointLightPosition.value=i.point.positions;l.pointLightDistance.value=i.point.distances;l.spotLightColor.value=i.spot.colors;l.spotLightPosition.value=i.spot.positions;l.spotLightDistance.value=i.spot.distances;l.spotLightDirection.value=i.spot.directions;l.spotLightAngle.value=i.spot.angles;l.spotLightExponent.value=i.spot.exponents}if(o instanceof THREE.MeshBasicMaterial||o instanceof THREE.MeshLambertMaterial||o instanceof THREE.MeshPhongMaterial){l.opacity.value=o.opacity;V.gammaInput?l.diffuse.value.copyGammaToLinear(o.color):l.diffuse.value=o.color;(l.map.texture=o.map)&&l.offsetRepeat.value.set(o.map.offset.x,o.map.offset.y,o.map.repeat.x,o.map.repeat.y);l.lightMap.texture=o.lightMap;l.envMap.texture=o.envMap;l.flipEnvMap.value=o.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;l.reflectivity.value=o.reflectivity;l.refractionRatio.value=o.refractionRatio;l.combine.value=o.combine;l.useRefract.value=o.envMap&&o.envMap.mapping instanceof THREE.CubeRefractionMapping}if(o instanceof THREE.LineBasicMaterial){l.diffuse.value=o.color;l.opacity.value=o.opacity}else if(o instanceof THREE.ParticleBasicMaterial){l.psColor.value=o.color;l.opacity.value=o.opacity;l.size.value=o.size;l.scale.value=T.height/2;l.map.texture=o.map}else if(o instanceof THREE.MeshPhongMaterial){l.shininess.value=o.shininess;if(V.gammaInput){l.ambient.value.copyGammaToLinear(o.ambient);l.emissive.value.copyGammaToLinear(o.emissive);l.specular.value.copyGammaToLinear(o.specular)}else{l.ambient.value=o.ambient;l.emissive.value=o.emissive;l.specular.value=o.specular}o.wrapAround&&l.wrapRGB.value.copy(o.wrapRGB)}else if(o instanceof THREE.MeshLambertMaterial){if(V.gammaInput){l.ambient.value.copyGammaToLinear(o.ambient);l.emissive.value.copyGammaToLinear(o.emissive)}else{l.ambient.value=o.ambient;l.emissive.value=o.emissive}o.wrapAround&&l.wrapRGB.value.copy(o.wrapRGB)}else if(o instanceof THREE.MeshDepthMaterial){l.mNear.value=t.near;l.mFar.value=t.far;l.opacity.value=o.opacity}else if(o instanceof THREE.MeshNormalMaterial)l.opacity.value=o.opacity;if(r.receiveShadow&&!o._shadowPass&&l.shadowMatrix){s=i=0;for(c=e.length;s<c;s++){h=e[s];if(h.castShadow&&(h instanceof THREE.SpotLight||h instanceof THREE.DirectionalLight&&!h.shadowCascade)){l.shadowMap.texture[i]=h.shadowMap;l.shadowMapSize.value[i]=h.shadowMapSize;l.shadowMatrix.value[i]=h.shadowMatrix;l.shadowDarkness.value[i]=h.shadowDarkness;l.shadowBias.value[i]=h.shadowBias;i++}}}e=o.uniformsList;l=0;for(i=e.length;l<i;l++)if(h=n.uniforms[e[l][1]]){s=e[l][0];m=s.type;c=s.value;switch(m){case"i":L.uniform1i(h,c);break;case"f":L.uniform1f(h,c);break;case"v2":L.uniform2f(h,c.x,c.y);break;case"v3":L.uniform3f(h,c.x,c.y,c.z);break;case"v4":L.uniform4f(h,c.x,c.y,c.z,c.w);break;case"c":L.uniform3f(h,c.r,c.g,c.b);break;case"fv1":L.uniform1fv(h,c);break;case"fv":L.uniform3fv(h,c);break;case"v2v":if(!s._array)s._array=new Float32Array(2*c.length);m=0;for(p=c.length;m<p;m++){d=m*2;s._array[d]=c[m].x;s._array[d+1]=c[m].y}L.uniform2fv(h,s._array);break;case"v3v":if(!s._array)s._array=new Float32Array(3*c.length);m=0;for(p=c.length;m<p;m++){d=m*3;s._array[d]=c[m].x;s._array[d+1]=c[m].y;s._array[d+2]=c[m].z}L.uniform3fv(h,s._array);break;case"v4v":if(!s._array)s._array=new Float32Array(4*c.length);m=0;for(p=c.length;m<p;m++){d=m*4;s._array[d]=c[m].x;s._array[d+1]=c[m].y;s._array[d+2]=c[m].z;s._array[d+3]=c[m].w}L.uniform4fv(h,s._array);break;case"m4":if(!s._array)s._array=new Float32Array(16);c.flattenToArray(s._array);L.uniformMatrix4fv(h,false,s._array);break;case"m4v":if(!s._array)s._array=new Float32Array(16*c.length);m=0;for(p=c.length;m<p;m++)c[m].flattenToArrayOffset(s._array,m*16);L.uniformMatrix4fv(h,false,s._array);break;case"t":L.uniform1i(h,c);h=s.texture;if(!h)continue;if(h.image instanceof Array&&h.image.length===6){s=h;if(s.image.length===6)if(s.needsUpdate){if(!s.image.__webglTextureCube)s.image.__webglTextureCube=L.createTexture();L.activeTexture(L.TEXTURE0+c);L.bindTexture(L.TEXTURE_CUBE_MAP,s.image.__webglTextureCube);c=[];for(h=0;h<6;h++){m=c;p=h;if(V.autoScaleCubemaps){d=s.image[h];v=ft;if(!(d.width<=v&&d.height<=v)){E=Math.max(d.width,d.height);_=Math.floor(d.width*v/E);v=Math.floor(d.height*v/E);E=document.createElement("canvas");E.width=_;E.height=v;E.getContext("2d").drawImage(d,0,0,d.width,d.height,0,0,_,v);d=E}}else d=s.image[h];m[p]=d}h=c[0];m=(h.width&h.width-1)===0&&(h.height&h.height-1)===0;p=b(s.format);d=b(s.type);x(L.TEXTURE_CUBE_MAP,s,m);for(h=0;h<6;h++)L.texImage2D(L.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,p,p,d,c[h]);s.generateMipmaps&&m&&L.generateMipmap(L.TEXTURE_CUBE_MAP);s.needsUpdate=false;if(s.onUpdate)s.onUpdate()}else{L.activeTexture(L.TEXTURE0+c);L.bindTexture(L.TEXTURE_CUBE_MAP,s.image.__webglTextureCube)}}else if(h instanceof THREE.WebGLRenderTargetCube){s=h;L.activeTexture(L.TEXTURE0+c);L.bindTexture(L.TEXTURE_CUBE_MAP,s.__webglTexture)}else V.setTexture(h,c);break;case"tv":if(!s._array){s._array=[];m=0;for(p=s.texture.length;m<p;m++)s._array[m]=c+m}L.uniform1iv(h,s._array);m=0;for(p=s.texture.length;m<p;m++)(h=s.texture[m])&&V.setTexture(h,s._array[m])}}if((o instanceof THREE.ShaderMaterial||o instanceof THREE.MeshPhongMaterial||o.envMap)&&a.cameraPosition!==null){e=t.matrixWorld.getPosition();L.uniform3f(a.cameraPosition,e.x,e.y,e.z)}(o instanceof THREE.MeshPhongMaterial||o instanceof THREE.MeshLambertMaterial||o instanceof THREE.ShaderMaterial||o.skinning)&&a.viewMatrix!==null&&L.uniformMatrix4fv(a.viewMatrix,false,t._viewMatrixArray);o.skinning&&L.uniformMatrix4fv(a.boneGlobalMatrices,false,r.boneMatrices)}L.uniformMatrix4fv(a.modelViewMatrix,false,r._modelViewMatrix.elements);a.normalMatrix&&L.uniformMatrix3fv(a.normalMatrix,false,r._normalMatrix.elements);a.objectMatrix!==null&&L.uniformMatrix4fv(a.objectMatrix,false,r.matrixWorld.elements);return n}function d(t,e){t._modelViewMatrix.multiply(e.matrixWorldInverse,t.matrixWorld);t._normalMatrix.getInverse(t._modelViewMatrix);t._normalMatrix.transpose()}function _(t,e,i){if(K!==t){t?L.enable(L.POLYGON_OFFSET_FILL):L.disable(L.POLYGON_OFFSET_FILL);K=t}if(t&&(Z!==e||Q!==i)){L.polygonOffset(e,i);Z=e;Q=i}}function v(t,e){var i;t==="fragment"?i=L.createShader(L.FRAGMENT_SHADER):t==="vertex"&&(i=L.createShader(L.VERTEX_SHADER));L.shaderSource(i,e);L.compileShader(i);if(!L.getShaderParameter(i,L.COMPILE_STATUS)){console.error(L.getShaderInfoLog(i));console.error(e);return null}return i}function x(t,e,i){if(i){L.texParameteri(t,L.TEXTURE_WRAP_S,b(e.wrapS));L.texParameteri(t,L.TEXTURE_WRAP_T,b(e.wrapT));L.texParameteri(t,L.TEXTURE_MAG_FILTER,b(e.magFilter));L.texParameteri(t,L.TEXTURE_MIN_FILTER,b(e.minFilter))}else{L.texParameteri(t,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE);L.texParameteri(t,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE);L.texParameteri(t,L.TEXTURE_MAG_FILTER,g(e.magFilter));L.texParameteri(t,L.TEXTURE_MIN_FILTER,g(e.minFilter))}}function E(t,e){L.bindRenderbuffer(L.RENDERBUFFER,t);if(e.depthBuffer&&!e.stencilBuffer){L.renderbufferStorage(L.RENDERBUFFER,L.DEPTH_COMPONENT16,e.width,e.height);L.framebufferRenderbuffer(L.FRAMEBUFFER,L.DEPTH_ATTACHMENT,L.RENDERBUFFER,t)}else if(e.depthBuffer&&e.stencilBuffer){L.renderbufferStorage(L.RENDERBUFFER,L.DEPTH_STENCIL,e.width,e.height);L.framebufferRenderbuffer(L.FRAMEBUFFER,L.DEPTH_STENCIL_ATTACHMENT,L.RENDERBUFFER,t)}else L.renderbufferStorage(L.RENDERBUFFER,L.RGBA4,e.width,e.height)}function g(t){switch(t){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return L.NEAREST;default:return L.LINEAR}}function b(t){switch(t){case THREE.RepeatWrapping:return L.REPEAT;case THREE.ClampToEdgeWrapping:return L.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return L.MIRRORED_REPEAT;case THREE.NearestFilter:return L.NEAREST;case THREE.NearestMipMapNearestFilter:return L.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return L.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return L.LINEAR;case THREE.LinearMipMapNearestFilter:return L.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return L.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return L.BYTE;case THREE.UnsignedByteType:return L.UNSIGNED_BYTE;case THREE.ShortType:return L.SHORT;case THREE.UnsignedShortType:return L.UNSIGNED_SHORT;case THREE.IntType:return L.INT;case THREE.UnsignedIntType:return L.UNSIGNED_INT;case THREE.FloatType:return L.FLOAT;case THREE.AlphaFormat:return L.ALPHA;case THREE.RGBFormat:return L.RGB;case THREE.RGBAFormat:return L.RGBA;case THREE.LuminanceFormat:return L.LUMINANCE;case THREE.LuminanceAlphaFormat:return L.LUMINANCE_ALPHA;case THREE.AddEquation:return L.FUNC_ADD;case THREE.SubtractEquation:return L.FUNC_SUBTRACT;case THREE.ReverseSubtractEquation:return L.FUNC_REVERSE_SUBTRACT;case THREE.ZeroFactor:return L.ZERO;case THREE.OneFactor:return L.ONE;case THREE.SrcColorFactor:return L.SRC_COLOR;case THREE.OneMinusSrcColorFactor:return L.ONE_MINUS_SRC_COLOR;case THREE.SrcAlphaFactor:return L.SRC_ALPHA;case THREE.OneMinusSrcAlphaFactor:return L.ONE_MINUS_SRC_ALPHA;case THREE.DstAlphaFactor:return L.DST_ALPHA;case THREE.OneMinusDstAlphaFactor:return L.ONE_MINUS_DST_ALPHA;case THREE.DstColorFactor:return L.DST_COLOR;case THREE.OneMinusDstColorFactor:return L.ONE_MINUS_DST_COLOR;case THREE.SrcAlphaSaturateFactor:return L.SRC_ALPHA_SATURATE}return 0}var t=t||{},T=t.canvas!==void 0?t.canvas:document.createElement("canvas"),R=t.precision!==void 0?t.precision:"highp",w=t.alpha!==void 0?t.alpha:true,S=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:true,C=t.antialias!==void 0?t.antialias:false,A=t.stencil!==void 0?t.stencil:true,M=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:false,D=t.clearColor!==void 0?new THREE.Color(t.clearColor):new THREE.Color(0),B=t.clearAlpha!==void 0?t.clearAlpha:0,H=t.maxLights!==void 0?t.maxLights:4;this.domElement=T;this.context=null;this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=true;this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=false;this.shadowMapCullFrontFaces=this.shadowMapSoft=this.shadowMapAutoUpdate=true;this.shadowMapCascade=this.shadowMapDebug=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.renderPluginsPre=[];this.renderPluginsPost=[];this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var V=this,L,P=[],F=null,I=null,U=-1,G=null,z=null,N=0,k=-1,O=-1,W=-1,j=-1,J=-1,X=-1,q=-1,Y=-1,K=null,Z=null,Q=null,$=null,tt=0,et=0,it=0,ot=0,rt=0,nt=0,at=new THREE.Frustum,st=new THREE.Matrix4,lt=new THREE.Matrix4,ct=new THREE.Vector4,ht=new THREE.Vector3,mt=true,pt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],angles:[],exponents:[]}};L=function(){var t;try{if(!(t=T.getContext("experimental-webgl",{alpha:w,premultipliedAlpha:S,antialias:C,stencil:A,preserveDrawingBuffer:M})))throw"Error creating WebGL context."}catch(t){console.error(t)}t.getExtension("OES_texture_float")||console.log("THREE.WebGLRenderer: Float textures not supported.");return t}();L.clearColor(0,0,0,1);L.clearDepth(1);L.clearStencil(0);L.enable(L.DEPTH_TEST);L.depthFunc(L.LEQUAL);L.frontFace(L.CCW);L.cullFace(L.BACK);L.enable(L.CULL_FACE);L.enable(L.BLEND);L.blendEquation(L.FUNC_ADD);L.blendFunc(L.SRC_ALPHA,L.ONE_MINUS_SRC_ALPHA);L.clearColor(D.r,D.g,D.b,B);this.context=L;var ut=L.getParameter(L.MAX_VERTEX_TEXTURE_IMAGE_UNITS);L.getParameter(L.MAX_TEXTURE_SIZE);var ft=L.getParameter(L.MAX_CUBE_MAP_TEXTURE_SIZE);this.getContext=function(){return L};this.supportsVertexTextures=function(){return ut>0};this.setSize=function(t,e){T.width=t;T.height=e;this.setViewport(0,0,T.width,T.height)};this.setViewport=function(t,e,i,o){tt=t;et=e;it=i;ot=o;L.viewport(tt,et,it,ot)};this.setScissor=function(t,e,i,o){L.scissor(t,e,i,o)};this.enableScissorTest=function(t){t?L.enable(L.SCISSOR_TEST):L.disable(L.SCISSOR_TEST)};this.setClearColorHex=function(t,e){D.setHex(t);B=e;L.clearColor(D.r,D.g,D.b,B)};this.setClearColor=function(t,e){D.copy(t);B=e;L.clearColor(D.r,D.g,D.b,B)};this.getClearColor=function(){return D};this.getClearAlpha=function(){return B};this.clear=function(t,e,i){var o=0;if(t===void 0||t)o=o|L.COLOR_BUFFER_BIT;if(e===void 0||e)o=o|L.DEPTH_BUFFER_BIT;if(i===void 0||i)o=o|L.STENCIL_BUFFER_BIT;L.clear(o)};this.clearTarget=function(t,e,i,o){this.setRenderTarget(t);this.clear(e,i,o)};this.addPostPlugin=function(t){t.init(this);this.renderPluginsPost.push(t)};this.addPrePlugin=function(t){t.init(this);this.renderPluginsPre.push(t)};this.deallocateObject=function(t){if(t.__webglInit){t.__webglInit=false;delete t._modelViewMatrix;delete t._normalMatrix;delete t._normalMatrixArray;delete t._modelViewMatrixArray;delete t._objectMatrixArray;if(t instanceof THREE.Mesh)for(var e in t.geometry.geometryGroups){var i=t.geometry.geometryGroups[e];L.deleteBuffer(i.__webglVertexBuffer);L.deleteBuffer(i.__webglNormalBuffer);L.deleteBuffer(i.__webglTangentBuffer);L.deleteBuffer(i.__webglColorBuffer);L.deleteBuffer(i.__webglUVBuffer);L.deleteBuffer(i.__webglUV2Buffer);L.deleteBuffer(i.__webglSkinVertexABuffer);L.deleteBuffer(i.__webglSkinVertexBBuffer);L.deleteBuffer(i.__webglSkinIndicesBuffer);L.deleteBuffer(i.__webglSkinWeightsBuffer);L.deleteBuffer(i.__webglFaceBuffer);L.deleteBuffer(i.__webglLineBuffer);var o=void 0,r=void 0;if(i.numMorphTargets){o=0;for(r=i.numMorphTargets;o<r;o++)L.deleteBuffer(i.__webglMorphTargetsBuffers[o])}if(i.numMorphNormals){o=0;for(r=i.numMorphNormals;o<r;o++)L.deleteBuffer(i.__webglMorphNormalsBuffers[o])}if(i.__webglCustomAttributesList){o=void 0;for(o in i.__webglCustomAttributesList)L.deleteBuffer(i.__webglCustomAttributesList[o].buffer)}V.info.memory.geometries--}else if(t instanceof THREE.Ribbon){t=t.geometry;L.deleteBuffer(t.__webglVertexBuffer);L.deleteBuffer(t.__webglColorBuffer);V.info.memory.geometries--}else if(t instanceof THREE.Line){t=t.geometry;L.deleteBuffer(t.__webglVertexBuffer);L.deleteBuffer(t.__webglColorBuffer);V.info.memory.geometries--}else if(t instanceof THREE.ParticleSystem){t=t.geometry;L.deleteBuffer(t.__webglVertexBuffer);L.deleteBuffer(t.__webglColorBuffer);V.info.memory.geometries--}}};this.deallocateTexture=function(t){if(t.__webglInit){t.__webglInit=false;L.deleteTexture(t.__webglTexture);V.info.memory.textures--}};this.deallocateRenderTarget=function(t){if(t&&t.__webglTexture){L.deleteTexture(t.__webglTexture);if(t instanceof THREE.WebGLRenderTargetCube)for(var e=0;e<6;e++){L.deleteFramebuffer(t.__webglFramebuffer[e]);L.deleteRenderbuffer(t.__webglRenderbuffer[e])}else{L.deleteFramebuffer(t.__webglFramebuffer);L.deleteRenderbuffer(t.__webglRenderbuffer)}}};this.updateShadowMap=function(t,e){F=null;U=G=Y=q=W=-1;mt=true;O=k=-1;this.shadowMapPlugin.update(t,e)};this.renderBufferImmediate=function(t,e,i){if(!t.__webglVertexBuffer)t.__webglVertexBuffer=L.createBuffer();if(!t.__webglNormalBuffer)t.__webglNormalBuffer=L.createBuffer();if(t.hasPos){L.bindBuffer(L.ARRAY_BUFFER,t.__webglVertexBuffer);L.bufferData(L.ARRAY_BUFFER,t.positionArray,L.DYNAMIC_DRAW);L.enableVertexAttribArray(e.attributes.position);L.vertexAttribPointer(e.attributes.position,3,L.FLOAT,false,0,0)}if(t.hasNormal){L.bindBuffer(L.ARRAY_BUFFER,t.__webglNormalBuffer);if(i===THREE.FlatShading){var o,r,n,a,s,l,c,h,m,p,u=t.count*3;for(p=0;p<u;p=p+9){i=t.normalArray;o=i[p];r=i[p+1];n=i[p+2];a=i[p+3];l=i[p+4];h=i[p+5];s=i[p+6];c=i[p+7];m=i[p+8];o=(o+a+s)/3;r=(r+l+c)/3;n=(n+h+m)/3;i[p]=o;i[p+1]=r;i[p+2]=n;i[p+3]=o;i[p+4]=r;i[p+5]=n;i[p+6]=o;i[p+7]=r;i[p+8]=n}}L.bufferData(L.ARRAY_BUFFER,t.normalArray,L.DYNAMIC_DRAW);L.enableVertexAttribArray(e.attributes.normal);L.vertexAttribPointer(e.attributes.normal,3,L.FLOAT,false,0,0)}L.drawArrays(L.TRIANGLES,0,t.count);t.count=0};this.renderBufferDirect=function(t,e,i,o,r,n){if(o.visible!==false){i=y(t,e,i,o,n);t=i.attributes;e=false;o=r.id*16777215+i.id*2+(o.wireframe?1:0);if(o!==G){G=o;e=true}if(n instanceof THREE.Mesh){n=r.offsets;o=0;for(i=n.length;o<i;++o){if(e){L.bindBuffer(L.ARRAY_BUFFER,r.vertexPositionBuffer);L.vertexAttribPointer(t.position,r.vertexPositionBuffer.itemSize,L.FLOAT,false,0,n[o].index*12);if(t.normal>=0&&r.vertexNormalBuffer){L.bindBuffer(L.ARRAY_BUFFER,r.vertexNormalBuffer);L.vertexAttribPointer(t.normal,r.vertexNormalBuffer.itemSize,L.FLOAT,false,0,n[o].index*12)}if(t.uv>=0&&r.vertexUvBuffer)if(r.vertexUvBuffer){L.bindBuffer(L.ARRAY_BUFFER,r.vertexUvBuffer);L.vertexAttribPointer(t.uv,r.vertexUvBuffer.itemSize,L.FLOAT,false,0,n[o].index*8);L.enableVertexAttribArray(t.uv)}else L.disableVertexAttribArray(t.uv);if(t.color>=0&&r.vertexColorBuffer){L.bindBuffer(L.ARRAY_BUFFER,r.vertexColorBuffer);L.vertexAttribPointer(t.color,r.vertexColorBuffer.itemSize,L.FLOAT,false,0,n[o].index*16)}L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,r.vertexIndexBuffer)}L.drawElements(L.TRIANGLES,n[o].count,L.UNSIGNED_SHORT,n[o].start*2);V.info.render.calls++;V.info.render.vertices=V.info.render.vertices+n[o].count;V.info.render.faces=V.info.render.faces+n[o].count/3}}}};this.renderBuffer=function(t,e,i,o,r,n){if(o.visible!==false){var a,s,i=y(t,e,i,o,n),e=i.attributes,t=false,i=r.id*16777215+i.id*2+(o.wireframe?1:0);if(i!==G){G=i;t=true}if(!o.morphTargets&&e.position>=0){if(t){L.bindBuffer(L.ARRAY_BUFFER,r.__webglVertexBuffer);L.vertexAttribPointer(e.position,3,L.FLOAT,false,0,0)}}else if(n.morphTargetBase){i=o.program.attributes;if(n.morphTargetBase!==-1){L.bindBuffer(L.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[n.morphTargetBase]);L.vertexAttribPointer(i.position,3,L.FLOAT,false,0,0)}else if(i.position>=0){L.bindBuffer(L.ARRAY_BUFFER,r.__webglVertexBuffer);L.vertexAttribPointer(i.position,3,L.FLOAT,false,0,0)}if(n.morphTargetForcedOrder.length){a=0;var l=n.morphTargetForcedOrder;for(s=n.morphTargetInfluences;a<o.numSupportedMorphTargets&&a<l.length;){L.bindBuffer(L.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[l[a]]);L.vertexAttribPointer(i["morphTarget"+a],3,L.FLOAT,false,0,0);if(o.morphNormals){L.bindBuffer(L.ARRAY_BUFFER,r.__webglMorphNormalsBuffers[l[a]]);L.vertexAttribPointer(i["morphNormal"+a],3,L.FLOAT,false,0,0)}n.__webglMorphTargetInfluences[a]=s[l[a]];a++}}else{var l=[],c=-1,h=0;s=n.morphTargetInfluences;var m,p=s.length;a=0;for(n.morphTargetBase!==-1&&(l[n.morphTargetBase]=true);a<o.numSupportedMorphTargets;){for(m=0;m<p;m++)if(!l[m]&&s[m]>c){h=m;c=s[h]}L.bindBuffer(L.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[h]);L.vertexAttribPointer(i["morphTarget"+a],3,L.FLOAT,false,0,0);if(o.morphNormals){L.bindBuffer(L.ARRAY_BUFFER,r.__webglMorphNormalsBuffers[h]);L.vertexAttribPointer(i["morphNormal"+a],3,L.FLOAT,false,0,0)}n.__webglMorphTargetInfluences[a]=c;l[h]=1;c=-1;a++}}o.program.uniforms.morphTargetInfluences!==null&&L.uniform1fv(o.program.uniforms.morphTargetInfluences,n.__webglMorphTargetInfluences)}if(t){if(r.__webglCustomAttributesList){a=0;for(s=r.__webglCustomAttributesList.length;a<s;a++){i=r.__webglCustomAttributesList[a];if(e[i.buffer.belongsToAttribute]>=0){L.bindBuffer(L.ARRAY_BUFFER,i.buffer);L.vertexAttribPointer(e[i.buffer.belongsToAttribute],i.size,L.FLOAT,false,0,0)}}}if(e.color>=0){L.bindBuffer(L.ARRAY_BUFFER,r.__webglColorBuffer);L.vertexAttribPointer(e.color,3,L.FLOAT,false,0,0)}if(e.normal>=0){L.bindBuffer(L.ARRAY_BUFFER,r.__webglNormalBuffer);L.vertexAttribPointer(e.normal,3,L.FLOAT,false,0,0)}if(e.tangent>=0){L.bindBuffer(L.ARRAY_BUFFER,r.__webglTangentBuffer);L.vertexAttribPointer(e.tangent,4,L.FLOAT,false,0,0)}if(e.uv>=0)if(r.__webglUVBuffer){L.bindBuffer(L.ARRAY_BUFFER,r.__webglUVBuffer);L.vertexAttribPointer(e.uv,2,L.FLOAT,false,0,0);L.enableVertexAttribArray(e.uv)}else L.disableVertexAttribArray(e.uv);if(e.uv2>=0)if(r.__webglUV2Buffer){L.bindBuffer(L.ARRAY_BUFFER,r.__webglUV2Buffer);L.vertexAttribPointer(e.uv2,2,L.FLOAT,false,0,0);L.enableVertexAttribArray(e.uv2)}else L.disableVertexAttribArray(e.uv2);if(o.skinning&&e.skinVertexA>=0&&e.skinVertexB>=0&&e.skinIndex>=0&&e.skinWeight>=0){L.bindBuffer(L.ARRAY_BUFFER,r.__webglSkinVertexABuffer);L.vertexAttribPointer(e.skinVertexA,4,L.FLOAT,false,0,0);L.bindBuffer(L.ARRAY_BUFFER,r.__webglSkinVertexBBuffer);L.vertexAttribPointer(e.skinVertexB,4,L.FLOAT,false,0,0);L.bindBuffer(L.ARRAY_BUFFER,r.__webglSkinIndicesBuffer);L.vertexAttribPointer(e.skinIndex,4,L.FLOAT,false,0,0);L.bindBuffer(L.ARRAY_BUFFER,r.__webglSkinWeightsBuffer);L.vertexAttribPointer(e.skinWeight,4,L.FLOAT,false,0,0)}}if(n instanceof THREE.Mesh){if(o.wireframe){o=o.wireframeLinewidth;if(o!==$){L.lineWidth(o);$=o}t&&L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,r.__webglLineBuffer);L.drawElements(L.LINES,r.__webglLineCount,L.UNSIGNED_SHORT,0)}else{t&&L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,r.__webglFaceBuffer);L.drawElements(L.TRIANGLES,r.__webglFaceCount,L.UNSIGNED_SHORT,0)}V.info.render.calls++;V.info.render.vertices=V.info.render.vertices+r.__webglFaceCount;V.info.render.faces=V.info.render.faces+r.__webglFaceCount/3}else if(n instanceof THREE.Line){n=n.type===THREE.LineStrip?L.LINE_STRIP:L.LINES;o=o.linewidth;if(o!==$){L.lineWidth(o);$=o}L.drawArrays(n,0,r.__webglLineCount);V.info.render.calls++}else if(n instanceof THREE.ParticleSystem){L.drawArrays(L.POINTS,0,r.__webglParticleCount);V.info.render.calls++;V.info.render.points=V.info.render.points+r.__webglParticleCount}else if(n instanceof THREE.Ribbon){L.drawArrays(L.TRIANGLE_STRIP,0,r.__webglVertexCount);V.info.render.calls++}}};this.render=function(t,e,i,o){var r,n,h,m,p=t.__lights,u=t.fog;U=-1;mt=true;if(e.parent===void 0){console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it...");t.add(e)}this.autoUpdateScene&&t.updateMatrixWorld();if(!e._viewMatrixArray)e._viewMatrixArray=new Float32Array(16);if(!e._projectionMatrixArray)e._projectionMatrixArray=new Float32Array(16);e.matrixWorldInverse.getInverse(e.matrixWorld);e.matrixWorldInverse.flattenToArray(e._viewMatrixArray);e.projectionMatrix.flattenToArray(e._projectionMatrixArray);st.multiply(e.projectionMatrix,e.matrixWorldInverse);at.setFromMatrix(st);this.autoUpdateObjects&&this.initWebGLObjects(t);s(this.renderPluginsPre,t,e);V.info.render.calls=0;V.info.render.vertices=0;V.info.render.faces=0;V.info.render.points=0;this.setRenderTarget(i);(this.autoClear||o)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);m=t.__webglObjects;o=0;for(r=m.length;o<r;o++){n=m[o];h=n.object;n.render=false;if(h.visible&&(!(h instanceof THREE.Mesh||h instanceof THREE.ParticleSystem)||!h.frustumCulled||at.contains(h))){d(h,e);var f=n,y=f.object,v=f.buffer,x=void 0,x=x=void 0,x=y.material;if(x instanceof THREE.MeshFaceMaterial){x=v.materialIndex;if(x>=0){x=y.geometry.materials[x];if(x.transparent){f.transparent=x;f.opaque=null}else{f.opaque=x;f.transparent=null}}}else if(x)if(x.transparent){f.transparent=x;f.opaque=null}else{f.opaque=x;f.transparent=null}n.render=true;if(this.sortObjects)if(h.renderDepth)n.z=h.renderDepth;else{ct.copy(h.matrixWorld.getPosition());st.multiplyVector3(ct);n.z=ct.z}}}this.sortObjects&&m.sort(a);m=t.__webglObjectsImmediate;o=0;for(r=m.length;o<r;o++){n=m[o];h=n.object;if(h.visible){d(h,e);h=n.object.material;if(h.transparent){n.transparent=h;n.opaque=null}else{n.opaque=h;n.transparent=null}}}if(t.overrideMaterial){o=t.overrideMaterial;this.setBlending(o.blending,o.blendEquation,o.blendSrc,o.blendDst);this.setDepthTest(o.depthTest);this.setDepthWrite(o.depthWrite);_(o.polygonOffset,o.polygonOffsetFactor,o.polygonOffsetUnits);l(t.__webglObjects,false,"",e,p,u,true,o);c(t.__webglObjectsImmediate,"",e,p,u,false,o)}else{this.setBlending(THREE.NormalBlending);l(t.__webglObjects,true,"opaque",e,p,u,false);c(t.__webglObjectsImmediate,"opaque",e,p,u,false);l(t.__webglObjects,false,"transparent",e,p,u,true);c(t.__webglObjectsImmediate,"transparent",e,p,u,true)}s(this.renderPluginsPost,t,e);if(i&&i.generateMipmaps&&i.minFilter!==THREE.NearestFilter&&i.minFilter!==THREE.LinearFilter)if(i instanceof THREE.WebGLRenderTargetCube){L.bindTexture(L.TEXTURE_CUBE_MAP,i.__webglTexture);L.generateMipmap(L.TEXTURE_CUBE_MAP);L.bindTexture(L.TEXTURE_CUBE_MAP,null)}else{L.bindTexture(L.TEXTURE_2D,i.__webglTexture);L.generateMipmap(L.TEXTURE_2D);L.bindTexture(L.TEXTURE_2D,null)}this.setDepthTest(true);this.setDepthWrite(true)};this.renderImmediateObject=function(t,e,i,o,r){var n=y(t,e,i,o,r);G=-1;V.setObjectFaces(r);r.immediateRenderCallback?r.immediateRenderCallback(n,L,at):r.render((function(t){V.renderBufferImmediate(t,n,o.shading)}))};this.initWebGLObjects=function(t){if(!t.__webglObjects){t.__webglObjects=[];t.__webglObjectsImmediate=[];t.__webglSprites=[];t.__webglFlares=[]}for(;t.__objectsAdded.length;){var a=t.__objectsAdded[0],s=t,l=void 0,c=void 0,y=void 0;if(!a.__webglInit){a.__webglInit=true;a._modelViewMatrix=new THREE.Matrix4;a._normalMatrix=new THREE.Matrix3;if(a instanceof THREE.Mesh){c=a.geometry;if(c instanceof THREE.Geometry){if(c.geometryGroups===void 0){var d=c,_=void 0,v=void 0,x=void 0,E=void 0,g=void 0,b=void 0,T=void 0,R={},w=d.morphTargets.length,S=d.morphNormals.length;d.geometryGroups={};_=0;for(v=d.faces.length;_<v;_++){x=d.faces[_];E=x.materialIndex;b=E!==void 0?E:-1;R[b]===void 0&&(R[b]={hash:b,counter:0});T=R[b].hash+"_"+R[b].counter;d.geometryGroups[T]===void 0&&(d.geometryGroups[T]={faces3:[],faces4:[],materialIndex:E,vertices:0,numMorphTargets:w,numMorphNormals:S});g=x instanceof THREE.Face3?3:4;if(d.geometryGroups[T].vertices+g>65535){R[b].counter=R[b].counter+1;T=R[b].hash+"_"+R[b].counter;d.geometryGroups[T]===void 0&&(d.geometryGroups[T]={faces3:[],faces4:[],materialIndex:E,vertices:0,numMorphTargets:w,numMorphNormals:S})}x instanceof THREE.Face3?d.geometryGroups[T].faces3.push(_):d.geometryGroups[T].faces4.push(_);d.geometryGroups[T].vertices=d.geometryGroups[T].vertices+g}d.geometryGroupsList=[];var C=void 0;for(C in d.geometryGroups){d.geometryGroups[C].id=N++;d.geometryGroupsList.push(d.geometryGroups[C])}}for(l in c.geometryGroups){y=c.geometryGroups[l];if(!y.__webglVertexBuffer){var A=y;A.__webglVertexBuffer=L.createBuffer();A.__webglNormalBuffer=L.createBuffer();A.__webglTangentBuffer=L.createBuffer();A.__webglColorBuffer=L.createBuffer();A.__webglUVBuffer=L.createBuffer();A.__webglUV2Buffer=L.createBuffer();A.__webglSkinVertexABuffer=L.createBuffer();A.__webglSkinVertexBBuffer=L.createBuffer();A.__webglSkinIndicesBuffer=L.createBuffer();A.__webglSkinWeightsBuffer=L.createBuffer();A.__webglFaceBuffer=L.createBuffer();A.__webglLineBuffer=L.createBuffer();var M=void 0,D=void 0;if(A.numMorphTargets){A.__webglMorphTargetsBuffers=[];M=0;for(D=A.numMorphTargets;M<D;M++)A.__webglMorphTargetsBuffers.push(L.createBuffer())}if(A.numMorphNormals){A.__webglMorphNormalsBuffers=[];M=0;for(D=A.numMorphNormals;M<D;M++)A.__webglMorphNormalsBuffers.push(L.createBuffer())}V.info.memory.geometries++;var B=y,H=a,P=H.geometry,F=B.faces3,I=B.faces4,U=F.length*3+I.length*4,G=F.length*1+I.length*2,z=F.length*3+I.length*4,k=i(H,B),O=r(k),W=o(k),j=k.vertexColors?k.vertexColors:false;B.__vertexArray=new Float32Array(U*3);if(W)B.__normalArray=new Float32Array(U*3);if(P.hasTangents)B.__tangentArray=new Float32Array(U*4);if(j)B.__colorArray=new Float32Array(U*3);if(O){if(P.faceUvs.length>0||P.faceVertexUvs.length>0)B.__uvArray=new Float32Array(U*2);if(P.faceUvs.length>1||P.faceVertexUvs.length>1)B.__uv2Array=new Float32Array(U*2)}if(H.geometry.skinWeights.length&&H.geometry.skinIndices.length){B.__skinVertexAArray=new Float32Array(U*4);B.__skinVertexBArray=new Float32Array(U*4);B.__skinIndexArray=new Float32Array(U*4);B.__skinWeightArray=new Float32Array(U*4)}B.__faceArray=new Uint16Array(G*3);B.__lineArray=new Uint16Array(z*2);var J=void 0,X=void 0;if(B.numMorphTargets){B.__morphTargetsArrays=[];J=0;for(X=B.numMorphTargets;J<X;J++)B.__morphTargetsArrays.push(new Float32Array(U*3))}if(B.numMorphNormals){B.__morphNormalsArrays=[];J=0;for(X=B.numMorphNormals;J<X;J++)B.__morphNormalsArrays.push(new Float32Array(U*3))}B.__webglFaceCount=G*3;B.__webglLineCount=z*2;if(k.attributes){if(B.__webglCustomAttributesList===void 0)B.__webglCustomAttributesList=[];var q=void 0;for(q in k.attributes){var Y=k.attributes[q],K={},Z;for(Z in Y)K[Z]=Y[Z];if(!K.__webglInitialized||K.createUniqueBuffers){K.__webglInitialized=true;var Q=1;K.type==="v2"?Q=2:K.type==="v3"?Q=3:K.type==="v4"?Q=4:K.type==="c"&&(Q=3);K.size=Q;K.array=new Float32Array(U*Q);K.buffer=L.createBuffer();K.buffer.belongsToAttribute=q;Y.needsUpdate=true;K.__original=Y}B.__webglCustomAttributesList.push(K)}}B.__inittedArrays=true;c.verticesNeedUpdate=true;c.morphTargetsNeedUpdate=true;c.elementsNeedUpdate=true;c.uvsNeedUpdate=true;c.normalsNeedUpdate=true;c.tangetsNeedUpdate=true;c.colorsNeedUpdate=true}}}}else if(a instanceof THREE.Ribbon){c=a.geometry;if(!c.__webglVertexBuffer){var $=c;$.__webglVertexBuffer=L.createBuffer();$.__webglColorBuffer=L.createBuffer();V.info.memory.geometries++;var tt=c,et=tt.vertices.length;tt.__vertexArray=new Float32Array(et*3);tt.__colorArray=new Float32Array(et*3);tt.__webglVertexCount=et;c.verticesNeedUpdate=true;c.colorsNeedUpdate=true}}else if(a instanceof THREE.Line){c=a.geometry;if(!c.__webglVertexBuffer){var it=c;it.__webglVertexBuffer=L.createBuffer();it.__webglColorBuffer=L.createBuffer();V.info.memory.geometries++;var ot=c,rt=a,nt=ot.vertices.length;ot.__vertexArray=new Float32Array(nt*3);ot.__colorArray=new Float32Array(nt*3);ot.__webglLineCount=nt;e(ot,rt);c.verticesNeedUpdate=true;c.colorsNeedUpdate=true}}else if(a instanceof THREE.ParticleSystem){c=a.geometry;if(!c.__webglVertexBuffer){var at=c;at.__webglVertexBuffer=L.createBuffer();at.__webglColorBuffer=L.createBuffer();V.info.geometries++;var st=c,lt=a,ct=st.vertices.length;st.__vertexArray=new Float32Array(ct*3);st.__colorArray=new Float32Array(ct*3);st.__sortArray=[];st.__webglParticleCount=ct;e(st,lt);c.verticesNeedUpdate=true;c.colorsNeedUpdate=true}}}if(!a.__webglActive){if(a instanceof THREE.Mesh){c=a.geometry;if(c instanceof THREE.BufferGeometry)h(s.__webglObjects,c,a);else for(l in c.geometryGroups){y=c.geometryGroups[l];h(s.__webglObjects,y,a)}}else if(a instanceof THREE.Ribbon||a instanceof THREE.Line||a instanceof THREE.ParticleSystem){c=a.geometry;h(s.__webglObjects,c,a)}else a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback?s.__webglObjectsImmediate.push({object:a,opaque:null,transparent:null}):a instanceof THREE.Sprite?s.__webglSprites.push(a):a instanceof THREE.LensFlare&&s.__webglFlares.push(a);a.__webglActive=true}t.__objectsAdded.splice(0,1)}for(;t.__objectsRemoved.length;){var ht=t.__objectsRemoved[0],mt=t;ht instanceof THREE.Mesh||ht instanceof THREE.ParticleSystem||ht instanceof THREE.Ribbon||ht instanceof THREE.Line?u(mt.__webglObjects,ht):ht instanceof THREE.Sprite?f(mt.__webglSprites,ht):ht instanceof THREE.LensFlare?f(mt.__webglFlares,ht):(ht instanceof THREE.ImmediateRenderObject||ht.immediateRenderCallback)&&u(mt.__webglObjectsImmediate,ht);ht.__webglActive=false;t.__objectsRemoved.splice(0,1)}for(var pt=0,ut=t.__webglObjects.length;pt<ut;pt++){var ft=t.__webglObjects[pt].object,yt=ft.geometry,dt=void 0,_t=void 0,vt=void 0;if(ft instanceof THREE.Mesh)if(yt instanceof THREE.BufferGeometry){yt.verticesNeedUpdate=false;yt.elementsNeedUpdate=false;yt.uvsNeedUpdate=false;yt.normalsNeedUpdate=false;yt.colorsNeedUpdate=false}else{for(var xt=0,Et=yt.geometryGroupsList.length;xt<Et;xt++){dt=yt.geometryGroupsList[xt];vt=i(ft,dt);_t=vt.attributes&&m(vt);if(yt.verticesNeedUpdate||yt.morphTargetsNeedUpdate||yt.elementsNeedUpdate||yt.uvsNeedUpdate||yt.normalsNeedUpdate||yt.colorsNeedUpdate||yt.tangetsNeedUpdate||_t){var gt=dt,bt=ft,Tt=L.DYNAMIC_DRAW,Rt=!yt.dynamic,wt=vt;if(gt.__inittedArrays){var St=o(wt),Ct=wt.vertexColors?wt.vertexColors:false,At=r(wt),Mt=St===THREE.SmoothShading,Dt=void 0,Bt=void 0,Ht=void 0,Vt=void 0,Lt=void 0,Pt=void 0,Ft=void 0,It=void 0,Ut=void 0,Gt=void 0,zt=void 0,Nt=void 0,kt=void 0,Ot=void 0,Wt=void 0,jt=void 0,Jt=void 0,Xt=void 0,qt=void 0,Yt=void 0,Kt=void 0,Zt=void 0,Qt=void 0,$t=void 0,te=void 0,ee=void 0,ie=void 0,oe=void 0,re=void 0,ne=void 0,ae=void 0,se=void 0,le=void 0,ce=void 0,he=void 0,me=void 0,pe=void 0,ue=void 0,fe=void 0,ye=void 0,de=void 0,_e=void 0,ve=void 0,xe=void 0,Ee=void 0,ge=void 0,be=void 0,Te=void 0,Re=void 0,we=void 0,Se=void 0,Ce=void 0,Ae=void 0,Me=void 0,De=0,Be=0,He=0,Ve=0,Le=0,Pe=0,Fe=0,Ie=0,Ue=0,Ge=0,ze=0,Ne=0,ke=void 0,Oe=gt.__vertexArray,We=gt.__uvArray,je=gt.__uv2Array,Je=gt.__normalArray,Xe=gt.__tangentArray,qe=gt.__colorArray,Ye=gt.__skinVertexAArray,Ke=gt.__skinVertexBArray,Ze=gt.__skinIndexArray,Qe=gt.__skinWeightArray,$e=gt.__morphTargetsArrays,ti=gt.__morphNormalsArrays,ei=gt.__webglCustomAttributesList,ii=void 0,oi=gt.__faceArray,ri=gt.__lineArray,ni=bt.geometry,ai=ni.elementsNeedUpdate,si=ni.uvsNeedUpdate,li=ni.normalsNeedUpdate,ci=ni.tangetsNeedUpdate,hi=ni.colorsNeedUpdate,mi=ni.morphTargetsNeedUpdate,pi=ni.vertices,ui=gt.faces3,fi=gt.faces4,yi=ni.faces,di=ni.faceVertexUvs[0],_i=ni.faceVertexUvs[1],vi=ni.skinVerticesA,xi=ni.skinVerticesB,Ei=ni.skinIndices,gi=ni.skinWeights,bi=ni.morphTargets,Ti=ni.morphNormals;if(ni.verticesNeedUpdate){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Vt=yi[ui[Dt]];Nt=pi[Vt.a];kt=pi[Vt.b];Ot=pi[Vt.c];Oe[Be]=Nt.x;Oe[Be+1]=Nt.y;Oe[Be+2]=Nt.z;Oe[Be+3]=kt.x;Oe[Be+4]=kt.y;Oe[Be+5]=kt.z;Oe[Be+6]=Ot.x;Oe[Be+7]=Ot.y;Oe[Be+8]=Ot.z;Be=Be+9}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Vt=yi[fi[Dt]];Nt=pi[Vt.a];kt=pi[Vt.b];Ot=pi[Vt.c];Wt=pi[Vt.d];Oe[Be]=Nt.x;Oe[Be+1]=Nt.y;Oe[Be+2]=Nt.z;Oe[Be+3]=kt.x;Oe[Be+4]=kt.y;Oe[Be+5]=kt.z;Oe[Be+6]=Ot.x;Oe[Be+7]=Ot.y;Oe[Be+8]=Ot.z;Oe[Be+9]=Wt.x;Oe[Be+10]=Wt.y;Oe[Be+11]=Wt.z;Be=Be+12}L.bindBuffer(L.ARRAY_BUFFER,gt.__webglVertexBuffer);L.bufferData(L.ARRAY_BUFFER,Oe,Tt)}if(mi){Re=0;for(we=bi.length;Re<we;Re++){Dt=ze=0;for(Bt=ui.length;Dt<Bt;Dt++){Ae=ui[Dt];Vt=yi[Ae];Nt=bi[Re].vertices[Vt.a];kt=bi[Re].vertices[Vt.b];Ot=bi[Re].vertices[Vt.c];Se=$e[Re];Se[ze]=Nt.x;Se[ze+1]=Nt.y;Se[ze+2]=Nt.z;Se[ze+3]=kt.x;Se[ze+4]=kt.y;Se[ze+5]=kt.z;Se[ze+6]=Ot.x;Se[ze+7]=Ot.y;Se[ze+8]=Ot.z;if(wt.morphNormals){if(Mt){Me=Ti[Re].vertexNormals[Ae];Yt=Me.a;Kt=Me.b;Zt=Me.c}else Zt=Kt=Yt=Ti[Re].faceNormals[Ae];Ce=ti[Re];Ce[ze]=Yt.x;Ce[ze+1]=Yt.y;Ce[ze+2]=Yt.z;Ce[ze+3]=Kt.x;Ce[ze+4]=Kt.y;Ce[ze+5]=Kt.z;Ce[ze+6]=Zt.x;Ce[ze+7]=Zt.y;Ce[ze+8]=Zt.z}ze=ze+9}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Ae=fi[Dt];Vt=yi[Ae];Nt=bi[Re].vertices[Vt.a];kt=bi[Re].vertices[Vt.b];Ot=bi[Re].vertices[Vt.c];Wt=bi[Re].vertices[Vt.d];Se=$e[Re];Se[ze]=Nt.x;Se[ze+1]=Nt.y;Se[ze+2]=Nt.z;Se[ze+3]=kt.x;Se[ze+4]=kt.y;Se[ze+5]=kt.z;Se[ze+6]=Ot.x;Se[ze+7]=Ot.y;Se[ze+8]=Ot.z;Se[ze+9]=Wt.x;Se[ze+10]=Wt.y;Se[ze+11]=Wt.z;if(wt.morphNormals){if(Mt){Me=Ti[Re].vertexNormals[Ae];Yt=Me.a;Kt=Me.b;Zt=Me.c;Qt=Me.d}else Qt=Zt=Kt=Yt=Ti[Re].faceNormals[Ae];Ce=ti[Re];Ce[ze]=Yt.x;Ce[ze+1]=Yt.y;Ce[ze+2]=Yt.z;Ce[ze+3]=Kt.x;Ce[ze+4]=Kt.y;Ce[ze+5]=Kt.z;Ce[ze+6]=Zt.x;Ce[ze+7]=Zt.y;Ce[ze+8]=Zt.z;Ce[ze+9]=Qt.x;Ce[ze+10]=Qt.y;Ce[ze+11]=Qt.z}ze=ze+12}L.bindBuffer(L.ARRAY_BUFFER,gt.__webglMorphTargetsBuffers[Re]);L.bufferData(L.ARRAY_BUFFER,$e[Re],Tt);if(wt.morphNormals){L.bindBuffer(L.ARRAY_BUFFER,gt.__webglMorphNormalsBuffers[Re]);L.bufferData(L.ARRAY_BUFFER,ti[Re],Tt)}}}if(gi.length){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Vt=yi[ui[Dt]];oe=gi[Vt.a];re=gi[Vt.b];ne=gi[Vt.c];Qe[Ge]=oe.x;Qe[Ge+1]=oe.y;Qe[Ge+2]=oe.z;Qe[Ge+3]=oe.w;Qe[Ge+4]=re.x;Qe[Ge+5]=re.y;Qe[Ge+6]=re.z;Qe[Ge+7]=re.w;Qe[Ge+8]=ne.x;Qe[Ge+9]=ne.y;Qe[Ge+10]=ne.z;Qe[Ge+11]=ne.w;se=Ei[Vt.a];le=Ei[Vt.b];ce=Ei[Vt.c];Ze[Ge]=se.x;Ze[Ge+1]=se.y;Ze[Ge+2]=se.z;Ze[Ge+3]=se.w;Ze[Ge+4]=le.x;Ze[Ge+5]=le.y;Ze[Ge+6]=le.z;Ze[Ge+7]=le.w;Ze[Ge+8]=ce.x;Ze[Ge+9]=ce.y;Ze[Ge+10]=ce.z;Ze[Ge+11]=ce.w;me=vi[Vt.a];pe=vi[Vt.b];ue=vi[Vt.c];Ye[Ge]=me.x;Ye[Ge+1]=me.y;Ye[Ge+2]=me.z;Ye[Ge+3]=1;Ye[Ge+4]=pe.x;Ye[Ge+5]=pe.y;Ye[Ge+6]=pe.z;Ye[Ge+7]=1;Ye[Ge+8]=ue.x;Ye[Ge+9]=ue.y;Ye[Ge+10]=ue.z;Ye[Ge+11]=1;ye=xi[Vt.a];de=xi[Vt.b];_e=xi[Vt.c];Ke[Ge]=ye.x;Ke[Ge+1]=ye.y;Ke[Ge+2]=ye.z;Ke[Ge+3]=1;Ke[Ge+4]=de.x;Ke[Ge+5]=de.y;Ke[Ge+6]=de.z;Ke[Ge+7]=1;Ke[Ge+8]=_e.x;Ke[Ge+9]=_e.y;Ke[Ge+10]=_e.z;Ke[Ge+11]=1;Ge=Ge+12}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Vt=yi[fi[Dt]];oe=gi[Vt.a];re=gi[Vt.b];ne=gi[Vt.c];ae=gi[Vt.d];Qe[Ge]=oe.x;Qe[Ge+1]=oe.y;Qe[Ge+2]=oe.z;Qe[Ge+3]=oe.w;Qe[Ge+4]=re.x;Qe[Ge+5]=re.y;Qe[Ge+6]=re.z;Qe[Ge+7]=re.w;Qe[Ge+8]=ne.x;Qe[Ge+9]=ne.y;Qe[Ge+10]=ne.z;Qe[Ge+11]=ne.w;Qe[Ge+12]=ae.x;Qe[Ge+13]=ae.y;Qe[Ge+14]=ae.z;Qe[Ge+15]=ae.w;se=Ei[Vt.a];le=Ei[Vt.b];ce=Ei[Vt.c];he=Ei[Vt.d];Ze[Ge]=se.x;Ze[Ge+1]=se.y;Ze[Ge+2]=se.z;Ze[Ge+3]=se.w;Ze[Ge+4]=le.x;Ze[Ge+5]=le.y;Ze[Ge+6]=le.z;Ze[Ge+7]=le.w;Ze[Ge+8]=ce.x;Ze[Ge+9]=ce.y;Ze[Ge+10]=ce.z;Ze[Ge+11]=ce.w;Ze[Ge+12]=he.x;Ze[Ge+13]=he.y;Ze[Ge+14]=he.z;Ze[Ge+15]=he.w;me=vi[Vt.a];pe=vi[Vt.b];ue=vi[Vt.c];fe=vi[Vt.d];Ye[Ge]=me.x;Ye[Ge+1]=me.y;Ye[Ge+2]=me.z;Ye[Ge+3]=1;Ye[Ge+4]=pe.x;Ye[Ge+5]=pe.y;Ye[Ge+6]=pe.z;Ye[Ge+7]=1;Ye[Ge+8]=ue.x;Ye[Ge+9]=ue.y;Ye[Ge+10]=ue.z;Ye[Ge+11]=1;Ye[Ge+12]=fe.x;Ye[Ge+13]=fe.y;Ye[Ge+14]=fe.z;Ye[Ge+15]=1;ye=xi[Vt.a];de=xi[Vt.b];_e=xi[Vt.c];ve=xi[Vt.d];Ke[Ge]=ye.x;Ke[Ge+1]=ye.y;Ke[Ge+2]=ye.z;Ke[Ge+3]=1;Ke[Ge+4]=de.x;Ke[Ge+5]=de.y;Ke[Ge+6]=de.z;Ke[Ge+7]=1;Ke[Ge+8]=_e.x;Ke[Ge+9]=_e.y;Ke[Ge+10]=_e.z;Ke[Ge+11]=1;Ke[Ge+12]=ve.x;Ke[Ge+13]=ve.y;Ke[Ge+14]=ve.z;Ke[Ge+15]=1;Ge=Ge+16}if(Ge>0){L.bindBuffer(L.ARRAY_BUFFER,gt.__webglSkinVertexABuffer);L.bufferData(L.ARRAY_BUFFER,Ye,Tt);L.bindBuffer(L.ARRAY_BUFFER,gt.__webglSkinVertexBBuffer);L.bufferData(L.ARRAY_BUFFER,Ke,Tt);L.bindBuffer(L.ARRAY_BUFFER,gt.__webglSkinIndicesBuffer);L.bufferData(L.ARRAY_BUFFER,Ze,Tt);L.bindBuffer(L.ARRAY_BUFFER,gt.__webglSkinWeightsBuffer);L.bufferData(L.ARRAY_BUFFER,Qe,Tt)}}if(hi&&Ct){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Vt=yi[ui[Dt]];Ft=Vt.vertexColors;It=Vt.color;if(Ft.length===3&&Ct===THREE.VertexColors){$t=Ft[0];te=Ft[1];ee=Ft[2]}else ee=te=$t=It;qe[Ue]=$t.r;qe[Ue+1]=$t.g;qe[Ue+2]=$t.b;qe[Ue+3]=te.r;qe[Ue+4]=te.g;qe[Ue+5]=te.b;qe[Ue+6]=ee.r;qe[Ue+7]=ee.g;qe[Ue+8]=ee.b;Ue=Ue+9}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Vt=yi[fi[Dt]];Ft=Vt.vertexColors;It=Vt.color;if(Ft.length===4&&Ct===THREE.VertexColors){$t=Ft[0];te=Ft[1];ee=Ft[2];ie=Ft[3]}else ie=ee=te=$t=It;qe[Ue]=$t.r;qe[Ue+1]=$t.g;qe[Ue+2]=$t.b;qe[Ue+3]=te.r;qe[Ue+4]=te.g;qe[Ue+5]=te.b;qe[Ue+6]=ee.r;qe[Ue+7]=ee.g;qe[Ue+8]=ee.b;qe[Ue+9]=ie.r;qe[Ue+10]=ie.g;qe[Ue+11]=ie.b;Ue=Ue+12}if(Ue>0){L.bindBuffer(L.ARRAY_BUFFER,gt.__webglColorBuffer);L.bufferData(L.ARRAY_BUFFER,qe,Tt)}}if(ci&&ni.hasTangents){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Vt=yi[ui[Dt]];Ut=Vt.vertexTangents;jt=Ut[0];Jt=Ut[1];Xt=Ut[2];Xe[Fe]=jt.x;Xe[Fe+1]=jt.y;Xe[Fe+2]=jt.z;Xe[Fe+3]=jt.w;Xe[Fe+4]=Jt.x;Xe[Fe+5]=Jt.y;Xe[Fe+6]=Jt.z;Xe[Fe+7]=Jt.w;Xe[Fe+8]=Xt.x;Xe[Fe+9]=Xt.y;Xe[Fe+10]=Xt.z;Xe[Fe+11]=Xt.w;Fe=Fe+12}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Vt=yi[fi[Dt]];Ut=Vt.vertexTangents;jt=Ut[0];Jt=Ut[1];Xt=Ut[2];qt=Ut[3];Xe[Fe]=jt.x;Xe[Fe+1]=jt.y;Xe[Fe+2]=jt.z;Xe[Fe+3]=jt.w;Xe[Fe+4]=Jt.x;Xe[Fe+5]=Jt.y;Xe[Fe+6]=Jt.z;Xe[Fe+7]=Jt.w;Xe[Fe+8]=Xt.x;Xe[Fe+9]=Xt.y;Xe[Fe+10]=Xt.z;Xe[Fe+11]=Xt.w;Xe[Fe+12]=qt.x;Xe[Fe+13]=qt.y;Xe[Fe+14]=qt.z;Xe[Fe+15]=qt.w;Fe=Fe+16}L.bindBuffer(L.ARRAY_BUFFER,gt.__webglTangentBuffer);L.bufferData(L.ARRAY_BUFFER,Xe,Tt)}if(li&&St){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Vt=yi[ui[Dt]];Lt=Vt.vertexNormals;Pt=Vt.normal;if(Lt.length===3&&Mt)for(xe=0;xe<3;xe++){ge=Lt[xe];Je[Pe]=ge.x;Je[Pe+1]=ge.y;Je[Pe+2]=ge.z;Pe=Pe+3}else for(xe=0;xe<3;xe++){Je[Pe]=Pt.x;Je[Pe+1]=Pt.y;Je[Pe+2]=Pt.z;Pe=Pe+3}}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Vt=yi[fi[Dt]];Lt=Vt.vertexNormals;Pt=Vt.normal;if(Lt.length===4&&Mt)for(xe=0;xe<4;xe++){ge=Lt[xe];Je[Pe]=ge.x;Je[Pe+1]=ge.y;Je[Pe+2]=ge.z;Pe=Pe+3}else for(xe=0;xe<4;xe++){Je[Pe]=Pt.x;Je[Pe+1]=Pt.y;Je[Pe+2]=Pt.z;Pe=Pe+3}}L.bindBuffer(L.ARRAY_BUFFER,gt.__webglNormalBuffer);L.bufferData(L.ARRAY_BUFFER,Je,Tt)}if(si&&di&&At){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Ht=ui[Dt];Vt=yi[Ht];Gt=di[Ht];if(Gt!==void 0)for(xe=0;xe<3;xe++){be=Gt[xe];We[He]=be.u;We[He+1]=be.v;He=He+2}}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Ht=fi[Dt];Vt=yi[Ht];Gt=di[Ht];if(Gt!==void 0)for(xe=0;xe<4;xe++){be=Gt[xe];We[He]=be.u;We[He+1]=be.v;He=He+2}}if(He>0){L.bindBuffer(L.ARRAY_BUFFER,gt.__webglUVBuffer);L.bufferData(L.ARRAY_BUFFER,We,Tt)}}if(si&&_i&&At){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Ht=ui[Dt];Vt=yi[Ht];zt=_i[Ht];if(zt!==void 0)for(xe=0;xe<3;xe++){Te=zt[xe];je[Ve]=Te.u;je[Ve+1]=Te.v;Ve=Ve+2}}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Ht=fi[Dt];Vt=yi[Ht];zt=_i[Ht];if(zt!==void 0)for(xe=0;xe<4;xe++){Te=zt[xe];je[Ve]=Te.u;je[Ve+1]=Te.v;Ve=Ve+2}}if(Ve>0){L.bindBuffer(L.ARRAY_BUFFER,gt.__webglUV2Buffer);L.bufferData(L.ARRAY_BUFFER,je,Tt)}}if(ai){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Vt=yi[ui[Dt]];oi[Le]=De;oi[Le+1]=De+1;oi[Le+2]=De+2;Le=Le+3;ri[Ie]=De;ri[Ie+1]=De+1;ri[Ie+2]=De;ri[Ie+3]=De+2;ri[Ie+4]=De+1;ri[Ie+5]=De+2;Ie=Ie+6;De=De+3}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Vt=yi[fi[Dt]];oi[Le]=De;oi[Le+1]=De+1;oi[Le+2]=De+3;oi[Le+3]=De+1;oi[Le+4]=De+2;oi[Le+5]=De+3;Le=Le+6;ri[Ie]=De;ri[Ie+1]=De+1;ri[Ie+2]=De;ri[Ie+3]=De+3;ri[Ie+4]=De+1;ri[Ie+5]=De+2;ri[Ie+6]=De+2;ri[Ie+7]=De+3;Ie=Ie+8;De=De+4}L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,gt.__webglFaceBuffer);L.bufferData(L.ELEMENT_ARRAY_BUFFER,oi,Tt);L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,gt.__webglLineBuffer);L.bufferData(L.ELEMENT_ARRAY_BUFFER,ri,Tt)}if(ei){xe=0;for(Ee=ei.length;xe<Ee;xe++){ii=ei[xe];if(ii.__original.needsUpdate){Ne=0;if(ii.size===1)if(ii.boundTo===void 0||ii.boundTo==="vertices"){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Vt=yi[ui[Dt]];ii.array[Ne]=ii.value[Vt.a];ii.array[Ne+1]=ii.value[Vt.b];ii.array[Ne+2]=ii.value[Vt.c];Ne=Ne+3}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Vt=yi[fi[Dt]];ii.array[Ne]=ii.value[Vt.a];ii.array[Ne+1]=ii.value[Vt.b];ii.array[Ne+2]=ii.value[Vt.c];ii.array[Ne+3]=ii.value[Vt.d];Ne=Ne+4}}else{if(ii.boundTo==="faces"){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){ke=ii.value[ui[Dt]];ii.array[Ne]=ke;ii.array[Ne+1]=ke;ii.array[Ne+2]=ke;Ne=Ne+3}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){ke=ii.value[fi[Dt]];ii.array[Ne]=ke;ii.array[Ne+1]=ke;ii.array[Ne+2]=ke;ii.array[Ne+3]=ke;Ne=Ne+4}}}else if(ii.size===2)if(ii.boundTo===void 0||ii.boundTo==="vertices"){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Vt=yi[ui[Dt]];Nt=ii.value[Vt.a];kt=ii.value[Vt.b];Ot=ii.value[Vt.c];ii.array[Ne]=Nt.x;ii.array[Ne+1]=Nt.y;ii.array[Ne+2]=kt.x;ii.array[Ne+3]=kt.y;ii.array[Ne+4]=Ot.x;ii.array[Ne+5]=Ot.y;Ne=Ne+6}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Vt=yi[fi[Dt]];Nt=ii.value[Vt.a];kt=ii.value[Vt.b];Ot=ii.value[Vt.c];Wt=ii.value[Vt.d];ii.array[Ne]=Nt.x;ii.array[Ne+1]=Nt.y;ii.array[Ne+2]=kt.x;ii.array[Ne+3]=kt.y;ii.array[Ne+4]=Ot.x;ii.array[Ne+5]=Ot.y;ii.array[Ne+6]=Wt.x;ii.array[Ne+7]=Wt.y;Ne=Ne+8}}else{if(ii.boundTo==="faces"){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Ot=kt=Nt=ke=ii.value[ui[Dt]];ii.array[Ne]=Nt.x;ii.array[Ne+1]=Nt.y;ii.array[Ne+2]=kt.x;ii.array[Ne+3]=kt.y;ii.array[Ne+4]=Ot.x;ii.array[Ne+5]=Ot.y;Ne=Ne+6}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Wt=Ot=kt=Nt=ke=ii.value[fi[Dt]];ii.array[Ne]=Nt.x;ii.array[Ne+1]=Nt.y;ii.array[Ne+2]=kt.x;ii.array[Ne+3]=kt.y;ii.array[Ne+4]=Ot.x;ii.array[Ne+5]=Ot.y;ii.array[Ne+6]=Wt.x;ii.array[Ne+7]=Wt.y;Ne=Ne+8}}}else if(ii.size===3){var Ri;Ri=ii.type==="c"?["r","g","b"]:["x","y","z"];if(ii.boundTo===void 0||ii.boundTo==="vertices"){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Vt=yi[ui[Dt]];Nt=ii.value[Vt.a];kt=ii.value[Vt.b];Ot=ii.value[Vt.c];ii.array[Ne]=Nt[Ri[0]];ii.array[Ne+1]=Nt[Ri[1]];ii.array[Ne+2]=Nt[Ri[2]];ii.array[Ne+3]=kt[Ri[0]];ii.array[Ne+4]=kt[Ri[1]];ii.array[Ne+5]=kt[Ri[2]];ii.array[Ne+6]=Ot[Ri[0]];ii.array[Ne+7]=Ot[Ri[1]];ii.array[Ne+8]=Ot[Ri[2]];Ne=Ne+9}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Vt=yi[fi[Dt]];Nt=ii.value[Vt.a];kt=ii.value[Vt.b];Ot=ii.value[Vt.c];Wt=ii.value[Vt.d];ii.array[Ne]=Nt[Ri[0]];ii.array[Ne+1]=Nt[Ri[1]];ii.array[Ne+2]=Nt[Ri[2]];ii.array[Ne+3]=kt[Ri[0]];ii.array[Ne+4]=kt[Ri[1]];ii.array[Ne+5]=kt[Ri[2]];ii.array[Ne+6]=Ot[Ri[0]];ii.array[Ne+7]=Ot[Ri[1]];ii.array[Ne+8]=Ot[Ri[2]];ii.array[Ne+9]=Wt[Ri[0]];ii.array[Ne+10]=Wt[Ri[1]];ii.array[Ne+11]=Wt[Ri[2]];Ne=Ne+12}}else if(ii.boundTo==="faces"){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Ot=kt=Nt=ke=ii.value[ui[Dt]];ii.array[Ne]=Nt[Ri[0]];ii.array[Ne+1]=Nt[Ri[1]];ii.array[Ne+2]=Nt[Ri[2]];ii.array[Ne+3]=kt[Ri[0]];ii.array[Ne+4]=kt[Ri[1]];ii.array[Ne+5]=kt[Ri[2]];ii.array[Ne+6]=Ot[Ri[0]];ii.array[Ne+7]=Ot[Ri[1]];ii.array[Ne+8]=Ot[Ri[2]];Ne=Ne+9}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Wt=Ot=kt=Nt=ke=ii.value[fi[Dt]];ii.array[Ne]=Nt[Ri[0]];ii.array[Ne+1]=Nt[Ri[1]];ii.array[Ne+2]=Nt[Ri[2]];ii.array[Ne+3]=kt[Ri[0]];ii.array[Ne+4]=kt[Ri[1]];ii.array[Ne+5]=kt[Ri[2]];ii.array[Ne+6]=Ot[Ri[0]];ii.array[Ne+7]=Ot[Ri[1]];ii.array[Ne+8]=Ot[Ri[2]];ii.array[Ne+9]=Wt[Ri[0]];ii.array[Ne+10]=Wt[Ri[1]];ii.array[Ne+11]=Wt[Ri[2]];Ne=Ne+12}}}else if(ii.size===4)if(ii.boundTo===void 0||ii.boundTo==="vertices"){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Vt=yi[ui[Dt]];Nt=ii.value[Vt.a];kt=ii.value[Vt.b];Ot=ii.value[Vt.c];ii.array[Ne]=Nt.x;ii.array[Ne+1]=Nt.y;ii.array[Ne+2]=Nt.z;ii.array[Ne+3]=Nt.w;ii.array[Ne+4]=kt.x;ii.array[Ne+5]=kt.y;ii.array[Ne+6]=kt.z;ii.array[Ne+7]=kt.w;ii.array[Ne+8]=Ot.x;ii.array[Ne+9]=Ot.y;ii.array[Ne+10]=Ot.z;ii.array[Ne+11]=Ot.w;Ne=Ne+12}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Vt=yi[fi[Dt]];Nt=ii.value[Vt.a];kt=ii.value[Vt.b];Ot=ii.value[Vt.c];Wt=ii.value[Vt.d];ii.array[Ne]=Nt.x;ii.array[Ne+1]=Nt.y;ii.array[Ne+2]=Nt.z;ii.array[Ne+3]=Nt.w;ii.array[Ne+4]=kt.x;ii.array[Ne+5]=kt.y;ii.array[Ne+6]=kt.z;ii.array[Ne+7]=kt.w;ii.array[Ne+8]=Ot.x;ii.array[Ne+9]=Ot.y;ii.array[Ne+10]=Ot.z;ii.array[Ne+11]=Ot.w;ii.array[Ne+12]=Wt.x;ii.array[Ne+13]=Wt.y;ii.array[Ne+14]=Wt.z;ii.array[Ne+15]=Wt.w;Ne=Ne+16}}else if(ii.boundTo==="faces"){Dt=0;for(Bt=ui.length;Dt<Bt;Dt++){Ot=kt=Nt=ke=ii.value[ui[Dt]];ii.array[Ne]=Nt.x;ii.array[Ne+1]=Nt.y;ii.array[Ne+2]=Nt.z;ii.array[Ne+3]=Nt.w;ii.array[Ne+4]=kt.x;ii.array[Ne+5]=kt.y;ii.array[Ne+6]=kt.z;ii.array[Ne+7]=kt.w;ii.array[Ne+8]=Ot.x;ii.array[Ne+9]=Ot.y;ii.array[Ne+10]=Ot.z;ii.array[Ne+11]=Ot.w;Ne=Ne+12}Dt=0;for(Bt=fi.length;Dt<Bt;Dt++){Wt=Ot=kt=Nt=ke=ii.value[fi[Dt]];ii.array[Ne]=Nt.x;ii.array[Ne+1]=Nt.y;ii.array[Ne+2]=Nt.z;ii.array[Ne+3]=Nt.w;ii.array[Ne+4]=kt.x;ii.array[Ne+5]=kt.y;ii.array[Ne+6]=kt.z;ii.array[Ne+7]=kt.w;ii.array[Ne+8]=Ot.x;ii.array[Ne+9]=Ot.y;ii.array[Ne+10]=Ot.z;ii.array[Ne+11]=Ot.w;ii.array[Ne+12]=Wt.x;ii.array[Ne+13]=Wt.y;ii.array[Ne+14]=Wt.z;ii.array[Ne+15]=Wt.w;Ne=Ne+16}}L.bindBuffer(L.ARRAY_BUFFER,ii.buffer);L.bufferData(L.ARRAY_BUFFER,ii.array,Tt)}}}if(Rt){delete gt.__inittedArrays;delete gt.__colorArray;delete gt.__normalArray;delete gt.__tangentArray;delete gt.__uvArray;delete gt.__uv2Array;delete gt.__faceArray;delete gt.__vertexArray;delete gt.__lineArray;delete gt.__skinVertexAArray;delete gt.__skinVertexBArray;delete gt.__skinIndexArray;delete gt.__skinWeightArray}}}}yt.verticesNeedUpdate=false;yt.morphTargetsNeedUpdate=false;yt.elementsNeedUpdate=false;yt.uvsNeedUpdate=false;yt.normalsNeedUpdate=false;yt.colorsNeedUpdate=false;yt.tangetsNeedUpdate=false;vt.attributes&&p(vt)}else if(ft instanceof THREE.Ribbon){if(yt.verticesNeedUpdate||yt.colorsNeedUpdate){var wi=yt,Si=L.DYNAMIC_DRAW,Ci=void 0,Ai=void 0,Mi=void 0,Di=void 0,Bi=void 0,Hi=wi.vertices,Vi=wi.colors,Li=Hi.length,Pi=Vi.length,Fi=wi.__vertexArray,Ii=wi.__colorArray,Ui=wi.colorsNeedUpdate;if(wi.verticesNeedUpdate){for(Ci=0;Ci<Li;Ci++){Mi=Hi[Ci];Di=Ci*3;Fi[Di]=Mi.x;Fi[Di+1]=Mi.y;Fi[Di+2]=Mi.z}L.bindBuffer(L.ARRAY_BUFFER,wi.__webglVertexBuffer);L.bufferData(L.ARRAY_BUFFER,Fi,Si)}if(Ui){for(Ai=0;Ai<Pi;Ai++){Bi=Vi[Ai];Di=Ai*3;Ii[Di]=Bi.r;Ii[Di+1]=Bi.g;Ii[Di+2]=Bi.b}L.bindBuffer(L.ARRAY_BUFFER,wi.__webglColorBuffer);L.bufferData(L.ARRAY_BUFFER,Ii,Si)}}yt.verticesNeedUpdate=false;yt.colorsNeedUpdate=false}else if(ft instanceof THREE.Line){vt=i(ft,dt);_t=vt.attributes&&m(vt);if(yt.verticesNeedUpdate||yt.colorsNeedUpdate||_t){var Gi=yt,zi=L.DYNAMIC_DRAW,Ni=void 0,ki=void 0,Oi=void 0,Wi=void 0,ji=void 0,Ji=Gi.vertices,Xi=Gi.colors,qi=Ji.length,Yi=Xi.length,Ki=Gi.__vertexArray,Zi=Gi.__colorArray,Qi=Gi.colorsNeedUpdate,$i=Gi.__webglCustomAttributesList,to=void 0,eo=void 0,io=void 0,oo=void 0,ro=void 0,no=void 0;if(Gi.verticesNeedUpdate){for(Ni=0;Ni<qi;Ni++){Oi=Ji[Ni];Wi=Ni*3;Ki[Wi]=Oi.x;Ki[Wi+1]=Oi.y;Ki[Wi+2]=Oi.z}L.bindBuffer(L.ARRAY_BUFFER,Gi.__webglVertexBuffer);L.bufferData(L.ARRAY_BUFFER,Ki,zi)}if(Qi){for(ki=0;ki<Yi;ki++){ji=Xi[ki];Wi=ki*3;Zi[Wi]=ji.r;Zi[Wi+1]=ji.g;Zi[Wi+2]=ji.b}L.bindBuffer(L.ARRAY_BUFFER,Gi.__webglColorBuffer);L.bufferData(L.ARRAY_BUFFER,Zi,zi)}if($i){to=0;for(eo=$i.length;to<eo;to++){no=$i[to];if(no.needsUpdate&&(no.boundTo===void 0||no.boundTo==="vertices")){Wi=0;oo=no.value.length;if(no.size===1)for(io=0;io<oo;io++)no.array[io]=no.value[io];else if(no.size===2)for(io=0;io<oo;io++){ro=no.value[io];no.array[Wi]=ro.x;no.array[Wi+1]=ro.y;Wi=Wi+2}else if(no.size===3)if(no.type==="c")for(io=0;io<oo;io++){ro=no.value[io];no.array[Wi]=ro.r;no.array[Wi+1]=ro.g;no.array[Wi+2]=ro.b;Wi=Wi+3}else for(io=0;io<oo;io++){ro=no.value[io];no.array[Wi]=ro.x;no.array[Wi+1]=ro.y;no.array[Wi+2]=ro.z;Wi=Wi+3}else if(no.size===4)for(io=0;io<oo;io++){ro=no.value[io];no.array[Wi]=ro.x;no.array[Wi+1]=ro.y;no.array[Wi+2]=ro.z;no.array[Wi+3]=ro.w;Wi=Wi+4}L.bindBuffer(L.ARRAY_BUFFER,no.buffer);L.bufferData(L.ARRAY_BUFFER,no.array,zi)}}}}yt.verticesNeedUpdate=false;yt.colorsNeedUpdate=false;vt.attributes&&p(vt)}else if(ft instanceof THREE.ParticleSystem){vt=i(ft,dt);_t=vt.attributes&&m(vt);(yt.verticesNeedUpdate||yt.colorsNeedUpdate||ft.sortParticles||_t)&&n(yt,L.DYNAMIC_DRAW,ft);yt.verticesNeedUpdate=false;yt.colorsNeedUpdate=false;vt.attributes&&p(vt)}}};this.initMaterial=function(t,e,i,o){var r,n,a;t instanceof THREE.MeshDepthMaterial?a="depth":t instanceof THREE.MeshNormalMaterial?a="normal":t instanceof THREE.MeshBasicMaterial?a="basic":t instanceof THREE.MeshLambertMaterial?a="lambert":t instanceof THREE.MeshPhongMaterial?a="phong":t instanceof THREE.LineBasicMaterial?a="basic":t instanceof THREE.ParticleBasicMaterial&&(a="particle_basic");if(a){var s=THREE.ShaderLib[a];t.uniforms=THREE.UniformsUtils.clone(s.uniforms);t.vertexShader=s.vertexShader;t.fragmentShader=s.fragmentShader}var l,c,h,m,p;l=m=p=s=0;for(c=e.length;l<c;l++){h=e[l];if(!h.onlyShadow){h instanceof THREE.DirectionalLight&&m++;h instanceof THREE.PointLight&&p++;h instanceof THREE.SpotLight&&s++}}if(p+s+m<=H){c=m;h=p;m=s}else{c=Math.ceil(H*m/(p+m));m=h=H-c}var u=0,s=0;for(p=e.length;s<p;s++){l=e[s];if(l.castShadow){l instanceof THREE.SpotLight&&u++;l instanceof THREE.DirectionalLight&&!l.shadowCascade&&u++}}var f=50;if(o!==void 0&&o instanceof THREE.SkinnedMesh)f=o.bones.length;var y;t:{p=t.fragmentShader;l=t.vertexShader;var s=t.uniforms,e=t.attributes,i={map:!!t.map,envMap:!!t.envMap,lightMap:!!t.lightMap,vertexColors:t.vertexColors,fog:i,useFog:t.fog,sizeAttenuation:t.sizeAttenuation,skinning:t.skinning,maxBones:f,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:c,maxPointLights:h,maxSpotLights:m,maxShadows:u,shadowMapEnabled:this.shadowMapEnabled&&o.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:t.alphaTest,metal:t.metal,perPixel:t.perPixel,wrapAround:t.wrapAround,doubleSided:o&&o.doubleSided},d,o=[];if(a)o.push(a);else{o.push(p);o.push(l)}for(d in i){o.push(d);o.push(i[d])}a=o.join();d=0;for(o=P.length;d<o;d++)if(P[d].code===a){y=P[d].program;break t}d=L.createProgram();o=["precision "+R+" float;",ut>0?"#define VERTEX_TEXTURES":"",V.gammaInput?"#define GAMMA_INPUT":"",V.gammaOutput?"#define GAMMA_OUTPUT":"",V.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.vertexColors?"#define USE_COLOR":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals?"#define USE_MORPHNORMALS":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapSoft?"#define SHADOWMAP_SOFT":"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");c=["precision "+R+" float;","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_SHADOWS "+i.maxShadows,i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",V.gammaInput?"#define GAMMA_INPUT":"",V.gammaOutput?"#define GAMMA_OUTPUT":"",V.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.vertexColors?"#define USE_COLOR":"",i.metal?"#define METAL":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapSoft?"#define SHADOWMAP_SOFT":"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");L.attachShader(d,v("fragment",c+p));L.attachShader(d,v("vertex",o+l));L.linkProgram(d);L.getProgramParameter(d,L.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+L.getProgramParameter(d,L.VALIDATE_STATUS)+", gl error ["+L.getError()+"]");d.uniforms={};d.attributes={};var _,o=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","boneGlobalMatrices","morphTargetInfluences"];for(_ in s)o.push(_);_=o;o=0;for(s=_.length;o<s;o++){p=_[o];d.uniforms[p]=L.getUniformLocation(d,p)}o=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(_=0;_<i.maxMorphTargets;_++)o.push("morphTarget"+_);for(_=0;_<i.maxMorphNormals;_++)o.push("morphNormal"+_);for(y in e)o.push(y);y=o;_=0;for(e=y.length;_<e;_++){i=y[_];d.attributes[i]=L.getAttribLocation(d,i)}d.id=P.length;P.push({program:d,code:a});V.info.memory.programs=P.length;y=d}t.program=y;y=t.program.attributes;y.position>=0&&L.enableVertexAttribArray(y.position);y.color>=0&&L.enableVertexAttribArray(y.color);y.normal>=0&&L.enableVertexAttribArray(y.normal);y.tangent>=0&&L.enableVertexAttribArray(y.tangent);if(t.skinning&&y.skinVertexA>=0&&y.skinVertexB>=0&&y.skinIndex>=0&&y.skinWeight>=0){L.enableVertexAttribArray(y.skinVertexA);L.enableVertexAttribArray(y.skinVertexB);L.enableVertexAttribArray(y.skinIndex);L.enableVertexAttribArray(y.skinWeight)}if(t.attributes)for(n in t.attributes)y[n]!==void 0&&y[n]>=0&&L.enableVertexAttribArray(y[n]);if(t.morphTargets){t.numSupportedMorphTargets=0;d="morphTarget";for(n=0;n<this.maxMorphTargets;n++){_=d+n;if(y[_]>=0){L.enableVertexAttribArray(y[_]);t.numSupportedMorphTargets++}}}if(t.morphNormals){t.numSupportedMorphNormals=0;d="morphNormal";for(n=0;n<this.maxMorphNormals;n++){_=d+n;if(y[_]>=0){L.enableVertexAttribArray(y[_]);t.numSupportedMorphNormals++}}}t.uniformsList=[];for(r in t.uniforms)t.uniformsList.push([t.uniforms[r],r])};this.setFaceCulling=function(t,e){if(t){!e||e==="ccw"?L.frontFace(L.CCW):L.frontFace(L.CW);t==="back"?L.cullFace(L.BACK):t==="front"?L.cullFace(L.FRONT):L.cullFace(L.FRONT_AND_BACK);L.enable(L.CULL_FACE)}else L.disable(L.CULL_FACE)};this.setObjectFaces=function(t){if(k!==t.doubleSided){t.doubleSided?L.disable(L.CULL_FACE):L.enable(L.CULL_FACE);k=t.doubleSided}if(O!==t.flipSided){t.flipSided?L.frontFace(L.CW):L.frontFace(L.CCW);O=t.flipSided}};this.setDepthTest=function(t){if(q!==t){t?L.enable(L.DEPTH_TEST):L.disable(L.DEPTH_TEST);q=t}};this.setDepthWrite=function(t){if(Y!==t){L.depthMask(t);Y=t}};this.setBlending=function(t,e,i,o){if(t!==W){switch(t){case THREE.NoBlending:L.disable(L.BLEND);break;case THREE.AdditiveBlending:L.enable(L.BLEND);L.blendEquation(L.FUNC_ADD);L.blendFunc(L.SRC_ALPHA,L.ONE);break;case THREE.SubtractiveBlending:L.enable(L.BLEND);L.blendEquation(L.FUNC_ADD);L.blendFunc(L.ZERO,L.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:L.enable(L.BLEND);L.blendEquation(L.FUNC_ADD);L.blendFunc(L.ZERO,L.SRC_COLOR);break;case THREE.CustomBlending:L.enable(L.BLEND);break;default:L.enable(L.BLEND);L.blendEquationSeparate(L.FUNC_ADD,L.FUNC_ADD);L.blendFuncSeparate(L.SRC_ALPHA,L.ONE_MINUS_SRC_ALPHA,L.ONE,L.ONE_MINUS_SRC_ALPHA)}W=t}if(t===THREE.CustomBlending){if(e!==j){L.blendEquation(b(e));j=e}if(i!==J||o!==X){L.blendFunc(b(i),b(o));J=i;X=o}}else X=J=j=null};this.setTexture=function(t,e){if(t.needsUpdate){if(!t.__webglInit){t.__webglInit=true;t.__webglTexture=L.createTexture();V.info.memory.textures++}L.activeTexture(L.TEXTURE0+e);L.bindTexture(L.TEXTURE_2D,t.__webglTexture);L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha);var i=t.image,o=(i.width&i.width-1)===0&&(i.height&i.height-1)===0,r=b(t.format),n=b(t.type);x(L.TEXTURE_2D,t,o);t instanceof THREE.DataTexture?L.texImage2D(L.TEXTURE_2D,0,r,i.width,i.height,0,r,n,i.data):L.texImage2D(L.TEXTURE_2D,0,r,r,n,t.image);t.generateMipmaps&&o&&L.generateMipmap(L.TEXTURE_2D);t.needsUpdate=false;if(t.onUpdate)t.onUpdate()}else{L.activeTexture(L.TEXTURE0+e);L.bindTexture(L.TEXTURE_2D,t.__webglTexture)}};this.setRenderTarget=function(t){var e=t instanceof THREE.WebGLRenderTargetCube;if(t&&!t.__webglFramebuffer){if(t.depthBuffer===void 0)t.depthBuffer=true;if(t.stencilBuffer===void 0)t.stencilBuffer=true;t.__webglTexture=L.createTexture();var i=(t.width&t.width-1)===0&&(t.height&t.height-1)===0,o=b(t.format),r=b(t.type);if(e){t.__webglFramebuffer=[];t.__webglRenderbuffer=[];L.bindTexture(L.TEXTURE_CUBE_MAP,t.__webglTexture);x(L.TEXTURE_CUBE_MAP,t,i);for(var n=0;n<6;n++){t.__webglFramebuffer[n]=L.createFramebuffer();t.__webglRenderbuffer[n]=L.createRenderbuffer();L.texImage2D(L.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,o,t.width,t.height,0,o,r,null);var a=t,s=L.TEXTURE_CUBE_MAP_POSITIVE_X+n;L.bindFramebuffer(L.FRAMEBUFFER,t.__webglFramebuffer[n]);L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,s,a.__webglTexture,0);E(t.__webglRenderbuffer[n],t)}i&&L.generateMipmap(L.TEXTURE_CUBE_MAP)}else{t.__webglFramebuffer=L.createFramebuffer();t.__webglRenderbuffer=L.createRenderbuffer();L.bindTexture(L.TEXTURE_2D,t.__webglTexture);x(L.TEXTURE_2D,t,i);L.texImage2D(L.TEXTURE_2D,0,o,t.width,t.height,0,o,r,null);o=L.TEXTURE_2D;L.bindFramebuffer(L.FRAMEBUFFER,t.__webglFramebuffer);L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,o,t.__webglTexture,0);E(t.__webglRenderbuffer,t);i&&L.generateMipmap(L.TEXTURE_2D)}e?L.bindTexture(L.TEXTURE_CUBE_MAP,null):L.bindTexture(L.TEXTURE_2D,null);L.bindRenderbuffer(L.RENDERBUFFER,null);L.bindFramebuffer(L.FRAMEBUFFER,null)}if(t){e=e?t.__webglFramebuffer[t.activeCubeFace]:t.__webglFramebuffer;i=t.width;t=t.height;r=o=0}else{e=null;i=it;t=ot;o=tt;r=et}if(e!==I){L.bindFramebuffer(L.FRAMEBUFFER,e);L.viewport(o,r,i,t);I=e}rt=i;nt=t};this.shadowMapPlugin=new THREE.ShadowMapPlugin;this.addPrePlugin(this.shadowMapPlugin);this.addPostPlugin(new THREE.SpritePlugin)};THREE.WebGLRenderTarget=function(t,e,i){this.width=t;this.height=e;i=i||{};this.wrapS=i.wrapS!==void 0?i.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=i.wrapT!==void 0?i.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=i.magFilter!==void 0?i.magFilter:THREE.LinearFilter;this.minFilter=i.minFilter!==void 0?i.minFilter:THREE.LinearMipMapLinearFilter;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=i.format!==void 0?i.format:THREE.RGBAFormat;this.type=i.type!==void 0?i.type:THREE.UnsignedByteType;this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:true;this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:true;this.generateMipmaps=true};THREE.WebGLRenderTarget.prototype.clone=function(){var t=new THREE.WebGLRenderTarget(this.width,this.height);t.wrapS=this.wrapS;t.wrapT=this.wrapT;t.magFilter=this.magFilter;t.minFilter=this.minFilter;t.offset.copy(this.offset);t.repeat.copy(this.repeat);t.format=this.format;t.type=this.type;t.depthBuffer=this.depthBuffer;t.stencilBuffer=this.stencilBuffer;return t};THREE.WebGLRenderTargetCube=function(t,e,i){THREE.WebGLRenderTarget.call(this,t,e,i);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=new THREE.WebGLRenderTarget;THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=true};THREE.RenderableVertex.prototype.copy=function(t){this.positionWorld.copy(t.positionWorld);this.positionScreen.copy(t.positionScreen)};THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.v4=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};THREE.RenderableObject=function(){this.z=this.object=null};THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new THREE.Vector2;this.material=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.material=null};THREE.ColorUtils={adjustHSV:function(t,e,i,o){var r=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(t,r);r.h=THREE.Math.clamp(r.h+e,0,1);r.s=THREE.Math.clamp(r.s+i,0,1);r.v=THREE.Math.clamp(r.v+o,0,1);t.setHSV(r.h,r.s,r.v)},rgbToHsv:function(t,e){var i=t.r,o=t.g,r=t.b,n=Math.max(Math.max(i,o),r),a=Math.min(Math.min(i,o),r);if(a===n)a=i=0;else{var s=n-a,a=s/n,i=(i===n?(o-r)/s:o===n?2+(r-i)/s:4+(i-o)/s)/6;i<0&&(i=i+1);i>1&&(i=i-1)}e===void 0&&(e={h:0,s:0,v:0});e.h=i;e.s=a;e.v=n;return e}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};THREE.GeometryUtils={merge:function(t,e){for(var i,o,r=t.vertices.length,n=e instanceof THREE.Mesh?e.geometry:e,a=t.vertices,s=n.vertices,l=t.faces,c=n.faces,h=t.faceVertexUvs[0],m=n.faceVertexUvs[0],p={},u=0;u<t.materials.length;u++)p[t.materials[u].id]=u;if(e instanceof THREE.Mesh){e.matrixAutoUpdate&&e.updateMatrix();i=e.matrix;o=new THREE.Matrix4;o.extractRotation(i,e.scale)}for(var u=0,f=s.length;u<f;u++){var y=s[u].clone();i&&i.multiplyVector3(y);a.push(y)}u=0;for(f=c.length;u<f;u++){var a=c[u],d,_,v=a.vertexNormals,x=a.vertexColors;a instanceof THREE.Face3?d=new THREE.Face3(a.a+r,a.b+r,a.c+r):a instanceof THREE.Face4&&(d=new THREE.Face4(a.a+r,a.b+r,a.c+r,a.d+r));d.normal.copy(a.normal);o&&o.multiplyVector3(d.normal);s=0;for(y=v.length;s<y;s++){_=v[s].clone();o&&o.multiplyVector3(_);d.vertexNormals.push(_)}d.color.copy(a.color);s=0;for(y=x.length;s<y;s++){_=x[s];d.vertexColors.push(_.clone())}if(a.materialIndex!==void 0){s=n.materials[a.materialIndex];y=s.id;x=p[y];if(x===void 0){x=t.materials.length;p[y]=x;t.materials.push(s)}d.materialIndex=x}d.centroid.copy(a.centroid);i&&i.multiplyVector3(d.centroid);l.push(d)}u=0;for(f=m.length;u<f;u++){i=m[u];o=[];s=0;for(y=i.length;s<y;s++)o.push(new THREE.UV(i[s].u,i[s].v));h.push(o)}},clone:function(t){var e=new THREE.Geometry,i,o=t.vertices,r=t.faces,n=t.faceVertexUvs[0];if(t.materials)e.materials=t.materials.slice();t=0;for(i=o.length;t<i;t++)e.vertices.push(o[t].clone());t=0;for(i=r.length;t<i;t++)e.faces.push(r[t].clone());t=0;for(i=n.length;t<i;t++){for(var o=n[t],r=[],a=0,s=o.length;a<s;a++)r.push(new THREE.UV(o[a].u,o[a].v));e.faceVertexUvs[0].push(r)}return e},randomPointInTriangle:function(t,e,i){var o,r,n,a=new THREE.Vector3,s=THREE.GeometryUtils.__v1;o=THREE.GeometryUtils.random();r=THREE.GeometryUtils.random();if(o+r>1){o=1-o;r=1-r}n=1-o-r;a.copy(t);a.multiplyScalar(o);s.copy(e);s.multiplyScalar(r);a.addSelf(s);s.copy(i);s.multiplyScalar(n);a.addSelf(s);return a},randomPointInFace:function(t,e,i){var o,r,n;if(t instanceof THREE.Face3){o=e.vertices[t.a];r=e.vertices[t.b];n=e.vertices[t.c];return THREE.GeometryUtils.randomPointInTriangle(o,r,n)}if(t instanceof THREE.Face4){o=e.vertices[t.a];r=e.vertices[t.b];n=e.vertices[t.c];var e=e.vertices[t.d],a;if(i)if(t._area1&&t._area2){i=t._area1;a=t._area2}else{i=THREE.GeometryUtils.triangleArea(o,r,e);a=THREE.GeometryUtils.triangleArea(r,n,e);t._area1=i;t._area2=a}else{i=THREE.GeometryUtils.triangleArea(o,r,e);a=THREE.GeometryUtils.triangleArea(r,n,e)}return THREE.GeometryUtils.random()*(i+a)<i?THREE.GeometryUtils.randomPointInTriangle(o,r,e):THREE.GeometryUtils.randomPointInTriangle(r,n,e)}},randomPointsInGeometry:function(t,e){function i(t){function e(i,o){if(o<i)return i;var r=i+Math.floor((o-i)/2);return c[r]>t?e(i,r-1):c[r]<t?e(r+1,o):r}return e(0,c.length-1)}var o,r,n=t.faces,a=t.vertices,s=n.length,l=0,c=[],h,m,p,u;for(r=0;r<s;r++){o=n[r];if(o instanceof THREE.Face3){h=a[o.a];m=a[o.b];p=a[o.c];o._area=THREE.GeometryUtils.triangleArea(h,m,p)}else if(o instanceof THREE.Face4){h=a[o.a];m=a[o.b];p=a[o.c];u=a[o.d];o._area1=THREE.GeometryUtils.triangleArea(h,m,u);o._area2=THREE.GeometryUtils.triangleArea(m,p,u);o._area=o._area1+o._area2}l=l+o._area;c[r]=l}o=[];for(r=0;r<e;r++){a=THREE.GeometryUtils.random()*l;a=i(a);o[r]=THREE.GeometryUtils.randomPointInFace(n[a],t,true)}return o},triangleArea:function(t,e,i){var o,r=THREE.GeometryUtils.__v1;r.sub(t,e);o=r.length();r.sub(t,i);t=r.length();r.sub(e,i);i=r.length();e=.5*(o+t+i);return Math.sqrt(e*(e-o)*(e-t)*(e-i))},center:function(t){t.computeBoundingBox();var e=t.boundingBox,i=new THREE.Vector3;i.add(e.min,e.max);i.multiplyScalar(-.5);t.applyMatrix((new THREE.Matrix4).makeTranslation(i.x,i.y,i.z));t.computeBoundingBox();return i},normalizeUVs:function(t){for(var t=t.faceVertexUvs[0],e=0,i=t.length;e<i;e++)for(var o=t[e],r=0,n=o.length;r<n;r++){if(o[r].u!==1)o[r].u=o[r].u-Math.floor(o[r].u);if(o[r].v!==1)o[r].v=o[r].v-Math.floor(o[r].v)}},triangulateQuads:function(t){var e,i,o,r,n=[],a=[],s=[];e=0;for(i=t.faceUvs.length;e<i;e++)a[e]=[];e=0;for(i=t.faceVertexUvs.length;e<i;e++)s[e]=[];e=0;for(i=t.faces.length;e<i;e++){o=t.faces[e];if(o instanceof THREE.Face4){r=o.a;var l=o.b,c=o.c,h=o.d,m=new THREE.Face3,p=new THREE.Face3;m.color.copy(o.color);p.color.copy(o.color);m.materialIndex=o.materialIndex;p.materialIndex=o.materialIndex;m.a=r;m.b=l;m.c=h;p.a=l;p.b=c;p.c=h;if(o.vertexColors.length===4){m.vertexColors[0]=o.vertexColors[0].clone();m.vertexColors[1]=o.vertexColors[1].clone();m.vertexColors[2]=o.vertexColors[3].clone();p.vertexColors[0]=o.vertexColors[1].clone();p.vertexColors[1]=o.vertexColors[2].clone();p.vertexColors[2]=o.vertexColors[3].clone()}n.push(m,p);o=0;for(r=t.faceVertexUvs.length;o<r;o++)if(t.faceVertexUvs[o].length){m=t.faceVertexUvs[o][e];l=m[1];c=m[2];h=m[3];m=[m[0].clone(),l.clone(),h.clone()];l=[l.clone(),c.clone(),h.clone()];s[o].push(m,l)}o=0;for(r=t.faceUvs.length;o<r;o++)if(t.faceUvs[o].length){l=t.faceUvs[o][e];a[o].push(l,l)}}else{n.push(o);o=0;for(r=t.faceUvs.length;o<r;o++)a[o].push(t.faceUvs[o]);o=0;for(r=t.faceVertexUvs.length;o<r;o++)s[o].push(t.faceVertexUvs[o])}}t.faces=n;t.faceUvs=a;t.faceVertexUvs=s;t.computeCentroids();t.computeFaceNormals();t.computeVertexNormals();t.hasTangents&&t.computeTangents()},explode:function(t){for(var e=[],i=0,o=t.faces.length;i<o;i++){var r=e.length,n=t.faces[i];if(n instanceof THREE.Face4){var a=n.a,s=n.b,l=n.c,a=t.vertices[a],s=t.vertices[s],l=t.vertices[l],c=t.vertices[n.d];e.push(a.clone());e.push(s.clone());e.push(l.clone());e.push(c.clone());n.a=r;n.b=r+1;n.c=r+2;n.d=r+3}else{a=n.a;s=n.b;l=n.c;a=t.vertices[a];s=t.vertices[s];l=t.vertices[l];e.push(a.clone());e.push(s.clone());e.push(l.clone());n.a=r;n.b=r+1;n.c=r+2}}t.vertices=e;delete t.__tmpVertices},tessellate:function(t,e){var i,o,r,n,a,s,l,c,h,m,p,u,f,y,d,_,v,x,E,g=[],b=[];i=0;for(o=t.faceVertexUvs.length;i<o;i++)b[i]=[];i=0;for(o=t.faces.length;i<o;i++){r=t.faces[i];if(r instanceof THREE.Face3){n=r.a;a=r.b;s=r.c;c=t.vertices[n];h=t.vertices[a];m=t.vertices[s];u=c.distanceTo(h);f=h.distanceTo(m);p=c.distanceTo(m);if(u>e||f>e||p>e){l=t.vertices.length;x=r.clone();E=r.clone();if(u>=f&&u>=p){c=c.clone();c.lerpSelf(h,.5);x.a=n;x.b=l;x.c=s;E.a=l;E.b=a;E.c=s;if(r.vertexNormals.length===3){n=r.vertexNormals[0].clone();n.lerpSelf(r.vertexNormals[1],.5);x.vertexNormals[1].copy(n);E.vertexNormals[0].copy(n)}if(r.vertexColors.length===3){n=r.vertexColors[0].clone();n.lerpSelf(r.vertexColors[1],.5);x.vertexColors[1].copy(n);E.vertexColors[0].copy(n)}r=0}else if(f>=u&&f>=p){c=h.clone();c.lerpSelf(m,.5);x.a=n;x.b=a;x.c=l;E.a=l;E.b=s;E.c=n;if(r.vertexNormals.length===3){n=r.vertexNormals[1].clone();n.lerpSelf(r.vertexNormals[2],.5);x.vertexNormals[2].copy(n);E.vertexNormals[0].copy(n);E.vertexNormals[1].copy(r.vertexNormals[2]);E.vertexNormals[2].copy(r.vertexNormals[0])}if(r.vertexColors.length===3){n=r.vertexColors[1].clone();n.lerpSelf(r.vertexColors[2],.5);x.vertexColors[2].copy(n);E.vertexColors[0].copy(n);E.vertexColors[1].copy(r.vertexColors[2]);E.vertexColors[2].copy(r.vertexColors[0])}r=1}else{c=c.clone();c.lerpSelf(m,.5);x.a=n;x.b=a;x.c=l;E.a=l;E.b=a;E.c=s;if(r.vertexNormals.length===3){n=r.vertexNormals[0].clone();n.lerpSelf(r.vertexNormals[2],.5);x.vertexNormals[2].copy(n);E.vertexNormals[0].copy(n)}if(r.vertexColors.length===3){n=r.vertexColors[0].clone();n.lerpSelf(r.vertexColors[2],.5);x.vertexColors[2].copy(n);E.vertexColors[0].copy(n)}r=2}g.push(x,E);t.vertices.push(c);n=0;for(a=t.faceVertexUvs.length;n<a;n++)if(t.faceVertexUvs[n].length){c=t.faceVertexUvs[n][i];E=c[0];s=c[1];x=c[2];if(r===0){h=E.clone();h.lerpSelf(s,.5);c=[E.clone(),h.clone(),x.clone()];s=[h.clone(),s.clone(),x.clone()]}else if(r===1){h=s.clone();h.lerpSelf(x,.5);c=[E.clone(),s.clone(),h.clone()];s=[h.clone(),x.clone(),E.clone()]}else{h=E.clone();h.lerpSelf(x,.5);c=[E.clone(),s.clone(),h.clone()];s=[h.clone(),s.clone(),x.clone()]}b[n].push(c,s)}}else{g.push(r);n=0;for(a=t.faceVertexUvs.length;n<a;n++)b[n].push(t.faceVertexUvs[n][i])}}else{n=r.a;a=r.b;s=r.c;l=r.d;c=t.vertices[n];h=t.vertices[a];m=t.vertices[s];p=t.vertices[l];u=c.distanceTo(h);f=h.distanceTo(m);y=m.distanceTo(p);d=c.distanceTo(p);if(u>e||f>e||y>e||d>e){_=t.vertices.length;v=t.vertices.length+1;x=r.clone();E=r.clone();if(u>=f&&u>=y&&u>=d||y>=f&&y>=u&&y>=d){u=c.clone();u.lerpSelf(h,.5);h=m.clone();h.lerpSelf(p,.5);x.a=n;x.b=_;x.c=v;x.d=l;E.a=_;E.b=a;E.c=s;E.d=v;if(r.vertexNormals.length===4){n=r.vertexNormals[0].clone();n.lerpSelf(r.vertexNormals[1],.5);a=r.vertexNormals[2].clone();a.lerpSelf(r.vertexNormals[3],.5);x.vertexNormals[1].copy(n);x.vertexNormals[2].copy(a);E.vertexNormals[0].copy(n);E.vertexNormals[3].copy(a)}if(r.vertexColors.length===4){n=r.vertexColors[0].clone();n.lerpSelf(r.vertexColors[1],.5);a=r.vertexColors[2].clone();a.lerpSelf(r.vertexColors[3],.5);x.vertexColors[1].copy(n);x.vertexColors[2].copy(a);E.vertexColors[0].copy(n);E.vertexColors[3].copy(a)}r=0}else{u=h.clone();u.lerpSelf(m,.5);h=p.clone();h.lerpSelf(c,.5);x.a=n;x.b=a;x.c=_;x.d=v;E.a=v;E.b=_;E.c=s;E.d=l;if(r.vertexNormals.length===4){n=r.vertexNormals[1].clone();n.lerpSelf(r.vertexNormals[2],.5);a=r.vertexNormals[3].clone();a.lerpSelf(r.vertexNormals[0],.5);x.vertexNormals[2].copy(n);x.vertexNormals[3].copy(a);E.vertexNormals[0].copy(a);E.vertexNormals[1].copy(n)}if(r.vertexColors.length===4){n=r.vertexColors[1].clone();n.lerpSelf(r.vertexColors[2],.5);a=r.vertexColors[3].clone();a.lerpSelf(r.vertexColors[0],.5);x.vertexColors[2].copy(n);x.vertexColors[3].copy(a);E.vertexColors[0].copy(a);E.vertexColors[1].copy(n)}r=1}g.push(x,E);t.vertices.push(u,h);n=0;for(a=t.faceVertexUvs.length;n<a;n++)if(t.faceVertexUvs[n].length){c=t.faceVertexUvs[n][i];E=c[0];s=c[1];x=c[2];c=c[3];if(r===0){h=E.clone();h.lerpSelf(s,.5);m=x.clone();m.lerpSelf(c,.5);E=[E.clone(),h.clone(),m.clone(),c.clone()];s=[h.clone(),s.clone(),x.clone(),m.clone()]}else{h=s.clone();h.lerpSelf(x,.5);m=c.clone();m.lerpSelf(E,.5);E=[E.clone(),s.clone(),h.clone(),m.clone()];s=[m.clone(),h.clone(),x.clone(),c.clone()]}b[n].push(E,s)}}else{g.push(r);n=0;for(a=t.faceVertexUvs.length;n<a;n++)b[n].push(t.faceVertexUvs[n][i])}}}t.faces=g;t.faceVertexUvs=b}};THREE.GeometryUtils.random=THREE.Math.random16;THREE.GeometryUtils.__v1=new THREE.Vector3;THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(t,e,i){var o=new Image,r=new THREE.Texture(o,e);o.onload=function(){r.needsUpdate=true;i&&i(this)};o.crossOrigin=this.crossOrigin;o.src=t;return r},loadTextureCube:function(t,e,i){var o,r=[],n=new THREE.Texture(r,e),e=r.loadCount=0;for(o=t.length;e<o;++e){r[e]=new Image;r[e].onload=function(){r.loadCount=r.loadCount+1;if(r.loadCount===6)n.needsUpdate=true;i&&i(this)};r[e].crossOrigin=this.crossOrigin;r[e].src=t[e]}return n},getNormalMap:function(t,e){var i=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return[t[0]/e,t[1]/e,t[2]/e]},e=e|1,o=t.width,r=t.height,n=document.createElement("canvas");n.width=o;n.height=r;var a=n.getContext("2d");a.drawImage(t,0,0);for(var s=a.getImageData(0,0,o,r).data,l=a.createImageData(o,r),c=l.data,h=0;h<o;h++)for(var m=0;m<r;m++){var p=m-1<0?0:m-1,u=m+1>r-1?r-1:m+1,f=h-1<0?0:h-1,y=h+1>o-1?o-1:h+1,d=[],_=[0,0,s[(m*o+h)*4]/255*e];d.push([-1,0,s[(m*o+f)*4]/255*e]);d.push([-1,-1,s[(p*o+f)*4]/255*e]);d.push([0,-1,s[(p*o+h)*4]/255*e]);d.push([1,-1,s[(p*o+y)*4]/255*e]);d.push([1,0,s[(m*o+y)*4]/255*e]);d.push([1,1,s[(u*o+y)*4]/255*e]);d.push([0,1,s[(u*o+h)*4]/255*e]);d.push([-1,1,s[(u*o+f)*4]/255*e]);p=[];f=d.length;for(u=0;u<f;u++){var y=d[u],v=d[(u+1)%f],y=[y[0]-_[0],y[1]-_[1],y[2]-_[2]],v=[v[0]-_[0],v[1]-_[1],v[2]-_[2]];p.push(i([y[1]*v[2]-y[2]*v[1],y[2]*v[0]-y[0]*v[2],y[0]*v[1]-y[1]*v[0]]))}d=[0,0,0];for(u=0;u<p.length;u++){d[0]=d[0]+p[u][0];d[1]=d[1]+p[u][1];d[2]=d[2]+p[u][2]}d[0]=d[0]/p.length;d[1]=d[1]/p.length;d[2]=d[2]/p.length;_=(m*o+h)*4;c[_]=(d[0]+1)/2*255|0;c[_+1]=(d[1]+.5)*255|0;c[_+2]=d[2]*255|0;c[_+3]=255}a.putImageData(l,0,0);return n},generateDataTexture:function(t,e,i){for(var o=t*e,r=new Uint8Array(3*o),n=Math.floor(i.r*255),a=Math.floor(i.g*255),i=Math.floor(i.b*255),s=0;s<o;s++){r[s*3]=n;r[s*3+1]=a;r[s*3+2]=i}t=new THREE.DataTexture(r,t,e,THREE.RGBFormat);t.needsUpdate=true;return t}};THREE.SceneUtils={showHierarchy:function(t,e){THREE.SceneUtils.traverseHierarchy(t,(function(t){t.visible=e}))},traverseHierarchy:function(t,e){var i,o,r=t.children.length;for(o=0;o<r;o++){i=t.children[o];e(i);THREE.SceneUtils.traverseHierarchy(i,e)}},createMultiMaterialObject:function(t,e){var i,o=e.length,r=new THREE.Object3D;for(i=0;i<o;i++){var n=new THREE.Mesh(t,e[i]);r.add(n)}return r},cloneObject:function(t){var e;if(t instanceof THREE.MorphAnimMesh){e=new THREE.MorphAnimMesh(t.geometry,t.material);e.duration=t.duration;e.mirroredLoop=t.mirroredLoop;e.time=t.time;e.lastKeyframe=t.lastKeyframe;e.currentKeyframe=t.currentKeyframe;e.direction=t.direction;e.directionBackwards=t.directionBackwards}else if(t instanceof THREE.SkinnedMesh)e=new THREE.SkinnedMesh(t.geometry,t.material);else if(t instanceof THREE.Mesh)e=new THREE.Mesh(t.geometry,t.material);else if(t instanceof THREE.Line)e=new THREE.Line(t.geometry,t.material,t.type);else if(t instanceof THREE.Ribbon)e=new THREE.Ribbon(t.geometry,t.material);else if(t instanceof THREE.ParticleSystem){e=new THREE.ParticleSystem(t.geometry,t.material);e.sortParticles=t.sortParticles}else if(t instanceof THREE.Particle)e=new THREE.Particle(t.material);else if(t instanceof THREE.Sprite){e=new THREE.Sprite({});e.color.copy(t.color);e.map=t.map;e.blending=t.blending;e.useScreenCoordinates=t.useScreenCoordinates;e.mergeWith3D=t.mergeWith3D;e.affectedByDistance=t.affectedByDistance;e.scaleByViewport=t.scaleByViewport;e.alignment=t.alignment;e.rotation3d.copy(t.rotation3d);e.rotation=t.rotation;e.opacity=t.opacity;e.uvOffset.copy(t.uvOffset);e.uvScale.copy(t.uvScale)}else t instanceof THREE.LOD?e=new THREE.LOD:t instanceof THREE.Object3D&&(e=new THREE.Object3D);e.name=t.name;e.parent=t.parent;e.up.copy(t.up);e.position.copy(t.position);e.rotation instanceof THREE.Vector3&&e.rotation.copy(t.rotation);e.eulerOrder=t.eulerOrder;e.scale.copy(t.scale);e.dynamic=t.dynamic;e.doubleSided=t.doubleSided;e.flipSided=t.flipSided;e.renderDepth=t.renderDepth;e.rotationAutoUpdate=t.rotationAutoUpdate;e.matrix.copy(t.matrix);e.matrixWorld.copy(t.matrixWorld);e.matrixRotationWorld.copy(t.matrixRotationWorld);e.matrixAutoUpdate=t.matrixAutoUpdate;e.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate;e.quaternion.copy(t.quaternion);e.useQuaternion=t.useQuaternion;e.boundRadius=t.boundRadius;e.boundRadiusScale=t.boundRadiusScale;e.visible=t.visible;e.castShadow=t.castShadow;e.receiveShadow=t.receiveShadow;e.frustumCulled=t.frustumCulled;for(var i=0;i<t.children.length;i++){var o=THREE.SceneUtils.cloneObject(t.children[i]);e.children[i]=o;o.parent=e}if(t instanceof THREE.LOD)for(i=0;i<t.LODs.length;i++)e.LODs[i]={visibleAtDistance:t.LODs[i].visibleAtDistance,object3D:e.children[i]};return e},detach:function(t,e,i){t.applyMatrix(e.matrixWorld);e.remove(t);i.add(t)},attach:function(t,e,i){var o=new THREE.Matrix4;o.getInverse(i.matrixWorld);t.applyMatrix(o);e.remove(t);i.add(t)}};THREE.WebGLRenderer&&(THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nfloat pointDistance = vPointLight[ i ].w;\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalMatrix * normal;\nvTangent = normalMatrix * tangent.xyz;\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( normalize( vNormal.xyz ) * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}});THREE.BufferGeometry=function(){this.id=THREE.GeometryCount++;this.vertexColorArray=this.vertexUvArray=this.vertexNormalArray=this.vertexPositionArray=this.vertexIndexArray=this.vertexColorBuffer=this.vertexUvBuffer=this.vertexNormalBuffer=this.vertexPositionBuffer=this.vertexIndexBuffer=null;this.dynamic=false;this.boundingSphere=this.boundingBox=null;this.morphTargets=[]};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,computeBoundingBox:function(){},computeBoundingSphere:function(){}};THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(){console.log("Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(t){return this.getPoint(this.getUtoTmapping(t))};THREE.Curve.prototype.getPoints=function(t){t||(t=5);var e,i=[];for(e=0;e<=t;e++)i.push(this.getPoint(e/t));return i};THREE.Curve.prototype.getSpacedPoints=function(t){t||(t=5);var e,i=[];for(e=0;e<=t;e++)i.push(this.getPointAt(e/t));return i};THREE.Curve.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]};THREE.Curve.prototype.getLengths=function(t){t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=false;var e=[],i,o=this.getPoint(0),r,n=0;e.push(0);for(r=1;r<=t;r++){i=this.getPoint(r/t);n=n+i.distanceTo(o);e.push(n);o=i}return this.cacheArcLengths=e};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(t,e){var i=this.getLengths(),o=0,r=i.length,n;n=e?e:t*i[r-1];for(var a=0,s=r-1,l;a<=s;){o=Math.floor(a+(s-a)/2);l=i[o]-n;if(l<0)a=o+1;else if(l>0)s=o-1;else{s=o;break}}o=s;if(i[o]==n)return o/(r-1);a=i[o];return i=(o+(n-a)/(i[o+1]-a))/(r-1)};THREE.Curve.prototype.getNormalVector=function(t){t=this.getTangent(t);return new THREE.Vector2(-t.y,t.x)};THREE.Curve.prototype.getTangent=function(t){var e=t-1e-4,t=t+1e-4;e<0&&(e=0);t>1&&(t=1);e=this.getPoint(e);return this.getPoint(t).clone().subSelf(e).normalize()};THREE.Curve.prototype.getTangentAt=function(t){return this.getTangent(this.getUtoTmapping(t))};THREE.LineCurve=function(t,e){this.v1=t;this.v2=e};THREE.LineCurve.prototype=new THREE.Curve;THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(t){var e=this.v2.clone().subSelf(this.v1);e.multiplyScalar(t).addSelf(this.v1);return e};THREE.LineCurve.prototype.getPointAt=function(t){return this.getPoint(t)};THREE.LineCurve.prototype.getTangent=function(){return this.v2.clone().subSelf(this.v1).normalize()};THREE.QuadraticBezierCurve=function(t,e,i){this.v0=t;this.v1=e;this.v2=i};THREE.QuadraticBezierCurve.prototype=new THREE.Curve;THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(t){var e;e=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x);t=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y);return new THREE.Vector2(e,t)};THREE.QuadraticBezierCurve.prototype.getTangent=function(t){var e;e=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x);t=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y);e=new THREE.Vector2(e,t);e.normalize();return e};THREE.CubicBezierCurve=function(t,e,i,o){this.v0=t;this.v1=e;this.v2=i;this.v3=o};THREE.CubicBezierCurve.prototype=new THREE.Curve;THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;THREE.CubicBezierCurve.prototype.getPoint=function(t){var e;e=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);t=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(e,t)};THREE.CubicBezierCurve.prototype.getTangent=function(t){var e;e=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);t=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);e=new THREE.Vector2(e,t);e.normalize();return e};THREE.SplineCurve=function(t){this.points=t==void 0?[]:t};THREE.SplineCurve.prototype=new THREE.Curve;THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;THREE.SplineCurve.prototype.getPoint=function(t){var e=new THREE.Vector2,i=[],o=this.points,r;r=(o.length-1)*t;t=Math.floor(r);r=r-t;i[0]=t==0?t:t-1;i[1]=t;i[2]=t>o.length-2?o.length-1:t+1;i[3]=t>o.length-3?o.length-1:t+2;e.x=THREE.Curve.Utils.interpolate(o[i[0]].x,o[i[1]].x,o[i[2]].x,o[i[3]].x,r);e.y=THREE.Curve.Utils.interpolate(o[i[0]].y,o[i[1]].y,o[i[2]].y,o[i[3]].y,r);return e};THREE.ArcCurve=function(t,e,i,o,r,n){this.aX=t;this.aY=e;this.aRadius=i;this.aStartAngle=o;this.aEndAngle=r;this.aClockwise=n};THREE.ArcCurve.prototype=new THREE.Curve;THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.ArcCurve.prototype.getPoint=function(t){var e=this.aEndAngle-this.aStartAngle;this.aClockwise||(t=1-t);e=this.aStartAngle+t*e;t=this.aX+this.aRadius*Math.cos(e);e=this.aY+this.aRadius*Math.sin(e);return new THREE.Vector2(t,e)};THREE.Curve.Utils={tangentQuadraticBezier:function(t,e,i,o){return 2*(1-t)*(i-e)+2*t*(o-i)},tangentCubicBezier:function(t,e,i,o,r){return-3*e*(1-t)*(1-t)+3*i*(1-t)*(1-t)-6*t*i*(1-t)+6*t*o*(1-t)-3*t*t*o+3*t*t*r},tangentSpline:function(t){return 6*t*t-6*t+(3*t*t-4*t+1)+(-6*t*t+6*t)+(3*t*t-2*t)},interpolate:function(t,e,i,o,r){var t=(i-t)*.5,o=(o-e)*.5,n=r*r;return(2*e-2*i+t+o)*r*n+(-3*e+3*i-2*t-o)*n+t*r+e}};THREE.Curve.create=function(t,e){t.prototype=new THREE.Curve;t.prototype.constructor=t;t.prototype.getPoint=e;return t};THREE.LineCurve3=THREE.Curve.create((function(t,e){this.v1=t;this.v2=e}),(function(t){var e=new THREE.Vector3;e.sub(this.v2,this.v1);e.multiplyScalar(t);e.addSelf(this.v1);return e}));THREE.QuadraticBezierCurve3=THREE.Curve.create((function(t,e,i){this.v0=t;this.v1=e;this.v2=i}),(function(t){var e,i;e=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x);i=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y);t=THREE.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z);return new THREE.Vector3(e,i,t)}));THREE.CubicBezierCurve3=THREE.Curve.create((function(t,e,i,o){this.v0=t;this.v1=e;this.v2=i;this.v3=o}),(function(t){var e,i;e=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);i=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);t=THREE.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new THREE.Vector3(e,i,t)}));THREE.SplineCurve3=THREE.Curve.create((function(t){this.points=t==void 0?[]:t}),(function(t){var e=new THREE.Vector3,i=[],o=this.points,r,t=(o.length-1)*t;r=Math.floor(t);t=t-r;i[0]=r==0?r:r-1;i[1]=r;i[2]=r>o.length-2?o.length-1:r+1;i[3]=r>o.length-3?o.length-1:r+2;r=o[i[0]];var n=o[i[1]],a=o[i[2]],i=o[i[3]];e.x=THREE.Curve.Utils.interpolate(r.x,n.x,a.x,i.x,t);e.y=THREE.Curve.Utils.interpolate(r.y,n.y,a.y,i.y,t);e.z=THREE.Curve.Utils.interpolate(r.z,n.z,a.z,i.z,t);return e}));THREE.ClosedSplineCurve3=THREE.Curve.create((function(t){this.points=t==void 0?[]:t}),(function(t){var e=new THREE.Vector3,i=[],o=this.points,r;r=(o.length-0)*t;t=Math.floor(r);r=r-t;t=t+(t>0?0:(Math.floor(Math.abs(t)/o.length)+1)*o.length);i[0]=(t-1)%o.length;i[1]=t%o.length;i[2]=(t+1)%o.length;i[3]=(t+2)%o.length;e.x=THREE.Curve.Utils.interpolate(o[i[0]].x,o[i[1]].x,o[i[2]].x,o[i[3]].x,r);e.y=THREE.Curve.Utils.interpolate(o[i[0]].y,o[i[1]].y,o[i[2]].y,o[i[3]].y,r);e.z=THREE.Curve.Utils.interpolate(o[i[0]].z,o[i[1]].z,o[i[2]].z,o[i[3]].z,r);return e}));THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};THREE.CurvePath.prototype=new THREE.Curve;THREE.CurvePath.prototype.constructor=THREE.CurvePath;THREE.CurvePath.prototype.add=function(t){this.curves.push(t)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new THREE.LineCurve(e,t))};THREE.CurvePath.prototype.getPoint=function(t){for(var e=t*this.getLength(),i=this.getCurveLengths(),t=0;t<i.length;){if(i[t]>=e){e=i[t]-e;t=this.curves[t];e=1-e/t.getLength();return t.getPointAt(e)}t++}return null};THREE.CurvePath.prototype.getLength=function(){var t=this.getCurveLengths();return t[t.length-1]};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var t=[],e=0,i,o=this.curves.length;for(i=0;i<o;i++){e=e+this.curves[i].getLength();t.push(e)}return this.cacheLengths=t};THREE.CurvePath.prototype.getBoundingBox=function(){var t=this.getPoints(),e,i,o,r;e=i=Number.NEGATIVE_INFINITY;o=r=Number.POSITIVE_INFINITY;var n,a,s,l;l=new THREE.Vector2;a=0;for(s=t.length;a<s;a++){n=t[a];if(n.x>e)e=n.x;else if(n.x<o)o=n.x;if(n.y>i)i=n.y;else if(n.y<i)r=n.y;l.addSelf(n.x,n.y)}return{minX:o,minY:r,maxX:e,maxY:i,centroid:l.divideScalar(s)}};THREE.CurvePath.prototype.createPointsGeometry=function(t){return this.createGeometry(this.getPoints(t,true))};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(t){return this.createGeometry(this.getSpacedPoints(t,true))};THREE.CurvePath.prototype.createGeometry=function(t){for(var e=new THREE.Geometry,i=0;i<t.length;i++)e.vertices.push(new THREE.Vector3(t[i].x,t[i].y,0));return e};THREE.CurvePath.prototype.addWrapPath=function(t){this.bends.push(t)};THREE.CurvePath.prototype.getTransformedPoints=function(t,e){var i=this.getPoints(t),o,r;if(!e)e=this.bends;o=0;for(r=e.length;o<r;o++)i=this.getWrapPoints(i,e[o]);return i};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(t,e){var i=this.getSpacedPoints(t),o,r;if(!e)e=this.bends;o=0;for(r=e.length;o<r;o++)i=this.getWrapPoints(i,e[o]);return i};THREE.CurvePath.prototype.getWrapPoints=function(t,e){var i=this.getBoundingBox(),o,r,n,a,s,l;o=0;for(r=t.length;o<r;o++){n=t[o];a=n.x;s=n.y;l=a/i.maxX;l=e.getUtoTmapping(l,a);a=e.getPoint(l);s=e.getNormalVector(l).multiplyScalar(s);n.x=a.x+s.x;n.y=a.y+s.y}return t};THREE.EventTarget=function(){var t={};this.addEventListener=function(e,i){t[e]==void 0&&(t[e]=[]);t[e].indexOf(i)===-1&&t[e].push(i)};this.dispatchEvent=function(e){for(var i in t[e.type])t[e.type][i](e)};this.removeEventListener=function(e,i){var o=t[e].indexOf(i);o!==-1&&t[e].splice(o,1)}};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=new THREE.Object3D;THREE.Gyroscope.prototype.constructor=THREE.Gyroscope;THREE.Gyroscope.prototype.updateMatrixWorld=function(t){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||t){if(this.parent){this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld);this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject);this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)}else this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=false;t=true}for(var e=0,i=this.children.length;e<i;e++)this.children[e].updateMatrixWorld(t)};THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3;THREE.Gyroscope.prototype.translationObject=new THREE.Vector3;THREE.Gyroscope.prototype.rotationWorld=new THREE.Quaternion;THREE.Gyroscope.prototype.rotationObject=new THREE.Quaternion;THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3;THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3;THREE.Path=function(t){THREE.CurvePath.call(this);this.actions=[];t&&this.fromPoints(t)};THREE.Path.prototype=new THREE.CurvePath;THREE.Path.prototype.constructor=THREE.Path;THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"};THREE.Path.prototype.fromPoints=function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y)};THREE.Path.prototype.moveTo=function(t,e){var i=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:i})};THREE.Path.prototype.lineTo=function(t,e){var i=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args;this.curves.push(new THREE.LineCurve(new THREE.Vector2(o[o.length-2],o[o.length-1]),new THREE.Vector2(t,e)));this.actions.push({action:THREE.PathActions.LINE_TO,args:i})};THREE.Path.prototype.quadraticCurveTo=function(t,e,i,o){var r=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args;this.curves.push(new THREE.QuadraticBezierCurve(new THREE.Vector2(n[n.length-2],n[n.length-1]),new THREE.Vector2(t,e),new THREE.Vector2(i,o)));this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:r})};THREE.Path.prototype.bezierCurveTo=function(t,e,i,o,r,n){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args;this.curves.push(new THREE.CubicBezierCurve(new THREE.Vector2(s[s.length-2],s[s.length-1]),new THREE.Vector2(t,e),new THREE.Vector2(i,o),new THREE.Vector2(r,n)));this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:a})};THREE.Path.prototype.splineThru=function(t){var e=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,i=[new THREE.Vector2(i[i.length-2],i[i.length-1])];Array.prototype.push.apply(i,t);this.curves.push(new THREE.SplineCurve(i));this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:e})};THREE.Path.prototype.arc=function(t,e,i,o,r,n){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1],s=new THREE.ArcCurve(s.x+t,s.y+e,i,o,r,n);this.curves.push(s);s=s.getPoint(n?1:0);a.push(s.x);a.push(s.y);this.actions.push({action:THREE.PathActions.ARC,args:a})};THREE.Path.prototype.absarc=function(t,e,i,o,r,n){var a=Array.prototype.slice.call(arguments),s=new THREE.ArcCurve(t,e,i,o,r,n);this.curves.push(s);s=s.getPoint(n?1:0);a.push(s.x);a.push(s.y);this.actions.push({action:THREE.PathActions.ARC,args:a})};THREE.Path.prototype.getSpacedPoints=function(t){t||(t=40);for(var e=[],i=0;i<t;i++)e.push(this.getPoint(i/t));return e};THREE.Path.prototype.getPoints=function(t,e){if(this.useSpacedPoints){console.log("tata");return this.getSpacedPoints(t,e)}var t=t||12,i=[],o,r,n,a,s,l,c,h,m,p,u,f,y;o=0;for(r=this.actions.length;o<r;o++){n=this.actions[o];a=n.action;n=n.args;switch(a){case THREE.PathActions.MOVE_TO:i.push(new THREE.Vector2(n[0],n[1]));break;case THREE.PathActions.LINE_TO:i.push(new THREE.Vector2(n[0],n[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:s=n[2];l=n[3];m=n[0];p=n[1];if(i.length>0){a=i[i.length-1];u=a.x;f=a.y}else{a=this.actions[o-1].args;u=a[a.length-2];f=a[a.length-1]}for(n=1;n<=t;n++){y=n/t;a=THREE.Shape.Utils.b2(y,u,m,s);y=THREE.Shape.Utils.b2(y,f,p,l);i.push(new THREE.Vector2(a,y))}break;case THREE.PathActions.BEZIER_CURVE_TO:s=n[4];l=n[5];m=n[0];p=n[1];c=n[2];h=n[3];if(i.length>0){a=i[i.length-1];u=a.x;f=a.y}else{a=this.actions[o-1].args;u=a[a.length-2];f=a[a.length-1]}for(n=1;n<=t;n++){y=n/t;a=THREE.Shape.Utils.b3(y,u,m,c,s);y=THREE.Shape.Utils.b3(y,f,p,h,l);i.push(new THREE.Vector2(a,y))}break;case THREE.PathActions.CSPLINE_THRU:a=this.actions[o-1].args;y=[new THREE.Vector2(a[a.length-2],a[a.length-1])];a=t*n[0].length;y=y.concat(n[0]);y=new THREE.SplineCurve(y);for(n=1;n<=a;n++)i.push(y.getPointAt(n/a));break;case THREE.PathActions.ARC:s=n[0];l=n[1];c=n[2];m=n[3];p=!!n[5];h=n[4]-m;u=t*2;for(n=1;n<=u;n++){y=n/u;p||(y=1-y);y=m+y*h;a=s+c*Math.cos(y);y=l+c*Math.sin(y);i.push(new THREE.Vector2(a,y))}}}o=i[i.length-1];Math.abs(o.x-i[0].x)<1e-10&&Math.abs(o.y-i[0].y)<1e-10&&i.splice(i.length-1,1);e&&i.push(i[0]);return i};THREE.Path.prototype.transform=function(t,e){this.getBoundingBox();return this.getWrapPoints(this.getPoints(e),t)};THREE.Path.prototype.nltransform=function(t,e,i,o,r,n){var a=this.getPoints(),s,l,c,h,m;s=0;for(l=a.length;s<l;s++){c=a[s];h=c.x;m=c.y;c.x=t*h+e*m+i;c.y=o*m+r*h+n}return a};THREE.Path.prototype.debug=function(t){var e=this.getBoundingBox();if(!t){t=document.createElement("canvas");t.setAttribute("width",e.maxX+100);t.setAttribute("height",e.maxY+100);document.body.appendChild(t)}e=t.getContext("2d");e.fillStyle="white";e.fillRect(0,0,t.width,t.height);e.strokeStyle="black";e.beginPath();var i,o,r,t=0;for(i=this.actions.length;t<i;t++){o=this.actions[t];r=o.args;o=o.action;o!=THREE.PathActions.CSPLINE_THRU&&e[o].apply(e,r)}e.stroke();e.closePath();e.strokeStyle="red";o=this.getPoints();t=0;for(i=o.length;t<i;t++){r=o[t];e.beginPath();e.arc(r.x,r.y,1.5,0,Math.PI*2,false);e.stroke();e.closePath()}};THREE.Path.prototype.toShapes=function(){var t,e,i,o,r=[],n=new THREE.Path;t=0;for(e=this.actions.length;t<e;t++){i=this.actions[t];o=i.args;i=i.action;if(i==THREE.PathActions.MOVE_TO&&n.actions.length!=0){r.push(n);n=new THREE.Path}n[i].apply(n,o)}n.actions.length!=0&&r.push(n);if(r.length==0)return[];var a;o=[];t=!THREE.Shape.Utils.isClockWise(r[0].getPoints());if(r.length==1){n=r[0];a=new THREE.Shape;a.actions=n.actions;a.curves=n.curves;o.push(a);return o}if(t){a=new THREE.Shape;t=0;for(e=r.length;t<e;t++){n=r[t];if(THREE.Shape.Utils.isClockWise(n.getPoints())){a.actions=n.actions;a.curves=n.curves;o.push(a);a=new THREE.Shape}else a.holes.push(n)}}else{t=0;for(e=r.length;t<e;t++){n=r[t];if(THREE.Shape.Utils.isClockWise(n.getPoints())){a&&o.push(a);a=new THREE.Shape;a.actions=n.actions;a.curves=n.curves}else a.holes.push(n)}o.push(a)}return o};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=new THREE.Path;THREE.Shape.prototype.constructor=THREE.Path;THREE.Shape.prototype.extrude=function(t){return new THREE.ExtrudeGeometry(this,t)};THREE.Shape.prototype.getPointsHoles=function(t){var e,i=this.holes.length,o=[];for(e=0;e<i;e++)o[e]=this.holes[e].getTransformedPoints(t,this.bends);return o};THREE.Shape.prototype.getSpacedPointsHoles=function(t){var e,i=this.holes.length,o=[];for(e=0;e<i;e++)o[e]=this.holes[e].getTransformedSpacedPoints(t,this.bends);return o};THREE.Shape.prototype.extractAllPoints=function(t){return{shape:this.getTransformedPoints(t),holes:this.getPointsHoles(t)}};THREE.Shape.prototype.extractPoints=function(t){return this.useSpacedPoints?this.extractAllSpacedPoints(t):this.extractAllPoints(t)};THREE.Shape.prototype.extractAllSpacedPoints=function(t){return{shape:this.getTransformedSpacedPoints(t),holes:this.getSpacedPointsHoles(t)}};THREE.Shape.Utils={removeHoles:function(t,e){var i=t.concat(),o=i.concat(),r,n,a,s,l,c,h,m,p,u,f=[];for(l=0;l<e.length;l++){c=e[l];Array.prototype.push.apply(o,c);n=Number.POSITIVE_INFINITY;for(r=0;r<c.length;r++){p=c[r];u=[];for(m=0;m<i.length;m++){h=i[m];h=p.distanceToSquared(h);u.push(h);if(h<n){n=h;a=r;s=m}}}r=s-1>=0?s-1:i.length-1;n=a-1>=0?a-1:c.length-1;var y=[c[a],i[s],i[r]];m=THREE.FontUtils.Triangulate.area(y);var d=[c[a],c[n],i[s]];p=THREE.FontUtils.Triangulate.area(d);u=s;h=a;s=s+1;a=a+-1;s<0&&(s=s+i.length);s=s%i.length;a<0&&(a=a+c.length);a=a%c.length;r=s-1>=0?s-1:i.length-1;n=a-1>=0?a-1:c.length-1;y=[c[a],i[s],i[r]];y=THREE.FontUtils.Triangulate.area(y);d=[c[a],c[n],i[s]];d=THREE.FontUtils.Triangulate.area(d);if(m+p>y+d){s=u;a=h;s<0&&(s=s+i.length);s=s%i.length;a<0&&(a=a+c.length);a=a%c.length;r=s-1>=0?s-1:i.length-1;n=a-1>=0?a-1:c.length-1}m=i.slice(0,s);p=i.slice(s);u=c.slice(a);h=c.slice(0,a);n=[c[a],c[n],i[s]];f.push([c[a],i[s],i[r]]);f.push(n);i=m.concat(u).concat(h).concat(p)}return{shape:i,isolatedPts:f,allpoints:o}},triangulateShape:function(t,e){var i=THREE.Shape.Utils.removeHoles(t,e),o=i.allpoints,r=i.isolatedPts,i=THREE.FontUtils.Triangulate(i.shape,false),n,a,s,l,c={};n=0;for(a=o.length;n<a;n++){l=o[n].x+":"+o[n].y;c[l]!==void 0&&console.log("Duplicate point",l);c[l]=n}n=0;for(a=i.length;n<a;n++){s=i[n];for(o=0;o<3;o++){l=s[o].x+":"+s[o].y;l=c[l];l!==void 0&&(s[o]=l)}}n=0;for(a=r.length;n<a;n++){s=r[n];for(o=0;o<3;o++){l=s[o].x+":"+s[o].y;l=c[l];l!==void 0&&(s[o]=l)}}return i.concat(r)},isClockWise:function(t){return THREE.FontUtils.Triangulate.area(t)<0},b2p0:function(t,e){var i=1-t;return i*i*e},b2p1:function(t,e){return 2*(1-t)*t*e},b2p2:function(t,e){return t*t*e},b2:function(t,e,i,o){return this.b2p0(t,e)+this.b2p1(t,i)+this.b2p2(t,o)},b3p0:function(t,e){var i=1-t;return i*i*i*e},b3p1:function(t,e){var i=1-t;return 3*i*i*t*e},b3p2:function(t,e){return 3*(1-t)*t*t*e},b3p3:function(t,e){return t*t*t*e},b3:function(t,e,i,o,r){return this.b3p0(t,e)+this.b3p1(t,i)+this.b3p2(t,o)+this.b3p3(t,r)}};THREE.TextPath=function(t,e){THREE.Path.call(this);this.parameters=e||{};this.set(t)};THREE.TextPath.prototype.set=function(t,e){e=e||this.parameters;this.text=t;var i=e.curveSegments!==void 0?e.curveSegments:4,o=e.font!==void 0?e.font:"helvetiker",r=e.weight!==void 0?e.weight:"normal",n=e.style!==void 0?e.style:"normal";THREE.FontUtils.size=e.size!==void 0?e.size:100;THREE.FontUtils.divisions=i;THREE.FontUtils.face=o;THREE.FontUtils.weight=r;THREE.FontUtils.style=n};THREE.TextPath.prototype.toShapes=function(){for(var t=THREE.FontUtils.drawText(this.text).paths,e=[],i=0,o=t.length;i<o;i++)Array.prototype.push.apply(e,t[i].toShapes());return e};THREE.AnimationHandler=function(){var t=[],e={},i={update:function(e){for(var i=0;i<t.length;i++)t[i].update(e)},addToUpdate:function(e){t.indexOf(e)===-1&&t.push(e)},removeFromUpdate:function(e){e=t.indexOf(e);e!==-1&&t.splice(e,1)},add:function(t){e[t.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+t.name+" already exists in library. Overwriting.");e[t.name]=t;if(t.initialized!==true){for(var i=0;i<t.hierarchy.length;i++){for(var o=0;o<t.hierarchy[i].keys.length;o++){if(t.hierarchy[i].keys[o].time<0)t.hierarchy[i].keys[o].time=0;if(t.hierarchy[i].keys[o].rot!==void 0&&!(t.hierarchy[i].keys[o].rot instanceof THREE.Quaternion)){var r=t.hierarchy[i].keys[o].rot;t.hierarchy[i].keys[o].rot=new THREE.Quaternion(r[0],r[1],r[2],r[3])}}if(t.hierarchy[i].keys.length&&t.hierarchy[i].keys[0].morphTargets!==void 0){r={};for(o=0;o<t.hierarchy[i].keys.length;o++)for(var n=0;n<t.hierarchy[i].keys[o].morphTargets.length;n++){var a=t.hierarchy[i].keys[o].morphTargets[n];r[a]=-1}t.hierarchy[i].usedMorphTargets=r;for(o=0;o<t.hierarchy[i].keys.length;o++){var s={};for(a in r){for(n=0;n<t.hierarchy[i].keys[o].morphTargets.length;n++)if(t.hierarchy[i].keys[o].morphTargets[n]===a){s[a]=t.hierarchy[i].keys[o].morphTargetsInfluences[n];break}n===t.hierarchy[i].keys[o].morphTargets.length&&(s[a]=0)}t.hierarchy[i].keys[o].morphTargetsInfluences=s}}for(o=1;o<t.hierarchy[i].keys.length;o++)if(t.hierarchy[i].keys[o].time===t.hierarchy[i].keys[o-1].time){t.hierarchy[i].keys.splice(o,1);o--}for(o=0;o<t.hierarchy[i].keys.length;o++)t.hierarchy[i].keys[o].index=o}o=parseInt(t.length*t.fps,10);t.JIT={};t.JIT.hierarchy=[];for(i=0;i<t.hierarchy.length;i++)t.JIT.hierarchy.push(Array(o));t.initialized=true}},get:function(t){if(typeof t==="string"){if(e[t])return e[t];console.log("THREE.AnimationHandler.get: Couldn't find animation "+t);return null}},parse:function(t){var e=[];if(t instanceof THREE.SkinnedMesh)for(var i=0;i<t.bones.length;i++)e.push(t.bones[i]);else o(t,e);return e}},o=function(t,e){e.push(t);for(var i=0;i<t.children.length;i++)o(t.children[i],e)};i.LINEAR=0;i.CATMULLROM=1;i.CATMULLROM_FORWARD=2;return i}();THREE.Animation=function(t,e,i,o){this.root=t;this.data=THREE.AnimationHandler.get(e);this.hierarchy=THREE.AnimationHandler.parse(t);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.loop=this.isPaused=true;this.interpolationType=i!==void 0?i:THREE.AnimationHandler.LINEAR;this.JITCompile=o!==void 0?o:true;this.points=[];this.target=new THREE.Vector3};THREE.Animation.prototype.play=function(t,e){if(!this.isPlaying){this.isPlaying=true;this.loop=t!==void 0?t:true;this.currentTime=e!==void 0?e:0;var i,o=this.hierarchy.length,r;for(i=0;i<o;i++){r=this.hierarchy[i];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD)r.useQuaternion=true;r.matrixAutoUpdate=true;if(r.animationCache===void 0){r.animationCache={};r.animationCache.prevKey={pos:0,rot:0,scl:0};r.animationCache.nextKey={pos:0,rot:0,scl:0};r.animationCache.originalMatrix=r instanceof THREE.Bone?r.skinMatrix:r.matrix}var n=r.animationCache.prevKey;r=r.animationCache.nextKey;n.pos=this.data.hierarchy[i].keys[0];n.rot=this.data.hierarchy[i].keys[0];n.scl=this.data.hierarchy[i].keys[0];r.pos=this.getNextKeyWith("pos",i,1);r.rot=this.getNextKeyWith("rot",i,1);r.scl=this.getNextKeyWith("scl",i,1)}this.update(0)}this.isPaused=false;THREE.AnimationHandler.addToUpdate(this)};THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=false;THREE.AnimationHandler.removeFromUpdate(this);for(var t=0;t<this.hierarchy.length;t++)if(this.hierarchy[t].animationCache!==void 0){this.hierarchy[t]instanceof THREE.Bone?this.hierarchy[t].skinMatrix=this.hierarchy[t].animationCache.originalMatrix:this.hierarchy[t].matrix=this.hierarchy[t].animationCache.originalMatrix;delete this.hierarchy[t].animationCache}};THREE.Animation.prototype.update=function(t){if(this.isPlaying){var e=["pos","rot","scl"],i,o,r,n,a,s,l,c,h=this.data.JIT.hierarchy,m,p;p=this.currentTime=this.currentTime+t*this.timeScale;m=this.currentTime=this.currentTime%this.data.length;c=parseInt(Math.min(m*this.data.fps,this.data.length*this.data.fps),10);for(var u=0,f=this.hierarchy.length;u<f;u++){t=this.hierarchy[u];l=t.animationCache;if(this.JITCompile&&h[u][c]!==void 0)if(t instanceof THREE.Bone){t.skinMatrix=h[u][c];t.matrixAutoUpdate=false;t.matrixWorldNeedsUpdate=false}else{t.matrix=h[u][c];t.matrixAutoUpdate=false;t.matrixWorldNeedsUpdate=true}else{if(this.JITCompile)t instanceof THREE.Bone?t.skinMatrix=t.animationCache.originalMatrix:t.matrix=t.animationCache.originalMatrix;for(var y=0;y<3;y++){i=e[y];a=l.prevKey[i];s=l.nextKey[i];if(s.time<=p){if(m<p)if(this.loop){a=this.data.hierarchy[u].keys[0];for(s=this.getNextKeyWith(i,u,1);s.time<m;){a=s;s=this.getNextKeyWith(i,u,s.index+1)}}else{this.stop();return}else{do{a=s;s=this.getNextKeyWith(i,u,s.index+1)}while(s.time<m)}l.prevKey[i]=a;l.nextKey[i]=s}t.matrixAutoUpdate=true;t.matrixWorldNeedsUpdate=true;o=(m-a.time)/(s.time-a.time);r=a[i];n=s[i];if(o<0||o>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+o+" on bone "+u);o=o<0?0:1}if(i==="pos"){i=t.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){i.x=r[0]+(n[0]-r[0])*o;i.y=r[1]+(n[1]-r[1])*o;i.z=r[2]+(n[2]-r[2])*o}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=this.getPrevKeyWith("pos",u,a.index-1).pos;this.points[1]=r;this.points[2]=n;this.points[3]=this.getNextKeyWith("pos",u,s.index+1).pos;o=o*.33+.33;r=this.interpolateCatmullRom(this.points,o);i.x=r[0];i.y=r[1];i.z=r[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){o=this.interpolateCatmullRom(this.points,o*1.01);this.target.set(o[0],o[1],o[2]);this.target.subSelf(i);this.target.y=0;this.target.normalize();o=Math.atan2(this.target.x,this.target.z);t.rotation.set(0,o,0)}}}else if(i==="rot")THREE.Quaternion.slerp(r,n,t.quaternion,o);else if(i==="scl"){i=t.scale;i.x=r[0]+(n[0]-r[0])*o;i.y=r[1]+(n[1]-r[1])*o;i.z=r[2]+(n[2]-r[2])*o}}}}if(this.JITCompile&&h[0][c]===void 0){this.hierarchy[0].updateMatrixWorld(true);for(u=0;u<this.hierarchy.length;u++)h[u][c]=this.hierarchy[u]instanceof THREE.Bone?this.hierarchy[u].skinMatrix.clone():this.hierarchy[u].matrix.clone()}}};THREE.Animation.prototype.interpolateCatmullRom=function(t,e){var i=[],o=[],r,n,a,s,l,c;r=(t.length-1)*e;n=Math.floor(r);r=r-n;i[0]=n===0?n:n-1;i[1]=n;i[2]=n>t.length-2?n:n+1;i[3]=n>t.length-3?n:n+2;n=t[i[0]];s=t[i[1]];l=t[i[2]];c=t[i[3]];i=r*r;a=r*i;o[0]=this.interpolate(n[0],s[0],l[0],c[0],r,i,a);o[1]=this.interpolate(n[1],s[1],l[1],c[1],r,i,a);o[2]=this.interpolate(n[2],s[2],l[2],c[2],r,i,a);return o};THREE.Animation.prototype.interpolate=function(t,e,i,o,r,n,a){t=(i-t)*.5;o=(o-e)*.5;return(2*(e-i)+t+o)*a+(-3*(e-i)-2*t-o)*n+t*r+e};THREE.Animation.prototype.getNextKeyWith=function(t,e,i){for(var o=this.data.hierarchy[e].keys,i=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?i<o.length-1?i:o.length-1:i%o.length;i<o.length;i++)if(o[i][t]!==void 0)return o[i];return this.data.hierarchy[e].keys[0]};THREE.Animation.prototype.getPrevKeyWith=function(t,e,i){for(var o=this.data.hierarchy[e].keys,i=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?i>0?i:0:i>=0?i:i+o.length;i>=0;i--)if(o[i][t]!==void 0)return o[i];return this.data.hierarchy[e].keys[o.length-1]};THREE.KeyFrameAnimation=function(t,e,i){this.root=t;this.data=THREE.AnimationHandler.get(e);this.hierarchy=THREE.AnimationHandler.parse(t);this.currentTime=0;this.timeScale=.001;this.isPlaying=false;this.loop=this.isPaused=true;this.JITCompile=i!==void 0?i:true;t=0;for(e=this.hierarchy.length;t<e;t++){var i=this.data.hierarchy[t].sids,o=this.hierarchy[t];if(this.data.hierarchy[t].keys.length&&i){for(var r=0;r<i.length;r++){var n=i[r],a=this.getNextKeyWith(n,t,0);a&&a.apply(n)}o.matrixAutoUpdate=false;this.data.hierarchy[t].node.updateMatrix();o.matrixWorldNeedsUpdate=true}}};THREE.KeyFrameAnimation.prototype.play=function(t,e){if(!this.isPlaying){this.isPlaying=true;this.loop=t!==void 0?t:true;this.currentTime=e!==void 0?e:0;this.startTimeMs=e;this.startTime=1e7;this.endTime=-this.startTime;var i,o=this.hierarchy.length,r,n;for(i=0;i<o;i++){r=this.hierarchy[i];n=this.data.hierarchy[i];r.useQuaternion=true;if(n.animationCache===void 0){n.animationCache={};n.animationCache.prevKey=null;n.animationCache.nextKey=null;n.animationCache.originalMatrix=r instanceof THREE.Bone?r.skinMatrix:r.matrix}r=this.data.hierarchy[i].keys;if(r.length){n.animationCache.prevKey=r[0];n.animationCache.nextKey=r[1];this.startTime=Math.min(r[0].time,this.startTime);this.endTime=Math.max(r[r.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;THREE.AnimationHandler.addToUpdate(this)};THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=false;THREE.AnimationHandler.removeFromUpdate(this);for(var t=0;t<this.data.hierarchy.length;t++){var e=this.hierarchy[t],i=this.data.hierarchy[t];if(i.animationCache!==void 0){var o=i.animationCache.originalMatrix;if(e instanceof THREE.Bone){o.copy(e.skinMatrix);e.skinMatrix=o}else{o.copy(e.matrix);e.matrix=o}delete i.animationCache}}};THREE.KeyFrameAnimation.prototype.update=function(t){if(this.isPlaying){var e,i,o,r,n=this.data.JIT.hierarchy,a,s,l;s=this.currentTime=this.currentTime+t*this.timeScale;a=this.currentTime=this.currentTime%this.data.length;if(a<this.startTimeMs)a=this.currentTime=this.startTimeMs+a;r=parseInt(Math.min(a*this.data.fps,this.data.length*this.data.fps),10);if((l=a<s)&&!this.loop){for(var t=0,c=this.hierarchy.length;t<c;t++){var h=this.data.hierarchy[t].keys,n=this.data.hierarchy[t].sids;o=h.length-1;r=this.hierarchy[t];if(h.length){for(h=0;h<n.length;h++){a=n[h];(s=this.getPrevKeyWith(a,t,o))&&s.apply(a)}this.data.hierarchy[t].node.updateMatrix();r.matrixWorldNeedsUpdate=true}}this.stop()}else if(!(a<this.startTime)){t=0;for(c=this.hierarchy.length;t<c;t++){o=this.hierarchy[t];e=this.data.hierarchy[t];var h=e.keys,m=e.animationCache;if(this.JITCompile&&n[t][r]!==void 0)if(o instanceof THREE.Bone){o.skinMatrix=n[t][r];o.matrixWorldNeedsUpdate=false}else{o.matrix=n[t][r];o.matrixWorldNeedsUpdate=true}else if(h.length){if(this.JITCompile&&m)o instanceof THREE.Bone?o.skinMatrix=m.originalMatrix:o.matrix=m.originalMatrix;e=m.prevKey;i=m.nextKey;if(e&&i){if(i.time<=s){if(l&&this.loop){e=h[0];for(i=h[1];i.time<a;){e=i;i=h[e.index+1]}}else if(!l)for(var p=h.length-1;i.time<a&&i.index!==p;){e=i;i=h[e.index+1]}m.prevKey=e;m.nextKey=i}i.time>=a?e.interpolate(i,a):e.interpolate(i,i.time)}this.data.hierarchy[t].node.updateMatrix();o.matrixWorldNeedsUpdate=true}}if(this.JITCompile&&n[0][r]===void 0){this.hierarchy[0].updateMatrixWorld(true);for(t=0;t<this.hierarchy.length;t++)n[t][r]=this.hierarchy[t]instanceof THREE.Bone?this.hierarchy[t].skinMatrix.clone():this.hierarchy[t].matrix.clone()}}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(t,e,i){e=this.data.hierarchy[e].keys;for(i=i%e.length;i<e.length;i++)if(e[i].hasTarget(t))return e[i];return e[0]};THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(t,e,i){e=this.data.hierarchy[e].keys;for(i=i>=0?i:i+e.length;i>=0;i--)if(e[i].hasTarget(t))return e[i];return e[e.length-1]};THREE.CubeCamera=function(t,e,i){THREE.Object3D.call(this);var o=new THREE.PerspectiveCamera(90,1,t,e);o.up.set(0,-1,0);o.lookAt(new THREE.Vector3(1,0,0));this.add(o);var r=new THREE.PerspectiveCamera(90,1,t,e);r.up.set(0,-1,0);r.lookAt(new THREE.Vector3(-1,0,0));this.add(r);var n=new THREE.PerspectiveCamera(90,1,t,e);n.up.set(0,0,1);n.lookAt(new THREE.Vector3(0,1,0));this.add(n);var a=new THREE.PerspectiveCamera(90,1,t,e);a.up.set(0,0,-1);a.lookAt(new THREE.Vector3(0,-1,0));this.add(a);var s=new THREE.PerspectiveCamera(90,1,t,e);s.up.set(0,-1,0);s.lookAt(new THREE.Vector3(0,0,1));this.add(s);var l=new THREE.PerspectiveCamera(90,1,t,e);l.up.set(0,-1,0);l.lookAt(new THREE.Vector3(0,0,-1));this.add(l);this.renderTarget=new THREE.WebGLRenderTargetCube(i,i,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(t,e){var i=this.renderTarget,c=i.generateMipmaps;i.generateMipmaps=false;i.activeCubeFace=0;t.render(e,o,i);i.activeCubeFace=1;t.render(e,r,i);i.activeCubeFace=2;t.render(e,n,i);i.activeCubeFace=3;t.render(e,a,i);i.activeCubeFace=4;t.render(e,s,i);i.generateMipmaps=c;i.activeCubeFace=5;t.render(e,l,i)}};THREE.CubeCamera.prototype=new THREE.Object3D;THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;THREE.CombinedCamera=function(t,e,i,o,r,n,a){THREE.Camera.call(this);this.fov=i;this.left=-t/2;this.right=t/2;this.top=e/2;this.bottom=-e/2;this.cameraO=new THREE.OrthographicCamera(t/-2,t/2,e/2,e/-2,n,a);this.cameraP=new THREE.PerspectiveCamera(i,t/e,o,r);this.zoom=1;this.toPerspective()};THREE.CombinedCamera.prototype=new THREE.Camera;THREE.CombinedCamera.prototype.constructor=THREE.CombinedCamera;THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPersepectiveMode=true;this.inOrthographicMode=false};THREE.CombinedCamera.prototype.toOrthographic=function(){var t=this.cameraP.aspect,e=(this.cameraP.near+this.cameraP.far)/2,e=Math.tan(this.fov/2)*e,t=2*e*t/2,e=e/this.zoom,t=t/this.zoom;this.cameraO.left=-t;this.cameraO.right=t;this.cameraO.top=e;this.cameraO.bottom=-e;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPersepectiveMode=false;this.inOrthographicMode=true};THREE.CombinedCamera.prototype.setSize=function(t,e){this.cameraP.aspect=t/e;this.left=-t/2;this.right=t/2;this.top=e/2;this.bottom=-e/2};THREE.CombinedCamera.prototype.setFov=function(t){this.fov=t;this.inPersepectiveMode?this.toPerspective():this.toOrthographic()};THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){if(this.inPersepectiveMode)this.toPerspective();else{this.toPerspective();this.toOrthographic()}};THREE.CombinedCamera.prototype.setLens=function(t,e){var i=2*Math.atan((e!==void 0?e:24)/(t*2))*(180/Math.PI);this.setFov(i);return i};THREE.CombinedCamera.prototype.setZoom=function(t){this.zoom=t;this.inPersepectiveMode?this.toPerspective():this.toOrthographic()};THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.FirstPersonControls=function(t,e){function i(t,e){return function(){e.apply(t,arguments)}}this.object=t;this.target=new THREE.Vector3(0,0,0);this.domElement=e!==void 0?e:document;this.movementSpeed=1;this.lookSpeed=.005;this.noFly=false;this.lookVertical=true;this.autoForward=false;this.activeLook=true;this.heightSpeed=false;this.heightCoef=1;this.heightMin=0;this.constrainVertical=false;this.verticalMin=0;this.verticalMax=Math.PI;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=false;if(this.domElement===document){this.viewHalfX=window.innerWidth/2;this.viewHalfY=window.innerHeight/2}else{this.viewHalfX=this.domElement.offsetWidth/2;this.viewHalfY=this.domElement.offsetHeight/2;this.domElement.setAttribute("tabindex",-1)}this.onMouseDown=function(t){this.domElement!==document&&this.domElement.focus();t.preventDefault();t.stopPropagation();if(this.activeLook)switch(t.button){case 0:this.moveForward=true;break;case 2:this.moveBackward=true}this.mouseDragOn=true};this.onMouseUp=function(t){t.preventDefault();t.stopPropagation();if(this.activeLook)switch(t.button){case 0:this.moveForward=false;break;case 2:this.moveBackward=false}this.mouseDragOn=false};this.onMouseMove=function(t){if(this.domElement===document){this.mouseX=t.pageX-this.viewHalfX;this.mouseY=t.pageY-this.viewHalfY}else{this.mouseX=t.pageX-this.domElement.offsetLeft-this.viewHalfX;this.mouseY=t.pageY-this.domElement.offsetTop-this.viewHalfY}};this.onKeyDown=function(t){switch(t.keyCode){case 38:case 87:this.moveForward=true;break;case 37:case 65:this.moveLeft=true;break;case 40:case 83:this.moveBackward=true;break;case 39:case 68:this.moveRight=true;break;case 82:this.moveUp=true;break;case 70:this.moveDown=true;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(t){switch(t.keyCode){case 38:case 87:this.moveForward=false;break;case 37:case 65:this.moveLeft=false;break;case 40:case 83:this.moveBackward=false;break;case 39:case 68:this.moveRight=false;break;case 82:this.moveUp=false;break;case 70:this.moveDown=false}};this.update=function(t){var e=0;if(!this.freeze){if(this.heightSpeed){e=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=t*e*this.heightCoef}else this.autoSpeedFactor=0;e=t*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(e+this.autoSpeedFactor));this.moveBackward&&this.object.translateZ(e);this.moveLeft&&this.object.translateX(-e);this.moveRight&&this.object.translateX(e);this.moveUp&&this.object.translateY(e);this.moveDown&&this.object.translateY(-e);t=t*this.lookSpeed;this.activeLook||(t=0);this.lon=this.lon+this.mouseX*t;if(this.lookVertical)this.lat=this.lat-this.mouseY*t;this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;var e=this.target,i=this.object.position;e.x=i.x+100*Math.sin(this.phi)*Math.cos(this.theta);e.y=i.y+100*Math.cos(this.phi);e.z=i.z+100*Math.sin(this.phi)*Math.sin(this.theta);e=1;this.constrainVertical&&(e=Math.PI/(this.verticalMax-this.verticalMin));this.lon=this.lon+this.mouseX*t;if(this.lookVertical)this.lat=this.lat-this.mouseY*t*e;this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical)this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax);e=this.target;i=this.object.position;e.x=i.x+100*Math.sin(this.phi)*Math.cos(this.theta);e.y=i.y+100*Math.cos(this.phi);e.z=i.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(e)}};this.domElement.addEventListener("contextmenu",(function(t){t.preventDefault()}),false);this.domElement.addEventListener("mousemove",i(this,this.onMouseMove),false);this.domElement.addEventListener("mousedown",i(this,this.onMouseDown),false);this.domElement.addEventListener("mouseup",i(this,this.onMouseUp),false);this.domElement.addEventListener("keydown",i(this,this.onKeyDown),false);this.domElement.addEventListener("keyup",i(this,this.onKeyUp),false)};THREE.PathControls=function(t,e){function i(t){return(t=t*2)<1?.5*t*t:-.5*(--t*(t-2)-1)}function o(t,e){return function(){e.apply(t,arguments)}}function r(t,e,i,o){var r={name:i,fps:.6,length:o,hierarchy:[]},n,a=e.getControlPointsArray(),s=e.getLength(),l=a.length,c=0;n=l-1;e={parent:-1,keys:[]};e.keys[0]={time:0,pos:a[0],rot:[0,0,0,1],scl:[1,1,1]};e.keys[n]={time:o,pos:a[n],rot:[0,0,0,1],scl:[1,1,1]};for(n=1;n<l-1;n++){c=o*s.chunks[n]/s.total;e.keys[n]={time:c,pos:a[n]}}r.hierarchy[0]=e;THREE.AnimationHandler.add(r);return new THREE.Animation(t,i,THREE.AnimationHandler.CATMULLROM_FORWARD,false)}function n(t,e){var i,o,r=new THREE.Geometry;for(i=0;i<t.points.length*e;i++){o=i/(t.points.length*e);o=t.getPoint(o);r.vertices[i]=new THREE.Vector3(o.x,o.y,o.z)}return r}this.object=t;this.domElement=e!==void 0?e:document;this.id="PathControls"+THREE.PathControlsIdCounter++;this.duration=1e4;this.waypoints=[];this.useConstantSpeed=true;this.resamplingCoef=50;this.debugPath=new THREE.Object3D;this.debugDummy=new THREE.Object3D;this.animationParent=new THREE.Object3D;this.lookSpeed=.005;this.lookHorizontal=this.lookVertical=true;this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.target=new THREE.Object3D;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0;if(this.domElement===document){this.viewHalfX=window.innerWidth/2;this.viewHalfY=window.innerHeight/2}else{this.viewHalfX=this.domElement.offsetWidth/2;this.viewHalfY=this.domElement.offsetHeight/2;this.domElement.setAttribute("tabindex",-1)}var a=Math.PI*2,s=Math.PI/180;this.update=function(t){var e;if(this.lookHorizontal)this.lon=this.lon+this.mouseX*this.lookSpeed*t;if(this.lookVertical)this.lat=this.lat-this.mouseY*this.lookSpeed*t;this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*s;this.theta=this.lon*s;t=this.phi%a;this.phi=t>=0?t:t+a;e=this.verticalAngleMap.srcRange;t=this.verticalAngleMap.dstRange;e=THREE.Math.mapLinear(this.phi,e[0],e[1],t[0],t[1]);var o=t[1]-t[0];this.phi=i((e-t[0])/o)*o+t[0];e=this.horizontalAngleMap.srcRange;t=this.horizontalAngleMap.dstRange;e=THREE.Math.mapLinear(this.theta,e[0],e[1],t[0],t[1]);o=t[1]-t[0];this.theta=i((e-t[0])/o)*o+t[0];t=this.target.position;t.x=100*Math.sin(this.phi)*Math.cos(this.theta);t.y=100*Math.cos(this.phi);t.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(this.target.position)};this.onMouseMove=function(t){if(this.domElement===document){this.mouseX=t.pageX-this.viewHalfX;this.mouseY=t.pageY-this.viewHalfY}else{this.mouseX=t.pageX-this.domElement.offsetLeft-this.viewHalfX;this.mouseY=t.pageY-this.domElement.offsetTop-this.viewHalfY}};this.init=function(){this.spline=new THREE.Spline;this.spline.initFromArray(this.waypoints);this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var t=new THREE.MeshLambertMaterial({color:30719}),e=new THREE.MeshLambertMaterial({color:65280}),i=new THREE.CubeGeometry(10,10,20),a=new THREE.CubeGeometry(2,2,10);this.animationParent=new THREE.Mesh(i,t);t=new THREE.Mesh(a,e);t.position.set(0,10,0);this.animation=r(this.animationParent,this.spline,this.id,this.duration);this.animationParent.add(this.object);this.animationParent.add(this.target);this.animationParent.add(t)}else{this.animation=r(this.animationParent,this.spline,this.id,this.duration);this.animationParent.add(this.target);this.animationParent.add(this.object)}if(this.createDebugPath){var t=this.debugPath,e=this.spline,a=n(e,10),i=n(e,10),s=new THREE.LineBasicMaterial({color:16711680,linewidth:3}),a=new THREE.Line(a,s),i=new THREE.ParticleSystem(i,new THREE.ParticleBasicMaterial({color:16755200,size:3}));a.scale.set(1,1,1);t.add(a);i.scale.set(1,1,1);t.add(i);for(var a=new THREE.SphereGeometry(1,16,8),s=new THREE.MeshBasicMaterial({color:65280}),l=0;l<e.points.length;l++){i=new THREE.Mesh(a,s);i.position.copy(e.points[l]);t.add(i)}}this.domElement.addEventListener("mousemove",o(this,this.onMouseMove),false)}};THREE.PathControlsIdCounter=0;THREE.FlyControls=function(t,e){function i(t,e){return function(){e.apply(t,arguments)}}this.object=t;this.domElement=e!==void 0?e:document;e&&this.domElement.setAttribute("tabindex",-1);this.movementSpeed=1;this.rollSpeed=.005;this.autoForward=this.dragToLook=false;this.object.useQuaternion=true;this.tmpQuaternion=new THREE.Quaternion;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.handleEvent=function(t){if(typeof this[t.type]=="function")this[t.type](t)};this.keydown=function(t){if(!t.altKey){switch(t.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(t){switch(t.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(t){this.domElement!==document&&this.domElement.focus();t.preventDefault();t.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(t.button){case 0:this.object.moveForward=true;break;case 2:this.object.moveBackward=true}};this.mousemove=function(t){if(!this.dragToLook||this.mouseStatus>0){var e=this.getContainerDimensions(),i=e.size[0]/2,o=e.size[1]/2;this.moveState.yawLeft=-(t.pageX-e.offset[0]-i)/i;this.moveState.pitchDown=(t.pageY-e.offset[1]-o)/o;this.updateRotationVector()}};this.mouseup=function(t){t.preventDefault();t.stopPropagation();if(this.dragToLook){this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0}else switch(t.button){case 0:this.moveForward=false;break;case 2:this.moveBackward=false}this.updateRotationVector()};this.update=function(t){var e=t*this.movementSpeed,t=t*this.rollSpeed;this.object.translateX(this.moveVector.x*e);this.object.translateY(this.moveVector.y*e);this.object.translateZ(this.moveVector.z*e);this.tmpQuaternion.set(this.rotationVector.x*t,this.rotationVector.y*t,this.rotationVector.z*t,1).normalize();this.object.quaternion.multiplySelf(this.tmpQuaternion);this.object.matrix.setPosition(this.object.position);this.object.matrix.setRotationFromQuaternion(this.object.quaternion);this.object.matrixWorldNeedsUpdate=true};this.updateMovementVector=function(){var t=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-t+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",i(this,this.mousemove),false);this.domElement.addEventListener("mousedown",i(this,this.mousedown),false);this.domElement.addEventListener("mouseup",i(this,this.mouseup),false);this.domElement.addEventListener("keydown",i(this,this.keydown),false);this.domElement.addEventListener("keyup",i(this,this.keyup),false);this.updateMovementVector();this.updateRotationVector()};THREE.RollControls=function(t,e){this.object=t;this.domElement=e!==void 0?e:document;this.mouseLook=true;this.autoForward=false;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-.9,.9];this.object.matrixAutoUpdate=false;this.forward=new THREE.Vector3(0,0,1);this.roll=0;var i=new THREE.Vector3,o=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Matrix4,a=false,s=1,l=0,c=0,h=0,m=0,p=0,u=window.innerWidth/2,f=window.innerHeight/2;this.update=function(t){if(this.mouseLook){var e=t*this.lookSpeed;this.rotateHorizontally(e*m);this.rotateVertically(e*p)}e=t*this.movementSpeed;this.object.translateZ(-e*(l>0||this.autoForward&&!(l<0)?1:l));this.object.translateX(e*c);this.object.translateY(e*h);if(a)this.roll=this.roll+this.rollSpeed*t*s;if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1];this.forward.normalize()}else if(this.forward.y<this.constrainVertical[0]){this.forward.y=this.constrainVertical[0];this.forward.normalize()}r.copy(this.forward);o.set(0,1,0);i.cross(o,r).normalize();o.cross(r,i).normalize();this.object.matrix.elements[0]=i.x;this.object.matrix.elements[4]=o.x;this.object.matrix.elements[8]=r.x;this.object.matrix.elements[1]=i.y;this.object.matrix.elements[5]=o.y;this.object.matrix.elements[9]=r.y;this.object.matrix.elements[2]=i.z;this.object.matrix.elements[6]=o.z;this.object.matrix.elements[10]=r.z;n.identity();n.elements[0]=Math.cos(this.roll);n.elements[4]=-Math.sin(this.roll);n.elements[1]=Math.sin(this.roll);n.elements[5]=Math.cos(this.roll);this.object.matrix.multiplySelf(n);this.object.matrixWorldNeedsUpdate=true;this.object.matrix.elements[12]=this.object.position.x;this.object.matrix.elements[13]=this.object.position.y;this.object.matrix.elements[14]=this.object.position.z};this.translateX=function(t){this.object.position.x=this.object.position.x+this.object.matrix.elements[0]*t;this.object.position.y=this.object.position.y+this.object.matrix.elements[1]*t;this.object.position.z=this.object.position.z+this.object.matrix.elements[2]*t};this.translateY=function(t){this.object.position.x=this.object.position.x+this.object.matrix.elements[4]*t;this.object.position.y=this.object.position.y+this.object.matrix.elements[5]*t;this.object.position.z=this.object.position.z+this.object.matrix.elements[6]*t};this.translateZ=function(t){this.object.position.x=this.object.position.x-this.object.matrix.elements[8]*t;this.object.position.y=this.object.position.y-this.object.matrix.elements[9]*t;this.object.position.z=this.object.position.z-this.object.matrix.elements[10]*t};this.rotateHorizontally=function(t){i.set(this.object.matrix.elements[0],this.object.matrix.elements[1],this.object.matrix.elements[2]);i.multiplyScalar(t);this.forward.subSelf(i);this.forward.normalize()};this.rotateVertically=function(t){o.set(this.object.matrix.elements[4],this.object.matrix.elements[5],this.object.matrix.elements[6]);o.multiplyScalar(t);this.forward.addSelf(o);this.forward.normalize()};this.domElement.addEventListener("contextmenu",(function(t){t.preventDefault()}),false);this.domElement.addEventListener("mousemove",(function(t){m=(t.clientX-u)/window.innerWidth;p=(t.clientY-f)/window.innerHeight}),false);this.domElement.addEventListener("mousedown",(function(t){t.preventDefault();t.stopPropagation();switch(t.button){case 0:l=1;break;case 2:l=-1}}),false);this.domElement.addEventListener("mouseup",(function(t){t.preventDefault();t.stopPropagation();switch(t.button){case 0:l=0;break;case 2:l=0}}),false);this.domElement.addEventListener("keydown",(function(t){switch(t.keyCode){case 38:case 87:l=1;break;case 37:case 65:c=-1;break;case 40:case 83:l=-1;break;case 39:case 68:c=1;break;case 81:a=true;s=1;break;case 69:a=true;s=-1;break;case 82:h=1;break;case 70:h=-1}}),false);this.domElement.addEventListener("keyup",(function(t){switch(t.keyCode){case 38:case 87:l=0;break;case 37:case 65:c=0;break;case 40:case 83:l=0;break;case 39:case 68:c=0;break;case 81:a=false;break;case 69:a=false;break;case 82:h=0;break;case 70:h=0}}),false)};THREE.TrackballControls=function(t,e){THREE.EventTarget.call(this);var i=this;this.object=t;this.domElement=e!==void 0?e:document;this.enabled=true;this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=false;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var o=new THREE.Vector3,r=false,n=-1,a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector2,h=new THREE.Vector2,m=new THREE.Vector2,p=new THREE.Vector2,u={type:"change"};this.handleEvent=function(t){if(typeof this[t.type]=="function")this[t.type](t)};this.getMouseOnScreen=function(t,e){return new THREE.Vector2((t-i.screen.offsetLeft)/i.radius*.5,(e-i.screen.offsetTop)/i.radius*.5)};this.getMouseProjectionOnBall=function(t,e){var o=new THREE.Vector3((t-i.screen.width*.5-i.screen.offsetLeft)/i.radius,(i.screen.height*.5+i.screen.offsetTop-e)/i.radius,0),r=o.length();r>1?o.normalize():o.z=Math.sqrt(1-r*r);a.copy(i.object.position).subSelf(i.target);r=i.object.up.clone().setLength(o.y);r.addSelf(i.object.up.clone().crossSelf(a).setLength(o.x));r.addSelf(a.setLength(o.z));return r};this.rotateCamera=function(){var t=Math.acos(s.dot(l)/s.length()/l.length());if(t){var e=(new THREE.Vector3).cross(s,l).normalize(),o=new THREE.Quaternion,t=t*i.rotateSpeed;o.setFromAxisAngle(e,-t);o.multiplyVector3(a);o.multiplyVector3(i.object.up);o.multiplyVector3(l);if(i.staticMoving)s=l;else{o.setFromAxisAngle(e,t*(i.dynamicDampingFactor-1));o.multiplyVector3(s)}}};this.zoomCamera=function(){var t=1+(h.y-c.y)*i.zoomSpeed;if(t!==1&&t>0){a.multiplyScalar(t);i.staticMoving?c=h:c.y=c.y+(h.y-c.y)*this.dynamicDampingFactor}};this.panCamera=function(){var t=p.clone().subSelf(m);if(t.lengthSq()){t.multiplyScalar(a.length()*i.panSpeed);var e=a.clone().crossSelf(i.object.up).setLength(t.x);e.addSelf(i.object.up.clone().setLength(t.y));i.object.position.addSelf(e);i.target.addSelf(e);i.staticMoving?m=p:m.addSelf(t.sub(p,m).multiplyScalar(i.dynamicDampingFactor))}};this.checkDistances=function(){if(!i.noZoom||!i.noPan){i.object.position.lengthSq()>i.maxDistance*i.maxDistance&&i.object.position.setLength(i.maxDistance);a.lengthSq()<i.minDistance*i.minDistance&&i.object.position.add(i.target,a.setLength(i.minDistance))}};this.update=function(){a.copy(i.object.position).subSelf(i.target);i.noRotate||i.rotateCamera();i.noZoom||i.zoomCamera();i.noPan||i.panCamera();i.object.position.add(i.target,a);i.checkDistances();i.object.lookAt(i.target);if(o.distanceTo(i.object.position)>0){i.dispatchEvent(u);o.copy(i.object.position)}};this.domElement.addEventListener("contextmenu",(function(t){t.preventDefault()}),false);this.domElement.addEventListener("mousemove",(function(t){if(i.enabled){if(r){s=l=i.getMouseProjectionOnBall(t.clientX,t.clientY);c=h=i.getMouseOnScreen(t.clientX,t.clientY);m=p=i.getMouseOnScreen(t.clientX,t.clientY);r=false}n!==-1&&(n===0&&!i.noRotate?l=i.getMouseProjectionOnBall(t.clientX,t.clientY):n===1&&!i.noZoom?h=i.getMouseOnScreen(t.clientX,t.clientY):n===2&&!i.noPan&&(p=i.getMouseOnScreen(t.clientX,t.clientY)))}}),false);this.domElement.addEventListener("mousedown",(function(t){if(i.enabled){t.preventDefault();t.stopPropagation();if(n===-1){n=t.button;n===0&&!i.noRotate?s=l=i.getMouseProjectionOnBall(t.clientX,t.clientY):n===1&&!i.noZoom?c=h=i.getMouseOnScreen(t.clientX,t.clientY):this.noPan||(m=p=i.getMouseOnScreen(t.clientX,t.clientY))}}}),false);this.domElement.addEventListener("mouseup",(function(t){if(i.enabled){t.preventDefault();t.stopPropagation();n=-1}}),false);window.addEventListener("keydown",(function(t){if(i.enabled&&n===-1){t.keyCode===i.keys[0]&&!i.noRotate?n=0:t.keyCode===i.keys[1]&&!i.noZoom?n=1:t.keyCode===i.keys[2]&&!i.noPan&&(n=2);n!==-1&&(r=true)}}),false);window.addEventListener("keyup",(function(){i.enabled&&n!==-1&&(n=-1)}),false)};THREE.CubeGeometry=function(t,e,i,o,r,n,a,s){function l(t,e,i,a,s,l,h,m){var p,u=o||1,f=r||1,y=s/2,d=l/2,_=c.vertices.length;if(t==="x"&&e==="y"||t==="y"&&e==="x")p="z";else if(t==="x"&&e==="z"||t==="z"&&e==="x"){p="y";f=n||1}else if(t==="z"&&e==="y"||t==="y"&&e==="z"){p="x";u=n||1}var v=u+1,x=f+1,E=s/u,g=l/f,b=new THREE.Vector3;b[p]=h>0?1:-1;for(s=0;s<x;s++)for(l=0;l<v;l++){var T=new THREE.Vector3;T[t]=(l*E-y)*i;T[e]=(s*g-d)*a;T[p]=h;c.vertices.push(T)}for(s=0;s<f;s++)for(l=0;l<u;l++){t=new THREE.Face4(l+v*s+_,l+v*(s+1)+_,l+1+v*(s+1)+_,l+1+v*s+_);t.normal.copy(b);t.vertexNormals.push(b.clone(),b.clone(),b.clone(),b.clone());t.materialIndex=m;c.faces.push(t);c.faceVertexUvs[0].push([new THREE.UV(l/u,s/f),new THREE.UV(l/u,(s+1)/f),new THREE.UV((l+1)/u,(s+1)/f),new THREE.UV((l+1)/u,s/f)])}}THREE.Geometry.call(this);var c=this,h=t/2,m=e/2,p=i/2,u,f,y,d,_,v;if(a!==void 0){if(a instanceof Array)this.materials=a;else{this.materials=[];for(u=0;u<6;u++)this.materials.push(a)}u=0;d=1;f=2;_=3;y=4;v=5}else this.materials=[];this.sides={px:true,nx:true,py:true,ny:true,pz:true,nz:true};if(s!=void 0)for(var x in s)this.sides[x]!==void 0&&(this.sides[x]=s[x]);this.sides.px&&l("z","y",-1,-1,i,e,h,u);this.sides.nx&&l("z","y",1,-1,i,e,-h,d);this.sides.py&&l("x","z",1,1,t,i,m,f);this.sides.ny&&l("x","z",1,-1,t,i,-m,_);this.sides.pz&&l("x","y",1,-1,t,e,p,y);this.sides.nz&&l("x","y",-1,-1,t,e,-p,v);this.computeCentroids();this.mergeVertices()};THREE.CubeGeometry.prototype=new THREE.Geometry;THREE.CubeGeometry.prototype.constructor=THREE.CubeGeometry;THREE.CylinderGeometry=function(t,e,i,o,r,n){THREE.Geometry.call(this);var t=t!==void 0?t:20,e=e!==void 0?e:20,i=i!==void 0?i:100,a=i/2,o=o||8,r=r||1,s,l,c=[],h=[];for(l=0;l<=r;l++){var m=[],p=[],u=l/r,f=u*(e-t)+t;for(s=0;s<=o;s++){var y=s/o,d=new THREE.Vector3;d.x=f*Math.sin(y*Math.PI*2);d.y=-u*i+a;d.z=f*Math.cos(y*Math.PI*2);this.vertices.push(d);m.push(this.vertices.length-1);p.push(new THREE.UV(y,u))}c.push(m);h.push(p)}i=(e-t)/i;for(s=0;s<o;s++){if(t!==0){m=this.vertices[c[0][s]].clone();p=this.vertices[c[0][s+1]].clone()}else{m=this.vertices[c[1][s]].clone();p=this.vertices[c[1][s+1]].clone()}m.setY(Math.sqrt(m.x*m.x+m.z*m.z)*i).normalize();p.setY(Math.sqrt(p.x*p.x+p.z*p.z)*i).normalize();for(l=0;l<r;l++){var u=c[l][s],f=c[l+1][s],y=c[l+1][s+1],d=c[l][s+1],_=m.clone(),v=m.clone(),x=p.clone(),E=p.clone(),g=h[l][s].clone(),b=h[l+1][s].clone(),T=h[l+1][s+1].clone(),R=h[l][s+1].clone();this.faces.push(new THREE.Face4(u,f,y,d,[_,v,x,E]));this.faceVertexUvs[0].push([g,b,T,R])}}if(!n&&t>0){this.vertices.push(new THREE.Vector3(0,a,0));for(s=0;s<o;s++){u=c[0][s];f=c[0][s+1];y=this.vertices.length-1;_=new THREE.Vector3(0,1,0);v=new THREE.Vector3(0,1,0);x=new THREE.Vector3(0,1,0);g=h[0][s].clone();b=h[0][s+1].clone();T=new THREE.UV(b.u,0);this.faces.push(new THREE.Face3(u,f,y,[_,v,x]));this.faceVertexUvs[0].push([g,b,T])}}if(!n&&e>0){this.vertices.push(new THREE.Vector3(0,-a,0));for(s=0;s<o;s++){u=c[l][s+1];f=c[l][s];y=this.vertices.length-1;_=new THREE.Vector3(0,-1,0);v=new THREE.Vector3(0,-1,0);x=new THREE.Vector3(0,-1,0);g=h[l][s+1].clone();b=h[l][s].clone();T=new THREE.UV(b.u,1);this.faces.push(new THREE.Face3(u,f,y,[_,v,x]));this.faceVertexUvs[0].push([g,b,T])}}this.computeCentroids();this.computeFaceNormals()};THREE.CylinderGeometry.prototype=new THREE.Geometry;THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;THREE.ExtrudeGeometry=function(t,e){if(typeof t!=="undefined"){THREE.Geometry.call(this);t=t instanceof Array?t:[t];this.shapebb=t[t.length-1].getBoundingBox();this.addShapeList(t,e);this.computeCentroids();this.computeFaceNormals()}};THREE.ExtrudeGeometry.prototype=new THREE.Geometry;THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShapeList=function(t,e){for(var i=t.length,o=0;o<i;o++)this.addShape(t[o],e)};THREE.ExtrudeGeometry.prototype.addShape=function(t,e){function i(t,e,i){e||console.log("die");return e.clone().multiplyScalar(i).addSelf(t)}function o(t,e,i){var o=THREE.ExtrudeGeometry.__v1,r=THREE.ExtrudeGeometry.__v2,n=THREE.ExtrudeGeometry.__v3,a=THREE.ExtrudeGeometry.__v4,s=THREE.ExtrudeGeometry.__v5,l=THREE.ExtrudeGeometry.__v6;o.set(t.x-e.x,t.y-e.y);r.set(t.x-i.x,t.y-i.y);o=o.normalize();r=r.normalize();n.set(-o.y,o.x);a.set(r.y,-r.x);s.copy(t).addSelf(n);l.copy(t).addSelf(a);if(s.equals(l))return a.clone();s.copy(e).addSelf(n);l.copy(i).addSelf(a);n=o.dot(a);a=l.subSelf(s).dot(a);if(n===0){console.log("Either infinite or no solutions!");a===0?console.log("Its finite solutions."):console.log("Too bad, no solutions.")}a=a/n;if(a<0){e=Math.atan2(e.y-t.y,e.x-t.x);t=Math.atan2(i.y-t.y,i.x-t.x);e>t&&(t=t+Math.PI*2);i=(e+t)/2;t=-Math.cos(i);i=-Math.sin(i);return new THREE.Vector2(t,i)}return o.multiplyScalar(a).addSelf(s).subSelf(t).clone()}function r(i,o){var r,n;for(G=i.length;--G>=0;){r=G;n=G-1;n<0&&(n=i.length-1);for(var a=0,s=p+h*2,a=0;a<s;a++){var l=F*a,c=F*(a+1),m=o+r+l,l=o+n+l,u=o+n+c,c=o+r+c,f=i,y=a,d=s,m=m+C,l=l+C,u=u+C,c=c+C;S.faces.push(new THREE.Face4(m,l,u,c,null,null,v));m=O.generateSideWallUV(S,t,f,e,m,l,u,c,y,d);S.faceVertexUvs[0].push(m)}}}function n(t,e,i){S.vertices.push(new THREE.Vector3(t,e,i))}function a(i,o,r,n){i=i+C;o=o+C;r=r+C;S.faces.push(new THREE.Face3(i,o,r,null,null,_));i=n?O.generateBottomUV(S,t,e,i,o,r):O.generateTopUV(S,t,e,i,o,r);S.faceVertexUvs[0].push(i)}var s=e.amount!==void 0?e.amount:100,l=e.bevelThickness!==void 0?e.bevelThickness:6,c=e.bevelSize!==void 0?e.bevelSize:l-2,h=e.bevelSegments!==void 0?e.bevelSegments:3,m=e.bevelEnabled!==void 0?e.bevelEnabled:true,p=e.steps!==void 0?e.steps:1,u=e.bendPath,f=e.extrudePath,y,d=false,_=e.material,v=e.extrudeMaterial,x,E,g,b;if(f){y=f.getSpacedPoints(p);d=true;m=false;x=new THREE.TubeGeometry.FrenetFrames(f,p,false);E=new THREE.Vector3;g=new THREE.Vector3;b=new THREE.Vector3}if(!m)c=l=h=0;var T,R,w,S=this,C=this.vertices.length;u&&t.addWrapPath(u);var f=t.extractPoints(),u=f.shape,A=f.holes;if(f=!THREE.Shape.Utils.isClockWise(u)){u=u.reverse();R=0;for(w=A.length;R<w;R++){T=A[R];THREE.Shape.Utils.isClockWise(T)&&(A[R]=T.reverse())}f=false}var M=THREE.Shape.Utils.triangulateShape(u,A),D=u;R=0;for(w=A.length;R<w;R++){T=A[R];u=u.concat(T)}var B,H,V,L,P,F=u.length,I,U=M.length,f=[],G=0;V=D.length;B=V-1;for(H=G+1;G<V;G++,B++,H++){B===V&&(B=0);H===V&&(H=0);f[G]=o(D[G],D[B],D[H])}var z=[],N,k=f.concat();R=0;for(w=A.length;R<w;R++){T=A[R];N=[];G=0;V=T.length;B=V-1;for(H=G+1;G<V;G++,B++,H++){B===V&&(B=0);H===V&&(H=0);N[G]=o(T[G],T[B],T[H])}z.push(N);k=k.concat(N)}for(B=0;B<h;B++){V=B/h;L=l*(1-V);H=c*Math.sin(V*Math.PI/2);G=0;for(V=D.length;G<V;G++){P=i(D[G],f[G],H);n(P.x,P.y,-L)}R=0;for(w=A.length;R<w;R++){T=A[R];N=z[R];G=0;for(V=T.length;G<V;G++){P=i(T[G],N[G],H);n(P.x,P.y,-L)}}}H=c;for(G=0;G<F;G++){P=m?i(u[G],k[G],H):u[G];if(d){g.copy(x.normals[0]).multiplyScalar(P.x);E.copy(x.binormals[0]).multiplyScalar(P.y);b.copy(y[0]).addSelf(g).addSelf(E);n(b.x,b.y,b.z)}else n(P.x,P.y,0)}for(V=1;V<=p;V++)for(G=0;G<F;G++){P=m?i(u[G],k[G],H):u[G];if(d){g.copy(x.normals[V]).multiplyScalar(P.x);E.copy(x.binormals[V]).multiplyScalar(P.y);b.copy(y[V]).addSelf(g).addSelf(E);n(b.x,b.y,b.z)}else n(P.x,P.y,s/p*V)}for(B=h-1;B>=0;B--){V=B/h;L=l*(1-V);H=c*Math.sin(V*Math.PI/2);G=0;for(V=D.length;G<V;G++){P=i(D[G],f[G],H);n(P.x,P.y,s+L)}R=0;for(w=A.length;R<w;R++){T=A[R];N=z[R];G=0;for(V=T.length;G<V;G++){P=i(T[G],N[G],H);d?n(P.x,P.y+y[p-1].y,y[p-1].x+L):n(P.x,P.y,s+L)}}}var O=THREE.ExtrudeGeometry.WorldUVGenerator;(function(){if(m){var t;t=F*0;for(G=0;G<U;G++){I=M[G];a(I[2]+t,I[1]+t,I[0]+t,true)}t=p+h*2;t=F*t;for(G=0;G<U;G++){I=M[G];a(I[0]+t,I[1]+t,I[2]+t,false)}}else{for(G=0;G<U;G++){I=M[G];a(I[2],I[1],I[0],true)}for(G=0;G<U;G++){I=M[G];a(I[0]+F*p,I[1]+F*p,I[2]+F*p,false)}}})();(function(){var t=0;r(D,t);t=t+D.length;R=0;for(w=A.length;R<w;R++){T=A[R];r(T,t);t=t+T.length}})()};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(t,e,i,o,r,n){e=t.vertices[r].x;r=t.vertices[r].y;i=t.vertices[n].x;n=t.vertices[n].y;return[new THREE.UV(t.vertices[o].x,1-t.vertices[o].y),new THREE.UV(e,1-r),new THREE.UV(i,1-n)]},generateBottomUV:function(t,e,i,o,r,n){return this.generateTopUV(t,e,i,o,r,n)},generateSideWallUV:function(t,e,i,o,r,n,a,s){var e=t.vertices[r].x,i=t.vertices[r].y,r=t.vertices[r].z,o=t.vertices[n].x,l=t.vertices[n].y,n=t.vertices[n].z,c=t.vertices[a].x,h=t.vertices[a].y,a=t.vertices[a].z,m=t.vertices[s].x,p=t.vertices[s].y,t=t.vertices[s].z;return Math.abs(i-l)<.01?[new THREE.UV(e,r),new THREE.UV(o,n),new THREE.UV(c,a),new THREE.UV(m,t)]:[new THREE.UV(i,r),new THREE.UV(l,n),new THREE.UV(h,a),new THREE.UV(p,t)]}};THREE.ExtrudeGeometry.__v1=new THREE.Vector2;THREE.ExtrudeGeometry.__v2=new THREE.Vector2;THREE.ExtrudeGeometry.__v3=new THREE.Vector2;THREE.ExtrudeGeometry.__v4=new THREE.Vector2;THREE.ExtrudeGeometry.__v5=new THREE.Vector2;THREE.ExtrudeGeometry.__v6=new THREE.Vector2;THREE.LatheGeometry=function(t,e,i){THREE.Geometry.call(this);for(var e=e||12,i=i||2*Math.PI,o=[],r=(new THREE.Matrix4).makeRotationZ(i/e),n=0;n<t.length;n++){o[n]=t[n].clone();this.vertices.push(o[n])}for(var a=e+1,i=0;i<a;i++)for(n=0;n<o.length;n++){o[n]=r.multiplyVector3(o[n].clone());this.vertices.push(o[n])}for(i=0;i<e;i++){o=0;for(r=t.length;o<r-1;o++){this.faces.push(new THREE.Face4(i*r+o,(i+1)%a*r+o,(i+1)%a*r+(o+1)%r,i*r+(o+1)%r));this.faceVertexUvs[0].push([new THREE.UV(1-i/e,o/r),new THREE.UV(1-(i+1)/e,o/r),new THREE.UV(1-(i+1)/e,(o+1)/r),new THREE.UV(1-i/e,(o+1)/r)])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=new THREE.Geometry;THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;THREE.PlaneGeometry=function(t,e,i,o){THREE.Geometry.call(this);for(var r=t/2,n=e/2,i=i||1,o=o||1,a=i+1,s=o+1,l=t/i,c=e/o,h=new THREE.Vector3(0,1,0),t=0;t<s;t++)for(e=0;e<a;e++)this.vertices.push(new THREE.Vector3(e*l-r,0,t*c-n));for(t=0;t<o;t++)for(e=0;e<i;e++){r=new THREE.Face4(e+a*t,e+a*(t+1),e+1+a*(t+1),e+1+a*t);r.normal.copy(h);r.vertexNormals.push(h.clone(),h.clone(),h.clone(),h.clone());this.faces.push(r);this.faceVertexUvs[0].push([new THREE.UV(e/i,t/o),new THREE.UV(e/i,(t+1)/o),new THREE.UV((e+1)/i,(t+1)/o),new THREE.UV((e+1)/i,t/o)])}this.computeCentroids()};THREE.PlaneGeometry.prototype=new THREE.Geometry;THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;THREE.SphereGeometry=function(t,e,i,o,r,n,a){THREE.Geometry.call(this);var t=t||50,o=o!==void 0?o:0,r=r!==void 0?r:Math.PI*2,n=n!==void 0?n:0,a=a!==void 0?a:Math.PI,e=Math.max(3,Math.floor(e)||8),i=Math.max(2,Math.floor(i)||6),s,l,c=[],h=[];for(l=0;l<=i;l++){var m=[],p=[];for(s=0;s<=e;s++){var u=s/e,f=l/i,y=new THREE.Vector3;y.x=-t*Math.cos(o+u*r)*Math.sin(n+f*a);y.y=t*Math.cos(n+f*a);y.z=t*Math.sin(o+u*r)*Math.sin(n+f*a);this.vertices.push(y);m.push(this.vertices.length-1);p.push(new THREE.UV(u,f))}c.push(m);h.push(p)}for(l=0;l<i;l++)for(s=0;s<e;s++){var o=c[l][s+1],r=c[l][s],n=c[l+1][s],a=c[l+1][s+1],m=this.vertices[o].clone().normalize(),p=this.vertices[r].clone().normalize(),u=this.vertices[n].clone().normalize(),f=this.vertices[a].clone().normalize(),y=h[l][s+1].clone(),d=h[l][s].clone(),_=h[l+1][s].clone(),v=h[l+1][s+1].clone();if(Math.abs(this.vertices[o].y)==t){this.faces.push(new THREE.Face3(o,n,a,[m,u,f]));this.faceVertexUvs[0].push([y,_,v])}else if(Math.abs(this.vertices[n].y)==t){this.faces.push(new THREE.Face3(o,r,n,[m,p,u]));this.faceVertexUvs[0].push([y,d,_])}else{this.faces.push(new THREE.Face4(o,r,n,a,[m,p,u,f]));this.faceVertexUvs[0].push([y,d,_,v])}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere={radius:t}};THREE.SphereGeometry.prototype=new THREE.Geometry;THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;THREE.TextGeometry=function(t,e){var i=new THREE.TextPath(t,e).toShapes();e.amount=e.height!==void 0?e.height:50;if(e.bevelThickness===void 0)e.bevelThickness=10;if(e.bevelSize===void 0)e.bevelSize=8;if(e.bevelEnabled===void 0)e.bevelEnabled=false;if(e.bend){var o=i[i.length-1].getBoundingBox().maxX;e.bendPath=new THREE.QuadraticBezierCurve(new THREE.Vector2(0,0),new THREE.Vector2(o/2,120),new THREE.Vector2(o,0))}THREE.ExtrudeGeometry.call(this,i,e)};THREE.TextGeometry.prototype=new THREE.ExtrudeGeometry;THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(t){var e=t.familyName.toLowerCase();this.faces[e]=this.faces[e]||{};this.faces[e][t.cssFontWeight]=this.faces[e][t.cssFontWeight]||{};this.faces[e][t.cssFontWeight][t.cssFontStyle]=t;return this.faces[e][t.cssFontWeight][t.cssFontStyle]=t},drawText:function(t){for(var e=this.getFace(),i=this.size/e.resolution,o=0,r=(""+t).split(""),n=r.length,a=[],t=0;t<n;t++){var s=new THREE.Path,s=this.extractGlyphPoints(r[t],e,i,o,s),o=o+s.offset;a.push(s.path)}return{paths:a,offset:o/2}},extractGlyphPoints:function(t,e,i,o,r){var n=[],a,s,l,c,h,m,p,u,f,y,d,_=e.glyphs[t]||e.glyphs["?"];if(_){if(_.o){e=_._cachedOutline||(_._cachedOutline=_.o.split(" "));c=e.length;for(t=0;t<c;){l=e[t++];switch(l){case"m":l=e[t++]*i+o;h=e[t++]*i;n.push(new THREE.Vector2(l,h));r.moveTo(l,h);break;case"l":l=e[t++]*i+o;h=e[t++]*i;n.push(new THREE.Vector2(l,h));r.lineTo(l,h);break;case"q":l=e[t++]*i+o;h=e[t++]*i;u=e[t++]*i+o;f=e[t++]*i;r.quadraticCurveTo(u,f,l,h);if(a=n[n.length-1]){m=a.x;p=a.y;a=1;for(s=this.divisions;a<=s;a++){var v=a/s,x=THREE.Shape.Utils.b2(v,m,u,l),v=THREE.Shape.Utils.b2(v,p,f,h);n.push(new THREE.Vector2(x,v))}}break;case"b":l=e[t++]*i+o;h=e[t++]*i;u=e[t++]*i+o;f=e[t++]*-i;y=e[t++]*i+o;d=e[t++]*-i;r.bezierCurveTo(l,h,u,f,y,d);if(a=n[n.length-1]){m=a.x;p=a.y;a=1;for(s=this.divisions;a<=s;a++){v=a/s;x=THREE.Shape.Utils.b3(v,m,u,y,l);v=THREE.Shape.Utils.b3(v,p,f,d,h);n.push(new THREE.Vector2(x,v))}}}}}return{offset:_.ha*i,points:n,path:r}}}};(function(t){var e=function(t){for(var e=t.length,i=0,o=e-1,r=0;r<e;o=r++)i=i+(t[o].x*t[r].y-t[r].x*t[o].y);return i*.5};t.Triangulate=function(t,i){var o=t.length;if(o<3)return null;var r=[],n=[],a=[],s,l,c;if(e(t)>0)for(l=0;l<o;l++)n[l]=l;else for(l=0;l<o;l++)n[l]=o-1-l;var h=2*o;for(l=o-1;o>2;){if(h--<=0){console.log("Warning, unable to triangulate polygon!");break}s=l;o<=s&&(s=0);l=s+1;o<=l&&(l=0);c=l+1;o<=c&&(c=0);var m;t:{m=t;var p=s,u=l,f=c,y=o,d=n,_=void 0,v=void 0,x=void 0,E=void 0,g=void 0,b=void 0,T=void 0,R=void 0,w=void 0,v=m[d[p]].x,x=m[d[p]].y,E=m[d[u]].x,g=m[d[u]].y,b=m[d[f]].x,T=m[d[f]].y;if(1e-10>(E-v)*(T-x)-(g-x)*(b-v))m=false;else{for(_=0;_<y;_++)if(!(_==p||_==u||_==f)){var R=m[d[_]].x,w=m[d[_]].y,S=void 0,C=void 0,A=void 0,M=void 0,D=void 0,B=void 0,H=void 0,V=void 0,L=void 0,P=void 0,F=void 0,I=void 0,S=A=D=void 0,S=b-E,C=T-g,A=v-b,M=x-T,D=E-v,B=g-x,H=R-v,V=w-x,L=R-E,P=w-g,F=R-b,I=w-T,S=S*P-C*L,D=D*V-B*H,A=A*I-M*F;if(S>=0&&A>=0&&D>=0){m=false;break t}}m=true}}if(m){r.push([t[n[s]],t[n[l]],t[n[c]]]);a.push([n[s],n[l],n[c]]);s=l;for(c=l+1;c<o;s++,c++)n[s]=n[c];o--;h=2*o}}return i?a:r};t.Triangulate.area=e;return t})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.TorusGeometry=function(t,e,i,o,r){THREE.Geometry.call(this);this.radius=t||100;this.tube=e||40;this.segmentsR=i||8;this.segmentsT=o||6;this.arc=r||Math.PI*2;r=new THREE.Vector3;t=[];e=[];for(i=0;i<=this.segmentsR;i++)for(o=0;o<=this.segmentsT;o++){var n=o/this.segmentsT*this.arc,a=i/this.segmentsR*Math.PI*2;r.x=this.radius*Math.cos(n);r.y=this.radius*Math.sin(n);var s=new THREE.Vector3;s.x=(this.radius+this.tube*Math.cos(a))*Math.cos(n);s.y=(this.radius+this.tube*Math.cos(a))*Math.sin(n);s.z=this.tube*Math.sin(a);this.vertices.push(s);t.push(new THREE.UV(o/this.segmentsT,1-i/this.segmentsR));e.push(s.clone().subSelf(r).normalize())}for(i=1;i<=this.segmentsR;i++)for(o=1;o<=this.segmentsT;o++){var r=(this.segmentsT+1)*i+o-1,n=(this.segmentsT+1)*(i-1)+o-1,a=(this.segmentsT+1)*(i-1)+o,s=(this.segmentsT+1)*i+o,l=new THREE.Face4(r,n,a,s,[e[r],e[n],e[a],e[s]]);l.normal.addSelf(e[r]);l.normal.addSelf(e[n]);l.normal.addSelf(e[a]);l.normal.addSelf(e[s]);l.normal.normalize();this.faces.push(l);this.faceVertexUvs[0].push([t[r].clone(),t[n].clone(),t[a].clone(),t[s].clone()])}this.computeCentroids()};THREE.TorusGeometry.prototype=new THREE.Geometry;THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;THREE.TorusKnotGeometry=function(t,e,i,o,r,n,a){function s(t,e,i,o,r,n){var a=Math.cos(t);Math.cos(e);e=Math.sin(t);t=i/o*t;i=Math.cos(t);a=r*(2+i)*.5*a;e=r*(2+i)*e*.5;r=n*r*Math.sin(t)*.5;return new THREE.Vector3(a,e,r)}THREE.Geometry.call(this);this.radius=t||200;this.tube=e||40;this.segmentsR=i||64;this.segmentsT=o||8;this.p=r||2;this.q=n||3;this.heightScale=a||1;this.grid=Array(this.segmentsR);i=new THREE.Vector3;o=new THREE.Vector3;r=new THREE.Vector3;for(t=0;t<this.segmentsR;++t){this.grid[t]=Array(this.segmentsT);for(e=0;e<this.segmentsT;++e){var l=t/this.segmentsR*2*this.p*Math.PI,a=e/this.segmentsT*2*Math.PI,n=s(l,a,this.q,this.p,this.radius,this.heightScale),l=s(l+.01,a,this.q,this.p,this.radius,this.heightScale);i.sub(l,n);o.add(l,n);r.cross(i,o);o.cross(r,i);r.normalize();o.normalize();l=-this.tube*Math.cos(a);a=this.tube*Math.sin(a);n.x=n.x+(l*o.x+a*r.x);n.y=n.y+(l*o.y+a*r.y);n.z=n.z+(l*o.z+a*r.z);this.grid[t][e]=this.vertices.push(new THREE.Vector3(n.x,n.y,n.z))-1}}for(t=0;t<this.segmentsR;++t)for(e=0;e<this.segmentsT;++e){var r=(t+1)%this.segmentsR,n=(e+1)%this.segmentsT,i=this.grid[t][e],o=this.grid[r][e],r=this.grid[r][n],n=this.grid[t][n],a=new THREE.UV(t/this.segmentsR,e/this.segmentsT),l=new THREE.UV((t+1)/this.segmentsR,e/this.segmentsT),c=new THREE.UV((t+1)/this.segmentsR,(e+1)/this.segmentsT),h=new THREE.UV(t/this.segmentsR,(e+1)/this.segmentsT);this.faces.push(new THREE.Face4(i,o,r,n));this.faceVertexUvs[0].push([a,l,c,h])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.TorusKnotGeometry.prototype=new THREE.Geometry;THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;THREE.TubeGeometry=function(t,e,i,o,r,n){THREE.Geometry.call(this);this.path=t;this.segments=e||64;this.radius=i||1;this.segmentsRadius=o||8;this.closed=r||false;if(n)this.debug=new THREE.Object3D;this.grid=[];var a,s,n=this.segments+1,l,c,h,m=new THREE.Vector3,p,u,f,e=new THREE.TubeGeometry.FrenetFrames(t,e,r);p=e.tangents;u=e.normals;f=e.binormals;this.tangents=p;this.normals=u;this.binormals=f;for(e=0;e<n;e++){this.grid[e]=[];o=e/(n-1);h=t.getPointAt(o);o=p[e];a=u[e];s=f[e];if(this.debug){this.debug.add(new THREE.ArrowHelper(o,h,i,255));this.debug.add(new THREE.ArrowHelper(a,h,i,16711680));this.debug.add(new THREE.ArrowHelper(s,h,i,65280))}for(o=0;o<this.segmentsRadius;o++){l=o/this.segmentsRadius*2*Math.PI;c=-this.radius*Math.cos(l);l=this.radius*Math.sin(l);m.copy(h);m.x=m.x+(c*a.x+l*s.x);m.y=m.y+(c*a.y+l*s.y);m.z=m.z+(c*a.z+l*s.z);this.grid[e][o]=this.vertices.push(new THREE.Vector3(m.x,m.y,m.z))-1}}for(e=0;e<this.segments;e++)for(o=0;o<this.segmentsRadius;o++){n=r?(e+1)%this.segments:e+1;m=(o+1)%this.segmentsRadius;t=this.grid[e][o];i=this.grid[n][o];n=this.grid[n][m];m=this.grid[e][m];p=new THREE.UV(e/this.segments,o/this.segmentsRadius);u=new THREE.UV((e+1)/this.segments,o/this.segmentsRadius);f=new THREE.UV((e+1)/this.segments,(o+1)/this.segmentsRadius);a=new THREE.UV(e/this.segments,(o+1)/this.segmentsRadius);this.faces.push(new THREE.Face4(t,i,n,m));this.faceVertexUvs[0].push([p,u,f,a])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=new THREE.Geometry;THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.FrenetFrames=function(t,e,i){new THREE.Vector3;var o=new THREE.Vector3;new THREE.Vector3;var r=[],n=[],a=[],s=new THREE.Vector3,l=new THREE.Matrix4,e=e+1,c,h,m;this.tangents=r;this.normals=n;this.binormals=a;for(c=0;c<e;c++){h=c/(e-1);r[c]=t.getTangentAt(h);r[c].normalize()}n[0]=new THREE.Vector3;a[0]=new THREE.Vector3;t=Number.MAX_VALUE;c=Math.abs(r[0].x);h=Math.abs(r[0].y);m=Math.abs(r[0].z);if(c<=t){t=c;o.set(1,0,0)}if(h<=t){t=h;o.set(0,1,0)}m<=t&&o.set(0,0,1);s.cross(r[0],o).normalize();n[0].cross(r[0],s);a[0].cross(r[0],n[0]);for(c=1;c<e;c++){n[c]=n[c-1].clone();a[c]=a[c-1].clone();s.cross(r[c-1],r[c]);if(s.length()>1e-4){s.normalize();o=Math.acos(r[c-1].dot(r[c]));l.makeRotationAxis(s,o).multiplyVector3(n[c])}a[c].cross(r[c],n[c])}if(i){o=Math.acos(n[0].dot(n[e-1]));o=o/(e-1);r[0].dot(s.cross(n[0],n[e-1]))>0&&(o=-o);for(c=1;c<e;c++){l.makeRotationAxis(r[c],o*c).multiplyVector3(n[c]);a[c].cross(r[c],n[c])}}};THREE.PolyhedronGeometry=function(t,e,i,o){function r(t){var e=t.normalize().clone();e.index=l.vertices.push(e)-1;var i=Math.atan2(t.z,-t.x)/2/Math.PI+.5,t=Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5;e.uv=new THREE.UV(i,t);return e}function n(t,e,i,o){if(o<1){o=new THREE.Face3(t.index,e.index,i.index,[t.clone(),e.clone(),i.clone()]);o.centroid.addSelf(t).addSelf(e).addSelf(i).divideScalar(3);o.normal=o.centroid.clone().normalize();l.faces.push(o);o=Math.atan2(o.centroid.z,-o.centroid.x);l.faceVertexUvs[0].push([s(t.uv,t,o),s(e.uv,e,o),s(i.uv,i,o)])}else{o=o-1;n(t,a(t,e),a(t,i),o);n(a(t,e),e,a(e,i),o);n(a(t,i),a(e,i),i,o);n(a(t,e),a(e,i),a(t,i),o)}}function a(t,e){m[t.index]||(m[t.index]=[]);m[e.index]||(m[e.index]=[]);var i=m[t.index][e.index];i===void 0&&(m[t.index][e.index]=m[e.index][t.index]=i=r((new THREE.Vector3).add(t,e).divideScalar(2)));return i}function s(t,e,i){i<0&&t.u===1&&(t=new THREE.UV(t.u-1,t.v));e.x===0&&e.z===0&&(t=new THREE.UV(i/2/Math.PI+.5,t.v));return t}THREE.Geometry.call(this);for(var i=i||1,o=o||0,l=this,c=0,h=t.length;c<h;c++)r(new THREE.Vector3(t[c][0],t[c][1],t[c][2]));for(var m=[],t=this.vertices,c=0,h=e.length;c<h;c++)n(t[e[c][0]],t[e[c][1]],t[e[c][2]],o);this.mergeVertices();c=0;for(h=this.vertices.length;c<h;c++)this.vertices[c].multiplyScalar(i);this.computeCentroids();this.boundingSphere={radius:i}};THREE.PolyhedronGeometry.prototype=new THREE.Geometry;THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;THREE.IcosahedronGeometry=function(t,e){var i=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[[-1,i,0],[1,i,0],[-1,-i,0],[1,-i,0],[0,-1,i],[0,1,i],[0,-1,-i],[0,1,-i],[i,0,-1],[i,0,1],[-i,0,-1],[-i,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],t,e)};THREE.IcosahedronGeometry.prototype=new THREE.Geometry;THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.OctahedronGeometry=function(t,e){THREE.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],t,e)};THREE.OctahedronGeometry.prototype=new THREE.Geometry;THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;THREE.TetrahedronGeometry=function(t,e){THREE.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],t,e)};THREE.TetrahedronGeometry.prototype=new THREE.Geometry;THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;THREE.ParametricGeometry=function(t,e,i,o){THREE.Geometry.call(this);var r=this.vertices,n=this.faces,a=this.faceVertexUvs[0],o=o===void 0?false:o,s,l,c,h,m=e+1;for(s=0;s<=i;s++){h=s/i;for(l=0;l<=e;l++){c=l/e;c=t(c,h);r.push(c)}}var p,u,f,y;for(s=0;s<i;s++)for(l=0;l<e;l++){t=s*m+l;r=s*m+l+1;h=(s+1)*m+l;c=(s+1)*m+l+1;p=new THREE.UV(s/e,l/i);u=new THREE.UV(s/e,(l+1)/i);f=new THREE.UV((s+1)/e,l/i);y=new THREE.UV((s+1)/e,(l+1)/i);if(o){n.push(new THREE.Face3(t,r,h));n.push(new THREE.Face3(r,c,h));a.push([p,u,f]);a.push([u,y,f])}else{n.push(new THREE.Face4(t,r,c,h));a.push([p,u,f,y])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=new THREE.Geometry;THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;THREE.AxisHelper=function(){THREE.Object3D.call(this);var t=new THREE.Geometry;t.vertices.push(new THREE.Vector3);t.vertices.push(new THREE.Vector3(0,100,0));var e=new THREE.CylinderGeometry(0,5,25,5,1),i;i=new THREE.Line(t,new THREE.LineBasicMaterial({color:16711680}));i.rotation.z=-Math.PI/2;this.add(i);i=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:16711680}));i.position.x=100;i.rotation.z=-Math.PI/2;this.add(i);i=new THREE.Line(t,new THREE.LineBasicMaterial({color:65280}));this.add(i);i=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:65280}));i.position.y=100;this.add(i);i=new THREE.Line(t,new THREE.LineBasicMaterial({color:255}));i.rotation.x=Math.PI/2;this.add(i);i=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:255}));i.position.z=100;i.rotation.x=Math.PI/2;this.add(i)};THREE.AxisHelper.prototype=new THREE.Object3D;THREE.AxisHelper.prototype.constructor=THREE.AxisHelper;THREE.ArrowHelper=function(t,e,i,o){THREE.Object3D.call(this);o===void 0&&(o=16776960);i===void 0&&(i=20);var r=new THREE.Geometry;r.vertices.push(new THREE.Vector3(0,0,0));r.vertices.push(new THREE.Vector3(0,1,0));this.line=new THREE.Line(r,new THREE.LineBasicMaterial({color:o}));this.add(this.line);r=new THREE.CylinderGeometry(0,.05,.25,5,1);this.cone=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:o}));this.cone.position.set(0,1,0);this.add(this.cone);if(e instanceof THREE.Vector3)this.position=e;this.setDirection(t);this.setLength(i)};THREE.ArrowHelper.prototype=new THREE.Object3D;THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;THREE.ArrowHelper.prototype.setDirection=function(t){var e=new THREE.Vector3(0,1,0).crossSelf(t),t=Math.acos(new THREE.Vector3(0,1,0).dot(t.clone().normalize()));this.matrix=(new THREE.Matrix4).makeRotationAxis(e.normalize(),t);this.rotation.getRotationFromMatrix(this.matrix,this.scale)};THREE.ArrowHelper.prototype.setLength=function(t){this.scale.set(t,t,t)};THREE.ArrowHelper.prototype.setColor=function(t){this.line.material.color.setHex(t);this.cone.material.color.setHex(t)};THREE.CameraHelper=function(t){function e(t,e,o){i(t,o);i(e,o)}function i(t,e){o.lineGeometry.vertices.push(new THREE.Vector3);o.lineGeometry.colors.push(new THREE.Color(e));o.pointMap[t]===void 0&&(o.pointMap[t]=[]);o.pointMap[t].push(o.lineGeometry.vertices.length-1)}THREE.Object3D.call(this);var o=this;this.lineGeometry=new THREE.Geometry;this.lineMaterial=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors});this.pointMap={};e("n1","n2",16755200);e("n2","n4",16755200);e("n4","n3",16755200);e("n3","n1",16755200);e("f1","f2",16755200);e("f2","f4",16755200);e("f4","f3",16755200);e("f3","f1",16755200);e("n1","f1",16755200);e("n2","f2",16755200);e("n3","f3",16755200);e("n4","f4",16755200);e("p","n1",16711680);e("p","n2",16711680);e("p","n3",16711680);e("p","n4",16711680);e("u1","u2",43775);e("u2","u3",43775);e("u3","u1",43775);e("c","t",16777215);e("p","c",3355443);e("cn1","cn2",3355443);e("cn3","cn4",3355443);e("cf1","cf2",3355443);e("cf3","cf4",3355443);this.camera=t;this.update(t);this.lines=new THREE.Line(this.lineGeometry,this.lineMaterial,THREE.LinePieces);this.add(this.lines)};THREE.CameraHelper.prototype=new THREE.Object3D;THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;THREE.CameraHelper.prototype.update=function(){function t(t,i,o,r){THREE.CameraHelper.__v.set(i,o,r);THREE.CameraHelper.__projector.unprojectVector(THREE.CameraHelper.__v,THREE.CameraHelper.__c);t=e.pointMap[t];if(t!==void 0){i=0;for(o=t.length;i<o;i++)e.lineGeometry.vertices[t[i]].copy(THREE.CameraHelper.__v)}}var e=this;THREE.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix);t("c",0,0,-1);t("t",0,0,1);t("n1",-1,-1,-1);t("n2",1,-1,-1);t("n3",-1,1,-1);t("n4",1,1,-1);t("f1",-1,-1,1);t("f2",1,-1,1);t("f3",-1,1,1);t("f4",1,1,1);t("u1",.7,1.1,-1);t("u2",-.7,1.1,-1);t("u3",0,2,-1);t("cf1",-1,0,1);t("cf2",1,0,1);t("cf3",0,-1,1);t("cf4",0,1,1);t("cn1",-1,0,-1);t("cn2",1,0,-1);t("cn3",0,-1,-1);t("cn4",0,1,-1);this.lineGeometry.verticesNeedUpdate=true};THREE.CameraHelper.__projector=new THREE.Projector;THREE.CameraHelper.__v=new THREE.Vector3;THREE.CameraHelper.__c=new THREE.Camera;THREE.SubdivisionModifier=function(t){this.subdivisions=t===void 0?1:t;this.useOldVertexColors=false;this.supportUVs=true;this.debug=false};THREE.SubdivisionModifier.prototype.constructor=THREE.SubdivisionModifier;THREE.SubdivisionModifier.prototype.modify=function(t){for(var e=this.subdivisions;e-- >0;)this.smooth(t)};THREE.SubdivisionModifier.prototype.smooth=function(t){function e(){p.debug&&console.log.apply(console,arguments)}function i(){console&&console.log.apply(console,arguments)}function o(t,i,o,r,a,s,l){var c=new THREE.Face4(t,i,o,r,null,a.color,a.material);if(p.useOldVertexColors){c.vertexColors=[];for(var u,f,y,d=0;d<4;d++){y=s[d];u=new THREE.Color;u.setRGB(0,0,0);for(var _=0;_<y.length;_++){f=a.vertexColors[y[_]-1];u.r=u.r+f.r;u.g=u.g+f.g;u.b=u.b+f.b}u.r=u.r/y.length;u.g=u.g/y.length;u.b=u.b/y.length;c.vertexColors[d]=u}}h.push(c);if(p.supportUVs){a=[n(t,""),n(i,l),n(o,l),n(r,l)];a[0]?a[1]?a[2]?a[3]?m.push(a):e("d :( ",r+":"+l):e("c :( ",o+":"+l):e("b :( ",i+":"+l):e("a :( ",t+":"+l)}}function r(t,e){return Math.min(t,e)+"_"+Math.max(t,e)}function n(t,o){var r=t+":"+o,n=v[r];if(!n){t>=x&&t<x+f.length?e("face pt"):e("edge pt");i("warning, UV not found for",r);return null}return n}function a(t,e,o){var r=t+":"+e;r in v?i("dup vertexNo",t,"oldFaceNo",e,"value",o,"key",r,v[r]):v[r]=o}function s(t,e){M[t]===void 0&&(M[t]=[]);M[t].push(e)}function l(t,e,i){D[t]===void 0&&(D[t]={});D[t][e]=i}var c=[],h=[],m=[],p=this,u=t.vertices,f=t.faces,c=u.concat(),y=[],d={},_={},v={},x=u.length,E,g,b,T,R,w=t.faceVertexUvs[0],S;e("originalFaces, uvs, originalVerticesLength",f.length,w.length,x);if(p.supportUVs){E=0;for(g=w.length;E<g;E++){b=0;for(T=w[E].length;b<T;b++){S=f[E]["abcd".charAt(b)];a(S,E,w[E][b])}}}if(w.length==0)p.supportUVs=false;E=0;for(R in v)E++;if(!E){p.supportUVs=false;e("no uvs")}e("-- Original Faces + Vertices UVs completed",v,"vs",w.length);E=0;for(g=f.length;E<g;E++){R=f[E];y.push(R.centroid);c.push(R.centroid);if(p.supportUVs){w=new THREE.UV;if(R instanceof THREE.Face3){w.u=n(R.a,E).u+n(R.b,E).u+n(R.c,E).u;w.v=n(R.a,E).v+n(R.b,E).v+n(R.c,E).v;w.u=w.u/3;w.v=w.v/3}else if(R instanceof THREE.Face4){w.u=n(R.a,E).u+n(R.b,E).u+n(R.c,E).u+n(R.d,E).u;w.v=n(R.a,E).v+n(R.b,E).v+n(R.c,E).v+n(R.d,E).v;w.u=w.u/4;w.v=w.v/4}a(x+E,"",w)}}e("-- added UVs for new Faces",v);g=function(t){function e(t,e){s[t]===void 0&&(s[t]=[]);s[t].push(e)}var i,o,n,a,s={};i=0;for(o=t.faces.length;i<o;i++){n=t.faces[i];if(n instanceof THREE.Face3){a=r(n.a,n.b);e(a,i);a=r(n.b,n.c);e(a,i);a=r(n.c,n.a);e(a,i)}else if(n instanceof THREE.Face4){a=r(n.a,n.b);e(a,i);a=r(n.b,n.c);e(a,i);a=r(n.c,n.d);e(a,i);a=r(n.d,n.a);e(a,i)}}return s}(t);S=0;var C,A,M={},D={};for(E in g){w=g[E];C=E.split("_");A=C[0];C=C[1];s(A,[A,C]);s(C,[A,C]);b=0;for(T=w.length;b<T;b++){R=w[b];l(A,R,E);l(C,R,E)}w.length<2&&(_[E]=true)}e("vertexEdgeMap",M,"vertexFaceMap",D);for(E in g){w=g[E];R=w[0];T=w[1];C=E.split("_");A=C[0];C=C[1];w=new THREE.Vector3;if(_[E]){w.addSelf(u[A]);w.addSelf(u[C]);w.multiplyScalar(.5)}else{w.addSelf(y[R]);w.addSelf(y[T]);w.addSelf(u[A]);w.addSelf(u[C]);w.multiplyScalar(.25)}d[E]=x+f.length+S;c.push(w);S++;if(p.supportUVs){w=new THREE.UV;w.u=n(A,R).u+n(C,R).u;w.v=n(A,R).v+n(C,R).v;w.u=w.u/2;w.v=w.v/2;a(d[E],R,w);if(!_[E]){w=new THREE.UV;w.u=n(A,T).u+n(C,T).u;w.v=n(A,T).v+n(C,T).v;w.u=w.u/2;w.v=w.v/2;a(d[E],T,w)}}}e("-- Step 2 done");var B,H;T=["123","12","2","23"];C=["123","23","3","31"];var V=["123","31","1","12"],L=["1234","12","2","23"],P=["1234","23","3","34"],F=["1234","34","4","41"],I=["1234","41","1","12"];E=0;for(g=y.length;E<g;E++){R=f[E];w=x+E;if(R instanceof THREE.Face3){S=r(R.a,R.b);A=r(R.b,R.c);B=r(R.c,R.a);o(w,d[S],R.b,d[A],R,T,E);o(w,d[A],R.c,d[B],R,C,E);o(w,d[B],R.a,d[S],R,V,E)}else if(R instanceof THREE.Face4){S=r(R.a,R.b);A=r(R.b,R.c);B=r(R.c,R.d);H=r(R.d,R.a);o(w,d[S],R.b,d[A],R,L,E);o(w,d[A],R.c,d[B],R,P,E);o(w,d[B],R.d,d[H],R,F,E);o(w,d[H],R.a,d[S],R,I,E)}else e("face should be a face!",R)}d=new THREE.Vector3;R=new THREE.Vector3;E=0;for(g=u.length;E<g;E++)if(M[E]!==void 0){d.set(0,0,0);R.set(0,0,0);A=new THREE.Vector3(0,0,0);w=0;for(b in D[E]){d.addSelf(y[b]);w++}T=0;S=M[E].length;for(b=0;b<S;b++)_[r(M[E][b][0],M[E][b][1])]&&T++;if(T!=2){d.divideScalar(w);for(b=0;b<S;b++){w=M[E][b];w=u[w[0]].clone().addSelf(u[w[1]]).divideScalar(2);R.addSelf(w)}R.divideScalar(S);A.addSelf(u[E]);A.multiplyScalar(S-3);A.addSelf(d);A.addSelf(R.multiplyScalar(2));A.divideScalar(S);c[E]=A}}t.vertices=c;t.faces=h;t.faceVertexUvs[0]=m;delete t.__tmpVertices;t.computeCentroids();t.computeFaceNormals();t.computeVertexNormals()};THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(){}};THREE.ImmediateRenderObject.prototype=new THREE.Object3D;THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;THREE.LensFlare=function(t,e,i,o,r){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;t!==void 0&&this.add(t,e,i,o,r)};THREE.LensFlare.prototype=new THREE.Object3D;THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.supr=THREE.Object3D.prototype;THREE.LensFlare.prototype.add=function(t,e,i,o,r,n){e===void 0&&(e=-1);i===void 0&&(i=0);n===void 0&&(n=1);r===void 0&&(r=new THREE.Color(16777215));if(o===void 0)o=THREE.NormalBlending;i=Math.min(i,Math.max(0,i));this.lensFlares.push({texture:t,size:e,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:n,color:r,blending:o})};THREE.LensFlare.prototype.updateLensFlares=function(){var t,e=this.lensFlares.length,i,o=-this.positionScreen.x*2,r=-this.positionScreen.y*2;for(t=0;t<e;t++){i=this.lensFlares[t];i.x=this.positionScreen.x+o*i.distance;i.y=this.positionScreen.y+r*i.distance;i.wantedRotation=i.x*Math.PI*.25;i.rotation=i.rotation+(i.wantedRotation-i.rotation)*.25}};THREE.MorphBlendMesh=function(t,e){THREE.Mesh.call(this,t,e);this.animationsMap={};this.animationsList=[];var i=this.geometry.morphTargets.length;this.createAnimation("__default",0,i-1,i/1);this.setAnimationWeight("__default",1)};THREE.MorphBlendMesh.prototype=new THREE.Mesh;THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh;THREE.MorphBlendMesh.prototype.createAnimation=function(t,e,i,o){e={startFrame:e,endFrame:i,length:i-e+1,fps:o,duration:(i-e)/o,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[t]=e;this.animationsList.push(e)};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(t){for(var e=/([a-z]+)(\d+)/,i,o={},r=this.geometry,n=0,a=r.morphTargets.length;n<a;n++){var s=r.morphTargets[n].name.match(e);if(s&&s.length>1){var l=s[1];o[l]||(o[l]={start:Infinity,end:-Infinity});s=o[l];if(n<s.start)s.start=n;if(n>s.end)s.end=n;i||(i=l)}}for(l in o){s=o[l];this.createAnimation(l,s.start,s.end,t)}this.firstAnimation=i};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(t){if(t=this.animationsMap[t]){t.direction=1;t.directionBackwards=false}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(t){if(t=this.animationsMap[t]){t.direction=-1;t.directionBackwards=true}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(t,e){var i=this.animationsMap[t];if(i){i.fps=e;i.duration=(i.end-i.start)/i.fps}};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(t,e){var i=this.animationsMap[t];if(i){i.duration=e;i.fps=(i.end-i.start)/i.duration}};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(t,e){var i=this.animationsMap[t];if(i)i.weight=e};THREE.MorphBlendMesh.prototype.setAnimationTime=function(t,e){var i=this.animationsMap[t];if(i)i.time=e};THREE.MorphBlendMesh.prototype.getAnimationTime=function(t){var e=0;if(t=this.animationsMap[t])e=t.time;return e};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(t){var e=-1;if(t=this.animationsMap[t])e=t.duration;return e};THREE.MorphBlendMesh.prototype.playAnimation=function(t){var e=this.animationsMap[t];if(e){e.time=0;e.active=true}else console.warn("animation["+t+"] undefined")};THREE.MorphBlendMesh.prototype.stopAnimation=function(t){if(t=this.animationsMap[t])t.active=false};THREE.MorphBlendMesh.prototype.update=function(t){for(var e=0,i=this.animationsList.length;e<i;e++){var o=this.animationsList[e];if(o.active){var r=o.duration/o.length;o.time=o.time+o.direction*t;if(o.mirroredLoop){if(o.time>o.duration||o.time<0){o.direction=o.direction*-1;if(o.time>o.duration){o.time=o.duration;o.directionBackwards=true}if(o.time<0){o.time=0;o.directionBackwards=false}}}else{o.time=o.time%o.duration;if(o.time<0)o.time=o.time+o.duration}var n=o.startFrame+THREE.Math.clamp(Math.floor(o.time/r),0,o.length-1),a=o.weight;if(n!==o.currentFrame){this.morphTargetInfluences[o.lastFrame]=0;this.morphTargetInfluences[o.currentFrame]=1*a;this.morphTargetInfluences[n]=0;o.lastFrame=o.currentFrame;o.currentFrame=n}r=o.time%r/r;o.directionBackwards&&(r=1-r);this.morphTargetInfluences[o.currentFrame]=r*a;this.morphTargetInfluences[o.lastFrame]=(1-r)*a}}};THREE.LensFlarePlugin=function(){function t(t){var i=e.createProgram(),o=e.createShader(e.FRAGMENT_SHADER),r=e.createShader(e.VERTEX_SHADER);e.shaderSource(o,t.fragmentShader);e.shaderSource(r,t.vertexShader);e.compileShader(o);e.compileShader(r);e.attachShader(i,o);e.attachShader(i,r);e.linkProgram(i);return i}var e,i,o,r,n,a,s,l,c,h,m,p,u;this.init=function(f){e=f.context;i=f;o=new Float32Array(16);r=new Uint16Array(6);f=0;o[f++]=-1;o[f++]=-1;o[f++]=0;o[f++]=0;o[f++]=1;o[f++]=-1;o[f++]=1;o[f++]=0;o[f++]=1;o[f++]=1;o[f++]=1;o[f++]=1;o[f++]=-1;o[f++]=1;o[f++]=0;o[f++]=1;f=0;r[f++]=0;r[f++]=1;r[f++]=2;r[f++]=0;r[f++]=2;r[f++]=3;n=e.createBuffer();a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);e.bufferData(e.ARRAY_BUFFER,o,e.STATIC_DRAW);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a);e.bufferData(e.ELEMENT_ARRAY_BUFFER,r,e.STATIC_DRAW);s=e.createTexture();l=e.createTexture();e.bindTexture(e.TEXTURE_2D,s);e.texImage2D(e.TEXTURE_2D,0,e.RGB,16,16,0,e.RGB,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST);e.bindTexture(e.TEXTURE_2D,l);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,16,16,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST);if(e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){c=false;h=t(THREE.ShaderFlares.lensFlare)}else{c=true;h=t(THREE.ShaderFlares.lensFlareVertexTexture)}m={};p={};m.vertex=e.getAttribLocation(h,"position");m.uv=e.getAttribLocation(h,"uv");p.renderType=e.getUniformLocation(h,"renderType");p.map=e.getUniformLocation(h,"map");p.occlusionMap=e.getUniformLocation(h,"occlusionMap");p.opacity=e.getUniformLocation(h,"opacity");p.color=e.getUniformLocation(h,"color");p.scale=e.getUniformLocation(h,"scale");p.rotation=e.getUniformLocation(h,"rotation");p.screenPosition=e.getUniformLocation(h,"screenPosition");u=false};this.render=function(t,o,r,f){var t=t.__webglFlares,y=t.length;if(y){var d=new THREE.Vector3,_=f/r,v=r*.5,x=f*.5,E=16/f,g=new THREE.Vector2(E*_,E),b=new THREE.Vector3(1,1,0),T=new THREE.Vector2(1,1),R=p,E=m;e.useProgram(h);if(!u){e.enableVertexAttribArray(m.vertex);e.enableVertexAttribArray(m.uv);u=true}e.uniform1i(R.occlusionMap,0);e.uniform1i(R.map,1);e.bindBuffer(e.ARRAY_BUFFER,n);e.vertexAttribPointer(E.vertex,2,e.FLOAT,false,16,0);e.vertexAttribPointer(E.uv,2,e.FLOAT,false,16,8);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a);e.disable(e.CULL_FACE);e.depthMask(false);var w,S,C,A,M;for(w=0;w<y;w++){E=16/f;g.set(E*_,E);A=t[w];d.set(A.matrixWorld.elements[12],A.matrixWorld.elements[13],A.matrixWorld.elements[14]);o.matrixWorldInverse.multiplyVector3(d);o.projectionMatrix.multiplyVector3(d);b.copy(d);T.x=b.x*v+v;T.y=b.y*x+x;if(c||T.x>0&&T.x<r&&T.y>0&&T.y<f){e.activeTexture(e.TEXTURE1);e.bindTexture(e.TEXTURE_2D,s);e.copyTexImage2D(e.TEXTURE_2D,0,e.RGB,T.x-8,T.y-8,16,16,0);e.uniform1i(R.renderType,0);e.uniform2f(R.scale,g.x,g.y);e.uniform3f(R.screenPosition,b.x,b.y,b.z);e.disable(e.BLEND);e.enable(e.DEPTH_TEST);e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0);e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,l);e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,T.x-8,T.y-8,16,16,0);e.uniform1i(R.renderType,1);e.disable(e.DEPTH_TEST);e.activeTexture(e.TEXTURE1);e.bindTexture(e.TEXTURE_2D,s);e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0);A.positionScreen.copy(b);A.customUpdateCallback?A.customUpdateCallback(A):A.updateLensFlares();e.uniform1i(R.renderType,2);e.enable(e.BLEND);S=0;for(C=A.lensFlares.length;S<C;S++){M=A.lensFlares[S];if(M.opacity>.001&&M.scale>.001){b.x=M.x;b.y=M.y;b.z=M.z;E=M.size*M.scale/f;g.x=E*_;g.y=E;e.uniform3f(R.screenPosition,b.x,b.y,b.z);e.uniform2f(R.scale,g.x,g.y);e.uniform1f(R.rotation,M.rotation);e.uniform1f(R.opacity,M.opacity);e.uniform3f(R.color,M.color.r,M.color.g,M.color.b);i.setBlending(M.blending,M.blendEquation,M.blendSrc,M.blendDst);i.setTexture(M.texture,1);e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}}}}e.enable(e.CULL_FACE);e.enable(e.DEPTH_TEST);e.depthMask(true)}}};THREE.ShadowMapPlugin=function(){var t,e,i,o,r=new THREE.Frustum,n=new THREE.Matrix4,a=new THREE.Vector3,s=new THREE.Vector3;this.init=function(r){t=r.context;e=r;var r=THREE.ShaderLib.depthRGBA,n=THREE.UniformsUtils.clone(r.uniforms);i=new THREE.ShaderMaterial({fragmentShader:r.fragmentShader,vertexShader:r.vertexShader,uniforms:n});o=new THREE.ShaderMaterial({fragmentShader:r.fragmentShader,vertexShader:r.vertexShader,uniforms:n,morphTargets:true});i._shadowPass=true;o._shadowPass=true};this.render=function(t,i){e.shadowMapEnabled&&e.shadowMapAutoUpdate&&this.update(t,i)};this.update=function(l,c){var h,m,p,u,f,y,d,_,v,x=[];u=0;t.clearColor(1,1,1,1);t.disable(t.BLEND);t.enable(t.CULL_FACE);e.shadowMapCullFrontFaces?t.cullFace(t.FRONT):t.cullFace(t.BACK);e.setDepthTest(true);h=0;for(m=l.__lights.length;h<m;h++){p=l.__lights[h];if(p.castShadow)if(p instanceof THREE.DirectionalLight&&p.shadowCascade)for(f=0;f<p.shadowCascadeCount;f++){var E;if(p.shadowCascadeArray[f])E=p.shadowCascadeArray[f];else{v=p;d=f;E=new THREE.DirectionalLight;E.isVirtual=true;E.onlyShadow=true;E.castShadow=true;E.shadowCameraNear=v.shadowCameraNear;E.shadowCameraFar=v.shadowCameraFar;E.shadowCameraLeft=v.shadowCameraLeft;E.shadowCameraRight=v.shadowCameraRight;E.shadowCameraBottom=v.shadowCameraBottom;E.shadowCameraTop=v.shadowCameraTop;E.shadowCameraVisible=v.shadowCameraVisible;E.shadowDarkness=v.shadowDarkness;E.shadowBias=v.shadowCascadeBias[d];E.shadowMapWidth=v.shadowCascadeWidth[d];E.shadowMapHeight=v.shadowCascadeHeight[d];E.pointsWorld=[];E.pointsFrustum=[];_=E.pointsWorld;y=E.pointsFrustum;for(var g=0;g<8;g++){_[g]=new THREE.Vector3;y[g]=new THREE.Vector3}_=v.shadowCascadeNearZ[d];v=v.shadowCascadeFarZ[d];y[0].set(-1,-1,_);y[1].set(1,-1,_);y[2].set(-1,1,_);y[3].set(1,1,_);y[4].set(-1,-1,v);y[5].set(1,-1,v);y[6].set(-1,1,v);y[7].set(1,1,v);E.originalCamera=c;y=new THREE.Gyroscope;y.position=p.shadowCascadeOffset;y.add(E);y.add(E.target);c.add(y);p.shadowCascadeArray[f]=E;console.log("Created virtualLight",E)}d=p;_=f;v=d.shadowCascadeArray[_];v.position.copy(d.position);v.target.position.copy(d.target.position);v.lookAt(v.target);v.shadowCameraVisible=d.shadowCameraVisible;v.shadowDarkness=d.shadowDarkness;v.shadowBias=d.shadowCascadeBias[_];y=d.shadowCascadeNearZ[_];d=d.shadowCascadeFarZ[_];v=v.pointsFrustum;v[0].z=y;v[1].z=y;v[2].z=y;v[3].z=y;v[4].z=d;v[5].z=d;v[6].z=d;v[7].z=d;x[u]=E;u++}else{x[u]=p;u++}}h=0;for(m=x.length;h<m;h++){p=x[h];if(!p.shadowMap){p.shadowMap=new THREE.WebGLRenderTarget(p.shadowMapWidth,p.shadowMapHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat});p.shadowMapSize=new THREE.Vector2(p.shadowMapWidth,p.shadowMapHeight);p.shadowMatrix=new THREE.Matrix4}if(!p.shadowCamera){if(p instanceof THREE.SpotLight)p.shadowCamera=new THREE.PerspectiveCamera(p.shadowCameraFov,p.shadowMapWidth/p.shadowMapHeight,p.shadowCameraNear,p.shadowCameraFar);else if(p instanceof THREE.DirectionalLight)p.shadowCamera=new THREE.OrthographicCamera(p.shadowCameraLeft,p.shadowCameraRight,p.shadowCameraTop,p.shadowCameraBottom,p.shadowCameraNear,p.shadowCameraFar);else{console.error("Unsupported light type for shadow");continue}l.add(p.shadowCamera);e.autoUpdateScene&&l.updateMatrixWorld()}if(p.shadowCameraVisible&&!p.cameraHelper){p.cameraHelper=new THREE.CameraHelper(p.shadowCamera);p.shadowCamera.add(p.cameraHelper)}if(p.isVirtual&&E.originalCamera==c){f=c;u=p.shadowCamera;y=p.pointsFrustum;v=p.pointsWorld;a.set(Infinity,Infinity,Infinity);s.set(-Infinity,-Infinity,-Infinity);for(d=0;d<8;d++){_=v[d];_.copy(y[d]);THREE.ShadowMapPlugin.__projector.unprojectVector(_,f);u.matrixWorldInverse.multiplyVector3(_);if(_.x<a.x)a.x=_.x;if(_.x>s.x)s.x=_.x;if(_.y<a.y)a.y=_.y;if(_.y>s.y)s.y=_.y;if(_.z<a.z)a.z=_.z;if(_.z>s.z)s.z=_.z}u.left=a.x;u.right=s.x;u.top=s.y;u.bottom=a.y;u.updateProjectionMatrix()}u=p.shadowMap;y=p.shadowMatrix;f=p.shadowCamera;f.position.copy(p.matrixWorld.getPosition());f.lookAt(p.target.matrixWorld.getPosition());f.updateMatrixWorld();f.matrixWorldInverse.getInverse(f.matrixWorld);if(p.cameraHelper)p.cameraHelper.lines.visible=p.shadowCameraVisible;p.shadowCameraVisible&&p.cameraHelper.update();y.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);y.multiplySelf(f.projectionMatrix);y.multiplySelf(f.matrixWorldInverse);if(!f._viewMatrixArray)f._viewMatrixArray=new Float32Array(16);if(!f._projectionMatrixArray)f._projectionMatrixArray=new Float32Array(16);f.matrixWorldInverse.flattenToArray(f._viewMatrixArray);f.projectionMatrix.flattenToArray(f._projectionMatrixArray);n.multiply(f.projectionMatrix,f.matrixWorldInverse);r.setFromMatrix(n);e.setRenderTarget(u);e.clear();v=l.__webglObjects;p=0;for(u=v.length;p<u;p++){d=v[p];y=d.object;d.render=false;if(y.visible&&y.castShadow&&(!(y instanceof THREE.Mesh)||!y.frustumCulled||r.contains(y))){y._modelViewMatrix.multiply(f.matrixWorldInverse,y.matrixWorld);d.render=true}}p=0;for(u=v.length;p<u;p++){d=v[p];if(d.render){y=d.object;d=d.buffer;_=y.customDepthMaterial?y.customDepthMaterial:y.geometry.morphTargets.length?o:i;d instanceof THREE.BufferGeometry?e.renderBufferDirect(f,l.__lights,null,_,d,y):e.renderBuffer(f,l.__lights,null,_,d,y)}}v=l.__webglObjectsImmediate;p=0;for(u=v.length;p<u;p++){d=v[p];y=d.object;if(y.visible&&y.castShadow){y._modelViewMatrix.multiply(f.matrixWorldInverse,y.matrixWorld);e.renderImmediateObject(f,l.__lights,null,i,y)}}}h=e.getClearColor();m=e.getClearAlpha();t.clearColor(h.r,h.g,h.b,m);t.enable(t.BLEND);e.shadowMapCullFrontFaces&&t.cullFace(t.BACK)}};THREE.ShadowMapPlugin.__projector=new THREE.Projector;THREE.SpritePlugin=function(){function t(t,e){return e.z-t.z}var e,i,o,r,n,a,s,l,c,h;this.init=function(t){e=t.context;i=t;o=new Float32Array(16);r=new Uint16Array(6);t=0;o[t++]=-1;o[t++]=-1;o[t++]=0;o[t++]=1;o[t++]=1;o[t++]=-1;o[t++]=1;o[t++]=1;o[t++]=1;o[t++]=1;o[t++]=1;o[t++]=0;o[t++]=-1;o[t++]=1;o[t++]=0;t=o[t++]=0;r[t++]=0;r[t++]=1;r[t++]=2;r[t++]=0;r[t++]=2;r[t++]=3;n=e.createBuffer();a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);e.bufferData(e.ARRAY_BUFFER,o,e.STATIC_DRAW);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a);e.bufferData(e.ELEMENT_ARRAY_BUFFER,r,e.STATIC_DRAW);var t=THREE.ShaderSprite.sprite,m=e.createProgram(),p=e.createShader(e.FRAGMENT_SHADER),u=e.createShader(e.VERTEX_SHADER);e.shaderSource(p,t.fragmentShader);e.shaderSource(u,t.vertexShader);e.compileShader(p);e.compileShader(u);e.attachShader(m,p);e.attachShader(m,u);e.linkProgram(m);s=m;l={};c={};l.position=e.getAttribLocation(s,"position");l.uv=e.getAttribLocation(s,"uv");c.uvOffset=e.getUniformLocation(s,"uvOffset");c.uvScale=e.getUniformLocation(s,"uvScale");c.rotation=e.getUniformLocation(s,"rotation");c.scale=e.getUniformLocation(s,"scale");c.alignment=e.getUniformLocation(s,"alignment");c.color=e.getUniformLocation(s,"color");c.map=e.getUniformLocation(s,"map");c.opacity=e.getUniformLocation(s,"opacity");c.useScreenCoordinates=e.getUniformLocation(s,"useScreenCoordinates");c.affectedByDistance=e.getUniformLocation(s,"affectedByDistance");c.screenPosition=e.getUniformLocation(s,"screenPosition");c.modelViewMatrix=e.getUniformLocation(s,"modelViewMatrix");c.projectionMatrix=e.getUniformLocation(s,"projectionMatrix");h=false};this.render=function(o,r,m,p){var o=o.__webglSprites,u=o.length;if(u){var f=l,y=c,d=p/m,m=m*.5,_=p*.5,v=true;e.useProgram(s);if(!h){e.enableVertexAttribArray(f.position);e.enableVertexAttribArray(f.uv);h=true}e.disable(e.CULL_FACE);e.enable(e.BLEND);e.depthMask(true);e.bindBuffer(e.ARRAY_BUFFER,n);e.vertexAttribPointer(f.position,2,e.FLOAT,false,16,0);e.vertexAttribPointer(f.uv,2,e.FLOAT,false,16,8);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a);e.uniformMatrix4fv(y.projectionMatrix,false,r._projectionMatrixArray);e.activeTexture(e.TEXTURE0);e.uniform1i(y.map,0);for(var x,E=[],f=0;f<u;f++){x=o[f];if(x.visible&&x.opacity!==0)if(x.useScreenCoordinates)x.z=-x.position.z;else{x._modelViewMatrix.multiply(r.matrixWorldInverse,x.matrixWorld);x.z=-x._modelViewMatrix.elements[14]}}o.sort(t);for(f=0;f<u;f++){x=o[f];if(x.visible&&x.opacity!==0&&x.map&&x.map.image&&x.map.image.width){if(x.useScreenCoordinates){e.uniform1i(y.useScreenCoordinates,1);e.uniform3f(y.screenPosition,(x.position.x-m)/m,(_-x.position.y)/_,Math.max(0,Math.min(1,x.position.z)))}else{e.uniform1i(y.useScreenCoordinates,0);e.uniform1i(y.affectedByDistance,x.affectedByDistance?1:0);e.uniformMatrix4fv(y.modelViewMatrix,false,x._modelViewMatrix.elements)}r=x.map.image.width/(x.scaleByViewport?p:1);E[0]=r*d*x.scale.x;E[1]=r*x.scale.y;e.uniform2f(y.uvScale,x.uvScale.x,x.uvScale.y);e.uniform2f(y.uvOffset,x.uvOffset.x,x.uvOffset.y);e.uniform2f(y.alignment,x.alignment.x,x.alignment.y);e.uniform1f(y.opacity,x.opacity);e.uniform3f(y.color,x.color.r,x.color.g,x.color.b);e.uniform1f(y.rotation,x.rotation);e.uniform2fv(y.scale,E);if(x.mergeWith3D&&!v){e.enable(e.DEPTH_TEST);v=true}else if(!x.mergeWith3D&&v){e.disable(e.DEPTH_TEST);v=false}i.setBlending(x.blending,x.blendEquation,x.blendSrc,x.blendDst);i.setTexture(x.map,0);e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}}e.enable(e.CULL_FACE);e.enable(e.DEPTH_TEST);e.depthMask(true)}}};THREE.DepthPassPlugin=function(){this.enabled=false;this.renderTarget=null;var t,e,i,o,r=new THREE.Frustum,n=new THREE.Matrix4;this.init=function(r){t=r.context;e=r;var r=THREE.ShaderLib.depthRGBA,n=THREE.UniformsUtils.clone(r.uniforms);i=new THREE.ShaderMaterial({fragmentShader:r.fragmentShader,vertexShader:r.vertexShader,uniforms:n});o=new THREE.ShaderMaterial({fragmentShader:r.fragmentShader,vertexShader:r.vertexShader,uniforms:n,morphTargets:true});i._shadowPass=true;o._shadowPass=true};this.render=function(t,e){this.enabled&&this.update(t,e)};this.update=function(a,s){var l,c,h,m,p,u;t.clearColor(1,1,1,1);t.disable(t.BLEND);e.setDepthTest(true);e.autoUpdateScene&&a.updateMatrixWorld();if(!s._viewMatrixArray)s._viewMatrixArray=new Float32Array(16);if(!s._projectionMatrixArray)s._projectionMatrixArray=new Float32Array(16);s.matrixWorldInverse.getInverse(s.matrixWorld);s.matrixWorldInverse.flattenToArray(s._viewMatrixArray);s.projectionMatrix.flattenToArray(s._projectionMatrixArray);n.multiply(s.projectionMatrix,s.matrixWorldInverse);r.setFromMatrix(n);e.setRenderTarget(this.renderTarget);e.clear();u=a.__webglObjects;l=0;for(c=u.length;l<c;l++){h=u[l];p=h.object;h.render=false;if(p.visible&&(!(p instanceof THREE.Mesh)||!p.frustumCulled||r.contains(p))){p._modelViewMatrix.multiply(s.matrixWorldInverse,p.matrixWorld);h.render=true}}l=0;for(c=u.length;l<c;l++){h=u[l];if(h.render){p=h.object;h=h.buffer;e.setObjectFaces(p);m=p.customDepthMaterial?p.customDepthMaterial:p.geometry.morphTargets.length?o:i;h instanceof THREE.BufferGeometry?e.renderBufferDirect(s,a.__lights,null,m,h,p):e.renderBuffer(s,a.__lights,null,m,h,p)}}u=a.__webglObjectsImmediate;l=0;for(c=u.length;l<c;l++){h=u[l];p=h.object;if(p.visible&&p.castShadow){p._modelViewMatrix.multiply(s.matrixWorldInverse,p.matrixWorld);e.renderImmediateObject(s,a.__lights,null,i,p)}}l=e.getClearColor();c=e.getClearAlpha();t.clearColor(l.r,l.g,l.b,c);t.enable(t.BLEND)}};THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}};THREE.ShaderSprite={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"precision mediump float;\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"}};module.exports={Maze:Maze,Box2D:Box2D,THREE:THREE};